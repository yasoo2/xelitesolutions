import{r as n,j as t,A as se}from"./index-BgXb08TP.js";function At({wsUrl:H,minimal:m}){var Ke,Je,Ye;const je=n.useRef(null),F=n.useRef(null),S=n.useRef(null),[g,Re]=n.useState({w:1280,h:800}),U=n.useRef({w:1280,h:800}),[j,z]=n.useState("connecting"),[Q,D]=n.useState(""),[v,O]=n.useState(""),[Ce,Te]=n.useState([]),[P,Ee]=n.useState(""),Ie=n.useRef(""),[L,_]=n.useState([]),[Me,I]=n.useState(""),[R,ie]=n.useState("console"),[Ne,le]=n.useState(!1),[Be,ce]=n.useState([]),[Fe,de]=n.useState([]),[Ae,X]=n.useState(1),[C,ze]=n.useState(!1),[He,Qe]=n.useState(!1),[ue,pe]=n.useState(!1),[Xe,he]=n.useState(5),[Ze,be]=n.useState(50),[Ge,ye]=n.useState(!0),[Ve,et]=n.useState(0),[tt,Rt]=n.useState('{"list":{"selector":"a[href^=\\"https\\"]:not([href*=\\"google.com\\"])","fields":{"text":{"selector":"","attr":""},"url":{"selector":"","attr":"href"}}}}'),[Ct,xe]=n.useState(null),[ge,rt]=n.useState(""),De=n.useRef(null),[fe,$]=n.useState(null),[W,ot]=n.useState(!0),[Z,Le]=n.useState(""),[T,$e]=n.useState(""),[q,G]=n.useState(null),[V,Tt]=n.useState(""),[ee,Et]=n.useState(""),[We,It]=n.useState(!0),[nt,Mt]=n.useState(!0),[at,Nt]=n.useState(!0),[st,Bt]=n.useState("أضرار التدخين"),te=n.useRef(0),re=n.useRef(null),oe=n.useRef(null),K=n.useRef(0),[f,me]=n.useState(!1),[it,Ue]=n.useState(!1),[ne,Oe]=n.useState(!1),[M,lt]=n.useState(null),[ae,ct]=n.useState(!1),[Pe,dt]=n.useState(!0),[E,_e]=n.useState([]),[A,ut]=n.useState(!1),[J,ve]=n.useState(0);n.useEffect(()=>{m&&(le(!1),ze(!1),X(1),pe(!1),me(!1))},[m]),n.useEffect(()=>{U.current=g},[g]),n.useEffect(()=>{Ie.current=P},[P]),n.useEffect(()=>{const e=()=>{Qe(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),e(),()=>document.removeEventListener("fullscreenchange",e)},[]);function ke(){try{const o=new URL(H).pathname.split("/").filter(Boolean);return o[o.length-1]}catch{return""}}function we(e){try{const o=new URL(e);return o.protocol==="ws:"&&(o.protocol="http:"),o.protocol==="wss:"&&(o.protocol="https:"),o.toString()}catch{try{const o=new URL(H);return o.protocol==="ws:"&&(o.protocol="http:"),o.protocol==="wss:"&&(o.protocol="https:"),o.search="",o.hash="",o.pathname="/",new URL(e,o.toString()).toString()}catch{return e}}}function N(e){const o=e.trim();if(!o)return"";try{return new URL(o).toString()}catch{try{return new URL(`https://${o}`).toString()}catch{return o}}}async function a(e){var s;const o=ke();if(!o)return;const l=["mouseMove","click","scroll","type","press","goBack","goForward","reload","goto","screenshot","tab.new","tab.switch","tab.close","tabs.list","pick","stream.setFps","stream.setQuality","redaction.set"];if(S.current&&S.current.readyState===WebSocket.OPEN&&e.every(p=>l.includes(p.type))){e.forEach(d=>{var h;(h=S.current)==null||h.send(JSON.stringify({type:"action",action:d}))});const p=e.map(d=>d.type).join(", ");if(I(p),setTimeout(()=>I(""),1200),W&&e.some(d=>d.type==="press"&&d.key==="Enter")&&setTimeout(()=>Y(),2e3),W&&e.some(d=>d.type==="reload")&&setTimeout(()=>Y(),1500),e.some(d=>d.type==="goto"||d.type==="reload")){if(G(null),We){const d=[];T?d.push({type:"locate",selector:T}):V&&ee&&d.push({type:"locate",role:V,roleName:ee}),d.length&&setTimeout(()=>a(d),1e3)}W&&setTimeout(()=>Y(),1500)}return}try{const p=localStorage.getItem("token"),h=await(await fetch(`${se}/tools/browser_run/execute`,{method:"POST",headers:{"Content-Type":"application/json",...p?{Authorization:`Bearer ${p}`}:{}},body:JSON.stringify({sessionId:o,actions:e})})).json();if(Array.isArray(h.artifacts)){const u=h.artifacts.map(x=>({name:x.name||x.filename||"download",href:x.href}));_(x=>[...u,...x].slice(0,5))}if(h!=null&&h.ok&&Array.isArray((s=h==null?void 0:h.output)==null?void 0:s.outputs)){const u=h.output.outputs.find(x=>x.type==="locate"&&x.boundingBox);if(u!=null&&u.boundingBox&&(G(u.boundingBox),e.some(k=>k.type==="locate")&&nt)){const b=[...e].reverse().find(w=>w.type==="locate")||null,r=[];if(b!=null&&b.selector)r.push({type:"click",selector:b.selector});else if(b!=null&&b.role&&(b!=null&&b.roleName))r.push({type:"click",role:b.role,roleName:b.roleName});else{const w=u.boundingBox;if(w){const St=Math.round(w.x+w.width/2),jt=Math.round(w.y+w.height/2);r.push({type:"click",x:St,y:jt})}}r.length&&setTimeout(()=>a(r),250);const c=!!(b!=null&&b.selector&&/(input|textarea)\[name=["']q["']\]/i.test(String(b.selector))),y=!!(b!=null&&b.roleName&&String(b.roleName).includes("بحث"));at&&!Z.trim()&&(c||y)&&setTimeout(()=>{a([{type:"waitForSelector",selector:'input[name="q"], textarea[name="q"]',timeoutMs:8e3}]),setTimeout(()=>a([{type:"type",text:st,delay:30}]),200),setTimeout(()=>a([{type:"press",key:"Enter"}]),300)},400)}}const B=e.map(u=>u.type).join(", ");if(I(B),setTimeout(()=>I(""),1200),e.some(u=>u.type==="goto"||u.type==="reload")&&(G(null),We)){const u=[];if(T)u.push({type:"locate",selector:T});else if(V&&ee)u.push({type:"locate",role:V,roleName:ee});else{const x=e.find(k=>k.type==="goto");try{const k=x!=null&&x.url?new URL(x.url).hostname:"";k&&/(^|\.)(google)\./i.test(k)&&u.push({type:"locate",selector:'input[name="q"], textarea[name="q"]'})}catch{}}u.length&&setTimeout(()=>a(u),1e3)}W&&e.some(u=>u.type==="press"&&u.key==="Enter")&&setTimeout(()=>{Y()},2e3),W&&e.some(u=>u.type==="goto"||u.type==="reload")&&setTimeout(()=>{Y()},1500)}catch{}}async function Y(){const e=ke();if(e)try{const o=localStorage.getItem("token"),l=JSON.parse(tt),s=await(await fetch(`${se}/tools/browser_extract/execute`,{method:"POST",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify({sessionId:e,schema:l})})).json();s!=null&&s.ok&&(s!=null&&s.output)?xe(s.output):xe(null)}catch{xe(null)}}async function pt(){var l,i;const e=ke(),o=(i=(l=De.current)==null?void 0:l.files)==null?void 0:i[0];if(!(!e||!o||!ge))try{const s=localStorage.getItem("token"),p=new FormData;p.append("file",o),p.append("sessionId",e);const h=await(await fetch(`${se}/files/upload`,{method:"POST",headers:{...s?{Authorization:`Bearer ${s}`}:{}},body:p})).json();if(h&&h._id){const B=`${se}/files/${h._id}/raw`;await a([{type:"uploadFile",selector:ge,fileUrl:B}])}}catch{}}n.useEffect(()=>{let e=!1;K.current=0,z("connecting"),D("");const o=()=>{re.current!=null&&(window.clearTimeout(re.current),re.current=null),oe.current!=null&&(window.clearTimeout(oe.current),oe.current=null)},l=()=>{if(!e){o();try{if(S.current){try{S.current.close()}catch{}S.current=null}const i=new WebSocket(H);S.current=i,z(K.current>0?"reconnecting":"connecting"),oe.current=window.setTimeout(()=>{try{i.readyState!==WebSocket.OPEN&&i.close()}catch{}},8e3),i.onopen=()=>{o(),!e&&(K.current=0,D(""),z("connected"))},i.onclose=s=>{if(o(),e)return;S.current=null;const p=8,d=K.current+1;if(K.current=d,d>p){z("error");const k=s!=null&&s.reason?` reason=${s.reason}`:"";D(`WebSocket closed (code=${(s==null?void 0:s.code)??"unknown"}${k})`);return}const h=Math.min(8e3,500*Math.pow(2,d-1)),B=Math.floor(Math.random()*250),u=h+B;z("reconnecting");const x=s!=null&&s.reason?` reason=${s.reason}`:"";D(`WebSocket closed (code=${(s==null?void 0:s.code)??"unknown"}${x}). retrying...`),re.current=window.setTimeout(l,u)},i.onerror=()=>{e||D("WebSocket error")},i.onmessage=s=>{var p,d,h,B,u,x,k,b;try{const r=JSON.parse(s.data);if(r.type==="stream_start"){const c={w:r.w,h:r.h};U.current=c,Re(c)}if(r.type==="state"){if((p=r.viewport)!=null&&p.width&&((d=r.viewport)!=null&&d.height)){const c={w:r.viewport.width,h:r.viewport.height};U.current=c,Re(c)}if(typeof r.url=="string"&&O(r.url),Array.isArray(r.tabs)&&Te(r.tabs),typeof r.activeTabId=="string"&&Ee(r.activeTabId),(h=r.stream)!=null&&h.fps&&he(Number(r.stream.fps)||5),(B=r.stream)!=null&&B.quality&&be(Number(r.stream.quality)||50),typeof r.redactionEnabled=="boolean"&&ye(!!r.redactionEnabled),Array.isArray(r.downloads)){const c=r.downloads.map(y=>({name:y.filename||y.name||"download",href:we(y.href)}));_(c.slice(-10).reverse())}Array.isArray(r.logs)&&ce(r.logs.slice(-500)),Array.isArray(r.network)&&de(r.network.slice(-500))}if(r.type==="tabs"&&(Array.isArray(r.tabs)&&Te(r.tabs),typeof r.activeTabId=="string"&&Ee(r.activeTabId)),r.type==="stream"&&(typeof r.fps=="number"&&he(r.fps),typeof r.quality=="number"&&be(r.quality)),r.type==="redaction"&&typeof r.enabled=="boolean"&&ye(!!r.enabled),r.type==="url"&&typeof r.url=="string"&&(!r.tabId||String(r.tabId)===String(Ie.current))&&O(r.url),r.type==="console"&&r.entry&&ce(c=>[...c,r.entry].slice(-500)),r.type==="network"&&r.entry&&de(c=>[...c,r.entry].slice(-500)),r.type==="download"&&r.download){const c=r.download,y={name:c.filename||c.name||"download",href:we(c.href)};_(w=>[y,...w].slice(0,10))}if(r.type==="screenshot"&&r.href){const c=we(String(r.href)),y=String(r.href).split("/").pop()||"screenshot.jpg";_(w=>[{name:y,href:c},...w].slice(0,10))}if(r.type==="cursor_move"&&$({x:r.x,y:r.y}),r.type==="cursor_click"){$({x:r.x,y:r.y});const c=document.createElement("div"),y=U.current;c.style.cssText=`
                position: absolute;
                left: ${r.x/y.w*100}%;
                top: ${r.y/y.h*100}%;
                width: 20px; height: 20px;
                background: rgba(255, 0, 0, 0.5);
                border-radius: 50%;
                transform: translate(-50%, -50%);
                pointer-events: none;
                z-index: 100;
                transition: opacity 0.5s;
              `,(x=(u=F.current)==null?void 0:u.parentElement)==null||x.appendChild(c),setTimeout(()=>c.remove(),500)}if(r.type==="action_start"){const c=r.action;let y=c.type;c.type==="goto"&&(y=`Opening ${new URL(c.url).hostname}...`),c.type==="type"&&(y="Typing..."),c.type==="click"&&(y="Clicking..."),c.type==="scroll"&&(y="Scrolling..."),c.type==="screenshot"&&(y="Capturing View..."),I(y)}if(r.type==="action_done"&&setTimeout(()=>I(""),500),r.type==="action_error"&&(I(String(r.error||"Action error")),setTimeout(()=>I(""),1500)),r.type==="frame"){if(Pe&&typeof r.jpegBase64=="string"&&_e(c=>[...c,{ts:Number(r.ts||Date.now()),jpegBase64:r.jpegBase64}].slice(-80)),ue||A)return;typeof r.jpegBase64=="string"&&qe(r.jpegBase64)}r.type==="pick"&&r.element&&(lt(r.element),(k=r.element)!=null&&k.selector&&$e(String(r.element.selector)),(b=r.element)!=null&&b.boundingBox&&G(r.element.boundingBox))}catch{}}}catch(i){z("error"),D(String((i==null?void 0:i.message)||i))}}};return l(),()=>{var i;e=!0,o();try{(i=S.current)==null||i.close()}catch{}S.current=null}},[H,Ve]);function ht(e){if(!f)return;const o=F.current;if(!o)return;try{o.focus()}catch{}const l=o.getBoundingClientRect(),i=Math.round((e.clientX-l.left)*(g.w/l.width)),s=Math.round((e.clientY-l.top)*(g.h/l.height));a(ne?[{type:"pick",x:i,y:s}]:[{type:"click",x:i,y:s}]),$({x:i,y:s})}function bt(e){if(!f)return;e.preventDefault();const o=Math.round(e.deltaY);a([{type:"scroll",deltaY:o}])}function yt(e){if(!f)return;const o=Date.now();if(o-(te.current||0)<60)return;te.current=o;const l=F.current;if(!l)return;const i=l.getBoundingClientRect(),s=Math.round((e.clientX-i.left)*(g.w/i.width)),p=Math.round((e.clientY-i.top)*(g.h/i.height));$({x:s,y:p}),a([{type:"mouseMove",x:s,y:p,steps:2}])}function xt(e){var d;if(!f)return;const o=F.current,l=(d=e.touches)==null?void 0:d[0];if(!o||!l)return;e.preventDefault();const i=o.getBoundingClientRect(),s=Math.round((l.clientX-i.left)*(g.w/i.width)),p=Math.round((l.clientY-i.top)*(g.h/i.height));a([{type:"click",x:s,y:p}]),$({x:s,y:p})}function gt(e){var h;if(!f)return;const o=Date.now();if(o-(te.current||0)<60)return;te.current=o;const l=F.current,i=(h=e.touches)==null?void 0:h[0];if(!l||!i)return;e.preventDefault();const s=l.getBoundingClientRect(),p=Math.round((i.clientX-s.left)*(g.w/s.width)),d=Math.round((i.clientY-s.top)*(g.h/s.height));$({x:p,y:d}),a([{type:"mouseMove",x:p,y:d,steps:2}])}function ft(){Z.trim()&&(a([{type:"type",text:Z,delay:30,sensitive:ae}]),Le(""))}const[Se,mt]=n.useState(!1);function vt(e){if(f){if(e.key==="Enter"){e.preventDefault(),a([{type:"press",key:"Enter"}]);return}if(e.key==="Backspace"){e.preventDefault(),a([{type:"press",key:"Backspace"}]);return}if(e.key==="Tab"){e.preventDefault(),a([{type:"press",key:"Tab"}]);return}if(e.key==="Escape"){e.preventDefault(),a([{type:"press",key:"Escape"}]);return}if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight"){e.preventDefault(),a([{type:"press",key:e.key}]);return}e.ctrlKey||e.metaKey||e.altKey||e.key&&e.key.length===1&&(e.preventDefault(),a([{type:"type",text:e.key,delay:0,sensitive:ae}]))}}function qe(e){const o=new Image;o.onload=()=>{const l=F.current;if(!l)return;const i=U.current;l.width=i.w,l.height=i.h,l.getContext("2d").drawImage(o,0,0,i.w,i.h)},o.src="data:image/jpeg;base64,"+e}n.useEffect(()=>{if(!A)return;const e=E[J];e!=null&&e.jpegBase64&&qe(e.jpegBase64)},[A,J,E]),n.useEffect(()=>{A&&ve(e=>Math.max(0,Math.min(e,Math.max(0,E.length-1))))},[A,E.length]);const kt=Ce.length?t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:m?"0 10px 10px 10px":"0 12px",flexWrap:"wrap"},children:[Ce.slice(0,12).map(e=>{const o=String(e.id)===String(P);let l=e.title&&e.title.trim()?e.title:e.url?(()=>{try{return new URL(String(e.url)).hostname}catch{return String(e.url)}})():e.id;return l=String(l).slice(0,28),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx("button",{onClick:()=>a([{type:"tab.switch",tabId:e.id}]),style:{height:28,padding:"0 10px",borderRadius:999,border:"1px solid var(--border-color)",background:o?"rgba(37, 99, 235, 0.18)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",maxWidth:260,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},dir:"auto",title:e.title||e.url||e.id,children:l}),t.jsx("button",{onClick:()=>a([{type:"tab.close",tabId:e.id}]),style:{width:28,height:28,borderRadius:999,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},title:"Close tab",children:"×"})]},e.id)}),t.jsx("button",{onClick:()=>a([{type:"tab.new",url:"about:blank",waitUntil:"domcontentloaded"}]),style:{height:28,padding:"0 12px",borderRadius:999,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},title:"New tab",children:"+"})]}):null,wt=t.jsxs("div",{style:{position:"absolute",top:10,left:10,right:10,zIndex:60,display:"flex",alignItems:"center",gap:8},children:[t.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:j==="connected"?"var(--accent-success)":j==="reconnecting"?"var(--accent-warning)":"var(--accent-danger)",boxShadow:j==="connected"?"0 0 8px var(--accent-success)":"none",flex:"0 0 auto"}}),t.jsx("button",{onClick:()=>me(e=>!e),style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:f?"rgba(37, 99, 235, 0.18)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:f?"تحكم: مفعل":"تحكم: متوقف"}),t.jsx("button",{onClick:()=>Oe(e=>!e),disabled:!f,style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:ne?"rgba(234, 179, 8, 0.18)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:f?"pointer":"not-allowed",opacity:f?1:.6,flex:"0 0 auto"},children:ne?"Picker: مفعل":"Picker"}),t.jsx("button",{onClick:()=>a([{type:"goBack"}]),title:"Back",style:{width:34,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:"⟵"}),t.jsx("button",{onClick:()=>a([{type:"goForward"}]),title:"Forward",style:{width:34,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:"⟶"}),t.jsx("button",{onClick:()=>a([{type:"reload"}]),title:"Reload",style:{width:34,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:"⟳"}),t.jsx("input",{type:"text",value:v,onChange:e=>O(e.target.value),onKeyDown:e=>{if(e.key==="Enter"){const o=N(v);o&&a([{type:"goto",url:o,waitUntil:"domcontentloaded"}])}},placeholder:"https://example.com",dir:"auto",style:{flex:"1 1 auto",height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(0,0,0,0.55)",color:"var(--text-primary)",outline:"none",minWidth:140,backdropFilter:"blur(8px)"}}),t.jsx("button",{onClick:()=>{const e=N(v);e&&a([{type:"goto",url:e,waitUntil:"domcontentloaded"}])},style:{height:32,padding:"0 12px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(37, 99, 235, 0.18)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:"فتح"}),Q?t.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)",maxWidth:420},dir:"auto",children:Q}):null]});return t.jsxs("div",{ref:je,className:"agent-browser-stream",style:{display:"flex",flexDirection:"column",gap:m?0:8,position:C?"fixed":"relative",inset:C?12:void 0,zIndex:C?9999:void 0,background:C?"var(--bg-dark)":void 0,padding:C?12:void 0,borderRadius:C?16:void 0,border:C?"1px solid var(--border-color)":void 0,boxShadow:C?"0 12px 50px rgba(0,0,0,0.6)":void 0,height:m?"100%":void 0},children:[m?wt:null,m?null:t.jsxs("div",{className:"agent-browser-header",style:{display:"flex",alignItems:"center",padding:"10px 12px",background:"var(--bg-secondary)",borderRadius:12,border:"1px solid var(--border-color)",gap:8,flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,whiteSpace:"nowrap"},children:[t.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:j==="connected"?"var(--accent-success)":j==="reconnecting"?"var(--accent-warning)":"var(--accent-danger)",boxShadow:j==="connected"?"0 0 8px var(--accent-success)":"none"}}),t.jsx("span",{style:{fontSize:12,fontWeight:600,color:"var(--text-primary)"},dir:"auto",children:j==="connected"?"متصل":j}),j==="error"?t.jsx("button",{onClick:()=>et(e=>e+1),style:{height:28,padding:"0 10px",borderRadius:8,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.04)",color:"var(--text-primary)",cursor:"pointer"},children:"إعادة اتصال"}):null]}),t.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flex:"1 1 420px",minWidth:260},children:[t.jsx("button",{onClick:()=>a([{type:"goBack"}]),title:"Back",style:{width:32,height:32,borderRadius:8,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"⟵"}),t.jsx("button",{onClick:()=>a([{type:"goForward"}]),title:"Forward",style:{width:32,height:32,borderRadius:8,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"⟶"}),t.jsx("button",{onClick:()=>a([{type:"reload"}]),title:"Reload",style:{width:32,height:32,borderRadius:8,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"⟳"}),t.jsx("input",{type:"text",value:v,onChange:e=>O(e.target.value),onKeyDown:e=>{if(e.key==="Enter"){const o=N(v);o&&a([{type:"goto",url:o,waitUntil:"domcontentloaded"}])}},placeholder:"https://example.com",dir:"auto",style:{flex:1,height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"var(--bg-primary)",color:"var(--text-primary)",outline:"none",minWidth:200}}),t.jsx("button",{onClick:()=>{const e=N(v);e&&a([{type:"goto",url:e,waitUntil:"domcontentloaded"}])},style:{height:32,padding:"0 12px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(37, 99, 235, 0.12)",color:"var(--text-primary)",cursor:"pointer"},children:"فتح"})]}),t.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"},children:[t.jsx("button",{onClick:()=>{const e=N(v);e&&navigator.clipboard&&navigator.clipboard.writeText(e).catch(()=>{})},title:"Copy URL",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"نسخ"}),t.jsx("button",{onClick:()=>{const e=N(v);e&&window.open(e,"_blank","noreferrer")},title:"Open in new tab",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"فتح خارجي"}),t.jsx("button",{onClick:()=>a([{type:"screenshot",fullPage:!1,quality:60}]),title:"Screenshot",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"لقطة"}),t.jsx("button",{onClick:()=>{const e=L[0];e!=null&&e.href&&window.open(e.href,"_blank","noreferrer")},disabled:!((Ke=L[0])!=null&&Ke.href),title:"Open latest download",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:(Je=L[0])!=null&&Je.href?"pointer":"not-allowed",opacity:(Ye=L[0])!=null&&Ye.href?1:.5},children:"تنزيل"}),t.jsx("button",{onClick:()=>X(e=>Math.max(.5,Number((e-.1).toFixed(2)))),title:"Zoom out",style:{width:32,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"−"}),t.jsxs("button",{onClick:()=>X(1),title:"Reset zoom",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:[Math.round(Ae*100),"%"]}),t.jsx("button",{onClick:()=>X(e=>Math.min(2,Number((e+.1).toFixed(2)))),title:"Zoom in",style:{width:32,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"+"}),t.jsx("button",{onClick:async()=>{var e;try{document.fullscreenElement?await document.exitFullscreen():await((e=je.current)==null?void 0:e.requestFullscreen())}catch{}},title:"Fullscreen",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:He?"خروج":"ملء"}),t.jsx("button",{onClick:()=>pe(e=>!e),title:"Pause stream",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:ue?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:ue?"تشغيل":"إيقاف"}),t.jsx("button",{onClick:()=>ze(e=>!e),title:"Focus mode",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:C?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"تركيز"}),t.jsx("button",{onClick:()=>le(e=>!e),title:"Logs",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:Ne?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"سجلات"}),t.jsx("button",{onClick:()=>mt(!Se),style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:Se?"أقل":"أكثر"})]}),Q?t.jsx("div",{style:{width:"100%",fontSize:12,color:"var(--text-secondary)"},dir:"auto",children:Q}):null,Me?t.jsx("div",{style:{width:"100%",display:"flex",justifyContent:"center"},children:t.jsx("div",{style:{padding:"4px 12px",background:"rgba(59, 130, 246, 0.15)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:999,color:"#60a5fa",fontSize:12},dir:"auto",children:Me})}):null]}),kt,t.jsx("div",{style:{border:m?"none":"1px solid var(--border-color)",borderRadius:m?0:14,overflow:"hidden",position:"relative",background:"#000",boxShadow:m?"none":"0 4px 20px rgba(0,0,0,0.3)",flex:m?1:void 0},children:t.jsxs("div",{style:{transform:m?"none":`scale(${Ae})`,transformOrigin:"top left",position:"relative"},children:[t.jsx("canvas",{ref:F,onClick:ht,onWheel:bt,onMouseMove:yt,onTouchStart:xt,onTouchMove:gt,tabIndex:f?0:-1,onFocus:()=>Ue(!0),onBlur:()=>Ue(!1),onKeyDown:vt,style:{width:"100%",height:"auto",display:"block",cursor:f?"crosshair":"default",touchAction:"none",outline:"none"}}),m&&f&&!it?t.jsx("div",{style:{position:"absolute",left:12,bottom:12,zIndex:70,padding:"6px 10px",borderRadius:12,background:"rgba(0,0,0,0.55)",border:"1px solid rgba(255,255,255,0.12)",color:"rgba(255,255,255,0.85)",fontSize:12,backdropFilter:"blur(8px)"},dir:"auto",children:"اضغط داخل المتصفح لتفعيل لوحة المفاتيح"}):null,q&&t.jsx("div",{style:{position:"absolute",left:`${q.x/g.w*100}%`,top:`${q.y/g.h*100}%`,width:`${q.width/g.w*100}%`,height:`${q.height/g.h*100}%`,border:"2px solid #eab308",boxShadow:"0 0 15px rgba(234, 179, 8, 0.4)",pointerEvents:"none",borderRadius:4,transition:"all 0.2s ease"}}),fe&&t.jsx("div",{style:{position:"absolute",left:`${fe.x/g.w*100}%`,top:`${fe.y/g.h*100}%`,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:50,transition:"all 0.1s linear"},children:t.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:"#eab308",border:"2px solid white",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"}})})]})}),!m&&Ne?t.jsxs("div",{style:{border:"1px solid var(--border-color)",borderRadius:12,background:"var(--bg-secondary)",overflow:"hidden"},children:[t.jsxs("div",{style:{display:"flex",gap:8,padding:10,borderBottom:"1px solid var(--border-color)",flexWrap:"wrap",alignItems:"center"},children:[t.jsx("button",{onClick:()=>ie("console"),style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:R==="console"?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"Console"}),t.jsx("button",{onClick:()=>ie("network"),style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:R==="network"?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"Network"}),t.jsx("button",{onClick:()=>ie("downloads"),style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:R==="downloads"?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"Downloads"}),t.jsxs("div",{style:{marginInlineStart:"auto",display:"flex",gap:8,alignItems:"center"},children:[t.jsx("button",{onClick:()=>{R==="console"&&ce([]),R==="network"&&de([]),R==="downloads"&&_([])},style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"Clear"}),t.jsx("button",{onClick:()=>le(!1),style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"إخفاء"})]})]}),t.jsxs("div",{style:{maxHeight:220,overflow:"auto",padding:10,fontSize:12,color:"var(--text-primary)",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace'},children:[R==="console"?Be.length?Be.slice(-200).map((e,o)=>t.jsxs("div",{style:{opacity:.95,padding:"2px 0"},dir:"auto",children:[t.jsx("span",{style:{color:e.level==="error"?"var(--accent-danger)":e.level==="warning"||e.level==="warn"?"var(--accent-warning)":"var(--text-secondary)"},children:new Date(e.ts).toLocaleTimeString()})," ",e.text]},o)):t.jsx("div",{style:{color:"var(--text-secondary)"},children:"لا توجد رسائل"}):null,R==="network"?Fe.length?Fe.slice(-200).map((e,o)=>t.jsxs("div",{style:{opacity:.95,padding:"2px 0"},dir:"auto",children:[t.jsx("span",{style:{color:"var(--text-secondary)"},children:new Date(e.ts).toLocaleTimeString()})," ",t.jsx("span",{style:{color:e.stage==="response"&&typeof e.status=="number"&&e.status>=400?"var(--accent-danger)":"var(--text-primary)"},children:e.method})," ",e.stage==="response"?t.jsx("span",{style:{color:"var(--text-secondary)"},children:e.status??""}):t.jsx("span",{style:{color:"var(--text-secondary)"},children:"→"})," ",e.url]},o)):t.jsx("div",{style:{color:"var(--text-secondary)"},children:"لا توجد طلبات"}):null,R==="downloads"?L.length?L.map((e,o)=>t.jsx("div",{style:{padding:"2px 0"},dir:"auto",children:t.jsx("a",{href:e.href,target:"_blank",rel:"noreferrer",style:{color:"#3b82f6",textDecoration:"none"},children:e.name})},o)):t.jsx("div",{style:{color:"var(--text-secondary)"},children:"لا توجد تنزيلات"}):null]})]}):null,Se&&t.jsxs("div",{style:{padding:12,border:"1px solid var(--border-color)",borderRadius:8,background:"var(--bg-secondary)",display:"flex",flexDirection:"column",gap:12},children:[t.jsxs("div",{className:"agent-browser-controls-row",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[t.jsx("button",{onClick:()=>a([{type:"goBack"}]),className:"btn",title:"Back",children:"⟵"}),t.jsx("button",{onClick:()=>a([{type:"goForward"}]),className:"btn",title:"Forward",children:"⟶"}),t.jsx("button",{onClick:()=>a([{type:"reload"}]),className:"btn",title:"Reload",children:"⟳"}),t.jsx("input",{type:"text",value:v,onChange:e=>O(e.target.value),onKeyDown:e=>{e.key==="Enter"&&v&&a([{type:"goto",url:N(v),waitUntil:"domcontentloaded"}])},placeholder:"https://example.com",style:{flex:1,minWidth:220,padding:"8px 10px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-primary)",color:"var(--text-primary)"}}),t.jsx("button",{onClick:()=>v&&a([{type:"goto",url:N(v),waitUntil:"domcontentloaded"}]),className:"btn",children:"Go"}),t.jsx("button",{onClick:()=>a([{type:"tab.new",url:"about:blank",waitUntil:"domcontentloaded"}]),className:"btn",title:"New tab",children:"+Tab"}),t.jsx("button",{onClick:()=>P&&a([{type:"tab.close",tabId:P}]),className:"btn",title:"Close active tab",children:"×Tab"})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:8},children:[t.jsxs("div",{style:{display:"flex",gap:4},children:[t.jsx("input",{type:"text",placeholder:"Upload Selector",value:ge,onChange:e=>rt(e.target.value),style:{flex:1,padding:4,borderRadius:4,border:"1px solid var(--border-color)"}}),t.jsx("input",{type:"file",ref:De,style:{width:80}}),t.jsx("button",{onClick:pt,className:"btn",children:"Up"})]}),t.jsxs("div",{style:{display:"flex",gap:4},children:[t.jsx("input",{type:ae?"password":"text",value:Z,onChange:e=>Le(e.target.value),placeholder:"Type text...",style:{flex:1,padding:4,borderRadius:4,border:"1px solid var(--border-color)"}}),t.jsx("button",{onClick:ft,className:"btn",children:"Type"}),t.jsx("button",{onClick:()=>a([{type:"press",key:"Enter"}]),className:"btn",children:"Ent"})]}),t.jsxs("div",{style:{display:"flex",gap:4},children:[t.jsx("input",{type:"text",value:T,onChange:e=>$e(e.target.value),placeholder:"CSS Selector",style:{flex:1,padding:4,borderRadius:4,border:"1px solid var(--border-color)"}}),t.jsx("button",{onClick:()=>T&&a([{type:"locate",selector:T}]),className:"btn",children:"Loc"}),t.jsx("button",{onClick:()=>T&&a([{type:"click",selector:T}]),className:"btn",children:"Clk"})]})]}),t.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:[t.jsx("input",{type:"checkbox",checked:f,onChange:e=>me(e.target.checked)}),"تحكم"]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:[t.jsx("input",{type:"checkbox",checked:ne,onChange:e=>Oe(e.target.checked),disabled:!f}),"Picker"]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:[t.jsx("input",{type:"checkbox",checked:ae,onChange:e=>ct(e.target.checked)}),"Login"]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:[t.jsx("input",{type:"checkbox",checked:Ge,onChange:e=>{const o=e.target.checked;ye(o),a([{type:"redaction.set",enabled:o}])}}),"Redaction"]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:["FPS",t.jsx("select",{value:Xe,onChange:e=>{const o=Number(e.target.value);he(o),a([{type:"stream.setFps",fps:o}])},style:{height:26,borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[2,5,8,10,15,20].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:["جودة",t.jsx("select",{value:Ze,onChange:e=>{const o=Number(e.target.value);be(o),a([{type:"stream.setQuality",quality:o}])},style:{height:26,borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[35,45,50,60,70].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:["Timeline",t.jsx("input",{type:"checkbox",checked:Pe,onChange:e=>dt(e.target.checked)})]}),t.jsx("button",{onClick:()=>{ut(e=>!e),pe(!0)},className:"btn",children:A?"إغلاق Replay":"Replay"}),t.jsx("button",{onClick:()=>{_e([]),ve(0)},className:"btn",children:"مسح"})]}),A&&E.length?t.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[t.jsx("input",{type:"range",min:0,max:Math.max(0,E.length-1),value:Math.min(J,Math.max(0,E.length-1)),onChange:e=>ve(Number(e.target.value)),style:{flex:1,minWidth:240}}),t.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)"},dir:"auto",children:E[J]?new Date(E[J].ts).toLocaleTimeString():""})]}):null,M?t.jsxs("div",{style:{fontSize:12,color:"var(--text-secondary)"},dir:"auto",children:["Picked: ",String(M.tag||"")," ",M.id?`#${M.id}`:""," ",M.ariaLabel?`aria="${M.ariaLabel}"`:""," ",M.selector?`sel=${M.selector}`:""]}):null,t.jsxs("div",{style:{fontSize:11,color:"var(--text-secondary)"},children:["DevTools: ",t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:W,onChange:e=>ot(e.target.checked)})," Auto Extract"]})]})]})]})}export{At as default};

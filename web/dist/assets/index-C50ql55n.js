const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AgentBrowserStream-BGYLW3Q3.js","assets/ui-vUf7uXgm.js","assets/vendor-DZWZ8VcW.js","assets/markdown-DC0SD8kP.js"])))=>i.map(i=>d[i]);
import{j as n,G as Ls,S as Es,M as Ps,L as Ts,a as os,m as ve,A as $s,Z as yt,X as bt,b as vt,c as As,d as zs,E as ls,e as cs,U as Fs,C as _s,R as Ds,f as Us,F as _t,g as ds,T as Bs,h as us,V as Ms,i as Vs,k as Dt,l as fs,n as qe,o as Xe,p as Ks,q as Hs,P as Ws,r as Ut,s as Js,t as qs,u as Gs,v as Bt,w as Ys,x as Qs,y as Xs,z as Zs,B as en,D as tn,H as sn,I as nn,J as rn}from"./ui-vUf7uXgm.js";import{b as an,a as h,u as nt,O as on,R as ln,B as cn,c as dn,d as Ge,N as un}from"./vendor-DZWZ8VcW.js";import{_ as ps,M as fn,h as pn}from"./markdown-DC0SD8kP.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var Ye={},Mt;function gn(){if(Mt)return Ye;Mt=1;var a=an();return Ye.createRoot=a.createRoot,Ye.hydrateRoot=a.hydrateRoot,Ye}var hn=gn();const mn=(a,e,t,s)=>{var i,o,c,l;const r=[t,{code:e,...s||{}}];if((o=(i=a==null?void 0:a.services)==null?void 0:i.logger)!=null&&o.forward)return a.services.logger.forward(r,"warn","react-i18next::",!0);Oe(r[0])&&(r[0]=`react-i18next:: ${r[0]}`),(l=(c=a==null?void 0:a.services)==null?void 0:c.logger)!=null&&l.warn?a.services.logger.warn(...r):console!=null&&console.warn&&console.warn(...r)},Vt={},wt=(a,e,t,s)=>{Oe(t)&&Vt[t]||(Oe(t)&&(Vt[t]=new Date),mn(a,e,t,s))},gs=(a,e)=>()=>{if(a.isInitialized)e();else{const t=()=>{setTimeout(()=>{a.off("initialized",t)},0),e()};a.on("initialized",t)}},jt=(a,e,t)=>{a.loadNamespaces(e,gs(a,t))},Kt=(a,e,t,s)=>{if(Oe(t)&&(t=[t]),a.options.preload&&a.options.preload.indexOf(e)>-1)return jt(a,t,s);t.forEach(r=>{a.options.ns.indexOf(r)<0&&a.options.ns.push(r)}),a.loadLanguages(e,gs(a,s))},xn=(a,e,t={})=>!e.languages||!e.languages.length?(wt(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(a,{lng:t.lng,precheck:(s,r)=>{if(t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&s.services.backendConnector.backend&&s.isLanguageChangingTo&&!r(s.isLanguageChangingTo,a))return!1}}),Oe=a=>typeof a=="string",yn=a=>typeof a=="object"&&a!==null,bn=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,vn={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},wn=a=>vn[a],jn=a=>a.replace(bn,wn);let St={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:jn};const Sn=(a={})=>{St={...St,...a}},kn=()=>St;let hs;const Nn=a=>{hs=a},Cn=()=>hs,In={type:"3rdParty",init(a){Sn(a.options.react),Nn(a)}},Rn=h.createContext();class On{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const Ln=(a,e)=>{const t=h.useRef();return h.useEffect(()=>{t.current=a},[a,e]),t.current},ms=(a,e,t,s)=>a.getFixedT(e,t,s),En=(a,e,t,s)=>h.useCallback(ms(a,e,t,s),[a,e,t,s]),Ve=(a,e={})=>{var _,G,B,z;const{i18n:t}=e,{i18n:s,defaultNS:r}=h.useContext(Rn)||{},i=t||s||Cn();if(i&&!i.reportNamespaces&&(i.reportNamespaces=new On),!i){wt(i,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const D=(X,U)=>Oe(U)?U:yn(U)&&Oe(U.defaultValue)?U.defaultValue:Array.isArray(X)?X[X.length-1]:X,J=[D,{},!1];return J.t=D,J.i18n={},J.ready=!1,J}(_=i.options.react)!=null&&_.wait&&wt(i,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={...kn(),...i.options.react,...e},{useSuspense:c,keyPrefix:l}=o;let d=r||((G=i.options)==null?void 0:G.defaultNS);d=Oe(d)?[d]:d||["translation"],(z=(B=i.reportNamespaces).addUsedNamespaces)==null||z.call(B,d);const g=(i.isInitialized||i.initializedStoreOnce)&&d.every(D=>xn(D,i,o)),y=En(i,e.lng||null,o.nsMode==="fallback"?d:d[0],l),p=()=>y,R=()=>ms(i,e.lng||null,o.nsMode==="fallback"?d:d[0],l),[m,j]=h.useState(p);let N=d.join();e.lng&&(N=`${e.lng}${N}`);const $=Ln(N),E=h.useRef(!0);h.useEffect(()=>{const{bindI18n:D,bindI18nStore:J}=o;E.current=!0,!g&&!c&&(e.lng?Kt(i,e.lng,d,()=>{E.current&&j(R)}):jt(i,d,()=>{E.current&&j(R)})),g&&$&&$!==N&&E.current&&j(R);const X=()=>{E.current&&j(R)};return D&&(i==null||i.on(D,X)),J&&(i==null||i.store.on(J,X)),()=>{E.current=!1,i&&D&&(D==null||D.split(" ").forEach(U=>i.off(U,X))),J&&i&&J.split(" ").forEach(U=>i.store.off(U,X))}},[i,N]),h.useEffect(()=>{E.current&&g&&j(p)},[i,l,g]);const W=[m,i,g];if(W.t=m,W.i18n=i,W.ready=g,g||!g&&!c)return W;throw new Promise(D=>{e.lng?Kt(i,e.lng,d,()=>D()):jt(i,d,()=>D())})},Ht=[{code:"en",label:"English"},{code:"ar",label:"العربية"},{code:"fr",label:"Français"},{code:"de",label:"Deutsch"},{code:"ru",label:"Русский"},{code:"es",label:"Español"}];function Pn(){var y;const{i18n:a,t:e}=Ve(),[t,s]=h.useState(()=>localStorage.getItem("theme")||"dark"),[r,i]=h.useState(()=>localStorage.getItem("lang")||"en"),[o,c]=h.useState(!1),l=h.useRef(null),d=nt();h.useEffect(()=>{localStorage.setItem("theme",t),document.documentElement.dataset.theme=t},[t]),h.useEffect(()=>{localStorage.setItem("lang",r),a.changeLanguage(r),document.documentElement.setAttribute("lang",r),document.documentElement.setAttribute("dir",r==="ar"?"rtl":"ltr")},[r,a]),h.useEffect(()=>{function p(R){l.current&&!l.current.contains(R.target)&&c(!1)}return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const g=((y=Ht.find(p=>p.code===r))==null?void 0:y.label)||"English";return n.jsxs("div",{className:"topbar",children:[n.jsx("div",{className:"brand",onClick:()=>d("/"),children:"JOE"}),n.jsx("div",{className:"spacer"}),n.jsxs("div",{className:"topbar-actions",style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"8px",marginInlineStart:"auto"},children:[n.jsxs("div",{className:"lang-dropdown",ref:l,style:{position:"relative"},children:[n.jsx("button",{className:`lang-btn ${o?"active":""}`,onClick:()=>c(!o),title:g,children:n.jsx(Ls,{size:20})}),o&&n.jsx("div",{className:"lang-menu",style:{position:"absolute",top:"100%",right:"0",zIndex:1e3,marginTop:"8px"},children:Ht.map(p=>n.jsx("button",{className:`lang-option ${r===p.code?"active":""}`,onClick:()=>{i(p.code),c(!1)},children:p.label},p.code))})]}),n.jsx("button",{className:"action-btn","aria-label":e("toggleTheme"),title:e("toggleTheme"),onClick:()=>{document.documentElement.classList.add("theme-switching"),s(t==="dark"?"light":"dark"),window.setTimeout(()=>{document.documentElement.classList.remove("theme-switching")},300)},children:t==="dark"?n.jsx(Es,{size:20}):n.jsx(Ps,{size:20})}),n.jsx("button",{className:localStorage.getItem("token")?"logout-btn":"login-btn",onClick:()=>{localStorage.getItem("token")?confirm(e("confirmLogout","Are you sure you want to logout?"))&&(localStorage.removeItem("token"),d("/login")):d("/login")},title:localStorage.getItem("token")?e("logout","Logout"):e("login"),children:localStorage.getItem("token")?n.jsx(Ts,{size:20}):n.jsx(os,{size:20})})]})]})}const Tn=()=>n.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:-1,overflow:"hidden",background:"var(--bg-dark)",transition:"background 0.3s ease"},children:[n.jsx(ve.div,{style:{position:"absolute",top:"-10%",left:"-10%",width:"50vw",height:"50vw",borderRadius:"50%",background:"radial-gradient(circle, rgba(37,99,235,0.15) 0%, rgba(37,99,235,0) 70%)",filter:"blur(60px)"},animate:{x:[0,100,0],y:[0,50,0],scale:[1,1.1,1]},transition:{duration:20,repeat:1/0,ease:"easeInOut"}}),n.jsx(ve.div,{style:{position:"absolute",bottom:"-10%",right:"-10%",width:"60vw",height:"60vw",borderRadius:"50%",background:"radial-gradient(circle, rgba(147,51,234,0.15) 0%, rgba(147,51,234,0) 70%)",filter:"blur(80px)"},animate:{x:[0,-100,0],y:[0,-50,0],scale:[1,1.2,1]},transition:{duration:25,repeat:1/0,ease:"easeInOut"}}),n.jsx(ve.div,{style:{position:"absolute",top:"40%",left:"40%",width:"40vw",height:"40vw",borderRadius:"50%",background:"radial-gradient(circle, rgba(56,189,248,0.1) 0%, rgba(56,189,248,0) 70%)",filter:"blur(50px)"},animate:{x:[0,-30,0],y:[0,40,0],scale:[1,1.3,1]},transition:{duration:15,repeat:1/0,ease:"easeInOut"}})]});function $n(){return n.jsxs("div",{className:"app",children:[n.jsx(Tn,{}),n.jsx(Pn,{}),n.jsx("div",{className:"content",children:n.jsx(on,{})})]})}function An(){const{t:a}=Ve(),e=nt();return n.jsxs("div",{className:"home-page",children:[n.jsx("div",{className:"home-bg-glow-1"}),n.jsx("div",{className:"home-bg-glow-2"}),n.jsxs("div",{className:"home-content",children:[n.jsx("div",{className:"home-logo-container",children:n.jsx("div",{className:"home-logo-ring",children:n.jsx("span",{className:"home-logo-text",children:"J"})})}),n.jsxs("h1",{className:"home-title",children:["JOE ",n.jsx("span",{className:"home-title-accent",children:"AI"})]}),n.jsx("p",{className:"home-subtitle",children:a("homeSubtitle","Your intelligent coding companion")}),n.jsxs("div",{className:"home-actions",children:[n.jsxs("button",{className:"home-btn-primary",onClick:()=>e("/login"),children:[n.jsx("span",{children:a("start_now","Start Now")}),n.jsx($s,{size:20})]}),n.jsxs("button",{className:"home-btn-secondary",onClick:()=>window.open("https://xelitesolutions.com","_blank"),children:[n.jsx("span",{children:a("learn_more","Learn More")}),n.jsx(yt,{size:18})]})]})]}),n.jsx("div",{className:"home-footer",children:"© 2025 Xelite Solutions. All rights reserved."})]})}const ht=window.location.hostname,zn="http://127.0.0.1:8080";ht.includes("joe-api")||ht.startsWith("api.");const se=String(zn).replace(/\/+$/,"");let Ae="";Ae||(Ae=`${se.replace(/^http/,"ws")}/ws`);Ae.startsWith("http")&&(Ae=Ae.replace(/^http/,"ws"));const Fn=Ae;function _n(){const{t:a}=Ve(),e=nt(),[t,s]=h.useState(""),[r,i]=h.useState(""),[o,c]=h.useState(!1),[l,d]=h.useState(null),[g,y]=h.useState(!1);async function p(){d(null),y(!0);try{const m=await fetch(`${se}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r,role:"OWNER"})});if(!m.ok){const j=await m.text();d(j);return}await R()}catch{d("Registration failed")}finally{y(!1)}}async function R(){d(null),y(!0);try{const m=await fetch(`${se}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})}),j=await m.json();if(!m.ok){d((j==null?void 0:j.error)||"Login failed");return}localStorage.setItem("token",j.token),e("/joe")}catch{d("Network error")}finally{y(!1)}}return n.jsxs("div",{className:"login-page",children:[n.jsxs("div",{className:"login-card",style:{position:"relative"},children:[n.jsx("button",{className:"login-close-btn",onClick:()=>e("/"),title:a("close","Close"),children:n.jsx(bt,{size:24})}),n.jsxs("div",{className:"login-header",children:[n.jsx("div",{className:"login-logo-wrapper",children:n.jsx("div",{className:"login-logo",children:n.jsx("span",{className:"login-logo-text",children:"J"})})}),n.jsx("div",{className:"login-title",children:"JOE AI"}),n.jsxs("div",{className:"login-subtitle",children:[n.jsx(vt,{size:14,style:{display:"inline",marginInlineEnd:6,color:"var(--accent-primary)"}}),a("login_subtitle","Welcome back to your workspace"),n.jsx(vt,{size:14,style:{display:"inline",marginInlineStart:6,color:"var(--accent-primary)"}})]})]}),n.jsxs("div",{className:"login-form",children:[l&&n.jsx("div",{className:"login-error",children:l}),n.jsxs("div",{className:"login-input-group",children:[n.jsx("label",{className:"login-label",children:a("email")}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx("input",{className:"login-input",value:t,onChange:m=>s(m.target.value),placeholder:"you@example.com"}),n.jsx(As,{size:18,style:{position:"absolute",top:16,left:16,color:"var(--text-muted)"},className:"input-icon-start"})]})]}),n.jsxs("div",{className:"login-input-group",children:[n.jsx("label",{className:"login-label",children:a("password")}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx("input",{className:"login-input",value:r,onChange:m=>i(m.target.value),type:o?"text":"password",placeholder:"••••••••",onKeyDown:m=>m.key==="Enter"&&R()}),n.jsx(zs,{size:18,style:{position:"absolute",top:16,left:16,color:"var(--text-muted)"},className:"input-icon-start"}),n.jsx("button",{type:"button",onClick:()=>c(!o),style:{position:"absolute",top:14,right:16,background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},className:"input-icon-end",children:o?n.jsx(ls,{size:18}):n.jsx(cs,{size:18})})]})]}),n.jsxs("div",{className:"login-actions",children:[n.jsx("button",{className:"login-submit-btn",onClick:R,disabled:g,children:g?"...":n.jsxs("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[n.jsx(os,{size:20})," ",a("login")]})}),n.jsx("button",{className:"login-register-btn",onClick:p,disabled:g,children:n.jsxs("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[n.jsx(Fs,{size:18})," ",a("register")]})})]})]})]}),n.jsx("div",{style:{position:"absolute",top:"10%",left:"10%",width:"300px",height:"300px",background:"radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%)",filter:"blur(40px)",zIndex:0}}),n.jsx("div",{style:{position:"absolute",bottom:"10%",right:"10%",width:"400px",height:"400px",background:"radial-gradient(circle, rgba(96, 165, 250, 0.1) 0%, transparent 70%)",filter:"blur(60px)",zIndex:0}})]})}const Dn={'pre[class*="language-"]':{color:"#d4d4d4",fontSize:"13px",textShadow:"none",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace',direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",lineHeight:"1.5",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",padding:"1em",margin:".5em 0",overflow:"auto",background:"#1e1e1e"},'code[class*="language-"]':{color:"#d4d4d4",fontSize:"13px",textShadow:"none",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace',direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",lineHeight:"1.5",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none"},'pre[class*="language-"]::selection':{textShadow:"none",background:"#264F78"},'code[class*="language-"]::selection':{textShadow:"none",background:"#264F78"},'pre[class*="language-"] *::selection':{textShadow:"none",background:"#264F78"},'code[class*="language-"] *::selection':{textShadow:"none",background:"#264F78"},':not(pre) > code[class*="language-"]':{padding:".1em .3em",borderRadius:".3em",color:"#db4c69",background:"#1e1e1e"},".namespace":{Opacity:".7"},"doctype.doctype-tag":{color:"#569CD6"},"doctype.name":{color:"#9cdcfe"},comment:{color:"#6a9955"},prolog:{color:"#6a9955"},punctuation:{color:"#d4d4d4"},".language-html .language-css .token.punctuation":{color:"#d4d4d4"},".language-html .language-javascript .token.punctuation":{color:"#d4d4d4"},property:{color:"#9cdcfe"},tag:{color:"#569cd6"},boolean:{color:"#569cd6"},number:{color:"#b5cea8"},constant:{color:"#9cdcfe"},symbol:{color:"#b5cea8"},inserted:{color:"#b5cea8"},unit:{color:"#b5cea8"},selector:{color:"#d7ba7d"},"attr-name":{color:"#9cdcfe"},string:{color:"#ce9178"},char:{color:"#ce9178"},builtin:{color:"#ce9178"},deleted:{color:"#ce9178"},".language-css .token.string.url":{textDecoration:"underline"},operator:{color:"#d4d4d4"},entity:{color:"#569cd6"},"operator.arrow":{color:"#569CD6"},atrule:{color:"#ce9178"},"atrule.rule":{color:"#c586c0"},"atrule.url":{color:"#9cdcfe"},"atrule.url.function":{color:"#dcdcaa"},"atrule.url.punctuation":{color:"#d4d4d4"},keyword:{color:"#569CD6"},"keyword.module":{color:"#c586c0"},"keyword.control-flow":{color:"#c586c0"},function:{color:"#dcdcaa"},"function.maybe-class-name":{color:"#dcdcaa"},regex:{color:"#d16969"},important:{color:"#569cd6"},italic:{fontStyle:"italic"},"class-name":{color:"#4ec9b0"},"maybe-class-name":{color:"#4ec9b0"},console:{color:"#9cdcfe"},parameter:{color:"#9cdcfe"},interpolation:{color:"#9cdcfe"},"punctuation.interpolation-punctuation":{color:"#569cd6"},variable:{color:"#9cdcfe"},"imports.maybe-class-name":{color:"#9cdcfe"},"exports.maybe-class-name":{color:"#9cdcfe"},escape:{color:"#d7ba7d"},"tag.punctuation":{color:"#808080"},cdata:{color:"#808080"},"attr-value":{color:"#ce9178"},"attr-value.punctuation":{color:"#ce9178"},"attr-value.punctuation.attr-equals":{color:"#d4d4d4"},namespace:{color:"#4ec9b0"},'pre[class*="language-javascript"]':{color:"#9cdcfe"},'code[class*="language-javascript"]':{color:"#9cdcfe"},'pre[class*="language-jsx"]':{color:"#9cdcfe"},'code[class*="language-jsx"]':{color:"#9cdcfe"},'pre[class*="language-typescript"]':{color:"#9cdcfe"},'code[class*="language-typescript"]':{color:"#9cdcfe"},'pre[class*="language-tsx"]':{color:"#9cdcfe"},'code[class*="language-tsx"]':{color:"#9cdcfe"},'pre[class*="language-css"]':{color:"#ce9178"},'code[class*="language-css"]':{color:"#ce9178"},'pre[class*="language-html"]':{color:"#d4d4d4"},'code[class*="language-html"]':{color:"#d4d4d4"},".language-regex .token.anchor":{color:"#dcdcaa"},".language-html .token.punctuation":{color:"#808080"},'pre[class*="language-"] > code[class*="language-"]':{position:"relative",zIndex:"1"},".line-highlight.line-highlight":{background:"#f7ebc6",boxShadow:"inset 5px 0 0 #f7d87c",zIndex:"0"}},Un=!1,Bn=h.lazy(()=>ps(()=>import("./AgentBrowserStream-BGYLW3Q3.js"),__vite__mapDeps([0,1,2,3])));function Mn({isThinking:a,toolVisible:e,activeToolName:t}){return n.jsx("div",{className:"mt-0.5",children:n.jsx(us,{children:a&&e&&t&&n.jsx(ve.div,{initial:{opacity:0,y:2},animate:{opacity:1,y:0},exit:{opacity:0,y:-2},transition:{duration:.18},className:"text-[10px] leading-3 font-light text-zinc-400/60",children:t},t)})})}const Wt=h.forwardRef(({event:a,isUser:e,onOptionClick:t},s)=>{const{t:r}=Ve();let i=a.data.text||a.data,o=[];if(!e&&typeof i=="string"&&i.includes(":::options")){const c=m=>{const j=m.search(/[\[{]/);if(j<0)return null;const N=[],$={"{":"}","[":"]"};let E=!1,W=!1;for(let _=j;_<m.length;_++){const G=m[_];if(E){if(W){W=!1;continue}if(G==="\\"){W=!0;continue}G==='"'&&(E=!1);continue}if(G==='"'){E=!0;continue}if(G==="{"||G==="["){N.push($[G]);continue}if(G==="}"||G==="]"){if(N.length===0)return null;const B=N[N.length-1];if(G!==B)return null;if(N.pop(),N.length===0)return{jsonText:m.slice(j,_+1),rest:m.slice(_+1)}}}return null},l=[];let d=i;const g=/:::options\s*([\s\S]*?):::/g;let y=null,p=0;const R=[];for(;y=g.exec(i);){R.push(i.slice(p,y.index)),p=g.lastIndex;const m=String(y[1]??"").trim();if(m)try{const j=JSON.parse(m);Array.isArray(j)?l.push(...j):j&&l.push(j)}catch{}}if(p>0&&(R.push(i.slice(p)),d=R.join("").trimEnd()),l.length===0){const m=i.indexOf(":::options"),j=i.slice(0,m).trimEnd(),N=i.slice(m+10),$=c(N);if($)try{const E=JSON.parse($.jsonText);Array.isArray(E)?l.push(...E):E&&l.push(E),d=j}catch{}}l.length>0&&(o=l,i=d)}return n.jsxs(ve.div,{ref:s,initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.4,ease:"easeOut"},className:`chat-bubble-wrapper ${e?"user":"ai"}`,children:[!e&&n.jsx("div",{className:"chat-avatar ai",children:n.jsx(vt,{size:18})}),n.jsxs("div",{className:"chat-bubble backdrop-blur-md shadow-lg",style:{background:e?"var(--user-msg-bg)":"var(--joe-msg-bg)",color:e?"#ffffff":"var(--text-primary)",backdropFilter:"blur(12px)",border:"1px solid var(--border-color)"},children:[n.jsxs("div",{className:"chat-bubble-header",children:[n.jsx("span",{className:"chat-bubble-sender",children:e?r("you","You"):"JOE AI"}),!e&&n.jsxs("div",{className:"chat-bubble-actions",children:[n.jsx("button",{className:"chat-action-btn",title:r("copy","Copy"),onClick:()=>navigator.clipboard.writeText(i),children:n.jsx(_s,{size:14})}),n.jsx("button",{className:"chat-action-btn",title:r("regenerate","Regenerate"),children:n.jsx(Ds,{size:14})})]})]}),n.jsx("div",{className:"chat-bubble-content",children:e?n.jsx("div",{style:{whiteSpace:"pre-wrap"},children:i}):n.jsxs(n.Fragment,{children:[n.jsx(fn,{components:{h1:({node:c,...l})=>n.jsx("h1",{className:"text-[var(--accent-secondary)] text-2xl mb-2 mt-2 border-b border-[var(--border-color)] pb-1",...l}),h2:({node:c,...l})=>n.jsx("h2",{className:"text-[var(--accent-primary)] text-xl mb-2 mt-4",...l}),h3:({node:c,...l})=>n.jsx("h3",{className:"text-[var(--neon-purple)] text-lg mb-2 mt-4",...l}),ul:({node:c,...l})=>n.jsx("ul",{className:"list-disc pl-6 mb-4",...l}),ol:({node:c,...l})=>n.jsx("ol",{className:"list-decimal pl-6 mb-4",...l}),li:({node:c,...l})=>n.jsx("li",{className:"mb-1 leading-relaxed",...l}),p:({node:c,...l})=>n.jsx("p",{className:"mb-4 leading-relaxed",...l}),blockquote:({node:c,...l})=>n.jsx("blockquote",{className:"border-l-4 border-[var(--accent-secondary)] bg-[var(--bg-secondary)] my-4 py-2 px-4 rounded",...l}),a:({node:c,...l})=>n.jsx("a",{...l,target:"_blank",rel:"noopener noreferrer",className:"text-[var(--accent-primary)] underline"}),code({node:c,inline:l,className:d,children:g,...y}){const p=/language-(\w+)/.exec(d||"");return!l&&p?n.jsx(pn,{style:Dn,language:p[1],PreTag:"div",...y,children:String(g).replace(/\n$/,"")}):n.jsx("code",{className:d,...y,style:l?{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:"3px"}:{display:"block",padding:"10px",background:"#1e1e1e",borderRadius:"4px",overflowX:"auto"},children:g})}},children:i||(typeof a.data=="string"?a.data:JSON.stringify(a.data))}),o.length>0&&n.jsx("div",{style:{display:"flex",gap:8,marginTop:16,flexWrap:"wrap",borderTop:"1px solid var(--border-color)",paddingTop:12},children:o.map((c,l)=>n.jsxs("button",{onClick:()=>t==null?void 0:t(c.query),style:{background:"rgba(255,255,255,0.05)",border:"1px solid var(--border-color)",borderRadius:20,padding:"6px 14px",color:"var(--text-secondary)",fontSize:13,cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:6},onMouseEnter:d=>d.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:d=>d.currentTarget.style.background="rgba(255,255,255,0.05)",children:[n.jsx("span",{style:{opacity:.7},children:"✨"})," ",c.label]},l))})]})})]}),e&&n.jsx("div",{className:"chat-avatar user",children:n.jsx(Us,{size:18})})]})});function Jt({sessionId:a,sessionKind:e="chat",browserSessionId:t=null,onSessionCreated:s,onPreviewArtifact:r,onStepsUpdate:i,onMessagesUpdate:o}){const{t:c}=Ve(),[l,d]=h.useState(""),[g,y]=h.useState([]),[p,R]=h.useState(!1),[m,j]=h.useState([]),[N,$]=h.useState(null),[E,W]=h.useState(!1),[_,G]=h.useState(!1),[B,z]=h.useState(!1),[D,J]=h.useState(!1),[X,U]=h.useState("idle"),[ie,Se]=h.useState(!1),[Y,ne]=h.useState(null),[fe,ye]=h.useState(!1),[Ce,re]=h.useState([]),pe=h.useRef(null);h.useRef(window.speechSynthesis);const oe=h.useRef(null),ke=h.useRef(),Ie=h.useRef(null),Re=h.useRef(null),Ke=h.useRef(null),je=h.useRef(!0),x=h.useRef(null),w=h.useRef({}),P=h.useRef(null),le=h.useRef(0),he=h.useRef(void 0),Nt=h.useRef(0),be=h.useRef(null),Ct=h.useRef(ie),It=h.useRef(fe),Rt=h.useRef(Y),[bs,it]=h.useState(!1),[Z,Ne]=h.useState({openai:{name:"OpenAI",apiKey:"",isConnected:!1,model:"gpt-4o"},anthropic:{name:"Anthropic",apiKey:"",isConnected:!1,model:"claude-3-opus-20240229"},gemini:{name:"Google Gemini",apiKey:"",isConnected:!1,model:"gemini-pro"},grok:{name:"xAI (Grok)",apiKey:"",isConnected:!1,baseUrl:"https://api.x.ai/v1",model:"grok-beta"}}),[F,at]=h.useState("openai"),[Ot,vs]=h.useState({}),[fr,He]=h.useState(null),We=h.useMemo(()=>{var K,k,A,T,te,H,de,ze,Fe,At,zt,Ft;const u=new Map,f=[],b=[],S=[],C=new Set,O=[],ae=m.map((v,ge)=>({e:v,idx:ge,seq:typeof(v==null?void 0:v.seq)=="number"?v.seq:Number.POSITIVE_INFINITY,ts:typeof(v==null?void 0:v.ts)=="number"?v.ts:ge})).sort((v,ge)=>v.seq-ge.seq||v.ts-ge.ts||v.idx-ge.idx),Q=(v,ge)=>(u.has(v)||(u.set(v,{...ge,key:v}),f.push(v)),u.get(v)),M=new Map,I=new Map;for(const{e:v}of ae){const ge=typeof(v==null?void 0:v.runId)=="string"?v.runId:typeof((K=v==null?void 0:v.data)==null?void 0:K.runId)=="string"?v.data.runId:void 0;if((v.type==="user_input"||v.type==="text"||v.type==="step_started"||v.type==="step_progress"||v.type==="step_done"||v.type==="step_failed"||v.type==="evidence_added"||v.type==="artifact_created"||v.type==="approval_required"||v.type==="approval_result"||v.type==="run_finished"||v.type==="run_completed")&&O.push({type:v.type,data:v.data,duration:v.duration}),v.type==="step_started"&&((k=v.data)!=null&&k.name)){const xe=String(v.data.name),me=`${ge||""}::${xe}`,Pe=(M.get(me)||0)+1;M.set(me,Pe);const _e=`${me}::${Pe}`,De=I.get(me)||[];De.push(_e),I.set(me,De);const ue=Q(_e,{name:xe,status:"running",runId:ge});ue.status="running",typeof(v==null?void 0:v.ts)=="number"&&(ue.startedAt=v.ts),((A=v.data)==null?void 0:A.input)!=null&&ue.input==null&&(ue.input=v.data.input)}if((v.type==="step_done"||v.type==="step_failed")&&((T=v.data)!=null&&T.name)){const xe=String(v.data.name),me=`${ge||""}::${xe}`,Pe=I.get(me)||[],_e=Pe.pop();Pe.length?I.set(me,Pe):I.delete(me);const De=_e||`${me}::${(M.get(me)||0)+1}`;_e||M.set(me,Number(De.split("::").pop())||(M.get(me)||0)+1);const ue=Q(De,{name:xe,status:"running",runId:ge});ue.status=v.type==="step_done"?"done":"failed",typeof v.duration=="number"?ue.duration=v.duration:typeof ue.startedAt=="number"&&typeof(v==null?void 0:v.ts)=="number"&&(ue.duration=v.ts-ue.startedAt),(te=v.data)!=null&&te.plan&&(ue.plan=v.data.plan),(H=v.data)!=null&&H.result&&(ue.result=v.data.result,v.data.result.ok||(ue.error=v.data.result.error||v.data.result.message)),v.type==="step_failed"&&!ue.error&&(ue.error=(de=v.data)==null?void 0:de.error)}if(v.type==="evidence_added"&&String(((ze=v.data)==null?void 0:ze.kind)||"")==="log"&&typeof((Fe=v.data)==null?void 0:Fe.text)=="string"&&b.push(v.data.text),v.type==="artifact_created"){const xe=typeof((At=v.data)==null?void 0:At.href)=="string"?v.data.href:"";xe&&!C.has(xe)&&(C.add(xe),S.push({name:String(((zt=v.data)==null?void 0:zt.name)||"artifact"),href:xe,kind:(Ft=v.data)==null?void 0:Ft.kind}))}}const q=f.map(v=>u.get(v)).filter(Boolean),ee=v=>v.startsWith("thinking_step_")?`Plan #${v.replace("thinking_step_","")}`:v.startsWith("execute:")?`Execute: ${v.slice(8)}`:v;return{steps:q.map(v=>({...v,displayName:ee(String(v.name||""))})),logs:b,artifacts:S,timeline:O}},[m]);h.useEffect(()=>{const u=f=>{const b=f==null?void 0:f.detail,S=typeof(b==null?void 0:b.text)=="string"?b.text:"";S&&d(C=>C?`${C}
${S}`:S)};return window.addEventListener("joe:prefill",u),()=>window.removeEventListener("joe:prefill",u)},[]),h.useEffect(()=>{try{const u=localStorage.getItem("ai_providers");if(u){const b=JSON.parse(u);Ne(S=>{const C={...S};return Object.keys(b).forEach(O=>{C[O]&&(C[O]={...C[O],...b[O]})}),C})}const f=localStorage.getItem("active_provider");f&&Z[f]&&at(f)}catch(u){console.error("Failed to load providers settings",u)}},[]),h.useEffect(()=>{localStorage.setItem("ai_providers",JSON.stringify(Z))},[Z]),h.useEffect(()=>{localStorage.setItem("active_provider",F)},[F]);const ot=(u="auto")=>{var b;const f=Re.current;if(!f){(b=Ie.current)==null||b.scrollIntoView({behavior:u});return}x.current!=null&&(cancelAnimationFrame(x.current),x.current=null),x.current=requestAnimationFrame(()=>{u==="smooth"?f.scrollTo({top:f.scrollHeight,behavior:u}):f.scrollTop=f.scrollHeight})},ws=()=>{const u=Re.current;if(!u){je.current=!0;return}const f=u.scrollHeight-u.scrollTop-u.clientHeight;je.current=f<120};h.useEffect(()=>{je.current=!0,ot("auto")},[a,e]),h.useEffect(()=>{const u=Re.current;if(!u)return;const f=()=>ws();return u.addEventListener("scroll",f,{passive:!0}),()=>u.removeEventListener("scroll",f)},[]),h.useEffect(()=>{const u=Ke.current;if(!u||typeof ResizeObserver>"u")return;const f=new ResizeObserver(()=>{je.current&&ot("auto")});return f.observe(u),()=>f.disconnect()},[]),h.useEffect(()=>()=>{x.current!=null&&cancelAnimationFrame(x.current)},[]),h.useEffect(()=>{if(je.current&&ot("auto"),i&&i(We.steps),o&&o(m),B&&m.length>0){const u=m[m.length-1];u.type==="text"&&u.data.text&&Lt(u.data.text)}},[m,We.steps,B,o,i,ie]);const Lt=async u=>{if(!B)return;lt(),J(!0);try{const C=localStorage.getItem("token");if(C){const O=await fetch(`${se}/audio/speech`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`},body:JSON.stringify({text:u,voice:"onyx"})});if(O.ok){const ae=await O.blob(),Q=URL.createObjectURL(ae),M=new Audio(Q);M.onended=()=>J(!1),M.onerror=()=>J(!1),M.play(),window.currentAudio=M;return}}}catch(C){console.warn("Backend TTS failed, falling back to browser",C)}const f=new SpeechSynthesisUtterance(u),b=/[\u0600-\u06FF]/.test(u);f.lang=b?"ar-SA":"en-US";const S=window.speechSynthesis.getVoices();if(b){const C=S.find(O=>O.lang.includes("ar")&&O.name.includes("Google"))||S.find(O=>O.lang.includes("ar"));C&&(f.voice=C)}f.onstart=()=>J(!0),f.onend=()=>J(!1),f.onerror=()=>J(!1),window.speechSynthesis.speak(f)},lt=()=>{window.speechSynthesis.cancel(),window.currentAudio&&(window.currentAudio.pause(),window.currentAudio=null),J(!1)};h.useEffect(()=>(window.speechSynthesis.getVoices(),window.speechSynthesis.onvoiceschanged=()=>{window.speechSynthesis.getVoices()},()=>{lt()}),[]),h.useEffect(()=>{const u=window.SpeechRecognition||window.webkitSpeechRecognition;if(u){const f=new u;f.continuous=!1,f.interimResults=!1,f.lang="ar-SA",f.onstart=()=>G(!0),f.onend=()=>G(!1),f.onresult=b=>{const S=b.results[0][0].transcript;d(C=>C+(C?" ":"")+S)},pe.current=f}},[]);const js=()=>{if(!pe.current){alert("التعرف الصوتي غير مدعوم في هذا المتصفح. يرجى استخدام Chrome.");return}_?pe.current.stop():pe.current.start()},Le=()=>{be.current!=null&&(window.clearTimeout(be.current),be.current=null)};h.useEffect(()=>{Ct.current=ie},[ie]),h.useEffect(()=>{It.current=fe},[fe]),h.useEffect(()=>{Rt.current=Y},[Y]);const Je=u=>{const f=String(u||"").trim();f&&(be.current!=null&&(window.clearTimeout(be.current),be.current=null),U("thinking"),Se(!0),ne(f),ye(!0),Nt.current=Date.now())},ct=()=>{const u=Date.now()-Nt.current,f=Math.max(250-u,0);be.current!=null&&window.clearTimeout(be.current);const b=f+250;return be.current=window.setTimeout(()=>{be.current=null,ye(!1),window.setTimeout(()=>{ne(null),Se(!1),U("idle"),re([])},250)},f),b};h.useEffect(()=>(Et(),()=>{oe.current&&oe.current.close(),ke.current&&window.clearTimeout(ke.current),Le()}),[]);function Et(){try{if(oe.current){if(oe.current.readyState===WebSocket.OPEN)return;try{oe.current.close()}catch{}}const u=Fn,f=`${se.replace(/^http/,"ws")}/ws`,b=O=>{var ae,Q,M,I,q,ee,V,K;try{const k=JSON.parse(O.data);if(typeof(k==null?void 0:k.seq)=="number"&&Number.isFinite(k.seq)&&k.seq>le.current&&(le.current=k.seq),typeof(k==null?void 0:k.runId)=="string"&&k.runId.trim()&&He(k.runId.trim()),k.type==="user_input"&&(Le(),Se(!0),ne(null),ye(!1),re([])),k.type==="artifact_created"){const A=(ae=k.data)==null?void 0:ae.kind,T=(Q=k.data)==null?void 0:Q.href;if(A==="browser_stream"||typeof T=="string"&&(/^wss?:\/\//i.test(T)||/^\/browser\/ws\//i.test(T))&&/\/ws\//i.test(T)){try{const H="http://dummy.com",ze=new URL(T,H).pathname.split("/").filter(Boolean),Fe=ze[ze.length-1];Fe&&window.dispatchEvent(new CustomEvent("joe:browser_attached",{detail:{sessionId:Fe,wsUrl:T}}))}catch(H){console.error("Failed to parse browser stream artifact",H)}if(e==="agent"&&t)return}}if(k.type==="approval_required"){const A=k.data||{},{id:T,risk:te,action:H}=A,de=typeof(A==null?void 0:A.runId)=="string"?A.runId:typeof(k==null?void 0:k.runId)=="string"?k.runId:"";T&&$({id:T,runId:de,risk:te,action:H})}if(k.type==="step_started"){const A=typeof(k==null?void 0:k.runId)=="string"?k.runId:typeof((M=k==null?void 0:k.data)==null?void 0:M.runId)=="string"?k.data.runId:"",T=String(((I=k==null?void 0:k.data)==null?void 0:I.name)||"");if(T&&(w.current[`${A}:${T}`]=Date.now()),T==="plan")Je("خطة"),re(te=>[...te,"خطة"].slice(-4));else if(T.startsWith("thinking_step_")){const te=T.replace("thinking_step_","").trim(),H=te?`خطة #${te}`:"خطة";Je(H),re(de=>[...de,H].slice(-4))}else T.startsWith("execute:")?Je(T.slice(8)):T&&Je(T)}if(k.type==="step_done"){const A=typeof(k==null?void 0:k.runId)=="string"?k.runId:typeof((q=k==null?void 0:k.data)==null?void 0:q.runId)=="string"?k.data.runId:"",T=String(((ee=k==null?void 0:k.data)==null?void 0:ee.name)||""),te=w.current[`${A}:${T}`];if(te&&(k.duration=Date.now()-te,delete w.current[`${A}:${T}`]),T==="execute:browser_open"&&((K=(V=k.data)==null?void 0:V.result)!=null&&K.ok)){const H=k.data.result.output;H!=null&&H.sessionId&&(H!=null&&H.wsUrl)&&window.dispatchEvent(new CustomEvent("joe:browser_attached",{detail:{sessionId:H.sessionId,wsUrl:H.wsUrl}}))}ct()}if(k.type==="text"){const A=typeof(k==null?void 0:k.id)=="string"?k.id:"";if(A.startsWith("system_prompt:"))return;const te=Ct.current||It.current||Rt.current!=null?ct():0;window.setTimeout(()=>{j(H=>A&&H.some(de=>typeof(de==null?void 0:de.id)=="string"&&de.id===A)?H:[...H,k]);try{let H=k.data;if(typeof H=="string"&&(H.startsWith("{")||H.startsWith("["))){const de=JSON.parse(H);H=de.text||de.output||H}Lt(String(H))}catch{}},te);return}if(k.type==="run_finished"&&ct(),!Un&&["step_started","step_progress","step_done","step_failed","evidence_added"].includes(k.type))return;["step_started","step_progress","step_done","step_failed","evidence_added","artifact_created","approval_required","approval_result","run_finished","run_completed","user_input"].includes(k.type)&&j(A=>{const T=typeof(k==null?void 0:k.id)=="string"?k.id:"";return T&&A.some(te=>typeof(te==null?void 0:te.id)=="string"&&te.id===T)?A:[...A,k]})}catch(k){console.error("WS parse error:",k)}},S=(O,ae)=>{O.onopen=()=>{oe.current===O&&W(!0)},O.onmessage=b,O.onclose=()=>{if(oe.current!==O)return;W(!1);const Q=(O==null?void 0:O.__triedFallback)===!0;if(ae&&!Q&&u!==f)try{const M=new WebSocket(f);M.__triedFallback=!0,oe.current=M,S(M,!1);return}catch{}ke.current=window.setTimeout(()=>Et(),2e3)},O.onerror=()=>{oe.current===O&&W(!1)}},C=new WebSocket(u);oe.current=C,S(C,!0)}catch(u){console.error("WS connect failed:",u),W(!1)}}h.useEffect(()=>{const u=he.current;if(he.current=a,!a){j([]),He(null),$(null),Le(),U("idle"),ne(null);return}if(u&&u!==a){j([]),He(null),$(null),Le(),U("idle"),ne(null),Pt(a);return}!u&&m.length===0&&Pt(a)},[a]);async function Pt(u){try{const f=localStorage.getItem("token"),b=await fetch(`${se}/sessions/${u}/history`,{headers:f?{Authorization:`Bearer ${f}`}:{}});if(b.ok){const S=await b.json();Array.isArray(S.events)&&j(S.events)}}catch(f){console.error("Failed to load history",f)}}async function Ss(u){var b;if(!((b=u.target.files)!=null&&b.length))return;const f=u.target.files[0];R(!0);try{const S=localStorage.getItem("token"),C=new FormData;C.append("file",f),a&&C.append("sessionId",a);const O=await fetch(`${se}/files/upload`,{method:"POST",headers:{...S?{Authorization:`Bearer ${S}`}:{}},body:C});if(O.ok){const ae=await O.json();y(Q=>[...Q,{id:ae.file.id,name:ae.file.originalName}])}else alert(c("uploadFailed")||"Upload failed")}catch(S){console.error(S),alert(c("uploadError")||"Upload error")}finally{R(!1),P.current&&(P.current.value="")}}async function dt(u){var ae,Q,M;const f=u||l;if(!f.trim())return;Le(),U("thinking"),ne(null),re([]);const b=I=>{const q=String(I||"").trim();if(!q)return!1;if(/https?:\/\/[^\s"'<>]+/i.test(q)||/(\b(browser|web)\b|متصفح|داخل المتصفح)/i.test(q))return!0;const K=/(افتح|افتحي|افتحوا|اذهب|زيارة|open|go to|visit)/i.test(q),k=/(github|جيتهاب|كتهاب|كيتهاب)/i.test(q),A=/(كود|code|repo|repository|مستودع|ملفات|files|اختبر|تحقق|راجع|audit|lint|build|typecheck|تحليل)/i.test(q);if(K&&k&&A)return!1;const T=/(file|folder|directory|ملف|مجلد|مسار|path|terminal|command|أمر|ترمينال)/i.test(q);return K&&T?!1:!!(K||/(youtube|يوتيوب|google|جوجل|facebook|فيسبوك|x\.com|twitter|تويتر|instagram|انستغرام)/i.test(q))},S=async I=>await new Promise((q,ee)=>{const K=k=>{const A=(k==null?void 0:k.detail)||{},T=String((A==null?void 0:A.sessionId)||"").trim(),te=typeof(A==null?void 0:A.wsUrl)=="string"?A.wsUrl:void 0;T&&(window.removeEventListener("joe:browser_opened",K),q({sessionId:T,wsUrl:te}))};window.addEventListener("joe:browser_opened",K),window.dispatchEvent(new CustomEvent("joe:browser_open_request",{detail:{url:I}})),window.setTimeout(()=>{window.removeEventListener("joe:browser_opened",K),ee(new Error("browser_open_timeout"))},2e4)}),C=Date.now().toString();j(I=>[...I,{type:"user_input",data:f,id:C,ts:Date.now(),seq:le.current+.1}]),u||d(""),y([]);const O=localStorage.getItem("token");try{let I=t;if(e==="agent"&&!I&&b(f)){const K=f.match(/https?:\/\/[^\s"'<>]+/i),k=K==null?void 0:K[0],A=/youtube|يوتيوب/i.test(f),T=/(github|جيتهاب|كتهاب|كيتهاب)/i.test(f);I=(await S(k||(A?"https://www.youtube.com":T?"https://github.com":"https://www.google.com"))).sessionId}const q=await fetch(`${se}/runs/start`,{method:"POST",headers:{"Content-Type":"application/json",...O?{Authorization:`Bearer ${O}`}:{}},body:JSON.stringify({text:f,sessionId:a,sessionKind:e,...e==="agent"&&I?{browserSessionId:I}:{},fileIds:g.map(K=>K.id),provider:F,apiKey:(ae=Z[F])==null?void 0:ae.apiKey,baseUrl:(Q=Z[F])==null?void 0:Q.baseUrl,model:(M=Z[F])==null?void 0:M.model})}),ee=await q.text();let V=null;try{V=ee?JSON.parse(ee):null}catch{V=null}if(!q.ok){const K=(V==null?void 0:V.error)||ee||`HTTP ${q.status}`;throw new Error(String(K).slice(0,500))}if(typeof(V==null?void 0:V.systemPrompt)=="string"&&V.systemPrompt.trim()&&typeof(V==null?void 0:V.systemPromptId)=="string"&&V.systemPromptId.trim()){const K=V.systemPromptId.trim(),k=V.systemPrompt;j(A=>A.some(T=>typeof(T==null?void 0:T.id)=="string"&&T.id===K)?A:[...A,{type:"text",id:K,data:k,ts:Date.now()}])}if(typeof(V==null?void 0:V.runId)=="string"&&V.runId.trim()&&He(V.runId.trim()),V.sessionId&&!a&&s&&s(V.sessionId),!E&&(V!=null&&V.result)){const K=V.result;if(K!=null&&K.output){const k=typeof K.output=="string"?K.output:JSON.stringify(K.output);j(A=>[...A,{type:"text",data:k}])}}}catch(I){console.error(I);const q=String((I==null?void 0:I.message)||I||"").trim(),ee=q?`${c("error")}: ${q}`:c("error");j(V=>[...V,{type:"error",data:ee}]),u||d(f),Le(),U("idle"),ne(null)}}async function Tt(u){if(!N)return;const f=localStorage.getItem("token");await fetch(`${se}/approvals/${N.id}/decision`,{method:"POST",headers:{"Content-Type":"application/json",...f?{Authorization:`Bearer ${f}`}:{}},body:JSON.stringify({decision:u})}),$(null)}const ks=async u=>{const f=Z[u];Ne(S=>({...S,[u]:{...S[u],isVerifying:!0,lastError:void 0}}));const b=localStorage.getItem("token");try{const S=await fetch(`${se}/runs/verify`,{method:"POST",headers:{"Content-Type":"application/json",...b?{Authorization:`Bearer ${b}`}:{}},body:JSON.stringify({provider:u,apiKey:f.apiKey,baseUrl:f.baseUrl,model:f.model})}),C=await S.json();if(S.ok)Ne(O=>({...O,[u]:{...O[u],isVerifying:!1,isConnected:!0,lastError:void 0}})),at(u);else throw new Error(C.error||"Connection failed")}catch(S){Ne(C=>({...C,[u]:{...C[u],isVerifying:!1,isConnected:!1,lastError:S.message}}))}},Ns=u=>{confirm("Are you sure you want to remove the API key?")&&Ne(f=>({...f,[u]:{...f[u],apiKey:"",isConnected:!1}}))},[pr,Cs]=h.useState({}),[$t,Is]=h.useState({}),[gr,hr]=h.useState({}),ut=u=>{var b;const f=typeof(u==null?void 0:u.runId)=="string"?u.runId:typeof((b=u==null?void 0:u.data)==null?void 0:b.runId)=="string"?u.data.runId:"";return f&&f.trim()?f.trim():"no-run"},Ee=h.useMemo(()=>m.map((f,b)=>{const S=typeof(f==null?void 0:f.ts)=="number"?f.ts:b,C=typeof(f==null?void 0:f.seq)=="number"?f.seq:void 0,O=typeof(f==null?void 0:f.id)=="string"&&f.id.startsWith("system_prompt:");return{e:f,idx:b,ts:S,seq:C,isSystemPrompt:O}}).sort((f,b)=>{if(f.isSystemPrompt&&!b.isSystemPrompt)return-1;if(!f.isSystemPrompt&&b.isSystemPrompt)return 1;const S=typeof f.seq=="number"&&Number.isFinite(f.seq),C=typeof b.seq=="number"&&Number.isFinite(b.seq);return S&&C?f.seq-b.seq||f.ts-b.ts||f.idx-b.idx:f.ts-b.ts||f.idx-b.idx}),[m]),ft=h.useMemo(()=>{const u=new Map;for(const f of We.steps||[]){const b=typeof(f==null?void 0:f.runId)=="string"&&f.runId.trim()?f.runId.trim():"no-run";u.has(b)||u.set(b,[]),u.get(b).push(f)}return u},[We.steps]);h.useMemo(()=>{var f,b;const u=new Map;for(const{e:S}of Ee){if((S==null?void 0:S.type)!=="evidence_added"||String(((f=S==null?void 0:S.data)==null?void 0:f.kind)||"")!=="log"||typeof((b=S==null?void 0:S.data)==null?void 0:b.text)!="string")continue;const C=ut(S);u.has(C)||u.set(C,[]),u.get(C).push(S.data.text)}return u},[Ee]);const pt=h.useMemo(()=>{const u=new Map;for(const{e:f}of Ee){const b=String((f==null?void 0:f.type)||"");if(b!=="run_finished"&&b!=="run_completed")continue;const S=ut(f);u.set(S,!0)}return u},[Ee]),gt=h.useMemo(()=>{const u=new Set;for(const b of ft.keys())u.add(b);for(const b of pt.keys())u.add(b);const f=new Map;for(const b of u){const S=ft.get(b)||[],C=pt.get(b)===!0,O=S.some(I=>(I==null?void 0:I.status)==="running"),ae=S.some(I=>(I==null?void 0:I.status)==="failed"),Q=S.length>0&&S.every(I=>(I==null?void 0:I.status)!=="running"),M=O?"running":ae?"failed":C||Q?"done":"idle";f.set(b,{status:M,terminal:C})}return f},[ft,pt]);h.useEffect(()=>{Cs(u=>{let f=!1;const b={...u};for(const[S,C]of gt.entries()){const O=$t[S]||"auto";C.status==="running"&&O!=="manual"&&(b[S]||(b[S]=!0,f=!0))}return f?b:u}),Is(u=>{let f=!1;const b={...u};for(const[S,C]of gt.entries()){const O=b[S]||"auto";C.status==="running"&&O!=="manual"&&b[S]!=="auto"&&(b[S]="auto",f=!0),C.terminal&&O!=="manual"&&b[S]!=="auto"&&(b[S]="auto",f=!0)}return f?b:u})},[gt,$t]);const Rs=u=>{let f=typeof u=="string"?u:u&&typeof u=="object"&&typeof u.text=="string"?u.text:String(u??"");if(f=f.replace(/\r\n/g,`
`),!f.trim())return"";const b=f.toLowerCase(),S=["file_write","file_read","file_edit","shell_execute","web_search","knowledge_search","grep_search","read_file_tree","scaffold_project","install_dependencies","check_syntax","image_generate","browser_"],C=S.reduce((Q,M)=>Q+(b.includes(M)?1:0),0);return C>=2||/(\bplan\s*#\d+\b)/i.test(f)&&/\b\d+(\.\d+)?s\b/.test(f)&&C>=1||/\bLog\b/.test(f)&&C>=1||/\[20\d\d-\d\d-\d\dT/.test(f)&&C>=1?f.split(`
`).map(Q=>Q.trimEnd()).filter(Q=>{const M=Q.trim();if(!M)return!1;const I=M.toLowerCase();return!(S.some(q=>I.includes(q))||/^\d+(\.\d+)?s\b/i.test(M)||/\bplan\s*#\d+\b/i.test(M)||/\bLog\b/.test(M)||/\[20\d\d-\d\d-\d\dT/.test(M)||/^تم إنهاء التنفيذ\b/.test(M))}).join(`
`).trim():f},Os=h.useMemo(()=>{const u=[],f=new Set;for(const{e:b,idx:S}of Ee){const C=String((b==null?void 0:b.type)||"");if(C==="step_started"||C==="step_progress"||C==="step_done"||C==="step_failed"||C==="evidence_added"){const O=ut(b);f.has(O)||(f.add(O),u.push({kind:"activity",key:`activity:${O}:${S}`,runId:O}));continue}C==="user_input"?u.push({kind:"user",key:`user:${S}`,e:b,idx:S}):C==="text"?u.push({kind:"text",key:`text:${S}`,e:b,idx:S}):C==="error"?u.push({kind:"error",key:`error:${S}`,e:b,idx:S}):C==="artifact_created"&&u.push({kind:"artifact",key:`artifact:${S}`,e:b,idx:S})}return u},[Ee]);return n.jsxs("div",{className:"composer",children:[n.jsx("div",{className:"events",ref:Re,children:n.jsxs("div",{className:"events-content",ref:Ke,children:[m.length===0&&n.jsxs("div",{className:"empty-state",children:[n.jsx("div",{className:"empty-state-logo-ring",children:n.jsx("span",{className:"empty-state-logo-text",children:"J"})}),n.jsx("h2",{className:"empty-state-title",children:c("welcomeTitle","How can I help you today?")}),n.jsxs("div",{className:"empty-state-suggestions",children:[n.jsxs("button",{className:"suggestion-card",onClick:()=>d("Write a React component for a login form"),children:[n.jsx("div",{className:"suggestion-icon",children:n.jsx(_t,{size:20})}),n.jsx("div",{className:"suggestion-text",children:"Create a Login Form"})]}),n.jsxs("button",{className:"suggestion-card",onClick:()=>d("Explain how useEffect works"),children:[n.jsx("div",{className:"suggestion-icon",children:n.jsx(yt,{size:20})}),n.jsx("div",{className:"suggestion-text",children:"Explain React Hooks"})]}),n.jsxs("button",{className:"suggestion-card",onClick:()=>d("Analyze this project structure"),children:[n.jsx("div",{className:"suggestion-icon",children:n.jsx(ds,{size:20})}),n.jsx("div",{className:"suggestion-text",children:"Analyze Project"})]}),n.jsxs("button",{className:"suggestion-card",onClick:()=>d("Write a Python script to scrape a website"),children:[n.jsx("div",{className:"suggestion-icon",children:n.jsx(Bs,{size:20})}),n.jsx("div",{className:"suggestion-text",children:"Python Scripting"})]})]})]}),n.jsx(us,{mode:"popLayout",children:Os.map(u=>{var f,b,S,C,O,ae,Q,M;if(u.kind==="activity")return null;if(u.kind==="user")return n.jsx(Wt,{event:u.e,isUser:!0},u.key);if(u.kind==="error")return n.jsx(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"message-row joe",children:n.jsxs("div",{className:"message-bubble error",dir:"auto",style:{color:"#ef4444",border:"1px solid #ef4444",background:"rgba(239, 68, 68, 0.1)"},children:["⚠️ ",(f=u.e)==null?void 0:f.data]})},u.key);if(u.kind==="text"){let I=(b=u.e)==null?void 0:b.data;try{if(typeof I=="string"&&(I.startsWith("{")||I.startsWith("["))){const ee=JSON.parse(I);I=ee.text||ee.output||I}}catch{}const q=Rs(I);return q?n.jsx(Wt,{event:{data:{text:q}},isUser:!1,onOptionClick:ee=>dt(ee)},u.key):null}if(u.kind==="artifact"){const I=u.e,q=(S=I==null?void 0:I.data)==null?void 0:S.kind,ee=(C=I==null?void 0:I.data)==null?void 0:C.href;if((q==="browser_stream"||typeof ee=="string"&&/^wss?:\/\//i.test(ee)&&/\/ws\//i.test(ee))&&ee)return e==="agent"&&t?null:n.jsx(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"message-row joe",children:n.jsx("div",{className:"event-artifact",style:{padding:0},children:n.jsx(h.Suspense,{fallback:n.jsx("div",{style:{padding:12,fontSize:12,opacity:.7},children:"Loading Stream..."}),children:n.jsx(Bn,{wsUrl:ee})})})},u.key);const K=/\.(png|jpg|jpeg|webp|gif)$/i.test(((O=I==null?void 0:I.data)==null?void 0:O.name)||"")||/\.(png|jpg|jpeg|webp|gif)$/i.test(((ae=I==null?void 0:I.data)==null?void 0:ae.href)||""),k=/\.(mp4|webm|mov)$/i.test(((Q=I==null?void 0:I.data)==null?void 0:Q.name)||"")||/\.(mp4|webm|mov)$/i.test(((M=I==null?void 0:I.data)==null?void 0:M.href)||"");return K?n.jsx(ve.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"message-row joe",children:n.jsxs("div",{className:"image-generation-frame",children:[n.jsx("div",{className:"scanline-overlay"}),n.jsx("img",{src:I.data.href,alt:I.data.name,className:"image-generation-img"})]})},u.key):n.jsx(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"message-row joe",children:n.jsxs("div",{className:"event-artifact",children:[k?n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[n.jsx(Ms,{size:16,className:"artifact-icon"}),n.jsx("div",{className:"artifact-title",children:c("artifacts.video")})]}),n.jsx("video",{controls:!0,src:I.data.href,style:{width:"100%",borderRadius:8}})]}):n.jsx(n.Fragment,{children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[n.jsx(_t,{size:20,className:"artifact-icon"}),n.jsxs("div",{className:"artifact-info",children:[n.jsx("div",{className:"artifact-title",children:c("artifacts.file")}),n.jsx("div",{className:"artifact-name",children:I.data.name})]})]})}),n.jsx("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end"},children:n.jsxs("a",{href:I.data.href,target:"_blank",rel:"noopener noreferrer",className:"artifact-link",children:[n.jsx(Vs,{size:12})," ",c("artifacts.openNewWindow")]})})]})},u.key)}return null})}),ie&&n.jsx(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"message-row joe",children:n.jsxs("div",{className:"px-3 py-2",dir:"auto",children:[n.jsx("div",{className:"text-[10px] leading-3 font-light text-zinc-400/65",children:"يفكّر…"}),n.jsx(Mn,{isThinking:ie,toolVisible:fe,activeToolName:Y}),Ce.length?n.jsx("div",{className:"mt-0.5 text-[10px] leading-3 font-light text-zinc-500/60",children:Ce.join(" › ")}):null]})}),n.jsx("div",{ref:Ie})]})}),N&&n.jsx("div",{className:"approval-modal",children:n.jsxs("div",{className:"approval-content",children:[n.jsx("h3",{children:c("approvalRequired")}),n.jsx("div",{className:"risk-badge",children:N.risk}),n.jsxs("p",{children:[c("action"),": ",N.action]}),n.jsxs("div",{className:"approval-actions",children:[n.jsx("button",{onClick:()=>Tt("denied"),className:"btn deny",children:c("deny")}),n.jsx("button",{onClick:()=>Tt("approved"),className:"btn approve",children:c("approve")})]})]})}),bs&&n.jsx("div",{className:"providers-modal-overlay",onClick:()=>it(!1),children:n.jsxs("div",{className:"providers-modal",onClick:u=>u.stopPropagation(),children:[n.jsxs("div",{className:"providers-left",children:[n.jsxs("h3",{style:{margin:"0 0 16px 0",fontSize:16,fontWeight:700,display:"flex",alignItems:"center",gap:8},children:[n.jsx(Dt,{size:18})," Providers"]}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:Object.entries(Z).map(([u,f])=>n.jsxs("button",{onClick:()=>at(u),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderRadius:8,border:"none",background:F===u?"var(--bg-primary, var(--bg-card))":"transparent",color:F===u?"var(--text-primary)":"var(--text-muted)",cursor:"pointer",textAlign:"left",fontWeight:F===u?600:400,transition:"all 0.2s"},children:[n.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:f.isConnected?"#22c55e":f.apiKey?"#eab308":"#71717a",boxShadow:f.isConnected?"0 0 8px #22c55e":"none"}}),f.name.split(" ")[0]]}),F===u&&n.jsx(fs,{size:14})]},u))})]}),n.jsx("div",{className:"providers-right",children:Z[F]&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24},children:[n.jsxs("div",{children:[n.jsx("h2",{style:{margin:0,fontSize:20},children:Z[F].name}),n.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",gap:6},children:[n.jsx("div",{style:{padding:"2px 8px",borderRadius:12,fontSize:11,fontWeight:600,background:Z[F].isConnected?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:Z[F].isConnected?"#22c55e":"#ef4444"},children:Z[F].isConnected?"CONNECTED":"DISCONNECTED"}),Z[F].isVerifying&&n.jsx(qe,{size:12,className:"spin"})]})]}),n.jsx("button",{onClick:()=>it(!1),style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},children:n.jsx(bt,{size:20})})]}),n.jsxs("div",{style:{flex:1},children:[n.jsxs("div",{style:{marginBottom:20},children:[n.jsx("label",{style:{display:"block",fontSize:13,fontWeight:500,marginBottom:8},children:"API Key"}),n.jsxs("div",{style:{position:"relative",display:"flex",gap:8},children:[n.jsxs("div",{style:{position:"relative",flex:1},children:[n.jsx("input",{type:Ot[F]?"text":"password",value:Z[F].apiKey,onChange:u=>Ne(f=>({...f,[F]:{...f[F],apiKey:u.target.value,isConnected:!1}})),placeholder:"sk-...",style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-secondary)",color:"var(--text-primary)",outline:"none",fontSize:14}}),n.jsx("button",{onClick:()=>vs(u=>({...u,[F]:!u[F]})),style:{position:"absolute",right:10,top:10,background:"none",border:"none",cursor:"pointer",opacity:.5},children:Ot[F]?n.jsx(ls,{size:16}):n.jsx(cs,{size:16})})]}),n.jsx("button",{onClick:()=>Ns(F),title:"Clear Key",style:{padding:"0 12px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-secondary)",color:"#ef4444",cursor:"pointer"},children:n.jsx(Xe,{size:18})})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:20},children:[n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:13,fontWeight:500,marginBottom:8},children:"Model ID"}),n.jsx("input",{type:"text",value:Z[F].model||"",onChange:u=>Ne(f=>({...f,[F]:{...f[F],model:u.target.value}})),placeholder:"gpt-4o",style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-secondary)",color:"var(--text-primary)",outline:"none",fontSize:14}})]}),F==="grok"&&n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:13,fontWeight:500,marginBottom:8},children:"Base URL"}),n.jsx("input",{type:"text",value:Z[F].baseUrl||"",onChange:u=>Ne(f=>({...f,[F]:{...f[F],baseUrl:u.target.value}})),placeholder:"https://api...",style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-secondary)",color:"var(--text-primary)",outline:"none",fontSize:14}})]})]}),Z[F].lastError&&n.jsxs("div",{style:{padding:12,borderRadius:8,background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.2)",color:"#ef4444",fontSize:13,marginBottom:20,display:"flex",alignItems:"center",gap:8},children:[n.jsx(Ks,{size:16}),Z[F].lastError]})]}),n.jsx("div",{style:{display:"flex",gap:12,paddingTop:20,borderTop:"1px solid var(--border-color)"},children:n.jsx("button",{onClick:()=>ks(F),disabled:Z[F].isVerifying,style:{flex:1,padding:"12px",borderRadius:8,border:"none",background:Z[F].isConnected?"#22c55e":"var(--accent-primary)",color:"#fff",fontSize:14,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8,opacity:Z[F].isVerifying?.7:1},children:Z[F].isVerifying?n.jsxs(n.Fragment,{children:[n.jsx(qe,{size:18,className:"spin"})," Verifying..."]}):Z[F].isConnected?n.jsxs(n.Fragment,{children:[n.jsx(Hs,{size:18})," Verified & Active"]}):n.jsxs(n.Fragment,{children:[n.jsx(yt,{size:18})," Connect & Activate"]})})})]})})]})}),g.length>0&&n.jsx("div",{className:"attached-files",children:g.map((u,f)=>n.jsxs("div",{className:"attached-file-chip",children:[n.jsx("span",{className:"file-name",children:u.name}),n.jsx("button",{onClick:()=>y(b=>b.filter((S,C)=>C!==f)),className:"remove-file-btn",children:n.jsx(bt,{size:12})})]},f))}),n.jsxs("div",{className:"input-area",children:[n.jsx("textarea",{value:l,onChange:u=>d(u.target.value),placeholder:c("inputPlaceholder"),dir:"auto",disabled:!!N,onKeyDown:u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),dt())}}),n.jsxs("div",{className:"input-actions",children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("div",{style:{width:8,height:8,borderRadius:"50%",backgroundColor:E?"#22c55e":"#ef4444",boxShadow:E?"0 0 6px #22c55e":"none",transition:"all 0.3s"},title:c(E?"connected":"connecting")}),n.jsx("span",{style:{fontSize:12,color:"var(--text-muted)"},children:c(E?"connected":"connecting")})]}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("div",{style:{position:"relative"},children:n.jsx("button",{className:"provider-btn",onClick:()=>it(!0),title:"AI Providers",children:n.jsx(Dt,{size:20})})}),n.jsx("input",{type:"file",ref:P,onChange:Ss,style:{display:"none"}}),n.jsx("button",{className:"mic-button",onClick:()=>{var u;return(u=P.current)==null?void 0:u.click()},title:c("attachFile")||"Attach file",disabled:p,style:{background:"transparent",border:"none",cursor:"pointer",opacity:p?.5:1},children:p?n.jsx(qe,{size:20,className:"spin"}):n.jsx(Ws,{size:20})}),n.jsx("button",{className:`mic-button ${B?"active":""}`,onClick:()=>z(!B),title:"Voice Mode",style:{background:"transparent",border:"none",cursor:"pointer",color:B?"var(--accent-primary)":"inherit",position:"relative"},children:B?n.jsx(Ut,{size:20}):n.jsx(Js,{size:20})}),n.jsx("button",{className:"send-button",onClick:()=>dt(),disabled:!l.trim()||!!N,title:c("send"),children:n.jsx(qs,{size:20})})]})]}),B&&n.jsxs("div",{style:{padding:10,background:"var(--bg-secondary)",borderTop:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"center",gap:16},children:[n.jsx("button",{className:`voice-btn ${_?"listening":""}`,onClick:js,style:{width:50,height:50,borderRadius:"50%",border:"none",background:_?"#ef4444":"var(--accent-primary)",color:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:_?"0 0 15px rgba(239, 68, 68, 0.5)":"none",transition:"all 0.3s"},children:_?n.jsx(qe,{className:"spin",size:24}):n.jsx(Ut,{size:24})}),n.jsxs("div",{style:{fontSize:14,fontWeight:500,display:"flex",flexDirection:"column",gap:4},children:[n.jsx("span",{children:_?"Listening...":"Tap to Speak"}),n.jsx("span",{style:{fontSize:10,opacity:.7},children:"Arabic (SA) / English (US)"})]}),n.jsx("button",{className:"icon-btn",title:"Stop Speaking",onClick:lt,disabled:!D,style:{marginLeft:"auto",opacity:D?1:.3},children:n.jsx(Gs,{size:18})})]})]})]})}function mt({session:a,isActive:e,onSelect:t,onDelete:s,onPin:r,onShare:i}){const[o,c]=h.useState(!1),l=h.useRef(null);return h.useEffect(()=>{function d(g){l.current&&!l.current.contains(g.target)&&c(!1)}return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]),n.jsxs("div",{className:`session-item ${e?"active":""}`,children:[n.jsx("button",{className:"session-btn",onClick:t,children:n.jsxs("div",{className:"session-info",children:[n.jsxs("div",{className:"session-title",children:[a.isPinned&&n.jsx(Bt,{size:12,className:"pin-icon",fill:"currentColor"}),n.jsx("span",{children:a.title})]}),a.lastSnippet&&n.jsx("div",{className:"session-snippet",children:a.lastSnippet})]})}),n.jsx("button",{className:"menu-trigger",onClick:d=>{d.stopPropagation(),c(!o)},children:n.jsx(Ys,{size:16})}),o&&n.jsxs("div",{className:"session-menu",ref:l,children:[n.jsxs("button",{onClick:d=>{d.stopPropagation(),r(),c(!1)},children:[n.jsx(Bt,{size:14})," ",a.isPinned?"إلغاء التثبيت":"تثبيت"]}),n.jsxs("button",{onClick:d=>{d.stopPropagation(),i(),c(!1)},children:[n.jsx(Qs,{size:14})," مشاركة"]}),n.jsx("div",{className:"divider"}),n.jsxs("button",{className:"delete",onClick:d=>{d.stopPropagation(),s(),c(!1)},children:[n.jsx(Xe,{size:14})," حذف"]})]})]})}const Vn=h.lazy(()=>ps(()=>import("./AgentBrowserStream-BGYLW3Q3.js"),__vite__mapDeps([0,1,2,3])));function Kn({onSession:a,autoOpen:e,minimal:t,initialSession:s}){const[r,i]=h.useState("https://www.google.com"),[o,c]=h.useState((s==null?void 0:s.wsUrl)||null),[l,d]=h.useState(!1),[g,y]=h.useState(null),p=h.useRef(!1);h.useEffect(()=>{s!=null&&s.wsUrl&&c(s.wsUrl)},[s]);async function R(m){var j,N,$,E,W;d(!0),y(null);try{const _=localStorage.getItem("token"),G=typeof m=="string"&&m.trim()?m.trim():r,z=await(await fetch(`${se}/tools/browser_open/execute`,{method:"POST",headers:{"Content-Type":"application/json",..._?{Authorization:`Bearer ${_}`}:{}},body:JSON.stringify({url:G})})).json(),D=((j=z==null?void 0:z.output)==null?void 0:j.wsUrl)||((E=($=(N=z==null?void 0:z.artifacts)==null?void 0:N.find)==null?void 0:$.call(N,U=>(U==null?void 0:U.kind)==="browser_stream"))==null?void 0:E.href);if(!(z!=null&&z.ok)||!D){c(null),y(String((z==null?void 0:z.error)||"فشل فتح المتصفح"));return}const J=String(((W=z==null?void 0:z.output)==null?void 0:W.sessionId)||""),X=String(D);c(X),J&&X&&(a==null||a({sessionId:J,wsUrl:X}),window.dispatchEvent(new CustomEvent("joe:browser_opened",{detail:{sessionId:J,wsUrl:X}})))}catch(_){c(null),y(String((_==null?void 0:_.message)||_))}finally{d(!1)}}return h.useEffect(()=>{e&&(p.current||(p.current=!0,R()))},[e]),h.useEffect(()=>{const m=j=>{const N=(j==null?void 0:j.detail)||{},$=typeof(N==null?void 0:N.url)=="string"?N.url:void 0;typeof $=="string"&&$.trim()&&i($.trim()),R($)};return window.addEventListener("joe:browser_open_request",m),()=>window.removeEventListener("joe:browser_open_request",m)},[]),h.useEffect(()=>{const m=j=>{const N=(j==null?void 0:j.detail)||{},$=String((N==null?void 0:N.sessionId)||""),E=String((N==null?void 0:N.wsUrl)||"");$&&E&&(c(E),a==null||a({sessionId:$,wsUrl:E}))};return window.addEventListener("joe:browser_attached",m),()=>window.removeEventListener("joe:browser_attached",m)},[]),n.jsx("div",{className:"browser-app",style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:n.jsx("div",{style:{flex:1,overflow:"hidden"},children:o?n.jsx(h.Suspense,{fallback:n.jsx("div",{style:{padding:12,color:"var(--text-secondary)"},children:"Loading Stream..."}),children:n.jsx(Vn,{wsUrl:o,minimal:t})}):n.jsx("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",padding:16,color:"var(--text-secondary)"},dir:"auto",children:n.jsxs("div",{style:{textAlign:"center"},children:[g?n.jsx("div",{style:{color:"#ef4444",marginBottom:10},children:g}):null,n.jsx("div",{children:l?"...جاري فتح المتصفح":"سيتم فتح المتصفح تلقائياً عند الحاجة."})]})})})})}function Hn(){const[a,e]=h.useState([]),[t,s]=h.useState([]),[r,i]=h.useState([]),[o,c]=h.useState({}),[l,d]=h.useState(null),[g,y]=h.useState(null),[p,R]=h.useState(!0),[m,j]=h.useState("agent"),[N,$]=h.useState(""),[E,W]=h.useState(!1),[_,G]=h.useState([]),[B,z]=h.useState(!1),[D,J]=h.useState(null),[X,U]=h.useState(null),ie=nt();h.useEffect(()=>{const x=w=>{const P=(w==null?void 0:w.detail)||{};P.sessionId&&P.wsUrl&&(U({sessionId:P.sessionId,wsUrl:P.wsUrl}),J(P.sessionId),j("agent"))};return window.addEventListener("joe:browser_attached",x),()=>window.removeEventListener("joe:browser_attached",x)},[]);function Se(){d(null),$(""),G([])}async function Y(){const x=localStorage.getItem("token");try{const w=await fetch(`${se}/sessions?kind=chat`,{headers:{Authorization:x?`Bearer ${x}`:""}});if(w.status===401){localStorage.removeItem("token"),ie("/login");return}const le=((await w.json()).sessions||[]).map(he=>({...he,id:he.id||he._id}));e(le),!l&&le[0]&&d(le[0].id)}catch(w){console.error("Failed to load sessions",w)}}async function ne(){const x=localStorage.getItem("token");try{const w=await fetch(`${se}/sessions?kind=agent`,{headers:{Authorization:x?`Bearer ${x}`:""}});if(w.status===401){localStorage.removeItem("token"),ie("/login");return}const le=((await w.json()).sessions||[]).map(he=>({...he,id:he.id||he._id}));s(le),!g&&le[0]&&y(le[0].id)}catch(w){console.error("Failed to load agent sessions",w)}}async function fe(){const x=localStorage.getItem("token");try{const w=await fetch(`${se}/folders`,{headers:{Authorization:x?`Bearer ${x}`:""}});if(w.ok){const P=await w.json();i(P)}}catch(w){console.error("Failed to load folders",w)}}h.useEffect(()=>{Y(),ne(),fe()},[]),h.useEffect(()=>{m==="agent"?(R(!1),t.length===0&&ne()):(R(!B),a.length===0&&Y())},[m]),h.useEffect(()=>{var le;const x=window.matchMedia("(max-width: 900px)"),w=()=>{z(x.matches),R(!x.matches)};w();const P=()=>w();return typeof x.addEventListener=="function"?x.addEventListener("change",P):(le=x.addListener)==null||le.call(x,P),()=>{var he;typeof x.removeEventListener=="function"?x.removeEventListener("change",P):(he=x.removeListener)==null||he.call(x,P)}},[]);async function ye(){const x=prompt("اسم المجلد الجديد:");if(!x)return;const w=localStorage.getItem("token");(await fetch(`${se}/folders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:w?`Bearer ${w}`:""},body:JSON.stringify({name:x})})).ok&&await fe()}async function Ce(x){if(!confirm("هل أنت متأكد من حذف هذا المجلد؟ سيتم نقل الجلسات إلى القائمة الرئيسية."))return;const w=localStorage.getItem("token");await fetch(`${se}/folders/${x}`,{method:"DELETE",headers:{Authorization:w?`Bearer ${w}`:""}}),await fe(),await Y()}async function re(x,w){const P=localStorage.getItem("token");await fetch(`${se}/sessions/${x}/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:P?`Bearer ${P}`:""},body:JSON.stringify({folderId:w})}),await Y()}async function pe(x,w){if(x===w||!confirm("Are you sure you want to merge these sessions? This cannot be undone."))return;const P=localStorage.getItem("token");(await fetch(`${se}/sessions/merge`,{method:"POST",headers:{"Content-Type":"application/json",...P?{Authorization:`Bearer ${P}`}:{}},body:JSON.stringify({sourceId:x,targetId:w})})).ok&&(await Y(),l===x&&d(w))}async function oe(x){if(!confirm("هل أنت متأكد من حذف هذه الجلسة؟"))return;const w=localStorage.getItem("token");await fetch(`${se}/sessions/${x}`,{method:"DELETE",headers:{Authorization:w?`Bearer ${w}`:""}}),await Y(),l===x&&d(null)}async function ke(x){if(!confirm("هل أنت متأكد من حذف هذه الجلسة؟"))return;const w=localStorage.getItem("token");await fetch(`${se}/sessions/${x}`,{method:"DELETE",headers:{Authorization:w?`Bearer ${w}`:""}}),await ne(),g===x&&y(null)}async function Ie(){if(!confirm("هل أنت متأكد من حذف جميع الجلسات؟ لا يمكن التراجع عن هذا الإجراء."))return;const x=localStorage.getItem("token");await fetch(`${se}/sessions`,{method:"DELETE",headers:{Authorization:x?`Bearer ${x}`:""}}),await Y(),d(null)}async function Re(x,w){const P=localStorage.getItem("token");await fetch(`${se}/sessions/${x}/pin`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:P?`Bearer ${P}`:""},body:JSON.stringify({isPinned:!w})}),await Y()}async function Ke(x,w){const P=localStorage.getItem("token");await fetch(`${se}/sessions/${x}/pin`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:P?`Bearer ${P}`:""},body:JSON.stringify({isPinned:!w})}),await ne()}function je(x){alert("تم نسخ رابط الجلسة")}return h.useEffect(()=>{if(!N){W(!1),G([]);return}const x=setTimeout(async()=>{W(!0);const w=localStorage.getItem("token");try{const le=await(await fetch(`${se}/sessions/search?q=${encodeURIComponent(N)}&kind=chat`,{headers:w?{Authorization:`Bearer ${w}`}:{}})).json();G(le.results||[])}catch(P){console.error(P)}},500);return()=>clearTimeout(x)},[N]),n.jsxs("div",{className:`joe-layout ${p?"sidebar-open":"sidebar-closed"}`,children:[m==="chat"&&p&&B&&n.jsx("div",{className:"sidebar-backdrop",onClick:()=>R(!1)}),m==="chat"&&p&&n.jsxs("aside",{className:"sidebar",children:[n.jsxs("div",{className:"sidebar-header",children:[n.jsxs("button",{className:"new-chat-btn",onClick:Se,children:[n.jsx("span",{children:"+"})," محادثة جديدة"]}),n.jsx("button",{className:"close-sidebar-btn",onClick:()=>R(!1),children:n.jsx(Xs,{size:20})})]}),n.jsx("div",{className:"search-box-container",style:{padding:"0 4px",marginBottom:16},children:n.jsxs("div",{className:"search-input-wrapper",children:[n.jsx(ds,{size:14,className:"search-icon"}),n.jsx("input",{type:"text",placeholder:"بحث في المحادثات...",value:N,onChange:x=>$(x.target.value),className:"search-input"})]})}),N?n.jsx("div",{className:"session-list",children:_.length===0?n.jsx("div",{style:{padding:16,textAlign:"center",color:"var(--text-muted)",fontSize:13},children:"لا توجد نتائج"}):_.map(x=>n.jsxs("button",{className:"search-result-item",onClick:()=>{d(x.sessionId),$(""),B&&R(!1)},children:[n.jsx("div",{className:"result-session-title",children:x.sessionTitle}),n.jsx("div",{className:"result-content",children:x.content}),n.jsx("div",{className:"result-date",children:new Date(x.createdAt).toLocaleDateString()})]},x.messageId))}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 8px",marginBottom:8},children:[n.jsx("div",{className:"section-title",style:{margin:0},children:"المجلدات"}),n.jsx("button",{onClick:ye,style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},title:"مجلد جديد",children:n.jsx(Zs,{size:16})})]}),n.jsxs("div",{className:"session-list",children:[r.map(x=>n.jsxs("div",{onDragOver:w=>{w.preventDefault(),w.dataTransfer.dropEffect="move",w.currentTarget.style.background="rgba(255,215,0,0.1)"},onDragLeave:w=>{w.currentTarget.style.background="transparent"},onDrop:w=>{w.preventDefault(),w.currentTarget.style.background="transparent";const P=w.dataTransfer.getData("sessionId");P&&re(P,x._id)},children:[n.jsxs("div",{className:"folder-header",style:{display:"flex",alignItems:"center",padding:"8px",cursor:"pointer",color:"var(--text-secondary)"},onClick:()=>c(w=>({...w,[x._id]:!w[x._id]})),children:[o[x._id]?n.jsx(en,{size:14}):n.jsx(fs,{size:14}),n.jsx(tn,{size:14,style:{margin:"0 8px",color:"var(--accent-primary)"}}),n.jsx("span",{style:{fontSize:13,flex:1},children:x.name}),n.jsx("button",{onClick:w=>{w.stopPropagation(),Ce(x._id)},style:{background:"none",border:"none",color:"var(--text-muted)",cursor:"pointer",opacity:.5},className:"folder-delete-btn",children:n.jsx(Xe,{size:12})})]}),o[x._id]&&n.jsxs("div",{style:{paddingRight:16},children:[a.filter(w=>w.folderId===x._id).map(w=>n.jsx("div",{draggable:!0,onDragStart:P=>{P.dataTransfer.setData("sessionId",w.id)},children:n.jsx(mt,{session:w,isActive:l===w.id,onSelect:()=>{d(w.id),B&&R(!1)},onDelete:()=>oe(w.id),onPin:()=>Re(w.id,!!w.isPinned),onShare:()=>je(w.id)})},w.id)),a.filter(w=>w.folderId===x._id).length===0&&n.jsx("div",{style:{fontSize:11,color:"var(--text-muted)",padding:"4px 8px 8px"},children:"مجلد فارغ"})]})]},x._id)),n.jsx("div",{className:"section-title",style:{marginTop:16},onDragOver:x=>{x.preventDefault(),x.dataTransfer.dropEffect="move"},onDrop:x=>{x.preventDefault();const w=x.dataTransfer.getData("sessionId");w&&re(w,null)},children:"جلسات أخرى"}),a.filter(x=>!x.folderId).map(x=>n.jsx("div",{draggable:!0,onDragStart:w=>{w.dataTransfer.setData("sessionId",x.id),w.dataTransfer.effectAllowed="move"},onDragOver:w=>{w.preventDefault(),w.dataTransfer.dropEffect="move"},onDrop:w=>{w.preventDefault();const P=w.dataTransfer.getData("sessionId");P&&P!==x.id&&pe(P,x.id)},children:n.jsx(mt,{session:x,isActive:l===x.id,onSelect:()=>{d(x.id),B&&R(!1)},onDelete:()=>oe(x.id),onPin:()=>Re(x.id,!!x.isPinned),onShare:()=>je(x.id)})},x.id))]})]}),n.jsx("div",{className:"sidebar-footer",children:n.jsxs("button",{className:"delete-all-btn",onClick:Ie,children:[n.jsx(Xe,{size:16})," حذف جميع الجلسات"]})})]}),m==="chat"&&!p&&n.jsx("button",{className:"sidebar-toggle-btn",style:{position:"absolute",left:16,top:16},onClick:()=>R(!0),children:n.jsx(sn,{size:20})}),n.jsxs("main",{className:"center",style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[n.jsxs("div",{className:"joe-modebar",style:{height:48,borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",padding:"0 16px",gap:8,background:"var(--bg-secondary)",flexShrink:0,overflowX:"auto",WebkitOverflowScrolling:"touch",whiteSpace:"nowrap"},children:[n.jsxs("button",{onClick:()=>j("agent"),style:{background:"none",border:"none",color:m==="agent"?"var(--accent-primary)":"var(--text-secondary)",fontWeight:m==="agent"?600:400,cursor:"pointer",display:"flex",alignItems:"center",gap:6,padding:"6px 12px",borderRadius:6,backgroundColor:m==="agent"?"rgba(37, 99, 235, 0.1)":"transparent"},children:[n.jsx(nn,{size:16})," الوكيل"]}),n.jsxs("button",{onClick:()=>j("chat"),style:{background:"none",border:"none",color:m==="chat"?"var(--accent-primary)":"var(--text-secondary)",fontWeight:m==="chat"?600:400,cursor:"pointer",display:"flex",alignItems:"center",gap:6,padding:"6px 12px",borderRadius:6,backgroundColor:m==="chat"?"rgba(37, 99, 235, 0.1)":"transparent"},children:[n.jsx(rn,{size:16})," Chat"]})]}),n.jsxs("div",{style:{flex:1,overflow:"hidden",position:"relative",display:"flex",flexDirection:"column"},children:[m==="agent"&&n.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:B?"column":"row"},children:[n.jsxs("div",{style:{width:B?"100%":280,flex:"0 0 auto",minHeight:B?180:0,overflow:"hidden",borderRight:B?void 0:"1px solid var(--border-color)",borderBottom:B?"1px solid var(--border-color)":void 0,background:"var(--bg-secondary)",display:"flex",flexDirection:"column"},children:[n.jsxs("div",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsx("div",{style:{fontWeight:600,color:"var(--text-primary)",fontSize:13},children:"جلسات الوكيل"}),n.jsx("button",{onClick:()=>y(null),style:{height:28,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(37, 99, 235, 0.12)",color:"var(--text-primary)",cursor:"pointer",fontSize:12},children:"جلسة جديدة"})]}),n.jsx("div",{style:{flex:1,overflow:"auto",padding:6},children:t.length===0?n.jsx("div",{style:{padding:12,color:"var(--text-muted)",fontSize:13},children:"لا توجد جلسات بعد"}):t.map(x=>n.jsx(mt,{session:x,isActive:g===x.id,onSelect:()=>y(x.id),onDelete:()=>ke(x.id),onPin:()=>Ke(x.id,!!x.isPinned),onShare:()=>je(x.id)},x.id))})]}),n.jsx("div",{style:{flex:1,minHeight:0,overflow:"hidden",background:"var(--bg-secondary)"},children:n.jsx(Kn,{minimal:!0,autoOpen:!0,onSession:x=>{J(x.sessionId)},initialSession:X})}),n.jsx("div",{style:{width:B?"100%":420,flex:"0 0 auto",minHeight:B?340:0,overflow:"hidden",borderLeft:B?void 0:"1px solid var(--border-color)",borderTop:B?"1px solid var(--border-color)":void 0,background:"var(--bg-secondary)",display:"flex",flexDirection:"column",height:"100%"},children:n.jsx(Jt,{sessionId:g||void 0,sessionKind:"agent",browserSessionId:D,onSessionCreated:async x=>{await ne(),y(x)}})})]}),m==="chat"&&n.jsx(Jt,{sessionId:l||void 0,sessionKind:"chat",onSessionCreated:async x=>{await Y(),d(x)}})]})]})]})}const L=a=>typeof a=="string",Ue=()=>{let a,e;const t=new Promise((s,r)=>{a=s,e=r});return t.resolve=a,t.reject=e,t},qt=a=>a==null?"":""+a,Wn=(a,e,t)=>{a.forEach(s=>{e[s]&&(t[s]=e[s])})},Jn=/###/g,Gt=a=>a&&a.indexOf("###")>-1?a.replace(Jn,"."):a,Yt=a=>!a||L(a),Be=(a,e,t)=>{const s=L(e)?e.split("."):e;let r=0;for(;r<s.length-1;){if(Yt(a))return{};const i=Gt(s[r]);!a[i]&&t&&(a[i]=new t),Object.prototype.hasOwnProperty.call(a,i)?a=a[i]:a={},++r}return Yt(a)?{}:{obj:a,k:Gt(s[r])}},Qt=(a,e,t)=>{const{obj:s,k:r}=Be(a,e,Object);if(s!==void 0||e.length===1){s[r]=t;return}let i=e[e.length-1],o=e.slice(0,e.length-1),c=Be(a,o,Object);for(;c.obj===void 0&&o.length;)i=`${o[o.length-1]}.${i}`,o=o.slice(0,o.length-1),c=Be(a,o,Object),c!=null&&c.obj&&typeof c.obj[`${c.k}.${i}`]<"u"&&(c.obj=void 0);c.obj[`${c.k}.${i}`]=t},qn=(a,e,t,s)=>{const{obj:r,k:i}=Be(a,e,Object);r[i]=r[i]||[],r[i].push(t)},Ze=(a,e)=>{const{obj:t,k:s}=Be(a,e);if(t&&Object.prototype.hasOwnProperty.call(t,s))return t[s]},Gn=(a,e,t)=>{const s=Ze(a,t);return s!==void 0?s:Ze(e,t)},xs=(a,e,t)=>{for(const s in e)s!=="__proto__"&&s!=="constructor"&&(s in a?L(a[s])||a[s]instanceof String||L(e[s])||e[s]instanceof String?t&&(a[s]=e[s]):xs(a[s],e[s],t):a[s]=e[s]);return a},Te=a=>a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Yn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Qn=a=>L(a)?a.replace(/[&<>"'\/]/g,e=>Yn[e]):a;class Xn{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const s=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,s),this.regExpQueue.push(e),s}}const Zn=[" ",",","?","!",";"],er=new Xn(20),tr=(a,e,t)=>{e=e||"",t=t||"";const s=Zn.filter(o=>e.indexOf(o)<0&&t.indexOf(o)<0);if(s.length===0)return!0;const r=er.getRegExp(`(${s.map(o=>o==="?"?"\\?":o).join("|")})`);let i=!r.test(a);if(!i){const o=a.indexOf(t);o>0&&!r.test(a.substring(0,o))&&(i=!0)}return i},kt=function(a,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!a)return;if(a[e])return Object.prototype.hasOwnProperty.call(a,e)?a[e]:void 0;const s=e.split(t);let r=a;for(let i=0;i<s.length;){if(!r||typeof r!="object")return;let o,c="";for(let l=i;l<s.length;++l)if(l!==i&&(c+=t),c+=s[l],o=r[c],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&l<s.length-1)continue;i+=l-i+1;break}r=o}return r},et=a=>a==null?void 0:a.replace("_","-"),sr={type:"logger",log(a){this.output("log",a)},warn(a){this.output("warn",a)},error(a){this.output("error",a)},output(a,e){var t,s;(s=(t=console==null?void 0:console[a])==null?void 0:t.apply)==null||s.call(t,console,e)}};class tt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||sr,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,s,r){return r&&!this.debug?null:(L(e[0])&&(e[0]=`${s}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new tt(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new tt(this.logger,e)}}var we=new tt;class rt{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const r=this.observers[s].get(t)||0;this.observers[s].set(t,r+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(o=>{let[c,l]=o;for(let d=0;d<l;d++)c(...s)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(o=>{let[c,l]=o;for(let d=0;d<l;d++)c.apply(c,[e,...s])})}}class Xt extends rt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,s){var d,g;let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,o=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let c;e.indexOf(".")>-1?c=e.split("."):(c=[e,t],s&&(Array.isArray(s)?c.push(...s):L(s)&&i?c.push(...s.split(i)):c.push(s)));const l=Ze(this.data,c);return!l&&!t&&!s&&e.indexOf(".")>-1&&(e=c[0],t=c[1],s=c.slice(2).join(".")),l||!o||!L(s)?l:kt((g=(d=this.data)==null?void 0:d[e])==null?void 0:g[t],s,i)}addResource(e,t,s,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const o=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let c=[e,t];s&&(c=c.concat(o?s.split(o):s)),e.indexOf(".")>-1&&(c=e.split("."),r=t,t=c[1]),this.addNamespaces(t),Qt(this.data,c,r),i.silent||this.emit("added",e,t,s,r)}addResources(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const i in s)(L(s[i])||Array.isArray(s[i]))&&this.addResource(e,t,i,s[i],{silent:!0});r.silent||this.emit("added",e,t,s)}addResourceBundle(e,t,s,r,i){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},c=[e,t];e.indexOf(".")>-1&&(c=e.split("."),r=s,s=t,t=c[1]),this.addNamespaces(t);let l=Ze(this.data,c)||{};o.skipCopy||(s=JSON.parse(JSON.stringify(s))),r?xs(l,s,i):l={...l,...s},Qt(this.data,c,l),o.silent||this.emit("added",e,t,s)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(r=>t[r]&&Object.keys(t[r]).length>0)}toJSON(){return this.data}}var ys={processors:{},addPostProcessor(a){this.processors[a.name]=a},handle(a,e,t,s,r){return a.forEach(i=>{var o;e=((o=this.processors[i])==null?void 0:o.process(e,t,s,r))??e}),e}};const Zt={},es=a=>!L(a)&&typeof a!="boolean"&&typeof a!="number";class st extends rt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Wn(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=we.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const s=this.resolve(e,t);return(s==null?void 0:s.res)!==void 0}extractFromKey(e,t){let s=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const r=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const o=s&&e.indexOf(s)>-1,c=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!tr(e,s,r);if(o&&!c){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:L(i)?[i]:i};const d=e.split(s);(s!==r||s===r&&this.options.ns.indexOf(d[0])>-1)&&(i=d.shift()),e=d.join(r)}return{key:e,namespaces:L(i)?[i]:i}}translate(e,t,s){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const r=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,i=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:o,namespaces:c}=this.extractFromKey(e[e.length-1],t),l=c[c.length-1],d=t.lng||this.language,g=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((d==null?void 0:d.toLowerCase())==="cimode"){if(g){const U=t.nsSeparator||this.options.nsSeparator;return r?{res:`${l}${U}${o}`,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:`${l}${U}${o}`}return r?{res:o,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:o}const y=this.resolve(e,t);let p=y==null?void 0:y.res;const R=(y==null?void 0:y.usedKey)||o,m=(y==null?void 0:y.exactUsedKey)||o,j=["[object Number]","[object Function]","[object RegExp]"],N=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,$=!this.i18nFormat||this.i18nFormat.handleAsObject,E=t.count!==void 0&&!L(t.count),W=st.hasDefaultValue(t),_=E?this.pluralResolver.getSuffix(d,t.count,t):"",G=t.ordinal&&E?this.pluralResolver.getSuffix(d,t.count,{ordinal:!1}):"",B=E&&!t.ordinal&&t.count===0,z=B&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${_}`]||t[`defaultValue${G}`]||t.defaultValue;let D=p;$&&!p&&W&&(D=z);const J=es(D),X=Object.prototype.toString.apply(D);if($&&D&&J&&j.indexOf(X)<0&&!(L(N)&&Array.isArray(D))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const U=this.options.returnedObjectHandler?this.options.returnedObjectHandler(R,D,{...t,ns:c}):`key '${o} (${this.language})' returned an object instead of string.`;return r?(y.res=U,y.usedParams=this.getUsedParamsDetails(t),y):U}if(i){const U=Array.isArray(D),ie=U?[]:{},Se=U?m:R;for(const Y in D)if(Object.prototype.hasOwnProperty.call(D,Y)){const ne=`${Se}${i}${Y}`;W&&!p?ie[Y]=this.translate(ne,{...t,defaultValue:es(z)?z[Y]:void 0,joinArrays:!1,ns:c}):ie[Y]=this.translate(ne,{...t,joinArrays:!1,ns:c}),ie[Y]===ne&&(ie[Y]=D[Y])}p=ie}}else if($&&L(N)&&Array.isArray(p))p=p.join(N),p&&(p=this.extendTranslation(p,e,t,s));else{let U=!1,ie=!1;!this.isValidLookup(p)&&W&&(U=!0,p=z),this.isValidLookup(p)||(ie=!0,p=o);const Y=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&ie?void 0:p,ne=W&&z!==p&&this.options.updateMissing;if(ie||U||ne){if(this.logger.log(ne?"updateKey":"missingKey",d,l,o,ne?z:p),i){const re=this.resolve(o,{...t,keySeparator:!1});re&&re.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let fe=[];const ye=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&ye&&ye[0])for(let re=0;re<ye.length;re++)fe.push(ye[re]);else this.options.saveMissingTo==="all"?fe=this.languageUtils.toResolveHierarchy(t.lng||this.language):fe.push(t.lng||this.language);const Ce=(re,pe,oe)=>{var Ie;const ke=W&&oe!==p?oe:Y;this.options.missingKeyHandler?this.options.missingKeyHandler(re,l,pe,ke,ne,t):(Ie=this.backendConnector)!=null&&Ie.saveMissing&&this.backendConnector.saveMissing(re,l,pe,ke,ne,t),this.emit("missingKey",re,l,pe,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&E?fe.forEach(re=>{const pe=this.pluralResolver.getSuffixes(re,t);B&&t[`defaultValue${this.options.pluralSeparator}zero`]&&pe.indexOf(`${this.options.pluralSeparator}zero`)<0&&pe.push(`${this.options.pluralSeparator}zero`),pe.forEach(oe=>{Ce([re],o+oe,t[`defaultValue${oe}`]||z)})}):Ce(fe,o,z))}p=this.extendTranslation(p,e,t,y,s),ie&&p===o&&this.options.appendNamespaceToMissingKey&&(p=`${l}:${o}`),(ie||U)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${o}`:o,U?p:void 0))}return r?(y.res=p,y.usedParams=this.getUsedParamsDetails(t),y):p}extendTranslation(e,t,s,r,i){var d,g;var o=this;if((d=this.i18nFormat)!=null&&d.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const y=L(e)&&(((g=s==null?void 0:s.interpolation)==null?void 0:g.skipOnVariables)!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let p;if(y){const m=e.match(this.interpolator.nestingRegexp);p=m&&m.length}let R=s.replace&&!L(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(R={...this.options.interpolation.defaultVariables,...R}),e=this.interpolator.interpolate(e,R,s.lng||this.language||r.usedLng,s),y){const m=e.match(this.interpolator.nestingRegexp),j=m&&m.length;p<j&&(s.nest=!1)}!s.lng&&r&&r.res&&(s.lng=this.language||r.usedLng),s.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var m=arguments.length,j=new Array(m),N=0;N<m;N++)j[N]=arguments[N];return(i==null?void 0:i[0])===j[0]&&!s.context?(o.logger.warn(`It seems you are nesting recursively key: ${j[0]} in key: ${t[0]}`),null):o.translate(...j,t)},s)),s.interpolation&&this.interpolator.reset()}const c=s.postProcess||this.options.postProcess,l=L(c)?[c]:c;return e!=null&&(l!=null&&l.length)&&s.applyPostProcessor!==!1&&(e=ys.handle(l,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s,r,i,o,c;return L(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(s))return;const d=this.extractFromKey(l,t),g=d.key;r=g;let y=d.namespaces;this.options.fallbackNS&&(y=y.concat(this.options.fallbackNS));const p=t.count!==void 0&&!L(t.count),R=p&&!t.ordinal&&t.count===0,m=t.context!==void 0&&(L(t.context)||typeof t.context=="number")&&t.context!=="",j=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);y.forEach(N=>{var $,E;this.isValidLookup(s)||(c=N,!Zt[`${j[0]}-${N}`]&&(($=this.utils)!=null&&$.hasLoadedNamespace)&&!((E=this.utils)!=null&&E.hasLoadedNamespace(c))&&(Zt[`${j[0]}-${N}`]=!0,this.logger.warn(`key "${r}" for languages "${j.join(", ")}" won't get resolved as namespace "${c}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),j.forEach(W=>{var B;if(this.isValidLookup(s))return;o=W;const _=[g];if((B=this.i18nFormat)!=null&&B.addLookupKeys)this.i18nFormat.addLookupKeys(_,g,W,N,t);else{let z;p&&(z=this.pluralResolver.getSuffix(W,t.count,t));const D=`${this.options.pluralSeparator}zero`,J=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(p&&(_.push(g+z),t.ordinal&&z.indexOf(J)===0&&_.push(g+z.replace(J,this.options.pluralSeparator)),R&&_.push(g+D)),m){const X=`${g}${this.options.contextSeparator}${t.context}`;_.push(X),p&&(_.push(X+z),t.ordinal&&z.indexOf(J)===0&&_.push(X+z.replace(J,this.options.pluralSeparator)),R&&_.push(X+D))}}let G;for(;G=_.pop();)this.isValidLookup(s)||(i=G,s=this.getResource(W,N,G,t))}))})}),{res:s,usedKey:r,exactUsedKey:i,usedLng:o,usedNS:c}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,s){var i;let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return(i=this.i18nFormat)!=null&&i.getResource?this.i18nFormat.getResource(e,t,s,r):this.resourceStore.getResource(e,t,s,r)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=e.replace&&!L(e.replace);let r=s?e.replace:e;if(s&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!s){r={...r};for(const i of t)delete r[i]}return r}static hasDefaultValue(e){const t="defaultValue";for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t===s.substring(0,t.length)&&e[s]!==void 0)return!0;return!1}}class ts{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=we.create("languageUtils")}getScriptPartFromCode(e){if(e=et(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=et(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(L(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(s=>{if(t)return;const r=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(r))&&(t=r)}),!t&&this.options.supportedLngs&&e.forEach(s=>{if(t)return;const r=this.getLanguagePartFromCode(s);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(i=>{if(i===r)return i;if(!(i.indexOf("-")<0&&r.indexOf("-")<0)&&(i.indexOf("-")>0&&r.indexOf("-")<0&&i.substring(0,i.indexOf("-"))===r||i.indexOf(r)===0&&r.length>1))return i})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),L(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let s=e[t];return s||(s=e[this.getScriptPartFromCode(t)]),s||(s=e[this.formatLanguageCode(t)]),s||(s=e[this.getLanguagePartFromCode(t)]),s||(s=e.default),s||[]}toResolveHierarchy(e,t){const s=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],i=o=>{o&&(this.isSupportedCode(o)?r.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return L(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(e))):L(e)&&i(this.formatLanguageCode(e)),s.forEach(o=>{r.indexOf(o)<0&&i(this.formatLanguageCode(o))}),r}}const ss={zero:0,one:1,two:2,few:3,many:4,other:5},ns={select:a=>a===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class nr{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=we.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=et(e==="dev"?"en":e),r=t.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:s,type:r});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let o;try{o=new Intl.PluralRules(s,{type:r})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),ns;if(!e.match(/-|_/))return ns;const l=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(l,t)}return this.pluralRulesCache[i]=o,o}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.getRule(e,t);return s||(s=this.getRule("dev",t)),(s==null?void 0:s.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,s).map(r=>`${t}${r}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.getRule(e,t);return s||(s=this.getRule("dev",t)),s?s.resolvedOptions().pluralCategories.sort((r,i)=>ss[r]-ss[i]).map(r=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${r}`):[]}getSuffix(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=this.getRule(e,s);return r?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,s))}}const rs=function(a,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,i=Gn(a,e,t);return!i&&r&&L(t)&&(i=kt(a,t,s),i===void 0&&(i=kt(e,t,s))),i},xt=a=>a.replace(/\$/g,"$$$$");class rr{constructor(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=we.create("interpolator"),this.options=e,this.format=((t=e==null?void 0:e.interpolation)==null?void 0:t.format)||(s=>s),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:s,useRawValueToEscape:r,prefix:i,prefixEscaped:o,suffix:c,suffixEscaped:l,formatSeparator:d,unescapeSuffix:g,unescapePrefix:y,nestingPrefix:p,nestingPrefixEscaped:R,nestingSuffix:m,nestingSuffixEscaped:j,nestingOptionsSeparator:N,maxReplaces:$,alwaysFormat:E}=e.interpolation;this.escape=t!==void 0?t:Qn,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=i?Te(i):o||"{{",this.suffix=c?Te(c):l||"}}",this.formatSeparator=d||",",this.unescapePrefix=g?"":y||"-",this.unescapeSuffix=this.unescapePrefix?"":g||"",this.nestingPrefix=p?Te(p):R||Te("$t("),this.nestingSuffix=m?Te(m):j||Te(")"),this.nestingOptionsSeparator=N||",",this.maxReplaces=$||1e3,this.alwaysFormat=E!==void 0?E:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,s)=>(t==null?void 0:t.source)===s?(t.lastIndex=0,t):new RegExp(s,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,s,r){var R;let i,o,c;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},d=m=>{if(m.indexOf(this.formatSeparator)<0){const E=rs(t,l,m,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(E,void 0,s,{...r,...t,interpolationkey:m}):E}const j=m.split(this.formatSeparator),N=j.shift().trim(),$=j.join(this.formatSeparator).trim();return this.format(rs(t,l,N,this.options.keySeparator,this.options.ignoreJSONStructure),$,s,{...r,...t,interpolationkey:N})};this.resetRegExp();const g=(r==null?void 0:r.missingInterpolationHandler)||this.options.missingInterpolationHandler,y=((R=r==null?void 0:r.interpolation)==null?void 0:R.skipOnVariables)!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:m=>xt(m)},{regex:this.regexp,safeValue:m=>this.escapeValue?xt(this.escape(m)):xt(m)}].forEach(m=>{for(c=0;i=m.regex.exec(e);){const j=i[1].trim();if(o=d(j),o===void 0)if(typeof g=="function"){const $=g(e,i,r);o=L($)?$:""}else if(r&&Object.prototype.hasOwnProperty.call(r,j))o="";else if(y){o=i[0];continue}else this.logger.warn(`missed to pass in variable ${j} for interpolating ${e}`),o="";else!L(o)&&!this.useRawValueToEscape&&(o=qt(o));const N=m.safeValue(o);if(e=e.replace(i[0],N),y?(m.regex.lastIndex+=o.length,m.regex.lastIndex-=i[0].length):m.regex.lastIndex=0,c++,c>=this.maxReplaces)break}}),e}nest(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r,i,o;const c=(l,d)=>{const g=this.nestingOptionsSeparator;if(l.indexOf(g)<0)return l;const y=l.split(new RegExp(`${g}[ ]*{`));let p=`{${y[1]}`;l=y[0],p=this.interpolate(p,o);const R=p.match(/'/g),m=p.match(/"/g);(((R==null?void 0:R.length)??0)%2===0&&!m||m.length%2!==0)&&(p=p.replace(/'/g,'"'));try{o=JSON.parse(p),d&&(o={...d,...o})}catch(j){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,j),`${l}${g}${p}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,l};for(;r=this.nestingRegexp.exec(e);){let l=[];o={...s},o=o.replace&&!L(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;let d=!1;if(r[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(r[1])){const g=r[1].split(this.formatSeparator).map(y=>y.trim());r[1]=g.shift(),l=g,d=!0}if(i=t(c.call(this,r[1].trim(),o),o),i&&r[0]===e&&!L(i))return i;L(i)||(i=qt(i)),i||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),i=""),d&&(i=l.reduce((g,y)=>this.format(g,y,s.lng,{...s,interpolationkey:r[1].trim()}),i.trim())),e=e.replace(r[0],i),this.regexp.lastIndex=0}return e}}const ir=a=>{let e=a.toLowerCase().trim();const t={};if(a.indexOf("(")>-1){const s=a.split("(");e=s[0].toLowerCase().trim();const r=s[1].substring(0,s[1].length-1);e==="currency"&&r.indexOf(":")<0?t.currency||(t.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?t.range||(t.range=r.trim()):r.split(";").forEach(o=>{if(o){const[c,...l]=o.split(":"),d=l.join(":").trim().replace(/^'+|'+$/g,""),g=c.trim();t[g]||(t[g]=d),d==="false"&&(t[g]=!1),d==="true"&&(t[g]=!0),isNaN(d)||(t[g]=parseInt(d,10))}})}return{formatName:e,formatOptions:t}},$e=a=>{const e={};return(t,s,r)=>{let i=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(i={...i,[r.interpolationkey]:void 0});const o=s+JSON.stringify(i);let c=e[o];return c||(c=a(et(s),r),e[o]=c),c(t)}};class ar{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=we.create("formatter"),this.options=e,this.formats={number:$e((t,s)=>{const r=new Intl.NumberFormat(t,{...s});return i=>r.format(i)}),currency:$e((t,s)=>{const r=new Intl.NumberFormat(t,{...s,style:"currency"});return i=>r.format(i)}),datetime:$e((t,s)=>{const r=new Intl.DateTimeFormat(t,{...s});return i=>r.format(i)}),relativetime:$e((t,s)=>{const r=new Intl.RelativeTimeFormat(t,{...s});return i=>r.format(i,s.range||"day")}),list:$e((t,s)=>{const r=new Intl.ListFormat(t,{...s});return i=>r.format(i)})},this.init(e)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=$e(t)}format(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=t.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(c=>c.indexOf(")")>-1)){const c=i.findIndex(l=>l.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,c)].join(this.formatSeparator)}return i.reduce((c,l)=>{var y;const{formatName:d,formatOptions:g}=ir(l);if(this.formats[d]){let p=c;try{const R=((y=r==null?void 0:r.formatParams)==null?void 0:y[r.interpolationkey])||{},m=R.locale||R.lng||r.locale||r.lng||s;p=this.formats[d](c,m,{...g,...r,...R})}catch(R){this.logger.warn(R)}return p}else this.logger.warn(`there was no format function for ${d}`);return c},e)}}const or=(a,e)=>{a.pending[e]!==void 0&&(delete a.pending[e],a.pendingCount--)};class lr extends rt{constructor(e,t,s){var i,o;let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=s,this.languageUtils=s.languageUtils,this.options=r,this.logger=we.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],(o=(i=this.backend)==null?void 0:i.init)==null||o.call(i,s,r.backend,r)}queueLoad(e,t,s,r){const i={},o={},c={},l={};return e.forEach(d=>{let g=!0;t.forEach(y=>{const p=`${d}|${y}`;!s.reload&&this.store.hasResourceBundle(d,y)?this.state[p]=2:this.state[p]<0||(this.state[p]===1?o[p]===void 0&&(o[p]=!0):(this.state[p]=1,g=!1,o[p]===void 0&&(o[p]=!0),i[p]===void 0&&(i[p]=!0),l[y]===void 0&&(l[y]=!0)))}),g||(c[d]=!0)}),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(c),toLoadNamespaces:Object.keys(l)}}loaded(e,t,s){const r=e.split("|"),i=r[0],o=r[1];t&&this.emit("failedLoading",i,o,t),!t&&s&&this.store.addResourceBundle(i,o,s,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&s&&(this.state[e]=0);const c={};this.queue.forEach(l=>{qn(l.loaded,[i],o),or(l,e),t&&l.errors.push(t),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(d=>{c[d]||(c[d]={});const g=l.loaded[d];g.length&&g.forEach(y=>{c[d][y]===void 0&&(c[d][y]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",c),this.queue=this.queue.filter(l=>!l.done)}read(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:s,tried:r,wait:i,callback:o});return}this.readingCalls++;const c=(d,g)=>{if(this.readingCalls--,this.waitingReads.length>0){const y=this.waitingReads.shift();this.read(y.lng,y.ns,y.fcName,y.tried,y.wait,y.callback)}if(d&&g&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,s,r+1,i*2,o)},i);return}o(d,g)},l=this.backend[s].bind(this.backend);if(l.length===2){try{const d=l(e,t);d&&typeof d.then=="function"?d.then(g=>c(null,g)).catch(c):c(null,d)}catch(d){c(d)}return}return l(e,t,c)}prepareLoading(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();L(e)&&(e=this.languageUtils.toResolveHierarchy(e)),L(t)&&(t=[t]);const i=this.queueLoad(e,t,s,r);if(!i.toLoad.length)return i.pending.length||r(),null;i.toLoad.forEach(o=>{this.loadOne(o)})}load(e,t,s){this.prepareLoading(e,t,{},s)}reload(e,t,s){this.prepareLoading(e,t,{reload:!0},s)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const s=e.split("|"),r=s[0],i=s[1];this.read(r,i,"read",void 0,void 0,(o,c)=>{o&&this.logger.warn(`${t}loading namespace ${i} for language ${r} failed`,o),!o&&c&&this.logger.log(`${t}loaded namespace ${i} for language ${r}`,c),this.loaded(e,o,c)})}saveMissing(e,t,s,r,i){var l,d,g,y,p;let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if((d=(l=this.services)==null?void 0:l.utils)!=null&&d.hasLoadedNamespace&&!((y=(g=this.services)==null?void 0:g.utils)!=null&&y.hasLoadedNamespace(t))){this.logger.warn(`did not save key "${s}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if((p=this.backend)!=null&&p.create){const R={...o,isUpdate:i},m=this.backend.create.bind(this.backend);if(m.length<6)try{let j;m.length===5?j=m(e,t,s,r,R):j=m(e,t,s,r),j&&typeof j.then=="function"?j.then(N=>c(null,N)).catch(c):c(null,j)}catch(j){c(j)}else m(e,t,s,r,c,R)}!e||!e[0]||this.store.addResource(e[0],t,s,r)}}}const is=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:a=>{let e={};if(typeof a[1]=="object"&&(e=a[1]),L(a[1])&&(e.defaultValue=a[1]),L(a[2])&&(e.tDescription=a[2]),typeof a[2]=="object"||typeof a[3]=="object"){const t=a[3]||a[2];Object.keys(t).forEach(s=>{e[s]=t[s]})}return e},interpolation:{escapeValue:!0,format:a=>a,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),as=a=>{var e,t;return L(a.ns)&&(a.ns=[a.ns]),L(a.fallbackLng)&&(a.fallbackLng=[a.fallbackLng]),L(a.fallbackNS)&&(a.fallbackNS=[a.fallbackNS]),((t=(e=a.supportedLngs)==null?void 0:e.indexOf)==null?void 0:t.call(e,"cimode"))<0&&(a.supportedLngs=a.supportedLngs.concat(["cimode"])),typeof a.initImmediate=="boolean"&&(a.initAsync=a.initImmediate),a},Qe=()=>{},cr=a=>{Object.getOwnPropertyNames(Object.getPrototypeOf(a)).forEach(t=>{typeof a[t]=="function"&&(a[t]=a[t].bind(a))})};class Me extends rt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=as(e),this.services={},this.logger=we,this.modules={external:[]},cr(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(s=t,t={}),t.defaultNS==null&&t.ns&&(L(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const r=is();this.options={...r,...this.options,...as(t)},this.options.interpolation={...r.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const i=g=>g?typeof g=="function"?new g:g:null;if(!this.options.isClone){this.modules.logger?we.init(i(this.modules.logger),this.options):we.init(null,this.options);let g;this.modules.formatter?g=this.modules.formatter:g=ar;const y=new ts(this.options);this.store=new Xt(this.options.resources,this.options);const p=this.services;p.logger=we,p.resourceStore=this.store,p.languageUtils=y,p.pluralResolver=new nr(y,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),g&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(p.formatter=i(g),p.formatter.init(p,this.options),this.options.interpolation.format=p.formatter.format.bind(p.formatter)),p.interpolator=new rr(this.options),p.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},p.backendConnector=new lr(i(this.modules.backend),p.resourceStore,p,this.options),p.backendConnector.on("*",function(R){for(var m=arguments.length,j=new Array(m>1?m-1:0),N=1;N<m;N++)j[N-1]=arguments[N];e.emit(R,...j)}),this.modules.languageDetector&&(p.languageDetector=i(this.modules.languageDetector),p.languageDetector.init&&p.languageDetector.init(p,this.options.detection,this.options)),this.modules.i18nFormat&&(p.i18nFormat=i(this.modules.i18nFormat),p.i18nFormat.init&&p.i18nFormat.init(this)),this.translator=new st(this.services,this.options),this.translator.on("*",function(R){for(var m=arguments.length,j=new Array(m>1?m-1:0),N=1;N<m;N++)j[N-1]=arguments[N];e.emit(R,...j)}),this.modules.external.forEach(R=>{R.init&&R.init(this)})}if(this.format=this.options.interpolation.format,s||(s=Qe),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const g=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);g.length>0&&g[0]!=="dev"&&(this.options.lng=g[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(g=>{this[g]=function(){return e.store[g](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(g=>{this[g]=function(){return e.store[g](...arguments),e}});const l=Ue(),d=()=>{const g=(y,p)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(p),s(y,p)};if(this.languages&&!this.isInitialized)return g(null,this.t.bind(this));this.changeLanguage(this.options.lng,g)};return this.options.resources||!this.options.initAsync?d():setTimeout(d,0),l}loadResources(e){var i,o;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qe;const r=L(e)?e:this.language;if(typeof e=="function"&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if((r==null?void 0:r.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const c=[],l=d=>{if(!d||d==="cimode")return;this.services.languageUtils.toResolveHierarchy(d).forEach(y=>{y!=="cimode"&&c.indexOf(y)<0&&c.push(y)})};r?l(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(g=>l(g)),(o=(i=this.options.preload)==null?void 0:i.forEach)==null||o.call(i,d=>l(d)),this.services.backendConnector.load(c,this.options.ns,d=>{!d&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(d)})}else s(null)}reloadResources(e,t,s){const r=Ue();return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),s||(s=Qe),this.services.backendConnector.reload(e,t,i=>{r.resolve(),s(i)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&ys.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const s=this.languages[t];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}}changeLanguage(e,t){var s=this;this.isLanguageChangingTo=e;const r=Ue();this.emit("languageChanging",e);const i=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},o=(l,d)=>{d?(i(d),this.translator.changeLanguage(d),this.isLanguageChangingTo=void 0,this.emit("languageChanged",d),this.logger.log("languageChanged",d)):this.isLanguageChangingTo=void 0,r.resolve(function(){return s.t(...arguments)}),t&&t(l,function(){return s.t(...arguments)})},c=l=>{var g,y;!e&&!l&&this.services.languageDetector&&(l=[]);const d=L(l)?l:this.services.languageUtils.getBestMatchFromCodes(l);d&&(this.language||i(d),this.translator.language||this.translator.changeLanguage(d),(y=(g=this.services.languageDetector)==null?void 0:g.cacheUserLanguage)==null||y.call(g,d)),this.loadResources(d,p=>{o(p,d)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?c(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(c):this.services.languageDetector.detect(c):c(e),r}getFixedT(e,t,s){var r=this;const i=function(o,c){let l;if(typeof c!="object"){for(var d=arguments.length,g=new Array(d>2?d-2:0),y=2;y<d;y++)g[y-2]=arguments[y];l=r.options.overloadTranslationOptionHandler([o,c].concat(g))}else l={...c};l.lng=l.lng||i.lng,l.lngs=l.lngs||i.lngs,l.ns=l.ns||i.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||s||i.keyPrefix);const p=r.options.keySeparator||".";let R;return l.keyPrefix&&Array.isArray(o)?R=o.map(m=>`${l.keyPrefix}${p}${m}`):R=l.keyPrefix?`${l.keyPrefix}${p}${o}`:o,r.t(R,l)};return L(e)?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=s,i}t(){var r;for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return(r=this.translator)==null?void 0:r.translate(...t)}exists(){var r;for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return(r=this.translator)==null?void 0:r.exists(...t)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=t.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const o=(c,l)=>{const d=this.services.backendConnector.state[`${c}|${l}`];return d===-1||d===0||d===2};if(t.precheck){const c=t.precheck(this,o);if(c!==void 0)return c}return!!(this.hasResourceBundle(s,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(s,e)&&(!r||o(i,e)))}loadNamespaces(e,t){const s=Ue();return this.options.ns?(L(e)&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{s.resolve(),t&&t(r)}),s):(t&&t(),Promise.resolve())}loadLanguages(e,t){const s=Ue();L(e)&&(e=[e]);const r=this.options.preload||[],i=e.filter(o=>r.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return i.length?(this.options.preload=r.concat(i),this.loadResources(o=>{s.resolve(),t&&t(o)}),s):(t&&t(),Promise.resolve())}dir(e){var r,i;if(e||(e=this.resolvedLanguage||(((r=this.languages)==null?void 0:r.length)>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=((i=this.services)==null?void 0:i.languageUtils)||new ts(is());return t.indexOf(s.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new Me(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qe;const s=e.forkResourceStore;s&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},i=new Me(r);if((e.debug!==void 0||e.prefix!==void 0)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(c=>{i[c]=this[c]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},s){const c=Object.keys(this.store.data).reduce((l,d)=>(l[d]={...this.store.data[d]},Object.keys(l[d]).reduce((g,y)=>(g[y]={...l[d][y]},g),{})),{});i.store=new Xt(c,r),i.services.resourceStore=i.store}return i.translator=new st(i.services,r),i.translator.on("*",function(c){for(var l=arguments.length,d=new Array(l>1?l-1:0),g=1;g<l;g++)d[g-1]=arguments[g];i.emit(c,...d)}),i.init(r,t),i.translator.options=r,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const ce=Me.createInstance();ce.createInstance=Me.createInstance;ce.createInstance;ce.dir;ce.init;ce.loadResources;ce.reloadResources;ce.use;ce.changeLanguage;ce.getFixedT;ce.t;ce.exists;ce.setDefaultNamespace;ce.hasLoadedNamespace;ce.loadNamespaces;ce.loadLanguages;const dr={en:{translation:{login:"Login",toggleTheme:"Toggle Theme",homeSubtitle:"A simple entry to the World of JOE",email:"Email",password:"Password",register:"Register",welcomeTitle:"👋",welcomeMsg:`Hello! I am Joe, your smart assistant.
How can I help you today?`,inputPlaceholder:"Enter your command here...",send:"Send",connecting:"Connecting...",connected:"Connected",copy:"Copy text",working:"Working...",planProposed:"📋 Proposed Plan",planAction:"I will",inputs:"Inputs",outputs:"Outputs",approvalRequired:"Approval Required",risk:"Risk",action:"Action",deny:"Deny",approve:"Approve",tools:{file_write:"Create File",file_read:"Read File",ls:"List Files",web_search:"Web Search",shell_execute:"Execute Command",http_fetch:"Fetch URL",file_edit:"Edit File",plan:"Plan & Analyze",summarize:"Summarize",unknown:"Unknown Tool"},artifacts:{image:"Image",video:"Video",file:"File",openNewWindow:"Open in new window"},error:"Error sending command"}},ar:{translation:{login:"تسجيل الدخول",toggleTheme:"تبديل السمة",homeSubtitle:"بوابة الدخول إلى عالم جو",email:"البريد الإلكتروني",password:"كلمة المرور",register:"تسجيل",welcomeTitle:"👋",welcomeMsg:`مرحباً! أنا جو، مساعدك الذكي.
كيف يمكنني مساعدتك اليوم؟`,inputPlaceholder:"أدخل أمرك هنا...",send:"إرسال",connecting:"جاري الاتصال...",connected:"متصل",copy:"نسخ النص",working:"جاري العمل...",planProposed:"📋 الخطة المقترحة",planAction:"سأقوم بـ",inputs:"المدخلات",outputs:"المخرجات",approvalRequired:"موافقة مطلوبة",risk:"مستوى الخطورة",action:"الإجراء",deny:"رفض",approve:"موافقة",tools:{file_write:"إنشاء ملف",file_read:"قراءة ملف",ls:"عرض الملفات",web_search:"بحث في الويب",shell_execute:"تنفيذ أمر النظام",http_fetch:"جلب رابط",file_edit:"تعديل ملف",plan:"تحليل وتخطيط",summarize:"تلخيص النتائج",unknown:"أداة غير معروفة"},artifacts:{image:"صورة",video:"فيديو",file:"ملف",openNewWindow:"فتح في نافذة جديدة"},error:"فشل إرسال الأمر"}},fr:{translation:{login:"Connexion",toggleTheme:"Changer de thème",homeSubtitle:"Une entrée simple dans le monde de JOE",email:"Email",password:"Mot de passe",register:"S'inscrire",welcomeTitle:"👋",welcomeMsg:`Bonjour ! Je suis Joe, votre assistant intelligent.
Comment puis-je vous aider aujourd'hui ?`,inputPlaceholder:"Entrez votre commande ici...",send:"Envoyer",connecting:"Connexion...",connected:"Connecté",copy:"Copier le texte",working:"En cours...",planProposed:"📋 Plan Proposé",planAction:"Je vais",inputs:"Entrées",outputs:"Sorties",approvalRequired:"Approbation requise",risk:"Risque",action:"Action",deny:"Refuser",approve:"Approuver",tools:{file_write:"Créer un fichier",file_read:"Lire un fichier",ls:"Lister les fichiers",web_search:"Recherche Web",shell_execute:"Exécuter la commande",http_fetch:"Récupérer URL",file_edit:"Modifier le fichier",plan:"Planifier & Analyser",summarize:"Résumer",unknown:"Outil inconnu"},artifacts:{image:"Image",video:"Vidéo",file:"Fichier",openNewWindow:"Ouvrir dans une nouvelle fenêtre"},error:"Erreur lors de l'envoi"}},de:{translation:{login:"Anmelden",toggleTheme:"Thema umschalten",homeSubtitle:"Ein einfacher Zugang zur Welt von JOE",email:"E-Mail",password:"Passwort",register:"Registrieren",welcomeTitle:"👋",welcomeMsg:`Hallo! Ich bin Joe, dein intelligenter Assistent.
Wie kann ich dir heute helfen?`,inputPlaceholder:"Gib deinen Befehl hier ein...",send:"Senden",connecting:"Verbinden...",connected:"Verbunden",copy:"Text kopieren",working:"Arbeite...",planProposed:"📋 Vorgeschlagener Plan",planAction:"Ich werde",inputs:"Eingaben",outputs:"Ausgaben",approvalRequired:"Genehmigung erforderlich",risk:"Risiko",action:"Aktion",deny:"Ablehnen",approve:"Genehmigen",tools:{file_write:"Datei erstellen",file_read:"Datei lesen",ls:"Dateien auflisten",web_search:"Websuche",shell_execute:"Befehl ausführen",http_fetch:"URL abrufen",file_edit:"Datei bearbeiten",plan:"Planen & Analysieren",summarize:"Zusammenfassen",unknown:"Unbekanntes Werkzeug"},artifacts:{image:"Bild",video:"Video",file:"Datei",openNewWindow:"In neuem Fenster öffnen"},error:"Fehler beim Senden"}},ru:{translation:{login:"Войти",toggleTheme:"Сменить тему",homeSubtitle:"Простой вход в мир JOE",email:"Email",password:"Пароль",register:"Регистрация",welcomeTitle:"👋",welcomeMsg:`Привет! Я Джо, твой умный помощник.
Чем я могу помочь сегодня?`,inputPlaceholder:"Введите команду здесь...",send:"Отправить",connecting:"Подключение...",connected:"Подключено",copy:"Копировать",working:"Работаю...",planProposed:"📋 Предложенный план",planAction:"Я сделаю",inputs:"Входные данные",outputs:"Выходные данные",approvalRequired:"Требуется подтверждение",risk:"Риск",action:"Действие",deny:"Отклонить",approve:"Принять",tools:{file_write:"Создать файл",file_read:"Читать файл",ls:"Список файлов",web_search:"Поиск в веб",shell_execute:"Выполнить команду",http_fetch:"Получить URL",file_edit:"Редактировать файл",plan:"Планирование",summarize:"Обобщить",unknown:"Неизвестный инструмент"},artifacts:{image:"Изображение",video:"Видео",file:"Файл",openNewWindow:"Открыть в новом окне"},error:"Ошибка отправки"}},es:{translation:{login:"Iniciar sesión",toggleTheme:"Cambiar tema",homeSubtitle:"Una entrada simple al mundo de JOE",email:"Correo electrónico",password:"Contraseña",register:"Registrarse",welcomeTitle:"👋",welcomeMsg:`¡Hola! Soy Joe, tu asistente inteligente.
¿Cómo puedo ayudarte hoy?`,inputPlaceholder:"Ingresa tu comando aquí...",send:"Enviar",connecting:"Conectando...",connected:"Conectado",copy:"Copiar texto",working:"Trabajando...",planProposed:"📋 Plan Propuesto",planAction:"Voy a",inputs:"Entradas",outputs:"Salidas",approvalRequired:"Aprobación requerida",risk:"Riesgo",action:"Acción",deny:"Rechazar",approve:"Aprobar",tools:{file_write:"Crear archivo",file_read:"Leer archivo",ls:"Listar archivos",web_search:"Búsqueda web",shell_execute:"Ejecutar comando",http_fetch:"Obtener URL",file_edit:"Editar archivo",plan:"Planificar y Analizar",summarize:"Resumir",unknown:"Herramienta desconocida"},artifacts:{image:"Imagen",video:"Video",file:"Archivo",openNewWindow:"Abrir en nueva ventana"},error:"Error al enviar"}}};ce.use(In).init({resources:dr,lng:localStorage.getItem("lang")||"en",fallbackLng:"en",interpolation:{escapeValue:!1}});function ur({children:a}){return localStorage.getItem("token")?n.jsx(n.Fragment,{children:a}):n.jsx(un,{to:"/login",replace:!0})}hn.createRoot(document.getElementById("root")).render(n.jsx(ln.StrictMode,{children:n.jsx(cn,{children:n.jsx(dn,{children:n.jsxs(Ge,{path:"/",element:n.jsx($n,{}),children:[n.jsx(Ge,{index:!0,element:n.jsx(An,{})}),n.jsx(Ge,{path:"login",element:n.jsx(_n,{})}),n.jsx(Ge,{path:"joe",element:n.jsx(ur,{children:n.jsx(Hn,{})})})]})})})}));export{se as A};

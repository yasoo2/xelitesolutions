import{j as t}from"./ui-vUf7uXgm.js";import{a as n}from"./vendor-DZWZ8VcW.js";import{A as P}from"./index-tv7uuH5a.js";import"./markdown-DC0SD8kP.js";function Pt({wsUrl:ie,minimal:f}){var Xe,Ye,He;const Ce=n.useRef(null),U=n.useRef(null),k=n.useRef(null),le=n.useMemo(()=>{let e=String(ie||"").trim();if(!e)return e;try{if(!/^wss?:\/\//i.test(e)){const o=P.replace(/^http/i,"ws");e=new URL(e,o).toString()}}catch{}try{const o=new URL(e);if(o.pathname.startsWith("/ws/")&&o.searchParams.get("key")){const c=o.pathname.split("/").filter(Boolean).pop()||"",i=P.replace(/^http/i,"ws");e=new URL(`/browser/ws/${encodeURIComponent(c)}`,i).toString()}}catch{}try{const o=new URL(e);if(o.pathname.startsWith("/browser/ws/")&&!o.searchParams.get("token")){const c=localStorage.getItem("token");c&&o.searchParams.set("token",c)}e=o.toString()}catch{}return e},[ie]),[b,Te]=n.useState({w:1280,h:800}),O=n.useRef({w:1280,h:800}),[S,$]=n.useState("connecting"),[Q,E]=n.useState(""),[v,_]=n.useState(""),[Ie,Ee]=n.useState([]),[q,Ne]=n.useState(""),Me=n.useRef(""),[z,K]=n.useState([]),[Be,w]=n.useState(""),[j,ce]=n.useState("console"),[Fe,de]=n.useState(!1),[Ue,ue]=n.useState([]),[Ae,pe]=n.useState([]),[Le,Z]=n.useState(1),[R,$e]=n.useState(!1),[Qe,Ze]=n.useState(!1),[he,ye]=n.useState(!1),[Ge,ge]=n.useState(5),[Ve,be]=n.useState(50),[et,xe]=n.useState(!0),[tt,rt]=n.useState(0),[ot,Et]=n.useState('{"list":{"selector":"a[href^=\\"https\\"]:not([href*=\\"google.com\\"])","fields":{"text":{"selector":"","attr":""},"url":{"selector":"","attr":"href"}}}}'),[Nt,fe]=n.useState(null),[me,nt]=n.useState(""),ze=n.useRef(null),[ve,D]=n.useState(null),[W,st]=n.useState(!0),[G,De]=n.useState(""),[C,We]=n.useState(""),[J,V]=n.useState(null),[ee,Mt]=n.useState(""),[te,Bt]=n.useState(""),[Pe,Ft]=n.useState(!0),[at,Ut]=n.useState(!0),[it,At]=n.useState(!0),[lt,Lt]=n.useState("أضرار التدخين"),re=n.useRef(0),oe=n.useRef(null),ne=n.useRef(null),X=n.useRef(0),[x,we]=n.useState(!1),[ct,Oe]=n.useState(!1),[se,_e]=n.useState(!1),[N,dt]=n.useState(null),[ae,ut]=n.useState(!1),[qe,pt]=n.useState(!0),[T,Ke]=n.useState([]),[A,ht]=n.useState(!1),[Y,ke]=n.useState(0);n.useEffect(()=>{f&&(de(!1),$e(!1),Z(1),ye(!1),we(!1))},[f]),n.useEffect(()=>{O.current=b},[b]),n.useEffect(()=>{Me.current=q},[q]),n.useEffect(()=>{const e=()=>{Ze(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),e(),()=>document.removeEventListener("fullscreenchange",e)},[]);function Se(){try{const o=new URL(le).pathname.split("/").filter(Boolean);return o[o.length-1]}catch{return""}}function je(e){try{const o=new URL(e);return o.protocol==="ws:"&&(o.protocol="http:"),o.protocol==="wss:"&&(o.protocol="https:"),o.toString()}catch{try{const o=new URL(le);return o.protocol==="ws:"&&(o.protocol="http:"),o.protocol==="wss:"&&(o.protocol="https:"),o.search="",o.hash="",o.pathname="/",new URL(e,o.toString()).toString()}catch{return e}}}function M(e){const o=e.trim();if(!o)return"";try{return new URL(o).toString()}catch{try{return new URL(`https://${o}`).toString()}catch{return o}}}async function s(e){var a;const o=Se();if(!o)return;const c=["mouseMove","click","scroll","type","press","goBack","goForward","reload","screenshot","tab.new","tab.switch","tab.close","tabs.list","pick","stream.setFps","stream.setQuality","redaction.set"];if(k.current&&k.current.readyState===WebSocket.OPEN&&e.every(h=>c.includes(h.type))){e.forEach(u=>{var y;(y=k.current)==null||y.send(JSON.stringify({type:"action",action:u}))});const h=e.map(u=>u.type).join(", ");if(w(h),setTimeout(()=>w(""),1200),W&&e.some(u=>u.type==="press"&&u.key==="Enter")&&setTimeout(()=>H(),2e3),W&&e.some(u=>u.type==="reload")&&setTimeout(()=>H(),1500),e.some(u=>u.type==="goto"||u.type==="reload")){if(V(null),Pe){const u=[];C?u.push({type:"locate",selector:C}):ee&&te&&u.push({type:"locate",role:ee,roleName:te}),u.length&&setTimeout(()=>s(u),1e3)}W&&setTimeout(()=>H(),1500)}return}try{const h=localStorage.getItem("token"),y=await(await fetch(`${P}/tools/browser_run/execute`,{method:"POST",headers:{"Content-Type":"application/json",...h?{Authorization:`Bearer ${h}`}:{}},body:JSON.stringify({sessionId:o,actions:e})})).json();if(Array.isArray(y.artifacts)){const p=y.artifacts.map(g=>({name:g.name||g.filename||"download",href:g.href}));K(g=>[...p,...g].slice(0,5))}if(y!=null&&y.ok&&Array.isArray((a=y==null?void 0:y.output)==null?void 0:a.outputs)){const p=y.output.outputs,g=p.find(r=>r&&r.type==="goto_blocked");if(g!=null&&g.url){const r=`تم حظر فتح هذا الرابط: ${String(g.url)}`;E(r),w(r),setTimeout(()=>w(""),2500)}const m=p.find(r=>r&&r.type==="error"&&(r.message||r.action));if(m!=null&&m.message){const r=String(m.message);E(r),w(r),setTimeout(()=>w(""),2500)}const F=y.output.outputs.find(r=>r.type==="locate"&&r.boundingBox);if(F!=null&&F.boundingBox&&(V(F.boundingBox),e.some(d=>d.type==="locate")&&at)){const l=[...e].reverse().find(L=>L.type==="locate")||null,I=[];if(l!=null&&l.selector)I.push({type:"click",selector:l.selector});else if(l!=null&&l.role&&(l!=null&&l.roleName))I.push({type:"click",role:l.role,roleName:l.roleName});else{const L=F.boundingBox;if(L){const Tt=Math.round(L.x+L.width/2),It=Math.round(L.y+L.height/2);I.push({type:"click",x:Tt,y:It})}}I.length&&setTimeout(()=>s(I),250);const Rt=!!(l!=null&&l.selector&&/(input|textarea)\[name=["']q["']\]/i.test(String(l.selector))),Ct=!!(l!=null&&l.roleName&&String(l.roleName).includes("بحث"));it&&!G.trim()&&(Rt||Ct)&&setTimeout(()=>{s([{type:"waitForSelector",selector:'textarea[name="q"], input[name="q"]:not([type="hidden"])',timeoutMs:8e3}]),setTimeout(()=>s([{type:"type",text:lt,delay:30}]),200),setTimeout(()=>s([{type:"press",key:"Enter"}]),300)},400)}}const B=e.map(p=>p.type).join(", ");if(w(B),setTimeout(()=>w(""),1200),e.some(p=>p.type==="goto"||p.type==="reload")&&(V(null),Pe)){const p=[];if(C)p.push({type:"locate",selector:C});else if(ee&&te)p.push({type:"locate",role:ee,roleName:te});else{const g=e.find(m=>m.type==="goto");try{const m=g!=null&&g.url?new URL(g.url).hostname:"";m&&/(^|\.)(google)\./i.test(m)&&p.push({type:"locate",selector:'textarea[name="q"], input[name="q"]:not([type="hidden"])'})}catch{}}p.length&&setTimeout(()=>s(p),1e3)}W&&e.some(p=>p.type==="press"&&p.key==="Enter")&&setTimeout(()=>{H()},2e3),W&&e.some(p=>p.type==="goto"||p.type==="reload")&&setTimeout(()=>{H()},1500)}catch{}}async function H(){const e=Se();if(e)try{const o=localStorage.getItem("token"),c=JSON.parse(ot),a=await(await fetch(`${P}/tools/browser_extract/execute`,{method:"POST",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify({sessionId:e,schema:c})})).json();a!=null&&a.ok&&(a!=null&&a.output)?fe(a.output):fe(null)}catch{fe(null)}}async function yt(){var c,i;const e=Se(),o=(i=(c=ze.current)==null?void 0:c.files)==null?void 0:i[0];if(!(!e||!o||!me))try{const a=localStorage.getItem("token"),h=new FormData;h.append("file",o),h.append("sessionId",e);const y=await(await fetch(`${P}/files/upload`,{method:"POST",headers:{...a?{Authorization:`Bearer ${a}`}:{}},body:h})).json();if(y&&y._id){const B=`${P}/files/${y._id}/raw`;await s([{type:"uploadFile",selector:me,fileUrl:B}])}}catch{}}n.useEffect(()=>{let e=!1;X.current=0,$("connecting"),E("");const o=()=>{oe.current!=null&&(window.clearTimeout(oe.current),oe.current=null),ne.current!=null&&(window.clearTimeout(ne.current),ne.current=null)},c=()=>{if(!e){o();try{if(k.current){try{k.current.close()}catch{}k.current=null}const i=new WebSocket(le);k.current=i,$(X.current>0?"reconnecting":"connecting"),ne.current=window.setTimeout(()=>{try{i.readyState!==WebSocket.OPEN&&i.close()}catch{}},8e3),i.onopen=()=>{o(),!e&&(X.current=0,E(""),$("connected"))},i.onclose=a=>{if(o(),e)return;k.current=null;const h=8,u=X.current+1;if(X.current=u,u>h){$("error");const m=a!=null&&a.reason?` reason=${a.reason}`:"";E(`WebSocket closed (code=${(a==null?void 0:a.code)??"unknown"}${m})`);return}const y=Math.min(8e3,500*Math.pow(2,u-1)),B=Math.floor(Math.random()*250),p=y+B;$("reconnecting");const g=a!=null&&a.reason?` reason=${a.reason}`:"";E(`WebSocket closed (code=${(a==null?void 0:a.code)??"unknown"}${g}). retrying...`),oe.current=window.setTimeout(c,p)},i.onerror=()=>{e||E("WebSocket error")},i.onmessage=a=>{var h,u,y,B,p,g,m,F;try{const r=JSON.parse(a.data);if(r.type==="stream_start"){const d={w:r.w,h:r.h};O.current=d,Te(d)}if(r.type==="state"){if((h=r.viewport)!=null&&h.width&&((u=r.viewport)!=null&&u.height)){const d={w:r.viewport.width,h:r.viewport.height};O.current=d,Te(d)}if(typeof r.url=="string"&&_(r.url),Array.isArray(r.tabs)&&Ee(r.tabs),typeof r.activeTabId=="string"&&Ne(r.activeTabId),(y=r.stream)!=null&&y.fps&&ge(Number(r.stream.fps)||5),(B=r.stream)!=null&&B.quality&&be(Number(r.stream.quality)||50),typeof r.redactionEnabled=="boolean"&&xe(!!r.redactionEnabled),Array.isArray(r.downloads)){const d=r.downloads.map(l=>({name:l.filename||l.name||"download",href:je(l.href)}));K(d.slice(-10).reverse())}Array.isArray(r.logs)&&ue(r.logs.slice(-500)),Array.isArray(r.network)&&pe(r.network.slice(-500))}if(r.type==="tabs"&&(Array.isArray(r.tabs)&&Ee(r.tabs),typeof r.activeTabId=="string"&&Ne(r.activeTabId)),r.type==="stream"&&(typeof r.fps=="number"&&ge(r.fps),typeof r.quality=="number"&&be(r.quality)),r.type==="redaction"&&typeof r.enabled=="boolean"&&xe(!!r.enabled),r.type==="url"&&typeof r.url=="string"&&(!r.tabId||String(r.tabId)===String(Me.current))&&_(r.url),r.type==="console"&&r.entry&&ue(d=>[...d,r.entry].slice(-500)),r.type==="network"&&r.entry&&pe(d=>[...d,r.entry].slice(-500)),r.type==="download"&&r.download){const d=r.download,l={name:d.filename||d.name||"download",href:je(d.href)};K(I=>[l,...I].slice(0,10))}if(r.type==="screenshot"&&r.href){const d=je(String(r.href)),l=String(r.href).split("/").pop()||"screenshot.jpg";K(I=>[{name:l,href:d},...I].slice(0,10))}if(r.type==="cursor_move"&&D({x:r.x,y:r.y}),r.type==="cursor_click"){D({x:r.x,y:r.y});const d=document.createElement("div"),l=O.current;d.style.cssText=`
                position: absolute;
                left: ${r.x/l.w*100}%;
                top: ${r.y/l.h*100}%;
                width: 20px; height: 20px;
                background: rgba(255, 0, 0, 0.5);
                border-radius: 50%;
                transform: translate(-50%, -50%);
                pointer-events: none;
                z-index: 100;
                transition: opacity 0.5s;
              `,(g=(p=U.current)==null?void 0:p.parentElement)==null||g.appendChild(d),setTimeout(()=>d.remove(),500)}if(r.type==="action_start"){const d=r.action;let l=d.type;d.type==="goto"&&(l=`Opening ${new URL(d.url).hostname}...`),d.type==="type"&&(l="Typing..."),d.type==="click"&&(l="Clicking..."),d.type==="scroll"&&(l="Scrolling..."),d.type==="screenshot"&&(l="Capturing View..."),w(l)}if(r.type==="action_done"&&setTimeout(()=>w(""),500),r.type==="action_error"&&(w(String(r.error||"Action error")),setTimeout(()=>w(""),1500)),r.type==="frame"){if(qe&&typeof r.jpegBase64=="string"&&Ke(d=>[...d,{ts:Number(r.ts||Date.now()),jpegBase64:r.jpegBase64}].slice(-80)),he||A)return;typeof r.jpegBase64=="string"&&Je(r.jpegBase64)}r.type==="pick"&&r.element&&(dt(r.element),(m=r.element)!=null&&m.selector&&We(String(r.element.selector)),(F=r.element)!=null&&F.boundingBox&&V(r.element.boundingBox))}catch{}}}catch(i){$("error"),E(String((i==null?void 0:i.message)||i))}}};return c(),()=>{var i;e=!0,o();try{(i=k.current)==null||i.close()}catch{}k.current=null}},[ie,tt]);function gt(e){if(!x)return;const o=U.current;if(!o)return;try{o.focus()}catch{}const c=o.getBoundingClientRect(),i=Math.round((e.clientX-c.left)*(b.w/c.width)),a=Math.round((e.clientY-c.top)*(b.h/c.height));s(se?[{type:"pick",x:i,y:a}]:[{type:"click",x:i,y:a}]),D({x:i,y:a})}function bt(e){if(!x)return;e.preventDefault();const o=Math.round(e.deltaY);s([{type:"scroll",deltaY:o}])}function xt(e){if(!x)return;const o=Date.now();if(o-(re.current||0)<60)return;re.current=o;const c=U.current;if(!c)return;const i=c.getBoundingClientRect(),a=Math.round((e.clientX-i.left)*(b.w/i.width)),h=Math.round((e.clientY-i.top)*(b.h/i.height));D({x:a,y:h}),s([{type:"mouseMove",x:a,y:h,steps:2}])}function ft(e){var u;if(!x)return;const o=U.current,c=(u=e.touches)==null?void 0:u[0];if(!o||!c)return;e.preventDefault();const i=o.getBoundingClientRect(),a=Math.round((c.clientX-i.left)*(b.w/i.width)),h=Math.round((c.clientY-i.top)*(b.h/i.height));s([{type:"click",x:a,y:h}]),D({x:a,y:h})}function mt(e){var y;if(!x)return;const o=Date.now();if(o-(re.current||0)<60)return;re.current=o;const c=U.current,i=(y=e.touches)==null?void 0:y[0];if(!c||!i)return;e.preventDefault();const a=c.getBoundingClientRect(),h=Math.round((i.clientX-a.left)*(b.w/a.width)),u=Math.round((i.clientY-a.top)*(b.h/a.height));D({x:h,y:u}),s([{type:"mouseMove",x:h,y:u,steps:2}])}function vt(){G.trim()&&(s([{type:"type",text:G,delay:30,sensitive:ae}]),De(""))}const[Re,wt]=n.useState(!1);function kt(e){if(x){if(e.key==="Enter"){e.preventDefault(),s([{type:"press",key:"Enter"}]);return}if(e.key==="Backspace"){e.preventDefault(),s([{type:"press",key:"Backspace"}]);return}if(e.key==="Tab"){e.preventDefault(),s([{type:"press",key:"Tab"}]);return}if(e.key==="Escape"){e.preventDefault(),s([{type:"press",key:"Escape"}]);return}if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight"){e.preventDefault(),s([{type:"press",key:e.key}]);return}e.ctrlKey||e.metaKey||e.altKey||e.key&&e.key.length===1&&(e.preventDefault(),s([{type:"type",text:e.key,delay:0,sensitive:ae}]))}}function Je(e){const o=new Image;o.onload=()=>{const c=U.current;if(!c)return;const i=O.current;c.width=i.w,c.height=i.h,c.getContext("2d").drawImage(o,0,0,i.w,i.h)},o.src="data:image/jpeg;base64,"+e}n.useEffect(()=>{if(!A)return;const e=T[Y];e!=null&&e.jpegBase64&&Je(e.jpegBase64)},[A,Y,T]),n.useEffect(()=>{A&&ke(e=>Math.max(0,Math.min(e,Math.max(0,T.length-1))))},[A,T.length]);const St=Ie.length?t.jsxs("div",{className:"agent-browser-tabs glass-panel",style:{display:"flex",alignItems:"center",gap:6,padding:"8px 10px",borderRadius:14,flexWrap:"nowrap",overflowX:"auto",overscrollBehaviorX:"contain"},children:[Ie.slice(0,12).map(e=>{const o=String(e.id)===String(q);let c=e.title&&e.title.trim()?e.title:e.url?(()=>{try{return new URL(String(e.url)).hostname}catch{return String(e.url)}})():e.id;return c=String(c).slice(0,28),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx("button",{onClick:()=>s([{type:"tab.switch",tabId:e.id}]),className:`agent-browser-tab${o?" active":""}`,dir:"auto",title:e.title||e.url||e.id,children:c}),t.jsx("button",{onClick:()=>s([{type:"tab.close",tabId:e.id}]),className:"agent-browser-tab-close",title:"Close tab",children:"×"})]},e.id)}),t.jsx("button",{onClick:()=>s([{type:"tab.new",url:"about:blank",waitUntil:"domcontentloaded"}]),className:"agent-browser-tab-new",title:"New tab",children:"+"})]}):null,jt=t.jsxs("div",{className:"agent-browser-compact-header glass-panel",style:{position:"absolute",top:10,left:10,right:10,zIndex:60,display:"flex",alignItems:"center",gap:8,padding:10,borderRadius:14},children:[t.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:S==="connected"?"var(--accent-success)":S==="reconnecting"?"var(--accent-warning)":"var(--accent-danger)",boxShadow:S==="connected"?"0 0 8px var(--accent-success)":"none",flex:"0 0 auto"}}),t.jsx("button",{onClick:()=>we(e=>!e),style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:x?"rgba(37, 99, 235, 0.18)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:x?"تحكم: مفعل":"تحكم: متوقف"}),t.jsx("button",{onClick:()=>_e(e=>!e),disabled:!x,style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:se?"rgba(234, 179, 8, 0.18)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:x?"pointer":"not-allowed",opacity:x?1:.6,flex:"0 0 auto"},children:se?"Picker: مفعل":"Picker"}),t.jsx("button",{onClick:()=>s([{type:"goBack"}]),title:"Back",style:{width:34,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:"⟵"}),t.jsx("button",{onClick:()=>s([{type:"goForward"}]),title:"Forward",style:{width:34,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:"⟶"}),t.jsx("button",{onClick:()=>s([{type:"reload"}]),title:"Reload",style:{width:34,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:"⟳"}),t.jsx("input",{type:"text",value:v,onChange:e=>_(e.target.value),onKeyDown:e=>{if(e.key==="Enter"){const o=M(v);o&&s([{type:"goto",url:o,waitUntil:"domcontentloaded"}])}},placeholder:"https://example.com",dir:"auto",style:{flex:"1 1 auto",height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(0,0,0,0.55)",color:"var(--text-primary)",outline:"none",minWidth:140,backdropFilter:"blur(8px)"}}),t.jsx("button",{onClick:()=>{const e=M(v);e&&s([{type:"goto",url:e,waitUntil:"domcontentloaded"}])},style:{height:32,padding:"0 12px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(37, 99, 235, 0.18)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:"فتح"}),Q?t.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)",maxWidth:420},dir:"auto",children:Q}):null]});return t.jsxs("div",{ref:Ce,className:"agent-browser-stream",style:{display:"flex",flexDirection:"column",gap:f?0:8,position:R?"fixed":"relative",inset:R?12:void 0,zIndex:R?9999:void 0,background:R?"var(--bg-dark)":void 0,padding:R?12:void 0,borderRadius:R?16:void 0,border:R?"1px solid var(--border-color)":void 0,boxShadow:R?"0 12px 50px rgba(0,0,0,0.6)":void 0,height:f?"100%":void 0},children:[f?jt:null,f?null:t.jsxs("div",{className:"agent-browser-header glass-panel",style:{display:"flex",alignItems:"center",padding:"10px 12px",borderRadius:14,gap:8,flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,whiteSpace:"nowrap"},children:[t.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:S==="connected"?"var(--accent-success)":S==="reconnecting"?"var(--accent-warning)":"var(--accent-danger)",boxShadow:S==="connected"?"0 0 8px var(--accent-success)":"none"}}),t.jsx("span",{style:{fontSize:12,fontWeight:600,color:"var(--text-primary)"},dir:"auto",children:S==="connected"?"متصل":S}),S==="error"?t.jsx("button",{onClick:()=>rt(e=>e+1),style:{height:28,padding:"0 10px",borderRadius:8,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.04)",color:"var(--text-primary)",cursor:"pointer"},children:"إعادة اتصال"}):null]}),t.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flex:"1 1 420px",minWidth:260},children:[t.jsx("button",{onClick:()=>s([{type:"goBack"}]),title:"Back",style:{width:32,height:32,borderRadius:8,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"⟵"}),t.jsx("button",{onClick:()=>s([{type:"goForward"}]),title:"Forward",style:{width:32,height:32,borderRadius:8,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"⟶"}),t.jsx("button",{onClick:()=>s([{type:"reload"}]),title:"Reload",style:{width:32,height:32,borderRadius:8,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"⟳"}),t.jsx("input",{type:"text",value:v,onChange:e=>_(e.target.value),onKeyDown:e=>{if(e.key==="Enter"){const o=M(v);o&&s([{type:"goto",url:o,waitUntil:"domcontentloaded"}])}},placeholder:"https://example.com",dir:"auto",style:{flex:1,height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.06)",color:"var(--text-primary)",outline:"none",minWidth:200}}),t.jsx("button",{onClick:()=>{const e=M(v);e&&s([{type:"goto",url:e,waitUntil:"domcontentloaded"}])},style:{height:32,padding:"0 12px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(37, 99, 235, 0.12)",color:"var(--text-primary)",cursor:"pointer"},children:"فتح"})]}),t.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"},children:[t.jsx("button",{onClick:()=>{const e=M(v);e&&navigator.clipboard&&navigator.clipboard.writeText(e).catch(()=>{})},title:"Copy URL",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"نسخ"}),t.jsx("button",{onClick:()=>{const e=M(v);e&&window.open(e,"_blank","noreferrer")},title:"Open in new tab",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"فتح خارجي"}),t.jsx("button",{onClick:()=>s([{type:"screenshot",fullPage:!1,quality:60}]),title:"Screenshot",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"لقطة"}),t.jsx("button",{onClick:()=>{const e=z[0];e!=null&&e.href&&window.open(e.href,"_blank","noreferrer")},disabled:!((Xe=z[0])!=null&&Xe.href),title:"Open latest download",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:(Ye=z[0])!=null&&Ye.href?"pointer":"not-allowed",opacity:(He=z[0])!=null&&He.href?1:.5},children:"تنزيل"}),t.jsx("button",{onClick:()=>Z(e=>Math.max(.5,Number((e-.1).toFixed(2)))),title:"Zoom out",style:{width:32,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"−"}),t.jsxs("button",{onClick:()=>Z(1),title:"Reset zoom",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:[Math.round(Le*100),"%"]}),t.jsx("button",{onClick:()=>Z(e=>Math.min(2,Number((e+.1).toFixed(2)))),title:"Zoom in",style:{width:32,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"+"}),t.jsx("button",{onClick:async()=>{var e;try{document.fullscreenElement?await document.exitFullscreen():await((e=Ce.current)==null?void 0:e.requestFullscreen())}catch{}},title:"Fullscreen",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:Qe?"خروج":"ملء"}),t.jsx("button",{onClick:()=>ye(e=>!e),title:"Pause stream",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:he?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:he?"تشغيل":"إيقاف"}),t.jsx("button",{onClick:()=>$e(e=>!e),title:"Focus mode",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:R?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"تركيز"}),t.jsx("button",{onClick:()=>de(e=>!e),title:"Logs",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:Fe?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"سجلات"}),t.jsx("button",{onClick:()=>wt(!Re),style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:Re?"أقل":"أكثر"})]}),Q?t.jsx("div",{style:{width:"100%",fontSize:12,color:"var(--text-secondary)"},dir:"auto",children:Q}):null,Be?t.jsx("div",{style:{width:"100%",display:"flex",justifyContent:"center"},children:t.jsx("div",{style:{padding:"4px 12px",background:"rgba(59, 130, 246, 0.15)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:999,color:"#60a5fa",fontSize:12},dir:"auto",children:Be})}):null]}),St,t.jsx("div",{className:"agent-browser-canvas-frame",style:{border:f?"none":void 0,borderRadius:f?0:16,overflow:"hidden",position:"relative",background:"#000",boxShadow:f?"none":void 0,flex:f?1:void 0},children:t.jsxs("div",{style:{transform:f?"none":`scale(${Le})`,transformOrigin:"top left",position:"relative"},children:[t.jsx("canvas",{ref:U,onClick:gt,onWheel:bt,onMouseMove:xt,onTouchStart:ft,onTouchMove:mt,tabIndex:x?0:-1,onFocus:()=>Oe(!0),onBlur:()=>Oe(!1),onKeyDown:kt,style:{width:"100%",height:"auto",display:"block",cursor:x?"crosshair":"default",touchAction:"none",outline:"none"}}),f&&x&&!ct?t.jsx("div",{style:{position:"absolute",left:12,bottom:12,zIndex:70,padding:"6px 10px",borderRadius:12,background:"rgba(0,0,0,0.55)",border:"1px solid rgba(255,255,255,0.12)",color:"rgba(255,255,255,0.85)",fontSize:12,backdropFilter:"blur(8px)"},dir:"auto",children:"اضغط داخل المتصفح لتفعيل لوحة المفاتيح"}):null,J&&t.jsx("div",{style:{position:"absolute",left:`${J.x/b.w*100}%`,top:`${J.y/b.h*100}%`,width:`${J.width/b.w*100}%`,height:`${J.height/b.h*100}%`,border:"2px solid #eab308",boxShadow:"0 0 15px rgba(234, 179, 8, 0.4)",pointerEvents:"none",borderRadius:4,transition:"all 0.2s ease"}}),ve&&t.jsx("div",{style:{position:"absolute",left:`${ve.x/b.w*100}%`,top:`${ve.y/b.h*100}%`,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:50,transition:"all 0.1s linear"},children:t.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:"#eab308",border:"2px solid white",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"}})})]})}),!f&&Fe?t.jsxs("div",{className:"glass-panel",style:{borderRadius:14,overflow:"hidden"},children:[t.jsxs("div",{style:{display:"flex",gap:8,padding:10,borderBottom:"1px solid var(--border-color)",flexWrap:"wrap",alignItems:"center"},children:[t.jsx("button",{onClick:()=>ce("console"),style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:j==="console"?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"Console"}),t.jsx("button",{onClick:()=>ce("network"),style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:j==="network"?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"Network"}),t.jsx("button",{onClick:()=>ce("downloads"),style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:j==="downloads"?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"Downloads"}),t.jsxs("div",{style:{marginInlineStart:"auto",display:"flex",gap:8,alignItems:"center"},children:[t.jsx("button",{onClick:()=>{j==="console"&&ue([]),j==="network"&&pe([]),j==="downloads"&&K([])},style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"Clear"}),t.jsx("button",{onClick:()=>de(!1),style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"إخفاء"})]})]}),t.jsxs("div",{style:{maxHeight:220,overflow:"auto",padding:10,fontSize:12,color:"var(--text-primary)",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace'},children:[j==="console"?Ue.length?Ue.slice(-200).map((e,o)=>t.jsxs("div",{style:{opacity:.95,padding:"2px 0"},dir:"auto",children:[t.jsx("span",{style:{color:e.level==="error"?"var(--accent-danger)":e.level==="warning"||e.level==="warn"?"var(--accent-warning)":"var(--text-secondary)"},children:new Date(e.ts).toLocaleTimeString()})," ",e.text]},o)):t.jsx("div",{style:{color:"var(--text-secondary)"},children:"لا توجد رسائل"}):null,j==="network"?Ae.length?Ae.slice(-200).map((e,o)=>t.jsxs("div",{style:{opacity:.95,padding:"2px 0"},dir:"auto",children:[t.jsx("span",{style:{color:"var(--text-secondary)"},children:new Date(e.ts).toLocaleTimeString()})," ",t.jsx("span",{style:{color:e.stage==="response"&&typeof e.status=="number"&&e.status>=400?"var(--accent-danger)":"var(--text-primary)"},children:e.method})," ",e.stage==="response"?t.jsx("span",{style:{color:"var(--text-secondary)"},children:e.status??""}):t.jsx("span",{style:{color:"var(--text-secondary)"},children:"→"})," ",e.url]},o)):t.jsx("div",{style:{color:"var(--text-secondary)"},children:"لا توجد طلبات"}):null,j==="downloads"?z.length?z.map((e,o)=>t.jsx("div",{style:{padding:"2px 0"},dir:"auto",children:t.jsx("a",{href:e.href,target:"_blank",rel:"noreferrer",style:{color:"#3b82f6",textDecoration:"none"},children:e.name})},o)):t.jsx("div",{style:{color:"var(--text-secondary)"},children:"لا توجد تنزيلات"}):null]})]}):null,Re&&t.jsxs("div",{style:{padding:12,border:"1px solid var(--border-color)",borderRadius:8,background:"var(--bg-secondary)",display:"flex",flexDirection:"column",gap:12},children:[t.jsxs("div",{className:"agent-browser-controls-row",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[t.jsx("button",{onClick:()=>s([{type:"goBack"}]),className:"btn",title:"Back",children:"⟵"}),t.jsx("button",{onClick:()=>s([{type:"goForward"}]),className:"btn",title:"Forward",children:"⟶"}),t.jsx("button",{onClick:()=>s([{type:"reload"}]),className:"btn",title:"Reload",children:"⟳"}),t.jsx("input",{type:"text",value:v,onChange:e=>_(e.target.value),onKeyDown:e=>{e.key==="Enter"&&v&&s([{type:"goto",url:M(v),waitUntil:"domcontentloaded"}])},placeholder:"https://example.com",style:{flex:1,minWidth:220,padding:"8px 10px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-primary)",color:"var(--text-primary)"}}),t.jsx("button",{onClick:()=>v&&s([{type:"goto",url:M(v),waitUntil:"domcontentloaded"}]),className:"btn",children:"Go"}),t.jsx("button",{onClick:()=>s([{type:"tab.new",url:"about:blank",waitUntil:"domcontentloaded"}]),className:"btn",title:"New tab",children:"+Tab"}),t.jsx("button",{onClick:()=>q&&s([{type:"tab.close",tabId:q}]),className:"btn",title:"Close active tab",children:"×Tab"})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:8},children:[t.jsxs("div",{style:{display:"flex",gap:4},children:[t.jsx("input",{type:"text",placeholder:"Upload Selector",value:me,onChange:e=>nt(e.target.value),style:{flex:1,padding:4,borderRadius:4,border:"1px solid var(--border-color)"}}),t.jsx("input",{type:"file",ref:ze,style:{width:80}}),t.jsx("button",{onClick:yt,className:"btn",children:"Up"})]}),t.jsxs("div",{style:{display:"flex",gap:4},children:[t.jsx("input",{type:ae?"password":"text",value:G,onChange:e=>De(e.target.value),placeholder:"Type text...",style:{flex:1,padding:4,borderRadius:4,border:"1px solid var(--border-color)"}}),t.jsx("button",{onClick:vt,className:"btn",children:"Type"}),t.jsx("button",{onClick:()=>s([{type:"press",key:"Enter"}]),className:"btn",children:"Ent"})]}),t.jsxs("div",{style:{display:"flex",gap:4},children:[t.jsx("input",{type:"text",value:C,onChange:e=>We(e.target.value),placeholder:"CSS Selector",style:{flex:1,padding:4,borderRadius:4,border:"1px solid var(--border-color)"}}),t.jsx("button",{onClick:()=>C&&s([{type:"locate",selector:C}]),className:"btn",children:"Loc"}),t.jsx("button",{onClick:()=>C&&s([{type:"click",selector:C}]),className:"btn",children:"Clk"})]})]}),t.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:[t.jsx("input",{type:"checkbox",checked:x,onChange:e=>we(e.target.checked)}),"تحكم"]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:[t.jsx("input",{type:"checkbox",checked:se,onChange:e=>_e(e.target.checked),disabled:!x}),"Picker"]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:[t.jsx("input",{type:"checkbox",checked:ae,onChange:e=>ut(e.target.checked)}),"Login"]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:[t.jsx("input",{type:"checkbox",checked:et,onChange:e=>{const o=e.target.checked;xe(o),s([{type:"redaction.set",enabled:o}])}}),"Redaction"]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:["FPS",t.jsx("select",{value:Ge,onChange:e=>{const o=Number(e.target.value);ge(o),s([{type:"stream.setFps",fps:o}])},style:{height:26,borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[2,5,8,10,15,20].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:["جودة",t.jsx("select",{value:Ve,onChange:e=>{const o=Number(e.target.value);be(o),s([{type:"stream.setQuality",quality:o}])},style:{height:26,borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[35,45,50,60,70].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:["Timeline",t.jsx("input",{type:"checkbox",checked:qe,onChange:e=>pt(e.target.checked)})]}),t.jsx("button",{onClick:()=>{ht(e=>!e),ye(!0)},className:"btn",children:A?"إغلاق Replay":"Replay"}),t.jsx("button",{onClick:()=>{Ke([]),ke(0)},className:"btn",children:"مسح"})]}),A&&T.length?t.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[t.jsx("input",{type:"range",min:0,max:Math.max(0,T.length-1),value:Math.min(Y,Math.max(0,T.length-1)),onChange:e=>ke(Number(e.target.value)),style:{flex:1,minWidth:240}}),t.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)"},dir:"auto",children:T[Y]?new Date(T[Y].ts).toLocaleTimeString():""})]}):null,N?t.jsxs("div",{style:{fontSize:12,color:"var(--text-secondary)"},dir:"auto",children:["Picked: ",String(N.tag||"")," ",N.id?`#${N.id}`:""," ",N.ariaLabel?`aria="${N.ariaLabel}"`:""," ",N.selector?`sel=${N.selector}`:""]}):null,t.jsxs("div",{style:{fontSize:11,color:"var(--text-secondary)"},children:["DevTools: ",t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:W,onChange:e=>st(e.target.checked)})," Auto Extract"]})]})]})]})}export{Pt as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AgentBrowserStream-EOfYXao8.js","assets/ui-vUf7uXgm.js","assets/vendor-DZWZ8VcW.js","assets/markdown-DC0SD8kP.js"])))=>i.map(i=>d[i]);
import{j as n,G as Es,S as Os,M as Ls,L as Ps,a as as,m as ve,A as Ts,Z as yt,X as bt,b as wt,c as $s,d as As,E as ls,e as cs,U as zs,C as Fs,R as _s,f as Ds,F as _t,g as ds,T as Ms,h as us,V as Bs,i as Us,k as Dt,l as fs,n as qe,o as Qe,p as Vs,q as Ks,P as Ws,r as Mt,s as Hs,t as Js,u as qs,v as Bt,w as Gs,x as Ys,y as Xs,z as Qs,B as Zs,D as en,H as tn,I as sn,J as nn}from"./ui-vUf7uXgm.js";import{b as rn,a as h,u as nt,O as on,R as an,B as ln,c as cn,d as Ge,N as dn}from"./vendor-DZWZ8VcW.js";import{_ as un,M as fn,h as pn}from"./markdown-DC0SD8kP.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var Ye={},Ut;function gn(){if(Ut)return Ye;Ut=1;var o=rn();return Ye.createRoot=o.createRoot,Ye.hydrateRoot=o.hydrateRoot,Ye}var hn=gn();const mn=(o,e,t,s)=>{var i,a,c,l;const r=[t,{code:e,...s||{}}];if((a=(i=o==null?void 0:o.services)==null?void 0:i.logger)!=null&&a.forward)return o.services.logger.forward(r,"warn","react-i18next::",!0);Ee(r[0])&&(r[0]=`react-i18next:: ${r[0]}`),(l=(c=o==null?void 0:o.services)==null?void 0:c.logger)!=null&&l.warn?o.services.logger.warn(...r):console!=null&&console.warn&&console.warn(...r)},Vt={},vt=(o,e,t,s)=>{Ee(t)&&Vt[t]||(Ee(t)&&(Vt[t]=new Date),mn(o,e,t,s))},ps=(o,e)=>()=>{if(o.isInitialized)e();else{const t=()=>{setTimeout(()=>{o.off("initialized",t)},0),e()};o.on("initialized",t)}},St=(o,e,t)=>{o.loadNamespaces(e,ps(o,t))},Kt=(o,e,t,s)=>{if(Ee(t)&&(t=[t]),o.options.preload&&o.options.preload.indexOf(e)>-1)return St(o,t,s);t.forEach(r=>{o.options.ns.indexOf(r)<0&&o.options.ns.push(r)}),o.loadLanguages(e,ps(o,s))},xn=(o,e,t={})=>!e.languages||!e.languages.length?(vt(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(o,{lng:t.lng,precheck:(s,r)=>{if(t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&s.services.backendConnector.backend&&s.isLanguageChangingTo&&!r(s.isLanguageChangingTo,o))return!1}}),Ee=o=>typeof o=="string",yn=o=>typeof o=="object"&&o!==null,bn=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,wn={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},vn=o=>wn[o],Sn=o=>o.replace(bn,vn);let jt={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:Sn};const jn=(o={})=>{jt={...jt,...o}},kn=()=>jt;let gs;const Nn=o=>{gs=o},Cn=()=>gs,In={type:"3rdParty",init(o){jn(o.options.react),Nn(o)}},Rn=h.createContext();class En{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const On=(o,e)=>{const t=h.useRef();return h.useEffect(()=>{t.current=o},[o,e]),t.current},hs=(o,e,t,s)=>o.getFixedT(e,t,s),Ln=(o,e,t,s)=>h.useCallback(hs(o,e,t,s),[o,e,t,s]),Ve=(o,e={})=>{var V,Y,E,O;const{i18n:t}=e,{i18n:s,defaultNS:r}=h.useContext(Rn)||{},i=t||s||Cn();if(i&&!i.reportNamespaces&&(i.reportNamespaces=new En),!i){vt(i,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const z=(G,M)=>Ee(M)?M:yn(M)&&Ee(M.defaultValue)?M.defaultValue:Array.isArray(G)?G[G.length-1]:G,T=[z,{},!1];return T.t=z,T.i18n={},T.ready=!1,T}(V=i.options.react)!=null&&V.wait&&vt(i,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const a={...kn(),...i.options.react,...e},{useSuspense:c,keyPrefix:l}=a;let d=r||((Y=i.options)==null?void 0:Y.defaultNS);d=Ee(d)?[d]:d||["translation"],(O=(E=i.reportNamespaces).addUsedNamespaces)==null||O.call(E,d);const g=(i.isInitialized||i.initializedStoreOnce)&&d.every(z=>xn(z,i,a)),m=Ln(i,e.lng||null,a.nsMode==="fallback"?d:d[0],l),p=()=>m,C=()=>hs(i,e.lng||null,a.nsMode==="fallback"?d:d[0],l),[x,S]=h.useState(p);let N=d.join();e.lng&&(N=`${e.lng}${N}`);const _=On(N),L=h.useRef(!0);h.useEffect(()=>{const{bindI18n:z,bindI18nStore:T}=a;L.current=!0,!g&&!c&&(e.lng?Kt(i,e.lng,d,()=>{L.current&&S(C)}):St(i,d,()=>{L.current&&S(C)})),g&&_&&_!==N&&L.current&&S(C);const G=()=>{L.current&&S(C)};return z&&(i==null||i.on(z,G)),T&&(i==null||i.store.on(T,G)),()=>{L.current=!1,i&&z&&(z==null||z.split(" ").forEach(M=>i.off(M,G))),T&&i&&T.split(" ").forEach(M=>i.store.off(M,G))}},[i,N]),h.useEffect(()=>{L.current&&g&&S(p)},[i,l,g]);const D=[x,i,g];if(D.t=x,D.i18n=i,D.ready=g,g||!g&&!c)return D;throw new Promise(z=>{e.lng?Kt(i,e.lng,d,()=>z()):St(i,d,()=>z())})},Wt=[{code:"en",label:"English"},{code:"ar",label:"العربية"},{code:"fr",label:"Français"},{code:"de",label:"Deutsch"},{code:"ru",label:"Русский"},{code:"es",label:"Español"}];function Pn(){var m;const{i18n:o,t:e}=Ve(),[t,s]=h.useState(()=>localStorage.getItem("theme")||"dark"),[r,i]=h.useState(()=>localStorage.getItem("lang")||"en"),[a,c]=h.useState(!1),l=h.useRef(null),d=nt();h.useEffect(()=>{localStorage.setItem("theme",t),document.documentElement.dataset.theme=t},[t]),h.useEffect(()=>{localStorage.setItem("lang",r),o.changeLanguage(r),document.documentElement.setAttribute("lang",r),document.documentElement.setAttribute("dir",r==="ar"?"rtl":"ltr")},[r,o]),h.useEffect(()=>{function p(C){l.current&&!l.current.contains(C.target)&&c(!1)}return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const g=((m=Wt.find(p=>p.code===r))==null?void 0:m.label)||"English";return n.jsxs("div",{className:"topbar",children:[n.jsx("div",{className:"brand",onClick:()=>d("/"),children:"JOE"}),n.jsx("div",{className:"spacer"}),n.jsxs("div",{className:"topbar-actions",style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"8px",marginInlineStart:"auto"},children:[n.jsxs("div",{className:"lang-dropdown",ref:l,style:{position:"relative"},children:[n.jsx("button",{className:`lang-btn ${a?"active":""}`,onClick:()=>c(!a),title:g,children:n.jsx(Es,{size:20})}),a&&n.jsx("div",{className:"lang-menu",style:{position:"absolute",top:"100%",right:"0",zIndex:1e3,marginTop:"8px"},children:Wt.map(p=>n.jsx("button",{className:`lang-option ${r===p.code?"active":""}`,onClick:()=>{i(p.code),c(!1)},children:p.label},p.code))})]}),n.jsx("button",{className:"action-btn","aria-label":e("toggleTheme"),title:e("toggleTheme"),onClick:()=>{document.documentElement.classList.add("theme-switching"),s(t==="dark"?"light":"dark"),window.setTimeout(()=>{document.documentElement.classList.remove("theme-switching")},300)},children:t==="dark"?n.jsx(Os,{size:20}):n.jsx(Ls,{size:20})}),n.jsx("button",{className:localStorage.getItem("token")?"logout-btn":"login-btn",onClick:()=>{localStorage.getItem("token")?confirm(e("confirmLogout","Are you sure you want to logout?"))&&(localStorage.removeItem("token"),d("/login")):d("/login")},title:localStorage.getItem("token")?e("logout","Logout"):e("login"),children:localStorage.getItem("token")?n.jsx(Ps,{size:20}):n.jsx(as,{size:20})})]})]})}const Tn=()=>n.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:-1,overflow:"hidden",background:"var(--bg-dark)",transition:"background 0.3s ease"},children:[n.jsx(ve.div,{style:{position:"absolute",top:"-10%",left:"-10%",width:"50vw",height:"50vw",borderRadius:"50%",background:"radial-gradient(circle, rgba(37,99,235,0.15) 0%, rgba(37,99,235,0) 70%)",filter:"blur(60px)"},animate:{x:[0,100,0],y:[0,50,0],scale:[1,1.1,1]},transition:{duration:20,repeat:1/0,ease:"easeInOut"}}),n.jsx(ve.div,{style:{position:"absolute",bottom:"-10%",right:"-10%",width:"60vw",height:"60vw",borderRadius:"50%",background:"radial-gradient(circle, rgba(147,51,234,0.15) 0%, rgba(147,51,234,0) 70%)",filter:"blur(80px)"},animate:{x:[0,-100,0],y:[0,-50,0],scale:[1,1.2,1]},transition:{duration:25,repeat:1/0,ease:"easeInOut"}}),n.jsx(ve.div,{style:{position:"absolute",top:"40%",left:"40%",width:"40vw",height:"40vw",borderRadius:"50%",background:"radial-gradient(circle, rgba(56,189,248,0.1) 0%, rgba(56,189,248,0) 70%)",filter:"blur(50px)"},animate:{x:[0,-30,0],y:[0,40,0],scale:[1,1.3,1]},transition:{duration:15,repeat:1/0,ease:"easeInOut"}})]});function $n(){return n.jsxs("div",{className:"app",children:[n.jsx(Tn,{}),n.jsx(Pn,{}),n.jsx("div",{className:"content",children:n.jsx(on,{})})]})}function An(){const{t:o}=Ve(),e=nt();return n.jsxs("div",{className:"home-page",children:[n.jsx("div",{className:"home-bg-glow-1"}),n.jsx("div",{className:"home-bg-glow-2"}),n.jsxs("div",{className:"home-content",children:[n.jsx("div",{className:"home-logo-container",children:n.jsx("div",{className:"home-logo-ring",children:n.jsx("span",{className:"home-logo-text",children:"J"})})}),n.jsxs("h1",{className:"home-title",children:["JOE ",n.jsx("span",{className:"home-title-accent",children:"AI"})]}),n.jsx("p",{className:"home-subtitle",children:o("homeSubtitle","Your intelligent coding companion")}),n.jsxs("div",{className:"home-actions",children:[n.jsxs("button",{className:"home-btn-primary",onClick:()=>e("/login"),children:[n.jsx("span",{children:o("start_now","Start Now")}),n.jsx(Ts,{size:20})]}),n.jsxs("button",{className:"home-btn-secondary",onClick:()=>window.open("https://xelitesolutions.com","_blank"),children:[n.jsx("span",{children:o("learn_more","Learn More")}),n.jsx(yt,{size:18})]})]})]}),n.jsx("div",{className:"home-footer",children:"© 2025 Xelite Solutions. All rights reserved."})]})}const ht=window.location.hostname,zn="http://127.0.0.1:8080";ht.includes("joe-api")||ht.startsWith("api.");const ee=String(zn).replace(/\/+$/,"");let Ae="";Ae||(Ae=`${ee.replace(/^http/,"ws")}/ws`);Ae.startsWith("http")&&(Ae=Ae.replace(/^http/,"ws"));const Fn=Ae;function _n(){const{t:o}=Ve(),e=nt(),[t,s]=h.useState(""),[r,i]=h.useState(""),[a,c]=h.useState(!1),[l,d]=h.useState(null),[g,m]=h.useState(!1);async function p(){d(null),m(!0);try{const x=await fetch(`${ee}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r,role:"OWNER"})});if(!x.ok){const S=await x.text();d(S);return}await C()}catch{d("Registration failed")}finally{m(!1)}}async function C(){d(null),m(!0);try{const x=await fetch(`${ee}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})}),S=await x.json();if(!x.ok){d((S==null?void 0:S.error)||"Login failed");return}localStorage.setItem("token",S.token),e("/joe")}catch{d("Network error")}finally{m(!1)}}return n.jsxs("div",{className:"login-page",children:[n.jsxs("div",{className:"login-card",style:{position:"relative"},children:[n.jsx("button",{className:"login-close-btn",onClick:()=>e("/"),title:o("close","Close"),children:n.jsx(bt,{size:24})}),n.jsxs("div",{className:"login-header",children:[n.jsx("div",{className:"login-logo-wrapper",children:n.jsx("div",{className:"login-logo",children:n.jsx("span",{className:"login-logo-text",children:"J"})})}),n.jsx("div",{className:"login-title",children:"JOE AI"}),n.jsxs("div",{className:"login-subtitle",children:[n.jsx(wt,{size:14,style:{display:"inline",marginInlineEnd:6,color:"var(--accent-primary)"}}),o("login_subtitle","Welcome back to your workspace"),n.jsx(wt,{size:14,style:{display:"inline",marginInlineStart:6,color:"var(--accent-primary)"}})]})]}),n.jsxs("div",{className:"login-form",children:[l&&n.jsx("div",{className:"login-error",children:l}),n.jsxs("div",{className:"login-input-group",children:[n.jsx("label",{className:"login-label",children:o("email")}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx("input",{className:"login-input",value:t,onChange:x=>s(x.target.value),placeholder:"you@example.com"}),n.jsx($s,{size:18,style:{position:"absolute",top:16,left:16,color:"var(--text-muted)"},className:"input-icon-start"})]})]}),n.jsxs("div",{className:"login-input-group",children:[n.jsx("label",{className:"login-label",children:o("password")}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx("input",{className:"login-input",value:r,onChange:x=>i(x.target.value),type:a?"text":"password",placeholder:"••••••••",onKeyDown:x=>x.key==="Enter"&&C()}),n.jsx(As,{size:18,style:{position:"absolute",top:16,left:16,color:"var(--text-muted)"},className:"input-icon-start"}),n.jsx("button",{type:"button",onClick:()=>c(!a),style:{position:"absolute",top:14,right:16,background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},className:"input-icon-end",children:a?n.jsx(ls,{size:18}):n.jsx(cs,{size:18})})]})]}),n.jsxs("div",{className:"login-actions",children:[n.jsx("button",{className:"login-submit-btn",onClick:C,disabled:g,children:g?"...":n.jsxs("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[n.jsx(as,{size:20})," ",o("login")]})}),n.jsx("button",{className:"login-register-btn",onClick:p,disabled:g,children:n.jsxs("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[n.jsx(zs,{size:18})," ",o("register")]})})]})]})]}),n.jsx("div",{style:{position:"absolute",top:"10%",left:"10%",width:"300px",height:"300px",background:"radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%)",filter:"blur(40px)",zIndex:0}}),n.jsx("div",{style:{position:"absolute",bottom:"10%",right:"10%",width:"400px",height:"400px",background:"radial-gradient(circle, rgba(96, 165, 250, 0.1) 0%, transparent 70%)",filter:"blur(60px)",zIndex:0}})]})}const Dn={'pre[class*="language-"]':{color:"#d4d4d4",fontSize:"13px",textShadow:"none",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace',direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",lineHeight:"1.5",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",padding:"1em",margin:".5em 0",overflow:"auto",background:"#1e1e1e"},'code[class*="language-"]':{color:"#d4d4d4",fontSize:"13px",textShadow:"none",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace',direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",lineHeight:"1.5",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none"},'pre[class*="language-"]::selection':{textShadow:"none",background:"#264F78"},'code[class*="language-"]::selection':{textShadow:"none",background:"#264F78"},'pre[class*="language-"] *::selection':{textShadow:"none",background:"#264F78"},'code[class*="language-"] *::selection':{textShadow:"none",background:"#264F78"},':not(pre) > code[class*="language-"]':{padding:".1em .3em",borderRadius:".3em",color:"#db4c69",background:"#1e1e1e"},".namespace":{Opacity:".7"},"doctype.doctype-tag":{color:"#569CD6"},"doctype.name":{color:"#9cdcfe"},comment:{color:"#6a9955"},prolog:{color:"#6a9955"},punctuation:{color:"#d4d4d4"},".language-html .language-css .token.punctuation":{color:"#d4d4d4"},".language-html .language-javascript .token.punctuation":{color:"#d4d4d4"},property:{color:"#9cdcfe"},tag:{color:"#569cd6"},boolean:{color:"#569cd6"},number:{color:"#b5cea8"},constant:{color:"#9cdcfe"},symbol:{color:"#b5cea8"},inserted:{color:"#b5cea8"},unit:{color:"#b5cea8"},selector:{color:"#d7ba7d"},"attr-name":{color:"#9cdcfe"},string:{color:"#ce9178"},char:{color:"#ce9178"},builtin:{color:"#ce9178"},deleted:{color:"#ce9178"},".language-css .token.string.url":{textDecoration:"underline"},operator:{color:"#d4d4d4"},entity:{color:"#569cd6"},"operator.arrow":{color:"#569CD6"},atrule:{color:"#ce9178"},"atrule.rule":{color:"#c586c0"},"atrule.url":{color:"#9cdcfe"},"atrule.url.function":{color:"#dcdcaa"},"atrule.url.punctuation":{color:"#d4d4d4"},keyword:{color:"#569CD6"},"keyword.module":{color:"#c586c0"},"keyword.control-flow":{color:"#c586c0"},function:{color:"#dcdcaa"},"function.maybe-class-name":{color:"#dcdcaa"},regex:{color:"#d16969"},important:{color:"#569cd6"},italic:{fontStyle:"italic"},"class-name":{color:"#4ec9b0"},"maybe-class-name":{color:"#4ec9b0"},console:{color:"#9cdcfe"},parameter:{color:"#9cdcfe"},interpolation:{color:"#9cdcfe"},"punctuation.interpolation-punctuation":{color:"#569cd6"},variable:{color:"#9cdcfe"},"imports.maybe-class-name":{color:"#9cdcfe"},"exports.maybe-class-name":{color:"#9cdcfe"},escape:{color:"#d7ba7d"},"tag.punctuation":{color:"#808080"},cdata:{color:"#808080"},"attr-value":{color:"#ce9178"},"attr-value.punctuation":{color:"#ce9178"},"attr-value.punctuation.attr-equals":{color:"#d4d4d4"},namespace:{color:"#4ec9b0"},'pre[class*="language-javascript"]':{color:"#9cdcfe"},'code[class*="language-javascript"]':{color:"#9cdcfe"},'pre[class*="language-jsx"]':{color:"#9cdcfe"},'code[class*="language-jsx"]':{color:"#9cdcfe"},'pre[class*="language-typescript"]':{color:"#9cdcfe"},'code[class*="language-typescript"]':{color:"#9cdcfe"},'pre[class*="language-tsx"]':{color:"#9cdcfe"},'code[class*="language-tsx"]':{color:"#9cdcfe"},'pre[class*="language-css"]':{color:"#ce9178"},'code[class*="language-css"]':{color:"#ce9178"},'pre[class*="language-html"]':{color:"#d4d4d4"},'code[class*="language-html"]':{color:"#d4d4d4"},".language-regex .token.anchor":{color:"#dcdcaa"},".language-html .token.punctuation":{color:"#808080"},'pre[class*="language-"] > code[class*="language-"]':{position:"relative",zIndex:"1"},".line-highlight.line-highlight":{background:"#f7ebc6",boxShadow:"inset 5px 0 0 #f7d87c",zIndex:"0"}},Mn=!1,Bn=h.lazy(()=>un(()=>import("./AgentBrowserStream-EOfYXao8.js"),__vite__mapDeps([0,1,2,3])));function Un({isThinking:o,toolVisible:e,activeToolName:t}){return n.jsx("div",{className:"mt-0.5",children:n.jsx(us,{children:o&&e&&t&&n.jsx(ve.div,{initial:{opacity:0,y:2},animate:{opacity:1,y:0},exit:{opacity:0,y:-2},transition:{duration:.18},className:"text-[10px] leading-3 font-light text-zinc-400/60",children:t},t)})})}const Ht=h.forwardRef(({event:o,isUser:e,onOptionClick:t},s)=>{const{t:r}=Ve();let i=o.data.text||o.data,a=[];if(!e&&typeof i=="string"&&i.includes(":::options")){const c=x=>{const S=x.search(/[\[{]/);if(S<0)return null;const N=[],_={"{":"}","[":"]"};let L=!1,D=!1;for(let V=S;V<x.length;V++){const Y=x[V];if(L){if(D){D=!1;continue}if(Y==="\\"){D=!0;continue}Y==='"'&&(L=!1);continue}if(Y==='"'){L=!0;continue}if(Y==="{"||Y==="["){N.push(_[Y]);continue}if(Y==="}"||Y==="]"){if(N.length===0)return null;const E=N[N.length-1];if(Y!==E)return null;if(N.pop(),N.length===0)return{jsonText:x.slice(S,V+1),rest:x.slice(V+1)}}}return null},l=[];let d=i;const g=/:::options\s*([\s\S]*?):::/g;let m=null,p=0;const C=[];for(;m=g.exec(i);){C.push(i.slice(p,m.index)),p=g.lastIndex;const x=String(m[1]??"").trim();if(x)try{const S=JSON.parse(x);Array.isArray(S)?l.push(...S):S&&l.push(S)}catch{}}if(p>0&&(C.push(i.slice(p)),d=C.join("").trimEnd()),l.length===0){const x=i.indexOf(":::options"),S=i.slice(0,x).trimEnd(),N=i.slice(x+10),_=c(N);if(_)try{const L=JSON.parse(_.jsonText);Array.isArray(L)?l.push(...L):L&&l.push(L),d=S}catch{}}l.length>0&&(a=l,i=d)}return n.jsxs(ve.div,{ref:s,initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.4,ease:"easeOut"},className:`chat-bubble-wrapper ${e?"user":"ai"}`,children:[!e&&n.jsx("div",{className:"chat-avatar ai",children:n.jsx(wt,{size:18})}),n.jsxs("div",{className:"chat-bubble backdrop-blur-md shadow-lg",style:{background:e?"var(--user-msg-bg)":"var(--joe-msg-bg)",color:e?"#ffffff":"var(--text-primary)",backdropFilter:"blur(12px)",border:"1px solid var(--border-color)"},children:[n.jsxs("div",{className:"chat-bubble-header",children:[n.jsx("span",{className:"chat-bubble-sender",children:e?r("you","You"):"JOE AI"}),!e&&n.jsxs("div",{className:"chat-bubble-actions",children:[n.jsx("button",{className:"chat-action-btn",title:r("copy","Copy"),onClick:()=>navigator.clipboard.writeText(i),children:n.jsx(Fs,{size:14})}),n.jsx("button",{className:"chat-action-btn",title:r("regenerate","Regenerate"),children:n.jsx(_s,{size:14})})]})]}),n.jsx("div",{className:"chat-bubble-content",children:e?n.jsx("div",{style:{whiteSpace:"pre-wrap"},children:i}):n.jsxs(n.Fragment,{children:[n.jsx(fn,{components:{h1:({node:c,...l})=>n.jsx("h1",{className:"text-[var(--accent-secondary)] text-2xl mb-2 mt-2 border-b border-[var(--border-color)] pb-1",...l}),h2:({node:c,...l})=>n.jsx("h2",{className:"text-[var(--accent-primary)] text-xl mb-2 mt-4",...l}),h3:({node:c,...l})=>n.jsx("h3",{className:"text-[var(--neon-purple)] text-lg mb-2 mt-4",...l}),ul:({node:c,...l})=>n.jsx("ul",{className:"list-disc pl-6 mb-4",...l}),ol:({node:c,...l})=>n.jsx("ol",{className:"list-decimal pl-6 mb-4",...l}),li:({node:c,...l})=>n.jsx("li",{className:"mb-1 leading-relaxed",...l}),p:({node:c,...l})=>n.jsx("p",{className:"mb-4 leading-relaxed",...l}),blockquote:({node:c,...l})=>n.jsx("blockquote",{className:"border-l-4 border-[var(--accent-secondary)] bg-[var(--bg-secondary)] my-4 py-2 px-4 rounded",...l}),a:({node:c,...l})=>n.jsx("a",{...l,target:"_blank",rel:"noopener noreferrer",className:"text-[var(--accent-primary)] underline"}),code({node:c,inline:l,className:d,children:g,...m}){const p=/language-(\w+)/.exec(d||"");return!l&&p?n.jsx(pn,{style:Dn,language:p[1],PreTag:"div",...m,children:String(g).replace(/\n$/,"")}):n.jsx("code",{className:d,...m,style:l?{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:"3px"}:{display:"block",padding:"10px",background:"#1e1e1e",borderRadius:"4px",overflowX:"auto"},children:g})}},children:i||(typeof o.data=="string"?o.data:JSON.stringify(o.data))}),a.length>0&&n.jsx("div",{style:{display:"flex",gap:8,marginTop:16,flexWrap:"wrap",borderTop:"1px solid var(--border-color)",paddingTop:12},children:a.map((c,l)=>n.jsxs("button",{onClick:()=>t==null?void 0:t(c.query),style:{background:"rgba(255,255,255,0.05)",border:"1px solid var(--border-color)",borderRadius:20,padding:"6px 14px",color:"var(--text-secondary)",fontSize:13,cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:6},onMouseEnter:d=>d.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:d=>d.currentTarget.style.background="rgba(255,255,255,0.05)",children:[n.jsx("span",{style:{opacity:.7},children:"✨"})," ",c.label]},l))})]})})]}),e&&n.jsx("div",{className:"chat-avatar user",children:n.jsx(Ds,{size:18})})]})});function Jt({sessionId:o,sessionKind:e="chat",browserSessionId:t=null,onSessionCreated:s,onPreviewArtifact:r,onStepsUpdate:i,onMessagesUpdate:a}){const{t:c}=Ve(),[l,d]=h.useState(""),[g,m]=h.useState([]),[p,C]=h.useState(!1),[x,S]=h.useState([]),[N,_]=h.useState(null),[L,D]=h.useState(!1),[V,Y]=h.useState(!1),[E,O]=h.useState(!1),[z,T]=h.useState(!1),[G,M]=h.useState("idle"),[$,ie]=h.useState(!1),[Q,re]=h.useState(null),[pe,be]=h.useState(!1),[Ce,oe]=h.useState([]),ge=h.useRef(null);h.useRef(window.speechSynthesis);const le=h.useRef(null),ke=h.useRef(),Ie=h.useRef(null),Re=h.useRef(null),Ke=h.useRef(null),je=h.useRef(!0),y=h.useRef(null),v=h.useRef({}),F=h.useRef(null),ce=h.useRef(0),me=h.useRef(void 0),Nt=h.useRef(0),we=h.useRef(null),Ct=h.useRef($),It=h.useRef(pe),Rt=h.useRef(Q),[ys,it]=h.useState(!1),[te,Ne]=h.useState({openai:{name:"OpenAI",apiKey:"",isConnected:!1,model:"gpt-4o"},anthropic:{name:"Anthropic",apiKey:"",isConnected:!1,model:"claude-3-opus-20240229"},gemini:{name:"Google Gemini",apiKey:"",isConnected:!1,model:"gemini-pro"},grok:{name:"xAI (Grok)",apiKey:"",isConnected:!1,baseUrl:"https://api.x.ai/v1",model:"grok-beta"}}),[K,ot]=h.useState("openai"),[Et,bs]=h.useState({}),[fr,We]=h.useState(null),He=h.useMemo(()=>{var J,k,U,B,ne,q,ue,ze,Fe,At,zt,Ft;const u=new Map,f=[],b=[],j=[],I=new Set,P=[],ae=x.map((w,he)=>({e:w,idx:he,seq:typeof(w==null?void 0:w.seq)=="number"?w.seq:Number.POSITIVE_INFINITY,ts:typeof(w==null?void 0:w.ts)=="number"?w.ts:he})).sort((w,he)=>w.seq-he.seq||w.ts-he.ts||w.idx-he.idx),Z=(w,he)=>(u.has(w)||(u.set(w,{...he,key:w}),f.push(w)),u.get(w)),W=new Map,R=new Map;for(const{e:w}of ae){const he=typeof(w==null?void 0:w.runId)=="string"?w.runId:typeof((J=w==null?void 0:w.data)==null?void 0:J.runId)=="string"?w.data.runId:void 0;if((w.type==="user_input"||w.type==="text"||w.type==="step_started"||w.type==="step_progress"||w.type==="step_done"||w.type==="step_failed"||w.type==="evidence_added"||w.type==="artifact_created"||w.type==="approval_required"||w.type==="approval_result"||w.type==="run_finished"||w.type==="run_completed")&&P.push({type:w.type,data:w.data,duration:w.duration}),w.type==="step_started"&&((k=w.data)!=null&&k.name)){const ye=String(w.data.name),xe=`${he||""}::${ye}`,Pe=(W.get(xe)||0)+1;W.set(xe,Pe);const _e=`${xe}::${Pe}`,De=R.get(xe)||[];De.push(_e),R.set(xe,De);const fe=Z(_e,{name:ye,status:"running",runId:he});fe.status="running",typeof(w==null?void 0:w.ts)=="number"&&(fe.startedAt=w.ts),((U=w.data)==null?void 0:U.input)!=null&&fe.input==null&&(fe.input=w.data.input)}if((w.type==="step_done"||w.type==="step_failed")&&((B=w.data)!=null&&B.name)){const ye=String(w.data.name),xe=`${he||""}::${ye}`,Pe=R.get(xe)||[],_e=Pe.pop();Pe.length?R.set(xe,Pe):R.delete(xe);const De=_e||`${xe}::${(W.get(xe)||0)+1}`;_e||W.set(xe,Number(De.split("::").pop())||(W.get(xe)||0)+1);const fe=Z(De,{name:ye,status:"running",runId:he});fe.status=w.type==="step_done"?"done":"failed",typeof w.duration=="number"?fe.duration=w.duration:typeof fe.startedAt=="number"&&typeof(w==null?void 0:w.ts)=="number"&&(fe.duration=w.ts-fe.startedAt),(ne=w.data)!=null&&ne.plan&&(fe.plan=w.data.plan),(q=w.data)!=null&&q.result&&(fe.result=w.data.result,w.data.result.ok||(fe.error=w.data.result.error||w.data.result.message)),w.type==="step_failed"&&!fe.error&&(fe.error=(ue=w.data)==null?void 0:ue.error)}if(w.type==="evidence_added"&&String(((ze=w.data)==null?void 0:ze.kind)||"")==="log"&&typeof((Fe=w.data)==null?void 0:Fe.text)=="string"&&b.push(w.data.text),w.type==="artifact_created"){const ye=typeof((At=w.data)==null?void 0:At.href)=="string"?w.data.href:"";ye&&!I.has(ye)&&(I.add(ye),j.push({name:String(((zt=w.data)==null?void 0:zt.name)||"artifact"),href:ye,kind:(Ft=w.data)==null?void 0:Ft.kind}))}}const X=f.map(w=>u.get(w)).filter(Boolean),se=w=>w.startsWith("thinking_step_")?`Plan #${w.replace("thinking_step_","")}`:w.startsWith("execute:")?`Execute: ${w.slice(8)}`:w;return{steps:X.map(w=>({...w,displayName:se(String(w.name||""))})),logs:b,artifacts:j,timeline:P}},[x]);h.useEffect(()=>{const u=f=>{const b=f==null?void 0:f.detail,j=typeof(b==null?void 0:b.text)=="string"?b.text:"";j&&d(I=>I?`${I}
${j}`:j)};return window.addEventListener("joe:prefill",u),()=>window.removeEventListener("joe:prefill",u)},[]),h.useEffect(()=>{try{const u=localStorage.getItem("ai_providers");if(u){const b=JSON.parse(u);Ne(j=>{const I={...j};return Object.keys(b).forEach(P=>{I[P]&&(I[P]={...I[P],...b[P]})}),I})}const f=localStorage.getItem("active_provider");f&&te[f]&&ot(f)}catch(u){console.error("Failed to load providers settings",u)}},[]),h.useEffect(()=>{localStorage.setItem("ai_providers",JSON.stringify(te))},[te]),h.useEffect(()=>{localStorage.setItem("active_provider",K)},[K]);const at=(u="auto")=>{var b;const f=Re.current;if(!f){(b=Ie.current)==null||b.scrollIntoView({behavior:u});return}y.current!=null&&(cancelAnimationFrame(y.current),y.current=null),y.current=requestAnimationFrame(()=>{u==="smooth"?f.scrollTo({top:f.scrollHeight,behavior:u}):f.scrollTop=f.scrollHeight})},ws=()=>{const u=Re.current;if(!u){je.current=!0;return}const f=u.scrollHeight-u.scrollTop-u.clientHeight;je.current=f<120};h.useEffect(()=>{je.current=!0,at("auto")},[o,e]),h.useEffect(()=>{const u=Re.current;if(!u)return;const f=()=>ws();return u.addEventListener("scroll",f,{passive:!0}),()=>u.removeEventListener("scroll",f)},[]),h.useEffect(()=>{const u=Ke.current;if(!u||typeof ResizeObserver>"u")return;const f=new ResizeObserver(()=>{je.current&&at("auto")});return f.observe(u),()=>f.disconnect()},[]),h.useEffect(()=>()=>{y.current!=null&&cancelAnimationFrame(y.current)},[]),h.useEffect(()=>{if(je.current&&at("auto"),i&&i(He.steps),a&&a(x),E&&x.length>0){const u=x[x.length-1];u.type==="text"&&u.data.text&&Ot(u.data.text)}},[x,He.steps,E,a,i,$]);const Ot=async u=>{if(!E)return;lt(),T(!0);try{const I=localStorage.getItem("token");if(I){const P=await fetch(`${ee}/audio/speech`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${I}`},body:JSON.stringify({text:u,voice:"onyx"})});if(P.ok){const ae=await P.blob(),Z=URL.createObjectURL(ae),W=new Audio(Z);W.onended=()=>T(!1),W.onerror=()=>T(!1),W.play(),window.currentAudio=W;return}}}catch(I){console.warn("Backend TTS failed, falling back to browser",I)}const f=new SpeechSynthesisUtterance(u),b=/[\u0600-\u06FF]/.test(u);f.lang=b?"ar-SA":"en-US";const j=window.speechSynthesis.getVoices();if(b){const I=j.find(P=>P.lang.includes("ar")&&P.name.includes("Google"))||j.find(P=>P.lang.includes("ar"));I&&(f.voice=I)}f.onstart=()=>T(!0),f.onend=()=>T(!1),f.onerror=()=>T(!1),window.speechSynthesis.speak(f)},lt=()=>{window.speechSynthesis.cancel(),window.currentAudio&&(window.currentAudio.pause(),window.currentAudio=null),T(!1)};h.useEffect(()=>(window.speechSynthesis.getVoices(),window.speechSynthesis.onvoiceschanged=()=>{window.speechSynthesis.getVoices()},()=>{lt()}),[]),h.useEffect(()=>{const u=window.SpeechRecognition||window.webkitSpeechRecognition;if(u){const f=new u;f.continuous=!1,f.interimResults=!1,f.lang="ar-SA",f.onstart=()=>Y(!0),f.onend=()=>Y(!1),f.onresult=b=>{const j=b.results[0][0].transcript;d(I=>I+(I?" ":"")+j)},ge.current=f}},[]);const vs=()=>{if(!ge.current){alert("التعرف الصوتي غير مدعوم في هذا المتصفح. يرجى استخدام Chrome.");return}V?ge.current.stop():ge.current.start()},Oe=()=>{we.current!=null&&(window.clearTimeout(we.current),we.current=null)};h.useEffect(()=>{Ct.current=$},[$]),h.useEffect(()=>{It.current=pe},[pe]),h.useEffect(()=>{Rt.current=Q},[Q]);const Je=u=>{const f=String(u||"").trim();f&&(we.current!=null&&(window.clearTimeout(we.current),we.current=null),M("thinking"),ie(!0),re(f),be(!0),Nt.current=Date.now())},ct=()=>{const u=Date.now()-Nt.current,f=Math.max(250-u,0);we.current!=null&&window.clearTimeout(we.current);const b=f+250;return we.current=window.setTimeout(()=>{we.current=null,be(!1),window.setTimeout(()=>{re(null),ie(!1),M("idle"),oe([])},250)},f),b};h.useEffect(()=>(Lt(),()=>{le.current&&le.current.close(),ke.current&&window.clearTimeout(ke.current),Oe()}),[]);function Lt(){try{if(le.current){if(le.current.readyState===WebSocket.OPEN)return;try{le.current.close()}catch{}}const u=Fn,f=`${ee.replace(/^http/,"ws")}/ws`,b=P=>{var ae,Z,W,R,X,se,H,J;try{const k=JSON.parse(P.data);if(typeof(k==null?void 0:k.seq)=="number"&&Number.isFinite(k.seq)&&k.seq>ce.current&&(ce.current=k.seq),typeof(k==null?void 0:k.runId)=="string"&&k.runId.trim()&&We(k.runId.trim()),k.type==="user_input"&&(Oe(),ie(!0),re(null),be(!1),oe([])),k.type==="artifact_created"){const U=(ae=k.data)==null?void 0:ae.kind,B=(Z=k.data)==null?void 0:Z.href;if(U==="browser_stream"||typeof B=="string"&&(/^wss?:\/\//i.test(B)||/^\/browser\/ws\//i.test(B))&&/\/ws\//i.test(B)){try{const q="http://dummy.com",ze=new URL(B,q).pathname.split("/").filter(Boolean),Fe=ze[ze.length-1];Fe&&window.dispatchEvent(new CustomEvent("joe:browser_attached",{detail:{sessionId:Fe,wsUrl:B}}))}catch(q){console.error("Failed to parse browser stream artifact",q)}if(e==="agent"&&t)return}}if(k.type==="approval_required"){const U=k.data||{},{id:B,risk:ne,action:q}=U,ue=typeof(U==null?void 0:U.runId)=="string"?U.runId:typeof(k==null?void 0:k.runId)=="string"?k.runId:"";B&&_({id:B,runId:ue,risk:ne,action:q})}if(k.type==="step_started"){const U=typeof(k==null?void 0:k.runId)=="string"?k.runId:typeof((W=k==null?void 0:k.data)==null?void 0:W.runId)=="string"?k.data.runId:"",B=String(((R=k==null?void 0:k.data)==null?void 0:R.name)||"");if(B&&(v.current[`${U}:${B}`]=Date.now()),B==="plan")Je("خطة"),oe(ne=>[...ne,"خطة"].slice(-4));else if(B.startsWith("thinking_step_")){const ne=B.replace("thinking_step_","").trim(),q=ne?`خطة #${ne}`:"خطة";Je(q),oe(ue=>[...ue,q].slice(-4))}else B.startsWith("execute:")?Je(B.slice(8)):B&&Je(B)}if(k.type==="step_done"){const U=typeof(k==null?void 0:k.runId)=="string"?k.runId:typeof((X=k==null?void 0:k.data)==null?void 0:X.runId)=="string"?k.data.runId:"",B=String(((se=k==null?void 0:k.data)==null?void 0:se.name)||""),ne=v.current[`${U}:${B}`];if(ne&&(k.duration=Date.now()-ne,delete v.current[`${U}:${B}`]),B==="execute:browser_open"&&((J=(H=k.data)==null?void 0:H.result)!=null&&J.ok)){const q=k.data.result.output;q!=null&&q.sessionId&&(q!=null&&q.wsUrl)&&window.dispatchEvent(new CustomEvent("joe:browser_attached",{detail:{sessionId:q.sessionId,wsUrl:q.wsUrl}}))}ct()}if(k.type==="text"){const U=typeof(k==null?void 0:k.id)=="string"?k.id:"";if(U.startsWith("system_prompt:"))return;const ne=Ct.current||It.current||Rt.current!=null?ct():0;window.setTimeout(()=>{S(q=>U&&q.some(ue=>typeof(ue==null?void 0:ue.id)=="string"&&ue.id===U)?q:[...q,k]);try{let q=k.data;if(typeof q=="string"&&(q.startsWith("{")||q.startsWith("["))){const ue=JSON.parse(q);q=ue.text||ue.output||q}Ot(String(q))}catch{}},ne);return}if(k.type==="run_finished"&&ct(),!Mn&&["step_started","step_progress","step_done","step_failed","evidence_added"].includes(k.type))return;["step_started","step_progress","step_done","step_failed","evidence_added","artifact_created","approval_required","approval_result","run_finished","run_completed","user_input"].includes(k.type)&&S(U=>{const B=typeof(k==null?void 0:k.id)=="string"?k.id:"";return B&&U.some(ne=>typeof(ne==null?void 0:ne.id)=="string"&&ne.id===B)?U:[...U,k]})}catch(k){console.error("WS parse error:",k)}},j=(P,ae)=>{P.onopen=()=>{le.current===P&&D(!0)},P.onmessage=b,P.onclose=()=>{if(le.current!==P)return;D(!1);const Z=(P==null?void 0:P.__triedFallback)===!0;if(ae&&!Z&&u!==f)try{const W=new WebSocket(f);W.__triedFallback=!0,le.current=W,j(W,!1);return}catch{}ke.current=window.setTimeout(()=>Lt(),2e3)},P.onerror=()=>{le.current===P&&D(!1)}},I=new WebSocket(u);le.current=I,j(I,!0)}catch(u){console.error("WS connect failed:",u),D(!1)}}h.useEffect(()=>{const u=me.current;if(me.current=o,!o){S([]),We(null),_(null),Oe(),M("idle"),re(null);return}if(u&&u!==o){S([]),We(null),_(null),Oe(),M("idle"),re(null),Pt(o);return}!u&&x.length===0&&Pt(o)},[o]);async function Pt(u){try{const f=localStorage.getItem("token"),b=await fetch(`${ee}/sessions/${u}/history`,{headers:f?{Authorization:`Bearer ${f}`}:{}});if(b.ok){const j=await b.json();Array.isArray(j.events)&&S(j.events)}}catch(f){console.error("Failed to load history",f)}}async function Ss(u){var b;if(!((b=u.target.files)!=null&&b.length))return;const f=u.target.files[0];C(!0);try{const j=localStorage.getItem("token"),I=new FormData;I.append("file",f),o&&I.append("sessionId",o);const P=await fetch(`${ee}/files/upload`,{method:"POST",headers:{...j?{Authorization:`Bearer ${j}`}:{}},body:I});if(P.ok){const ae=await P.json();m(Z=>[...Z,{id:ae.file.id,name:ae.file.originalName}])}else alert(c("uploadFailed")||"Upload failed")}catch(j){console.error(j),alert(c("uploadError")||"Upload error")}finally{C(!1),F.current&&(F.current.value="")}}async function dt(u){var ae,Z,W;const f=u||l;if(!f.trim())return;Oe(),M("thinking"),re(null),oe([]);const b=R=>{const X=String(R||"").trim();if(!X)return!1;if(/https?:\/\/[^\s"'<>]+/i.test(X)||/(\b(browser|web)\b|متصفح|داخل المتصفح)/i.test(X))return!0;const J=/(افتح|افتحي|افتحوا|اذهب|زيارة|open|go to|visit)/i.test(X),k=/(github|جيتهاب|كتهاب|كيتهاب)/i.test(X),U=/(كود|code|repo|repository|مستودع|ملفات|files|اختبر|تحقق|راجع|audit|lint|build|typecheck|تحليل)/i.test(X);if(J&&k&&U)return!1;const B=/(file|folder|directory|ملف|مجلد|مسار|path|terminal|command|أمر|ترمينال)/i.test(X);return J&&B?!1:!!(J||/(youtube|يوتيوب|google|جوجل|facebook|فيسبوك|x\.com|twitter|تويتر|instagram|انستغرام)/i.test(X))},j=async R=>await new Promise((X,se)=>{const J=k=>{const U=(k==null?void 0:k.detail)||{},B=String((U==null?void 0:U.sessionId)||"").trim(),ne=typeof(U==null?void 0:U.wsUrl)=="string"?U.wsUrl:void 0;B&&(window.removeEventListener("joe:browser_opened",J),X({sessionId:B,wsUrl:ne}))};window.addEventListener("joe:browser_opened",J),window.dispatchEvent(new CustomEvent("joe:browser_open_request",{detail:{url:R}})),window.setTimeout(()=>{window.removeEventListener("joe:browser_opened",J),se(new Error("browser_open_timeout"))},2e4)}),I=Date.now().toString();S(R=>[...R,{type:"user_input",data:f,id:I,ts:Date.now(),seq:ce.current+.1}]),u||d(""),m([]);const P=localStorage.getItem("token");try{let R=t;if(e==="agent"&&!R&&b(f)){const J=f.match(/https?:\/\/[^\s"'<>]+/i),k=J==null?void 0:J[0],U=/youtube|يوتيوب/i.test(f),B=/(github|جيتهاب|كتهاب|كيتهاب)/i.test(f);R=(await j(k||(U?"https://www.youtube.com":B?"https://github.com":"https://www.google.com"))).sessionId}const X=await fetch(`${ee}/runs/start`,{method:"POST",headers:{"Content-Type":"application/json",...P?{Authorization:`Bearer ${P}`}:{}},body:JSON.stringify({text:f,sessionId:o,sessionKind:e,...e==="agent"&&R?{browserSessionId:R}:{},fileIds:g.map(J=>J.id),provider:K,apiKey:(ae=te[K])==null?void 0:ae.apiKey,baseUrl:(Z=te[K])==null?void 0:Z.baseUrl,model:(W=te[K])==null?void 0:W.model})}),se=await X.text();let H=null;try{H=se?JSON.parse(se):null}catch{H=null}if(!X.ok){const J=(H==null?void 0:H.error)||se||`HTTP ${X.status}`;throw new Error(String(J).slice(0,500))}if(typeof(H==null?void 0:H.systemPrompt)=="string"&&H.systemPrompt.trim()&&typeof(H==null?void 0:H.systemPromptId)=="string"&&H.systemPromptId.trim()){const J=H.systemPromptId.trim(),k=H.systemPrompt;S(U=>U.some(B=>typeof(B==null?void 0:B.id)=="string"&&B.id===J)?U:[...U,{type:"text",id:J,data:k,ts:Date.now()}])}if(typeof(H==null?void 0:H.runId)=="string"&&H.runId.trim()&&We(H.runId.trim()),H.sessionId&&!o&&s&&s(H.sessionId),!L&&(H!=null&&H.result)){const J=H.result;if(J!=null&&J.output){const k=typeof J.output=="string"?J.output:JSON.stringify(J.output);S(U=>[...U,{type:"text",data:k}])}}}catch(R){console.error(R);const X=String((R==null?void 0:R.message)||R||"").trim(),se=X?`${c("error")}: ${X}`:c("error");S(H=>[...H,{type:"error",data:se}]),u||d(f),Oe(),M("idle"),re(null)}}async function Tt(u){if(!N)return;const f=localStorage.getItem("token");await fetch(`${ee}/approvals/${N.id}/decision`,{method:"POST",headers:{"Content-Type":"application/json",...f?{Authorization:`Bearer ${f}`}:{}},body:JSON.stringify({decision:u})}),_(null)}const js=async u=>{const f=te[u];Ne(j=>({...j,[u]:{...j[u],isVerifying:!0,lastError:void 0}}));const b=localStorage.getItem("token");try{const j=await fetch(`${ee}/runs/verify`,{method:"POST",headers:{"Content-Type":"application/json",...b?{Authorization:`Bearer ${b}`}:{}},body:JSON.stringify({provider:u,apiKey:f.apiKey,baseUrl:f.baseUrl,model:f.model})}),I=await j.json();if(j.ok)Ne(P=>({...P,[u]:{...P[u],isVerifying:!1,isConnected:!0,lastError:void 0}})),ot(u);else throw new Error(I.error||"Connection failed")}catch(j){Ne(I=>({...I,[u]:{...I[u],isVerifying:!1,isConnected:!1,lastError:j.message}}))}},ks=u=>{confirm("Are you sure you want to remove the API key?")&&Ne(f=>({...f,[u]:{...f[u],apiKey:"",isConnected:!1}}))},[pr,Ns]=h.useState({}),[$t,Cs]=h.useState({}),[gr,hr]=h.useState({}),ut=u=>{var b;const f=typeof(u==null?void 0:u.runId)=="string"?u.runId:typeof((b=u==null?void 0:u.data)==null?void 0:b.runId)=="string"?u.data.runId:"";return f&&f.trim()?f.trim():"no-run"},Le=h.useMemo(()=>x.map((f,b)=>{const j=typeof(f==null?void 0:f.ts)=="number"?f.ts:b,I=typeof(f==null?void 0:f.seq)=="number"?f.seq:void 0,P=typeof(f==null?void 0:f.id)=="string"&&f.id.startsWith("system_prompt:");return{e:f,idx:b,ts:j,seq:I,isSystemPrompt:P}}).sort((f,b)=>{if(f.isSystemPrompt&&!b.isSystemPrompt)return-1;if(!f.isSystemPrompt&&b.isSystemPrompt)return 1;const j=typeof f.seq=="number"&&Number.isFinite(f.seq),I=typeof b.seq=="number"&&Number.isFinite(b.seq);return j&&I?f.seq-b.seq||f.ts-b.ts||f.idx-b.idx:f.ts-b.ts||f.idx-b.idx}),[x]),ft=h.useMemo(()=>{const u=new Map;for(const f of He.steps||[]){const b=typeof(f==null?void 0:f.runId)=="string"&&f.runId.trim()?f.runId.trim():"no-run";u.has(b)||u.set(b,[]),u.get(b).push(f)}return u},[He.steps]);h.useMemo(()=>{var f,b;const u=new Map;for(const{e:j}of Le){if((j==null?void 0:j.type)!=="evidence_added"||String(((f=j==null?void 0:j.data)==null?void 0:f.kind)||"")!=="log"||typeof((b=j==null?void 0:j.data)==null?void 0:b.text)!="string")continue;const I=ut(j);u.has(I)||u.set(I,[]),u.get(I).push(j.data.text)}return u},[Le]);const pt=h.useMemo(()=>{const u=new Map;for(const{e:f}of Le){const b=String((f==null?void 0:f.type)||"");if(b!=="run_finished"&&b!=="run_completed")continue;const j=ut(f);u.set(j,!0)}return u},[Le]),gt=h.useMemo(()=>{const u=new Set;for(const b of ft.keys())u.add(b);for(const b of pt.keys())u.add(b);const f=new Map;for(const b of u){const j=ft.get(b)||[],I=pt.get(b)===!0,P=j.some(R=>(R==null?void 0:R.status)==="running"),ae=j.some(R=>(R==null?void 0:R.status)==="failed"),Z=j.length>0&&j.every(R=>(R==null?void 0:R.status)!=="running"),W=P?"running":ae?"failed":I||Z?"done":"idle";f.set(b,{status:W,terminal:I})}return f},[ft,pt]);h.useEffect(()=>{Ns(u=>{let f=!1;const b={...u};for(const[j,I]of gt.entries()){const P=$t[j]||"auto";I.status==="running"&&P!=="manual"&&(b[j]||(b[j]=!0,f=!0))}return f?b:u}),Cs(u=>{let f=!1;const b={...u};for(const[j,I]of gt.entries()){const P=b[j]||"auto";I.status==="running"&&P!=="manual"&&b[j]!=="auto"&&(b[j]="auto",f=!0),I.terminal&&P!=="manual"&&b[j]!=="auto"&&(b[j]="auto",f=!0)}return f?b:u})},[gt,$t]);const Is=u=>{let f=typeof u=="string"?u:u&&typeof u=="object"&&typeof u.text=="string"?u.text:String(u??"");if(f=f.replace(/\r\n/g,`
`),!f.trim())return"";const b=f.toLowerCase(),j=["file_write","file_read","file_edit","shell_execute","web_search","knowledge_search","grep_search","read_file_tree","scaffold_project","install_dependencies","check_syntax","image_generate","browser_"],I=j.reduce((Z,W)=>Z+(b.includes(W)?1:0),0);return I>=2||/(\bplan\s*#\d+\b)/i.test(f)&&/\b\d+(\.\d+)?s\b/.test(f)&&I>=1||/\bLog\b/.test(f)&&I>=1||/\[20\d\d-\d\d-\d\dT/.test(f)&&I>=1?f.split(`
`).map(Z=>Z.trimEnd()).filter(Z=>{const W=Z.trim();if(!W)return!1;const R=W.toLowerCase();return!(j.some(X=>R.includes(X))||/^\d+(\.\d+)?s\b/i.test(W)||/\bplan\s*#\d+\b/i.test(W)||/\bLog\b/.test(W)||/\[20\d\d-\d\d-\d\dT/.test(W)||/^تم إنهاء التنفيذ\b/.test(W))}).join(`
`).trim():f},Rs=h.useMemo(()=>{const u=[],f=new Set;for(const{e:b,idx:j}of Le){const I=String((b==null?void 0:b.type)||"");if(I==="step_started"||I==="step_progress"||I==="step_done"||I==="step_failed"||I==="evidence_added"){const P=ut(b);f.has(P)||(f.add(P),u.push({kind:"activity",key:`activity:${P}:${j}`,runId:P}));continue}I==="user_input"?u.push({kind:"user",key:`user:${j}`,e:b,idx:j}):I==="text"?u.push({kind:"text",key:`text:${j}`,e:b,idx:j}):I==="error"?u.push({kind:"error",key:`error:${j}`,e:b,idx:j}):I==="artifact_created"&&u.push({kind:"artifact",key:`artifact:${j}`,e:b,idx:j})}return u},[Le]);return n.jsxs("div",{className:"composer",children:[n.jsx("div",{className:"events",ref:Re,children:n.jsxs("div",{className:"events-content",ref:Ke,children:[x.length===0&&n.jsxs("div",{className:"empty-state",children:[n.jsx("div",{className:"empty-state-logo-ring",children:n.jsx("span",{className:"empty-state-logo-text",children:"J"})}),n.jsx("h2",{className:"empty-state-title",children:c("welcomeTitle","How can I help you today?")}),n.jsxs("div",{className:"empty-state-suggestions",children:[n.jsxs("button",{className:"suggestion-card",onClick:()=>d("Write a React component for a login form"),children:[n.jsx("div",{className:"suggestion-icon",children:n.jsx(_t,{size:20})}),n.jsx("div",{className:"suggestion-text",children:"Create a Login Form"})]}),n.jsxs("button",{className:"suggestion-card",onClick:()=>d("Explain how useEffect works"),children:[n.jsx("div",{className:"suggestion-icon",children:n.jsx(yt,{size:20})}),n.jsx("div",{className:"suggestion-text",children:"Explain React Hooks"})]}),n.jsxs("button",{className:"suggestion-card",onClick:()=>d("Analyze this project structure"),children:[n.jsx("div",{className:"suggestion-icon",children:n.jsx(ds,{size:20})}),n.jsx("div",{className:"suggestion-text",children:"Analyze Project"})]}),n.jsxs("button",{className:"suggestion-card",onClick:()=>d("Write a Python script to scrape a website"),children:[n.jsx("div",{className:"suggestion-icon",children:n.jsx(Ms,{size:20})}),n.jsx("div",{className:"suggestion-text",children:"Python Scripting"})]})]})]}),n.jsx(us,{mode:"popLayout",children:Rs.map(u=>{var f,b,j,I,P,ae,Z,W;if(u.kind==="activity")return null;if(u.kind==="user")return n.jsx(Ht,{event:u.e,isUser:!0},u.key);if(u.kind==="error")return n.jsx(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"message-row joe",children:n.jsxs("div",{className:"message-bubble error",dir:"auto",style:{color:"#ef4444",border:"1px solid #ef4444",background:"rgba(239, 68, 68, 0.1)"},children:["⚠️ ",(f=u.e)==null?void 0:f.data]})},u.key);if(u.kind==="text"){let R=(b=u.e)==null?void 0:b.data;try{if(typeof R=="string"&&(R.startsWith("{")||R.startsWith("["))){const se=JSON.parse(R);R=se.text||se.output||R}}catch{}const X=Is(R);return X?n.jsx(Ht,{event:{data:{text:X}},isUser:!1,onOptionClick:se=>dt(se)},u.key):null}if(u.kind==="artifact"){const R=u.e,X=(j=R==null?void 0:R.data)==null?void 0:j.kind,se=(I=R==null?void 0:R.data)==null?void 0:I.href;if((X==="browser_stream"||typeof se=="string"&&/^wss?:\/\//i.test(se)&&/\/ws\//i.test(se))&&se)return e==="agent"&&t?null:n.jsx(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"message-row joe",children:n.jsx("div",{className:"event-artifact",style:{padding:0},children:n.jsx(h.Suspense,{fallback:n.jsx("div",{style:{padding:12,fontSize:12,opacity:.7},children:"Loading Stream..."}),children:n.jsx(Bn,{wsUrl:se})})})},u.key);const J=/\.(png|jpg|jpeg|webp|gif)$/i.test(((P=R==null?void 0:R.data)==null?void 0:P.name)||"")||/\.(png|jpg|jpeg|webp|gif)$/i.test(((ae=R==null?void 0:R.data)==null?void 0:ae.href)||""),k=/\.(mp4|webm|mov)$/i.test(((Z=R==null?void 0:R.data)==null?void 0:Z.name)||"")||/\.(mp4|webm|mov)$/i.test(((W=R==null?void 0:R.data)==null?void 0:W.href)||"");return J?n.jsx(ve.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"message-row joe",children:n.jsxs("div",{className:"image-generation-frame",children:[n.jsx("div",{className:"scanline-overlay"}),n.jsx("img",{src:R.data.href,alt:R.data.name,className:"image-generation-img"})]})},u.key):n.jsx(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"message-row joe",children:n.jsxs("div",{className:"event-artifact",children:[k?n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[n.jsx(Bs,{size:16,className:"artifact-icon"}),n.jsx("div",{className:"artifact-title",children:c("artifacts.video")})]}),n.jsx("video",{controls:!0,src:R.data.href,style:{width:"100%",borderRadius:8}})]}):n.jsx(n.Fragment,{children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[n.jsx(_t,{size:20,className:"artifact-icon"}),n.jsxs("div",{className:"artifact-info",children:[n.jsx("div",{className:"artifact-title",children:c("artifacts.file")}),n.jsx("div",{className:"artifact-name",children:R.data.name})]})]})}),n.jsx("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end"},children:n.jsxs("a",{href:R.data.href,target:"_blank",rel:"noopener noreferrer",className:"artifact-link",children:[n.jsx(Us,{size:12})," ",c("artifacts.openNewWindow")]})})]})},u.key)}return null})}),$&&n.jsx(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"message-row joe",children:n.jsxs("div",{className:"px-3 py-2",dir:"auto",children:[n.jsx("div",{className:"text-[10px] leading-3 font-light text-zinc-400/65",children:"يفكّر…"}),n.jsx(Un,{isThinking:$,toolVisible:pe,activeToolName:Q}),Ce.length?n.jsx("div",{className:"mt-0.5 text-[10px] leading-3 font-light text-zinc-500/60",children:Ce.join(" › ")}):null]})}),n.jsx("div",{ref:Ie})]})}),N&&n.jsx("div",{className:"approval-modal",children:n.jsxs("div",{className:"approval-content",children:[n.jsx("h3",{children:c("approvalRequired")}),n.jsx("div",{className:"risk-badge",children:N.risk}),n.jsxs("p",{children:[c("action"),": ",N.action]}),n.jsxs("div",{className:"approval-actions",children:[n.jsx("button",{onClick:()=>Tt("denied"),className:"btn deny",children:c("deny")}),n.jsx("button",{onClick:()=>Tt("approved"),className:"btn approve",children:c("approve")})]})]})}),ys&&n.jsx("div",{className:"providers-modal-overlay",onClick:()=>it(!1),children:n.jsxs("div",{className:"providers-modal",onClick:u=>u.stopPropagation(),children:[n.jsxs("div",{className:"providers-left",children:[n.jsxs("h3",{style:{margin:"0 0 16px 0",fontSize:16,fontWeight:700,display:"flex",alignItems:"center",gap:8},children:[n.jsx(Dt,{size:18})," Providers"]}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:Object.entries(te).map(([u,f])=>n.jsxs("button",{onClick:()=>ot(u),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderRadius:8,border:"none",background:K===u?"var(--bg-primary, var(--bg-card))":"transparent",color:K===u?"var(--text-primary)":"var(--text-muted)",cursor:"pointer",textAlign:"left",fontWeight:K===u?600:400,transition:"all 0.2s"},children:[n.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:f.isConnected?"#22c55e":f.apiKey?"#eab308":"#71717a",boxShadow:f.isConnected?"0 0 8px #22c55e":"none"}}),f.name.split(" ")[0]]}),K===u&&n.jsx(fs,{size:14})]},u))})]}),n.jsx("div",{className:"providers-right",children:te[K]&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24},children:[n.jsxs("div",{children:[n.jsx("h2",{style:{margin:0,fontSize:20},children:te[K].name}),n.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",gap:6},children:[n.jsx("div",{style:{padding:"2px 8px",borderRadius:12,fontSize:11,fontWeight:600,background:te[K].isConnected?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:te[K].isConnected?"#22c55e":"#ef4444"},children:te[K].isConnected?"CONNECTED":"DISCONNECTED"}),te[K].isVerifying&&n.jsx(qe,{size:12,className:"spin"})]})]}),n.jsx("button",{onClick:()=>it(!1),style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},children:n.jsx(bt,{size:20})})]}),n.jsxs("div",{style:{flex:1},children:[n.jsxs("div",{style:{marginBottom:20},children:[n.jsx("label",{style:{display:"block",fontSize:13,fontWeight:500,marginBottom:8},children:"API Key"}),n.jsxs("div",{style:{position:"relative",display:"flex",gap:8},children:[n.jsxs("div",{style:{position:"relative",flex:1},children:[n.jsx("input",{type:Et[K]?"text":"password",value:te[K].apiKey,onChange:u=>Ne(f=>({...f,[K]:{...f[K],apiKey:u.target.value,isConnected:!1}})),placeholder:"sk-...",style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-secondary)",color:"var(--text-primary)",outline:"none",fontSize:14}}),n.jsx("button",{onClick:()=>bs(u=>({...u,[K]:!u[K]})),style:{position:"absolute",right:10,top:10,background:"none",border:"none",cursor:"pointer",opacity:.5},children:Et[K]?n.jsx(ls,{size:16}):n.jsx(cs,{size:16})})]}),n.jsx("button",{onClick:()=>ks(K),title:"Clear Key",style:{padding:"0 12px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-secondary)",color:"#ef4444",cursor:"pointer"},children:n.jsx(Qe,{size:18})})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:20},children:[n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:13,fontWeight:500,marginBottom:8},children:"Model ID"}),n.jsx("input",{type:"text",value:te[K].model||"",onChange:u=>Ne(f=>({...f,[K]:{...f[K],model:u.target.value}})),placeholder:"gpt-4o",style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-secondary)",color:"var(--text-primary)",outline:"none",fontSize:14}})]}),K==="grok"&&n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:13,fontWeight:500,marginBottom:8},children:"Base URL"}),n.jsx("input",{type:"text",value:te[K].baseUrl||"",onChange:u=>Ne(f=>({...f,[K]:{...f[K],baseUrl:u.target.value}})),placeholder:"https://api...",style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-secondary)",color:"var(--text-primary)",outline:"none",fontSize:14}})]})]}),te[K].lastError&&n.jsxs("div",{style:{padding:12,borderRadius:8,background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.2)",color:"#ef4444",fontSize:13,marginBottom:20,display:"flex",alignItems:"center",gap:8},children:[n.jsx(Vs,{size:16}),te[K].lastError]})]}),n.jsx("div",{style:{display:"flex",gap:12,paddingTop:20,borderTop:"1px solid var(--border-color)"},children:n.jsx("button",{onClick:()=>js(K),disabled:te[K].isVerifying,style:{flex:1,padding:"12px",borderRadius:8,border:"none",background:te[K].isConnected?"#22c55e":"var(--accent-primary)",color:"#fff",fontSize:14,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8,opacity:te[K].isVerifying?.7:1},children:te[K].isVerifying?n.jsxs(n.Fragment,{children:[n.jsx(qe,{size:18,className:"spin"})," Verifying..."]}):te[K].isConnected?n.jsxs(n.Fragment,{children:[n.jsx(Ks,{size:18})," Verified & Active"]}):n.jsxs(n.Fragment,{children:[n.jsx(yt,{size:18})," Connect & Activate"]})})})]})})]})}),g.length>0&&n.jsx("div",{className:"attached-files",children:g.map((u,f)=>n.jsxs("div",{className:"attached-file-chip",children:[n.jsx("span",{className:"file-name",children:u.name}),n.jsx("button",{onClick:()=>m(b=>b.filter((j,I)=>I!==f)),className:"remove-file-btn",children:n.jsx(bt,{size:12})})]},f))}),n.jsxs("div",{className:"input-area",children:[n.jsx("textarea",{value:l,onChange:u=>d(u.target.value),placeholder:c("inputPlaceholder"),dir:"auto",disabled:!!N,onKeyDown:u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),dt())}}),n.jsxs("div",{className:"input-actions",children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("div",{style:{width:8,height:8,borderRadius:"50%",backgroundColor:L?"#22c55e":"#ef4444",boxShadow:L?"0 0 6px #22c55e":"none",transition:"all 0.3s"},title:c(L?"connected":"connecting")}),n.jsx("span",{style:{fontSize:12,color:"var(--text-muted)"},children:c(L?"connected":"connecting")})]}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("div",{style:{position:"relative"},children:n.jsx("button",{className:"provider-btn",onClick:()=>it(!0),title:"AI Providers",children:n.jsx(Dt,{size:20})})}),n.jsx("input",{type:"file",ref:F,onChange:Ss,style:{display:"none"}}),n.jsx("button",{className:"mic-button",onClick:()=>{var u;return(u=F.current)==null?void 0:u.click()},title:c("attachFile")||"Attach file",disabled:p,style:{background:"transparent",border:"none",cursor:"pointer",opacity:p?.5:1},children:p?n.jsx(qe,{size:20,className:"spin"}):n.jsx(Ws,{size:20})}),n.jsx("button",{className:`mic-button ${E?"active":""}`,onClick:()=>O(!E),title:"Voice Mode",style:{background:"transparent",border:"none",cursor:"pointer",color:E?"var(--accent-primary)":"inherit",position:"relative"},children:E?n.jsx(Mt,{size:20}):n.jsx(Hs,{size:20})}),n.jsx("button",{className:"send-button",onClick:()=>dt(),disabled:!l.trim()||!!N,title:c("send"),children:n.jsx(Js,{size:20})})]})]}),E&&n.jsxs("div",{style:{padding:10,background:"var(--bg-secondary)",borderTop:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"center",gap:16},children:[n.jsx("button",{className:`voice-btn ${V?"listening":""}`,onClick:vs,style:{width:50,height:50,borderRadius:"50%",border:"none",background:V?"#ef4444":"var(--accent-primary)",color:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:V?"0 0 15px rgba(239, 68, 68, 0.5)":"none",transition:"all 0.3s"},children:V?n.jsx(qe,{className:"spin",size:24}):n.jsx(Mt,{size:24})}),n.jsxs("div",{style:{fontSize:14,fontWeight:500,display:"flex",flexDirection:"column",gap:4},children:[n.jsx("span",{children:V?"Listening...":"Tap to Speak"}),n.jsx("span",{style:{fontSize:10,opacity:.7},children:"Arabic (SA) / English (US)"})]}),n.jsx("button",{className:"icon-btn",title:"Stop Speaking",onClick:lt,disabled:!z,style:{marginLeft:"auto",opacity:z?1:.3},children:n.jsx(qs,{size:18})})]})]})]})}function mt({session:o,isActive:e,onSelect:t,onDelete:s,onPin:r,onShare:i}){const[a,c]=h.useState(!1),l=h.useRef(null);return h.useEffect(()=>{function d(g){l.current&&!l.current.contains(g.target)&&c(!1)}return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]),n.jsxs("div",{className:`session-item ${e?"active":""}`,children:[n.jsx("button",{className:"session-btn",onClick:t,children:n.jsxs("div",{className:"session-info",children:[n.jsxs("div",{className:"session-title",children:[o.isPinned&&n.jsx(Bt,{size:12,className:"pin-icon",fill:"currentColor"}),n.jsx("span",{children:o.title})]}),o.lastSnippet&&n.jsx("div",{className:"session-snippet",children:o.lastSnippet})]})}),n.jsx("button",{className:"menu-trigger",onClick:d=>{d.stopPropagation(),c(!a)},children:n.jsx(Gs,{size:16})}),a&&n.jsxs("div",{className:"session-menu",ref:l,children:[n.jsxs("button",{onClick:d=>{d.stopPropagation(),r(),c(!1)},children:[n.jsx(Bt,{size:14})," ",o.isPinned?"إلغاء التثبيت":"تثبيت"]}),n.jsxs("button",{onClick:d=>{d.stopPropagation(),i(),c(!1)},children:[n.jsx(Ys,{size:14})," مشاركة"]}),n.jsx("div",{className:"divider"}),n.jsxs("button",{className:"delete",onClick:d=>{d.stopPropagation(),s(),c(!1)},children:[n.jsx(Qe,{size:14})," حذف"]})]})]})}function Vn({sessionId:o,className:e,onClose:t}){const s=h.useRef(null),r=h.useRef(null),[i,a]=h.useState("connecting"),[c,l]=h.useState(""),[d,g]=h.useState({w:1280,h:800}),[m,p]=h.useState({x:0,y:0}),[C,x]=h.useState(null),[S,N]=h.useState(null);h.useEffect(()=>{if(!o)return;const E=window.location.protocol==="https:"?"wss:":"ws:",O=ee.replace(/^https?:\/\//,""),z=localStorage.getItem("token"),T=`${E}//${O}/browser/ws/${o}?token=${z}`;console.log("BrowserView: Connecting to",T),a("connecting"),l("");const G=new WebSocket(T);return r.current=G,G.onopen=()=>{console.log("BrowserView: Connected"),a("connected")},G.onclose=M=>{console.log("BrowserView: Closed",M.code,M.reason),a("closed"),r.current=null},G.onerror=()=>{console.error("BrowserView: Error"),a("error"),l("Connection failed")},G.onmessage=M=>{try{const $=JSON.parse(M.data);if($.type==="stream_start"||$.type==="state"){const ie=$.viewport||($.w&&$.h?{w:$.w,h:$.h}:null);ie&&(g({w:ie.w,h:ie.h}),s.current&&(s.current.width=ie.w,s.current.height=ie.h))}if($.type==="frame"&&$.jpegBase64){const ie=new Image;ie.onload=()=>{x(ie)},ie.src="data:image/jpeg;base64,"+$.jpegBase64}$.type==="cursor_move"&&p({x:$.x,y:$.y}),$.type==="cursor_click"&&(p({x:$.x,y:$.y}),N({x:$.x,y:$.y,ts:Date.now()}),setTimeout(()=>N(null),300))}catch($){console.error("BrowserView: Parse error",$)}},()=>{G.close()}},[o]),h.useEffect(()=>{_()},[C,m,S,d]);function _(){const E=s.current;if(!E)return;const O=E.getContext("2d");if(O&&(O.clearRect(0,0,E.width,E.height),C?O.drawImage(C,0,0,E.width,E.height):(O.fillStyle="#1e1e1e",O.fillRect(0,0,E.width,E.height),O.fillStyle="#666",O.font="14px sans-serif",O.fillText("Waiting for stream...",20,30)),m.x>=0&&m.y>=0&&(O.beginPath(),O.arc(m.x,m.y,8,0,2*Math.PI),O.fillStyle="rgba(239, 68, 68, 0.8)",O.fill(),O.strokeStyle="#fff",O.lineWidth=2,O.stroke(),O.beginPath(),O.arc(m.x,m.y,2,0,2*Math.PI),O.fillStyle="#fff",O.fill()),S)){const z=Date.now()-S.ts;if(z<300){const T=10+z/300*20,G=1-z/300;O.beginPath(),O.arc(S.x,S.y,T,0,2*Math.PI),O.strokeStyle=`rgba(239, 68, 68, ${G})`,O.lineWidth=3,O.stroke()}}}function L(E){var O;((O=r.current)==null?void 0:O.readyState)===WebSocket.OPEN&&r.current.send(JSON.stringify({type:"action",action:E}))}function D(E){if(!s.current)return;const O=s.current.getBoundingClientRect(),z=Math.round((E.clientX-O.left)*(d.w/O.width)),T=Math.round((E.clientY-O.top)*(d.h/O.height));L({type:"click",x:z,y:T})}function V(E){if(!s.current)return;const O=s.current.getBoundingClientRect(),z=Math.round((E.clientX-O.left)*(d.w/O.width)),T=Math.round((E.clientY-O.top)*(d.h/O.height));L({type:"mouseMove",x:z,y:T})}function Y(E){E.key==="Enter"?L({type:"press",key:"Enter"}):E.key==="Backspace"?L({type:"press",key:"Backspace"}):E.key.length===1&&L({type:"type",text:E.key})}return n.jsxs("div",{className:`browser-view ${e||""}`,style:{width:"100%",height:"100%",position:"relative",background:"#000",overflow:"hidden"},children:[i!=="connected"&&n.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",background:"rgba(0,0,0,0.8)"},children:i==="connecting"?"Connecting...":i==="error"?`Error: ${c}`:"Disconnected"}),n.jsx("canvas",{ref:s,style:{width:"100%",height:"100%",objectFit:"contain"},onMouseDown:D,onMouseMove:V,tabIndex:0,onKeyDown:Y})]})}function Kn({onSession:o,autoOpen:e,minimal:t,initialSession:s}){const[r,i]=h.useState("https://www.google.com"),[a,c]=h.useState((s==null?void 0:s.wsUrl)||null),[l,d]=h.useState((s==null?void 0:s.sessionId)||null),[g,m]=h.useState(!1),[p,C]=h.useState(null),x=h.useRef(!1);h.useEffect(()=>{s!=null&&s.wsUrl&&(c(s.wsUrl),d(s.sessionId))},[s]);async function S(N){var _,L,D,V,Y;m(!0),C(null);try{const E=localStorage.getItem("token"),O=typeof N=="string"&&N.trim()?N.trim():r,T=await(await fetch(`${ee}/tools/browser_open/execute`,{method:"POST",headers:{"Content-Type":"application/json",...E?{Authorization:`Bearer ${E}`}:{}},body:JSON.stringify({url:O})})).json(),G=((_=T==null?void 0:T.output)==null?void 0:_.wsUrl)||((V=(D=(L=T==null?void 0:T.artifacts)==null?void 0:L.find)==null?void 0:D.call(L,ie=>(ie==null?void 0:ie.kind)==="browser_stream"))==null?void 0:V.href);if(!(T!=null&&T.ok)||!G){c(null),d(null),C(String((T==null?void 0:T.error)||"فشل فتح المتصفح"));return}const M=String(((Y=T==null?void 0:T.output)==null?void 0:Y.sessionId)||""),$=String(G);c($),d(M),M&&$&&(o==null||o({sessionId:M,wsUrl:$}),window.dispatchEvent(new CustomEvent("joe:browser_opened",{detail:{sessionId:M,wsUrl:$}})))}catch(E){c(null),d(null),C(String((E==null?void 0:E.message)||E))}finally{m(!1)}}return h.useEffect(()=>{e&&(x.current||(x.current=!0,S()))},[e]),h.useEffect(()=>{const N=_=>{const L=(_==null?void 0:_.detail)||{},D=typeof(L==null?void 0:L.url)=="string"?L.url:void 0;typeof D=="string"&&D.trim()&&i(D.trim()),S(D)};return window.addEventListener("joe:browser_open_request",N),()=>window.removeEventListener("joe:browser_open_request",N)},[]),h.useEffect(()=>{const N=_=>{const L=(_==null?void 0:_.detail)||{},D=String((L==null?void 0:L.sessionId)||""),V=String((L==null?void 0:L.wsUrl)||"");D&&V&&(c(V),d(D),o==null||o({sessionId:D,wsUrl:V}))};return window.addEventListener("joe:browser_attached",N),()=>window.removeEventListener("joe:browser_attached",N)},[]),n.jsx("div",{className:"browser-app",style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:n.jsx("div",{style:{flex:1,overflow:"hidden",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",background:"#000"},children:l?n.jsx(Vn,{sessionId:l}):n.jsx("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",padding:16,color:"var(--text-secondary)"},dir:"auto",children:n.jsxs("div",{style:{textAlign:"center"},children:[p?n.jsx("div",{style:{color:"#ef4444",marginBottom:10},children:p}):null,n.jsx("div",{children:g?"...جاري فتح المتصفح":"سيتم فتح المتصفح تلقائياً عند الحاجة."})]})})})})}function Wn(){const[o,e]=h.useState([]),[t,s]=h.useState([]),[r,i]=h.useState([]),[a,c]=h.useState({}),[l,d]=h.useState(null),[g,m]=h.useState(null),[p,C]=h.useState(!0),[x,S]=h.useState("agent"),[N,_]=h.useState(""),[L,D]=h.useState(!1),[V,Y]=h.useState([]),[E,O]=h.useState(!1),[z,T]=h.useState(null),[G,M]=h.useState(null),$=nt();h.useEffect(()=>{const y=v=>{const F=(v==null?void 0:v.detail)||{};F.sessionId&&F.wsUrl&&(M({sessionId:F.sessionId,wsUrl:F.wsUrl}),T(F.sessionId),S("agent"))};return window.addEventListener("joe:browser_attached",y),()=>window.removeEventListener("joe:browser_attached",y)},[]);function ie(){d(null),_(""),Y([])}async function Q(){const y=localStorage.getItem("token");try{const v=await fetch(`${ee}/sessions?kind=chat`,{headers:{Authorization:y?`Bearer ${y}`:""}});if(v.status===401){localStorage.removeItem("token"),$("/login");return}const ce=((await v.json()).sessions||[]).map(me=>({...me,id:me.id||me._id}));e(ce),!l&&ce[0]&&d(ce[0].id)}catch(v){console.error("Failed to load sessions",v)}}async function re(){const y=localStorage.getItem("token");try{const v=await fetch(`${ee}/sessions?kind=agent`,{headers:{Authorization:y?`Bearer ${y}`:""}});if(v.status===401){localStorage.removeItem("token"),$("/login");return}const ce=((await v.json()).sessions||[]).map(me=>({...me,id:me.id||me._id}));s(ce),!g&&ce[0]&&m(ce[0].id)}catch(v){console.error("Failed to load agent sessions",v)}}async function pe(){const y=localStorage.getItem("token");try{const v=await fetch(`${ee}/folders`,{headers:{Authorization:y?`Bearer ${y}`:""}});if(v.ok){const F=await v.json();i(F)}}catch(v){console.error("Failed to load folders",v)}}h.useEffect(()=>{Q(),re(),pe()},[]),h.useEffect(()=>{x==="agent"?(C(!1),t.length===0&&re()):(C(!E),o.length===0&&Q())},[x]),h.useEffect(()=>{var ce;const y=window.matchMedia("(max-width: 900px)"),v=()=>{O(y.matches),C(!y.matches)};v();const F=()=>v();return typeof y.addEventListener=="function"?y.addEventListener("change",F):(ce=y.addListener)==null||ce.call(y,F),()=>{var me;typeof y.removeEventListener=="function"?y.removeEventListener("change",F):(me=y.removeListener)==null||me.call(y,F)}},[]);async function be(){const y=prompt("اسم المجلد الجديد:");if(!y)return;const v=localStorage.getItem("token");(await fetch(`${ee}/folders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:v?`Bearer ${v}`:""},body:JSON.stringify({name:y})})).ok&&await pe()}async function Ce(y){if(!confirm("هل أنت متأكد من حذف هذا المجلد؟ سيتم نقل الجلسات إلى القائمة الرئيسية."))return;const v=localStorage.getItem("token");await fetch(`${ee}/folders/${y}`,{method:"DELETE",headers:{Authorization:v?`Bearer ${v}`:""}}),await pe(),await Q()}async function oe(y,v){const F=localStorage.getItem("token");await fetch(`${ee}/sessions/${y}/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:F?`Bearer ${F}`:""},body:JSON.stringify({folderId:v})}),await Q()}async function ge(y,v){if(y===v||!confirm("Are you sure you want to merge these sessions? This cannot be undone."))return;const F=localStorage.getItem("token");(await fetch(`${ee}/sessions/merge`,{method:"POST",headers:{"Content-Type":"application/json",...F?{Authorization:`Bearer ${F}`}:{}},body:JSON.stringify({sourceId:y,targetId:v})})).ok&&(await Q(),l===y&&d(v))}async function le(y){if(!confirm("هل أنت متأكد من حذف هذه الجلسة؟"))return;const v=localStorage.getItem("token");await fetch(`${ee}/sessions/${y}`,{method:"DELETE",headers:{Authorization:v?`Bearer ${v}`:""}}),await Q(),l===y&&d(null)}async function ke(y){if(!confirm("هل أنت متأكد من حذف هذه الجلسة؟"))return;const v=localStorage.getItem("token");await fetch(`${ee}/sessions/${y}`,{method:"DELETE",headers:{Authorization:v?`Bearer ${v}`:""}}),await re(),g===y&&m(null)}async function Ie(){if(!confirm("هل أنت متأكد من حذف جميع الجلسات؟ لا يمكن التراجع عن هذا الإجراء."))return;const y=localStorage.getItem("token");await fetch(`${ee}/sessions`,{method:"DELETE",headers:{Authorization:y?`Bearer ${y}`:""}}),await Q(),d(null)}async function Re(y,v){const F=localStorage.getItem("token");await fetch(`${ee}/sessions/${y}/pin`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:F?`Bearer ${F}`:""},body:JSON.stringify({isPinned:!v})}),await Q()}async function Ke(y,v){const F=localStorage.getItem("token");await fetch(`${ee}/sessions/${y}/pin`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:F?`Bearer ${F}`:""},body:JSON.stringify({isPinned:!v})}),await re()}function je(y){alert("تم نسخ رابط الجلسة")}return h.useEffect(()=>{if(!N){D(!1),Y([]);return}const y=setTimeout(async()=>{D(!0);const v=localStorage.getItem("token");try{const ce=await(await fetch(`${ee}/sessions/search?q=${encodeURIComponent(N)}&kind=chat`,{headers:v?{Authorization:`Bearer ${v}`}:{}})).json();Y(ce.results||[])}catch(F){console.error(F)}},500);return()=>clearTimeout(y)},[N]),n.jsxs("div",{className:`joe-layout ${p?"sidebar-open":"sidebar-closed"}`,children:[x==="chat"&&p&&E&&n.jsx("div",{className:"sidebar-backdrop",onClick:()=>C(!1)}),x==="chat"&&p&&n.jsxs("aside",{className:"sidebar",children:[n.jsxs("div",{className:"sidebar-header",children:[n.jsxs("button",{className:"new-chat-btn",onClick:ie,children:[n.jsx("span",{children:"+"})," محادثة جديدة"]}),n.jsx("button",{className:"close-sidebar-btn",onClick:()=>C(!1),children:n.jsx(Xs,{size:20})})]}),n.jsx("div",{className:"search-box-container",style:{padding:"0 4px",marginBottom:16},children:n.jsxs("div",{className:"search-input-wrapper",children:[n.jsx(ds,{size:14,className:"search-icon"}),n.jsx("input",{type:"text",placeholder:"بحث في المحادثات...",value:N,onChange:y=>_(y.target.value),className:"search-input"})]})}),N?n.jsx("div",{className:"session-list",children:V.length===0?n.jsx("div",{style:{padding:16,textAlign:"center",color:"var(--text-muted)",fontSize:13},children:"لا توجد نتائج"}):V.map(y=>n.jsxs("button",{className:"search-result-item",onClick:()=>{d(y.sessionId),_(""),E&&C(!1)},children:[n.jsx("div",{className:"result-session-title",children:y.sessionTitle}),n.jsx("div",{className:"result-content",children:y.content}),n.jsx("div",{className:"result-date",children:new Date(y.createdAt).toLocaleDateString()})]},y.messageId))}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 8px",marginBottom:8},children:[n.jsx("div",{className:"section-title",style:{margin:0},children:"المجلدات"}),n.jsx("button",{onClick:be,style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},title:"مجلد جديد",children:n.jsx(Qs,{size:16})})]}),n.jsxs("div",{className:"session-list",children:[r.map(y=>n.jsxs("div",{onDragOver:v=>{v.preventDefault(),v.dataTransfer.dropEffect="move",v.currentTarget.style.background="rgba(255,215,0,0.1)"},onDragLeave:v=>{v.currentTarget.style.background="transparent"},onDrop:v=>{v.preventDefault(),v.currentTarget.style.background="transparent";const F=v.dataTransfer.getData("sessionId");F&&oe(F,y._id)},children:[n.jsxs("div",{className:"folder-header",style:{display:"flex",alignItems:"center",padding:"8px",cursor:"pointer",color:"var(--text-secondary)"},onClick:()=>c(v=>({...v,[y._id]:!v[y._id]})),children:[a[y._id]?n.jsx(Zs,{size:14}):n.jsx(fs,{size:14}),n.jsx(en,{size:14,style:{margin:"0 8px",color:"var(--accent-primary)"}}),n.jsx("span",{style:{fontSize:13,flex:1},children:y.name}),n.jsx("button",{onClick:v=>{v.stopPropagation(),Ce(y._id)},style:{background:"none",border:"none",color:"var(--text-muted)",cursor:"pointer",opacity:.5},className:"folder-delete-btn",children:n.jsx(Qe,{size:12})})]}),a[y._id]&&n.jsxs("div",{style:{paddingRight:16},children:[o.filter(v=>v.folderId===y._id).map(v=>n.jsx("div",{draggable:!0,onDragStart:F=>{F.dataTransfer.setData("sessionId",v.id)},children:n.jsx(mt,{session:v,isActive:l===v.id,onSelect:()=>{d(v.id),E&&C(!1)},onDelete:()=>le(v.id),onPin:()=>Re(v.id,!!v.isPinned),onShare:()=>je(v.id)})},v.id)),o.filter(v=>v.folderId===y._id).length===0&&n.jsx("div",{style:{fontSize:11,color:"var(--text-muted)",padding:"4px 8px 8px"},children:"مجلد فارغ"})]})]},y._id)),n.jsx("div",{className:"section-title",style:{marginTop:16},onDragOver:y=>{y.preventDefault(),y.dataTransfer.dropEffect="move"},onDrop:y=>{y.preventDefault();const v=y.dataTransfer.getData("sessionId");v&&oe(v,null)},children:"جلسات أخرى"}),o.filter(y=>!y.folderId).map(y=>n.jsx("div",{draggable:!0,onDragStart:v=>{v.dataTransfer.setData("sessionId",y.id),v.dataTransfer.effectAllowed="move"},onDragOver:v=>{v.preventDefault(),v.dataTransfer.dropEffect="move"},onDrop:v=>{v.preventDefault();const F=v.dataTransfer.getData("sessionId");F&&F!==y.id&&ge(F,y.id)},children:n.jsx(mt,{session:y,isActive:l===y.id,onSelect:()=>{d(y.id),E&&C(!1)},onDelete:()=>le(y.id),onPin:()=>Re(y.id,!!y.isPinned),onShare:()=>je(y.id)})},y.id))]})]}),n.jsx("div",{className:"sidebar-footer",children:n.jsxs("button",{className:"delete-all-btn",onClick:Ie,children:[n.jsx(Qe,{size:16})," حذف جميع الجلسات"]})})]}),x==="chat"&&!p&&n.jsx("button",{className:"sidebar-toggle-btn",style:{position:"absolute",left:16,top:16},onClick:()=>C(!0),children:n.jsx(tn,{size:20})}),n.jsxs("main",{className:"center",style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[n.jsxs("div",{className:"joe-modebar",style:{height:48,borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",padding:"0 16px",gap:8,background:"var(--bg-secondary)",flexShrink:0,overflowX:"auto",WebkitOverflowScrolling:"touch",whiteSpace:"nowrap"},children:[n.jsxs("button",{onClick:()=>S("agent"),style:{background:"none",border:"none",color:x==="agent"?"var(--accent-primary)":"var(--text-secondary)",fontWeight:x==="agent"?600:400,cursor:"pointer",display:"flex",alignItems:"center",gap:6,padding:"6px 12px",borderRadius:6,backgroundColor:x==="agent"?"rgba(37, 99, 235, 0.1)":"transparent"},children:[n.jsx(sn,{size:16})," الوكيل"]}),n.jsxs("button",{onClick:()=>S("chat"),style:{background:"none",border:"none",color:x==="chat"?"var(--accent-primary)":"var(--text-secondary)",fontWeight:x==="chat"?600:400,cursor:"pointer",display:"flex",alignItems:"center",gap:6,padding:"6px 12px",borderRadius:6,backgroundColor:x==="chat"?"rgba(37, 99, 235, 0.1)":"transparent"},children:[n.jsx(nn,{size:16})," Chat"]})]}),n.jsxs("div",{style:{flex:1,overflow:"hidden",position:"relative",display:"flex",flexDirection:"column"},children:[x==="agent"&&n.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:E?"column":"row"},children:[n.jsxs("div",{style:{width:E?"100%":280,flex:"0 0 auto",minHeight:E?180:0,overflow:"hidden",borderRight:E?void 0:"1px solid var(--border-color)",borderBottom:E?"1px solid var(--border-color)":void 0,background:"var(--bg-secondary)",display:"flex",flexDirection:"column"},children:[n.jsxs("div",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsx("div",{style:{fontWeight:600,color:"var(--text-primary)",fontSize:13},children:"جلسات الوكيل"}),n.jsx("button",{onClick:()=>m(null),style:{height:28,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(37, 99, 235, 0.12)",color:"var(--text-primary)",cursor:"pointer",fontSize:12},children:"جلسة جديدة"})]}),n.jsx("div",{style:{flex:1,overflow:"auto",padding:6},children:t.length===0?n.jsx("div",{style:{padding:12,color:"var(--text-muted)",fontSize:13},children:"لا توجد جلسات بعد"}):t.map(y=>n.jsx(mt,{session:y,isActive:g===y.id,onSelect:()=>m(y.id),onDelete:()=>ke(y.id),onPin:()=>Ke(y.id,!!y.isPinned),onShare:()=>je(y.id)},y.id))})]}),n.jsx("div",{style:{flex:1,minHeight:0,overflow:"hidden",background:"var(--bg-secondary)"},children:n.jsx(Kn,{minimal:!0,autoOpen:!0,onSession:y=>{T(y.sessionId)},initialSession:G})}),n.jsx("div",{style:{width:E?"100%":420,flex:"0 0 auto",minHeight:E?340:0,overflow:"hidden",borderLeft:E?void 0:"1px solid var(--border-color)",borderTop:E?"1px solid var(--border-color)":void 0,background:"var(--bg-secondary)",display:"flex",flexDirection:"column",height:"100%"},children:n.jsx(Jt,{sessionId:g||void 0,sessionKind:"agent",browserSessionId:z,onSessionCreated:async y=>{await re(),m(y)}})})]}),x==="chat"&&n.jsx(Jt,{sessionId:l||void 0,sessionKind:"chat",onSessionCreated:async y=>{await Q(),d(y)}})]})]})]})}const A=o=>typeof o=="string",Me=()=>{let o,e;const t=new Promise((s,r)=>{o=s,e=r});return t.resolve=o,t.reject=e,t},qt=o=>o==null?"":""+o,Hn=(o,e,t)=>{o.forEach(s=>{e[s]&&(t[s]=e[s])})},Jn=/###/g,Gt=o=>o&&o.indexOf("###")>-1?o.replace(Jn,"."):o,Yt=o=>!o||A(o),Be=(o,e,t)=>{const s=A(e)?e.split("."):e;let r=0;for(;r<s.length-1;){if(Yt(o))return{};const i=Gt(s[r]);!o[i]&&t&&(o[i]=new t),Object.prototype.hasOwnProperty.call(o,i)?o=o[i]:o={},++r}return Yt(o)?{}:{obj:o,k:Gt(s[r])}},Xt=(o,e,t)=>{const{obj:s,k:r}=Be(o,e,Object);if(s!==void 0||e.length===1){s[r]=t;return}let i=e[e.length-1],a=e.slice(0,e.length-1),c=Be(o,a,Object);for(;c.obj===void 0&&a.length;)i=`${a[a.length-1]}.${i}`,a=a.slice(0,a.length-1),c=Be(o,a,Object),c!=null&&c.obj&&typeof c.obj[`${c.k}.${i}`]<"u"&&(c.obj=void 0);c.obj[`${c.k}.${i}`]=t},qn=(o,e,t,s)=>{const{obj:r,k:i}=Be(o,e,Object);r[i]=r[i]||[],r[i].push(t)},Ze=(o,e)=>{const{obj:t,k:s}=Be(o,e);if(t&&Object.prototype.hasOwnProperty.call(t,s))return t[s]},Gn=(o,e,t)=>{const s=Ze(o,t);return s!==void 0?s:Ze(e,t)},ms=(o,e,t)=>{for(const s in e)s!=="__proto__"&&s!=="constructor"&&(s in o?A(o[s])||o[s]instanceof String||A(e[s])||e[s]instanceof String?t&&(o[s]=e[s]):ms(o[s],e[s],t):o[s]=e[s]);return o},Te=o=>o.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Yn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Xn=o=>A(o)?o.replace(/[&<>"'\/]/g,e=>Yn[e]):o;class Qn{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const s=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,s),this.regExpQueue.push(e),s}}const Zn=[" ",",","?","!",";"],er=new Qn(20),tr=(o,e,t)=>{e=e||"",t=t||"";const s=Zn.filter(a=>e.indexOf(a)<0&&t.indexOf(a)<0);if(s.length===0)return!0;const r=er.getRegExp(`(${s.map(a=>a==="?"?"\\?":a).join("|")})`);let i=!r.test(o);if(!i){const a=o.indexOf(t);a>0&&!r.test(o.substring(0,a))&&(i=!0)}return i},kt=function(o,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!o)return;if(o[e])return Object.prototype.hasOwnProperty.call(o,e)?o[e]:void 0;const s=e.split(t);let r=o;for(let i=0;i<s.length;){if(!r||typeof r!="object")return;let a,c="";for(let l=i;l<s.length;++l)if(l!==i&&(c+=t),c+=s[l],a=r[c],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&l<s.length-1)continue;i+=l-i+1;break}r=a}return r},et=o=>o==null?void 0:o.replace("_","-"),sr={type:"logger",log(o){this.output("log",o)},warn(o){this.output("warn",o)},error(o){this.output("error",o)},output(o,e){var t,s;(s=(t=console==null?void 0:console[o])==null?void 0:t.apply)==null||s.call(t,console,e)}};class tt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||sr,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,s,r){return r&&!this.debug?null:(A(e[0])&&(e[0]=`${s}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new tt(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new tt(this.logger,e)}}var Se=new tt;class rt{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const r=this.observers[s].get(t)||0;this.observers[s].set(t,r+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(a=>{let[c,l]=a;for(let d=0;d<l;d++)c(...s)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(a=>{let[c,l]=a;for(let d=0;d<l;d++)c.apply(c,[e,...s])})}}class Qt extends rt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,s){var d,g;let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,a=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let c;e.indexOf(".")>-1?c=e.split("."):(c=[e,t],s&&(Array.isArray(s)?c.push(...s):A(s)&&i?c.push(...s.split(i)):c.push(s)));const l=Ze(this.data,c);return!l&&!t&&!s&&e.indexOf(".")>-1&&(e=c[0],t=c[1],s=c.slice(2).join(".")),l||!a||!A(s)?l:kt((g=(d=this.data)==null?void 0:d[e])==null?void 0:g[t],s,i)}addResource(e,t,s,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const a=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let c=[e,t];s&&(c=c.concat(a?s.split(a):s)),e.indexOf(".")>-1&&(c=e.split("."),r=t,t=c[1]),this.addNamespaces(t),Xt(this.data,c,r),i.silent||this.emit("added",e,t,s,r)}addResources(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const i in s)(A(s[i])||Array.isArray(s[i]))&&this.addResource(e,t,i,s[i],{silent:!0});r.silent||this.emit("added",e,t,s)}addResourceBundle(e,t,s,r,i){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},c=[e,t];e.indexOf(".")>-1&&(c=e.split("."),r=s,s=t,t=c[1]),this.addNamespaces(t);let l=Ze(this.data,c)||{};a.skipCopy||(s=JSON.parse(JSON.stringify(s))),r?ms(l,s,i):l={...l,...s},Xt(this.data,c,l),a.silent||this.emit("added",e,t,s)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(r=>t[r]&&Object.keys(t[r]).length>0)}toJSON(){return this.data}}var xs={processors:{},addPostProcessor(o){this.processors[o.name]=o},handle(o,e,t,s,r){return o.forEach(i=>{var a;e=((a=this.processors[i])==null?void 0:a.process(e,t,s,r))??e}),e}};const Zt={},es=o=>!A(o)&&typeof o!="boolean"&&typeof o!="number";class st extends rt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Hn(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Se.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const s=this.resolve(e,t);return(s==null?void 0:s.res)!==void 0}extractFromKey(e,t){let s=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const r=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const a=s&&e.indexOf(s)>-1,c=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!tr(e,s,r);if(a&&!c){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:A(i)?[i]:i};const d=e.split(s);(s!==r||s===r&&this.options.ns.indexOf(d[0])>-1)&&(i=d.shift()),e=d.join(r)}return{key:e,namespaces:A(i)?[i]:i}}translate(e,t,s){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const r=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,i=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:a,namespaces:c}=this.extractFromKey(e[e.length-1],t),l=c[c.length-1],d=t.lng||this.language,g=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((d==null?void 0:d.toLowerCase())==="cimode"){if(g){const M=t.nsSeparator||this.options.nsSeparator;return r?{res:`${l}${M}${a}`,usedKey:a,exactUsedKey:a,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:`${l}${M}${a}`}return r?{res:a,usedKey:a,exactUsedKey:a,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:a}const m=this.resolve(e,t);let p=m==null?void 0:m.res;const C=(m==null?void 0:m.usedKey)||a,x=(m==null?void 0:m.exactUsedKey)||a,S=["[object Number]","[object Function]","[object RegExp]"],N=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,_=!this.i18nFormat||this.i18nFormat.handleAsObject,L=t.count!==void 0&&!A(t.count),D=st.hasDefaultValue(t),V=L?this.pluralResolver.getSuffix(d,t.count,t):"",Y=t.ordinal&&L?this.pluralResolver.getSuffix(d,t.count,{ordinal:!1}):"",E=L&&!t.ordinal&&t.count===0,O=E&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${V}`]||t[`defaultValue${Y}`]||t.defaultValue;let z=p;_&&!p&&D&&(z=O);const T=es(z),G=Object.prototype.toString.apply(z);if(_&&z&&T&&S.indexOf(G)<0&&!(A(N)&&Array.isArray(z))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const M=this.options.returnedObjectHandler?this.options.returnedObjectHandler(C,z,{...t,ns:c}):`key '${a} (${this.language})' returned an object instead of string.`;return r?(m.res=M,m.usedParams=this.getUsedParamsDetails(t),m):M}if(i){const M=Array.isArray(z),$=M?[]:{},ie=M?x:C;for(const Q in z)if(Object.prototype.hasOwnProperty.call(z,Q)){const re=`${ie}${i}${Q}`;D&&!p?$[Q]=this.translate(re,{...t,defaultValue:es(O)?O[Q]:void 0,joinArrays:!1,ns:c}):$[Q]=this.translate(re,{...t,joinArrays:!1,ns:c}),$[Q]===re&&($[Q]=z[Q])}p=$}}else if(_&&A(N)&&Array.isArray(p))p=p.join(N),p&&(p=this.extendTranslation(p,e,t,s));else{let M=!1,$=!1;!this.isValidLookup(p)&&D&&(M=!0,p=O),this.isValidLookup(p)||($=!0,p=a);const Q=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&$?void 0:p,re=D&&O!==p&&this.options.updateMissing;if($||M||re){if(this.logger.log(re?"updateKey":"missingKey",d,l,a,re?O:p),i){const oe=this.resolve(a,{...t,keySeparator:!1});oe&&oe.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let pe=[];const be=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&be&&be[0])for(let oe=0;oe<be.length;oe++)pe.push(be[oe]);else this.options.saveMissingTo==="all"?pe=this.languageUtils.toResolveHierarchy(t.lng||this.language):pe.push(t.lng||this.language);const Ce=(oe,ge,le)=>{var Ie;const ke=D&&le!==p?le:Q;this.options.missingKeyHandler?this.options.missingKeyHandler(oe,l,ge,ke,re,t):(Ie=this.backendConnector)!=null&&Ie.saveMissing&&this.backendConnector.saveMissing(oe,l,ge,ke,re,t),this.emit("missingKey",oe,l,ge,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&L?pe.forEach(oe=>{const ge=this.pluralResolver.getSuffixes(oe,t);E&&t[`defaultValue${this.options.pluralSeparator}zero`]&&ge.indexOf(`${this.options.pluralSeparator}zero`)<0&&ge.push(`${this.options.pluralSeparator}zero`),ge.forEach(le=>{Ce([oe],a+le,t[`defaultValue${le}`]||O)})}):Ce(pe,a,O))}p=this.extendTranslation(p,e,t,m,s),$&&p===a&&this.options.appendNamespaceToMissingKey&&(p=`${l}:${a}`),($||M)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${a}`:a,M?p:void 0))}return r?(m.res=p,m.usedParams=this.getUsedParamsDetails(t),m):p}extendTranslation(e,t,s,r,i){var d,g;var a=this;if((d=this.i18nFormat)!=null&&d.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const m=A(e)&&(((g=s==null?void 0:s.interpolation)==null?void 0:g.skipOnVariables)!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let p;if(m){const x=e.match(this.interpolator.nestingRegexp);p=x&&x.length}let C=s.replace&&!A(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(C={...this.options.interpolation.defaultVariables,...C}),e=this.interpolator.interpolate(e,C,s.lng||this.language||r.usedLng,s),m){const x=e.match(this.interpolator.nestingRegexp),S=x&&x.length;p<S&&(s.nest=!1)}!s.lng&&r&&r.res&&(s.lng=this.language||r.usedLng),s.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var x=arguments.length,S=new Array(x),N=0;N<x;N++)S[N]=arguments[N];return(i==null?void 0:i[0])===S[0]&&!s.context?(a.logger.warn(`It seems you are nesting recursively key: ${S[0]} in key: ${t[0]}`),null):a.translate(...S,t)},s)),s.interpolation&&this.interpolator.reset()}const c=s.postProcess||this.options.postProcess,l=A(c)?[c]:c;return e!=null&&(l!=null&&l.length)&&s.applyPostProcessor!==!1&&(e=xs.handle(l,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s,r,i,a,c;return A(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(s))return;const d=this.extractFromKey(l,t),g=d.key;r=g;let m=d.namespaces;this.options.fallbackNS&&(m=m.concat(this.options.fallbackNS));const p=t.count!==void 0&&!A(t.count),C=p&&!t.ordinal&&t.count===0,x=t.context!==void 0&&(A(t.context)||typeof t.context=="number")&&t.context!=="",S=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);m.forEach(N=>{var _,L;this.isValidLookup(s)||(c=N,!Zt[`${S[0]}-${N}`]&&((_=this.utils)!=null&&_.hasLoadedNamespace)&&!((L=this.utils)!=null&&L.hasLoadedNamespace(c))&&(Zt[`${S[0]}-${N}`]=!0,this.logger.warn(`key "${r}" for languages "${S.join(", ")}" won't get resolved as namespace "${c}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),S.forEach(D=>{var E;if(this.isValidLookup(s))return;a=D;const V=[g];if((E=this.i18nFormat)!=null&&E.addLookupKeys)this.i18nFormat.addLookupKeys(V,g,D,N,t);else{let O;p&&(O=this.pluralResolver.getSuffix(D,t.count,t));const z=`${this.options.pluralSeparator}zero`,T=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(p&&(V.push(g+O),t.ordinal&&O.indexOf(T)===0&&V.push(g+O.replace(T,this.options.pluralSeparator)),C&&V.push(g+z)),x){const G=`${g}${this.options.contextSeparator}${t.context}`;V.push(G),p&&(V.push(G+O),t.ordinal&&O.indexOf(T)===0&&V.push(G+O.replace(T,this.options.pluralSeparator)),C&&V.push(G+z))}}let Y;for(;Y=V.pop();)this.isValidLookup(s)||(i=Y,s=this.getResource(D,N,Y,t))}))})}),{res:s,usedKey:r,exactUsedKey:i,usedLng:a,usedNS:c}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,s){var i;let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return(i=this.i18nFormat)!=null&&i.getResource?this.i18nFormat.getResource(e,t,s,r):this.resourceStore.getResource(e,t,s,r)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=e.replace&&!A(e.replace);let r=s?e.replace:e;if(s&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!s){r={...r};for(const i of t)delete r[i]}return r}static hasDefaultValue(e){const t="defaultValue";for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t===s.substring(0,t.length)&&e[s]!==void 0)return!0;return!1}}class ts{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Se.create("languageUtils")}getScriptPartFromCode(e){if(e=et(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=et(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(A(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(s=>{if(t)return;const r=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(r))&&(t=r)}),!t&&this.options.supportedLngs&&e.forEach(s=>{if(t)return;const r=this.getLanguagePartFromCode(s);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(i=>{if(i===r)return i;if(!(i.indexOf("-")<0&&r.indexOf("-")<0)&&(i.indexOf("-")>0&&r.indexOf("-")<0&&i.substring(0,i.indexOf("-"))===r||i.indexOf(r)===0&&r.length>1))return i})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),A(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let s=e[t];return s||(s=e[this.getScriptPartFromCode(t)]),s||(s=e[this.formatLanguageCode(t)]),s||(s=e[this.getLanguagePartFromCode(t)]),s||(s=e.default),s||[]}toResolveHierarchy(e,t){const s=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],i=a=>{a&&(this.isSupportedCode(a)?r.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return A(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(e))):A(e)&&i(this.formatLanguageCode(e)),s.forEach(a=>{r.indexOf(a)<0&&i(this.formatLanguageCode(a))}),r}}const ss={zero:0,one:1,two:2,few:3,many:4,other:5},ns={select:o=>o===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class nr{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=Se.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=et(e==="dev"?"en":e),r=t.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:s,type:r});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let a;try{a=new Intl.PluralRules(s,{type:r})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),ns;if(!e.match(/-|_/))return ns;const l=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(l,t)}return this.pluralRulesCache[i]=a,a}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.getRule(e,t);return s||(s=this.getRule("dev",t)),(s==null?void 0:s.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,s).map(r=>`${t}${r}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.getRule(e,t);return s||(s=this.getRule("dev",t)),s?s.resolvedOptions().pluralCategories.sort((r,i)=>ss[r]-ss[i]).map(r=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${r}`):[]}getSuffix(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=this.getRule(e,s);return r?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,s))}}const rs=function(o,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,i=Gn(o,e,t);return!i&&r&&A(t)&&(i=kt(o,t,s),i===void 0&&(i=kt(e,t,s))),i},xt=o=>o.replace(/\$/g,"$$$$");class rr{constructor(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Se.create("interpolator"),this.options=e,this.format=((t=e==null?void 0:e.interpolation)==null?void 0:t.format)||(s=>s),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:s,useRawValueToEscape:r,prefix:i,prefixEscaped:a,suffix:c,suffixEscaped:l,formatSeparator:d,unescapeSuffix:g,unescapePrefix:m,nestingPrefix:p,nestingPrefixEscaped:C,nestingSuffix:x,nestingSuffixEscaped:S,nestingOptionsSeparator:N,maxReplaces:_,alwaysFormat:L}=e.interpolation;this.escape=t!==void 0?t:Xn,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=i?Te(i):a||"{{",this.suffix=c?Te(c):l||"}}",this.formatSeparator=d||",",this.unescapePrefix=g?"":m||"-",this.unescapeSuffix=this.unescapePrefix?"":g||"",this.nestingPrefix=p?Te(p):C||Te("$t("),this.nestingSuffix=x?Te(x):S||Te(")"),this.nestingOptionsSeparator=N||",",this.maxReplaces=_||1e3,this.alwaysFormat=L!==void 0?L:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,s)=>(t==null?void 0:t.source)===s?(t.lastIndex=0,t):new RegExp(s,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,s,r){var C;let i,a,c;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},d=x=>{if(x.indexOf(this.formatSeparator)<0){const L=rs(t,l,x,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(L,void 0,s,{...r,...t,interpolationkey:x}):L}const S=x.split(this.formatSeparator),N=S.shift().trim(),_=S.join(this.formatSeparator).trim();return this.format(rs(t,l,N,this.options.keySeparator,this.options.ignoreJSONStructure),_,s,{...r,...t,interpolationkey:N})};this.resetRegExp();const g=(r==null?void 0:r.missingInterpolationHandler)||this.options.missingInterpolationHandler,m=((C=r==null?void 0:r.interpolation)==null?void 0:C.skipOnVariables)!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:x=>xt(x)},{regex:this.regexp,safeValue:x=>this.escapeValue?xt(this.escape(x)):xt(x)}].forEach(x=>{for(c=0;i=x.regex.exec(e);){const S=i[1].trim();if(a=d(S),a===void 0)if(typeof g=="function"){const _=g(e,i,r);a=A(_)?_:""}else if(r&&Object.prototype.hasOwnProperty.call(r,S))a="";else if(m){a=i[0];continue}else this.logger.warn(`missed to pass in variable ${S} for interpolating ${e}`),a="";else!A(a)&&!this.useRawValueToEscape&&(a=qt(a));const N=x.safeValue(a);if(e=e.replace(i[0],N),m?(x.regex.lastIndex+=a.length,x.regex.lastIndex-=i[0].length):x.regex.lastIndex=0,c++,c>=this.maxReplaces)break}}),e}nest(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r,i,a;const c=(l,d)=>{const g=this.nestingOptionsSeparator;if(l.indexOf(g)<0)return l;const m=l.split(new RegExp(`${g}[ ]*{`));let p=`{${m[1]}`;l=m[0],p=this.interpolate(p,a);const C=p.match(/'/g),x=p.match(/"/g);(((C==null?void 0:C.length)??0)%2===0&&!x||x.length%2!==0)&&(p=p.replace(/'/g,'"'));try{a=JSON.parse(p),d&&(a={...d,...a})}catch(S){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,S),`${l}${g}${p}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,l};for(;r=this.nestingRegexp.exec(e);){let l=[];a={...s},a=a.replace&&!A(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;let d=!1;if(r[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(r[1])){const g=r[1].split(this.formatSeparator).map(m=>m.trim());r[1]=g.shift(),l=g,d=!0}if(i=t(c.call(this,r[1].trim(),a),a),i&&r[0]===e&&!A(i))return i;A(i)||(i=qt(i)),i||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),i=""),d&&(i=l.reduce((g,m)=>this.format(g,m,s.lng,{...s,interpolationkey:r[1].trim()}),i.trim())),e=e.replace(r[0],i),this.regexp.lastIndex=0}return e}}const ir=o=>{let e=o.toLowerCase().trim();const t={};if(o.indexOf("(")>-1){const s=o.split("(");e=s[0].toLowerCase().trim();const r=s[1].substring(0,s[1].length-1);e==="currency"&&r.indexOf(":")<0?t.currency||(t.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?t.range||(t.range=r.trim()):r.split(";").forEach(a=>{if(a){const[c,...l]=a.split(":"),d=l.join(":").trim().replace(/^'+|'+$/g,""),g=c.trim();t[g]||(t[g]=d),d==="false"&&(t[g]=!1),d==="true"&&(t[g]=!0),isNaN(d)||(t[g]=parseInt(d,10))}})}return{formatName:e,formatOptions:t}},$e=o=>{const e={};return(t,s,r)=>{let i=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(i={...i,[r.interpolationkey]:void 0});const a=s+JSON.stringify(i);let c=e[a];return c||(c=o(et(s),r),e[a]=c),c(t)}};class or{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Se.create("formatter"),this.options=e,this.formats={number:$e((t,s)=>{const r=new Intl.NumberFormat(t,{...s});return i=>r.format(i)}),currency:$e((t,s)=>{const r=new Intl.NumberFormat(t,{...s,style:"currency"});return i=>r.format(i)}),datetime:$e((t,s)=>{const r=new Intl.DateTimeFormat(t,{...s});return i=>r.format(i)}),relativetime:$e((t,s)=>{const r=new Intl.RelativeTimeFormat(t,{...s});return i=>r.format(i,s.range||"day")}),list:$e((t,s)=>{const r=new Intl.ListFormat(t,{...s});return i=>r.format(i)})},this.init(e)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=$e(t)}format(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=t.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(c=>c.indexOf(")")>-1)){const c=i.findIndex(l=>l.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,c)].join(this.formatSeparator)}return i.reduce((c,l)=>{var m;const{formatName:d,formatOptions:g}=ir(l);if(this.formats[d]){let p=c;try{const C=((m=r==null?void 0:r.formatParams)==null?void 0:m[r.interpolationkey])||{},x=C.locale||C.lng||r.locale||r.lng||s;p=this.formats[d](c,x,{...g,...r,...C})}catch(C){this.logger.warn(C)}return p}else this.logger.warn(`there was no format function for ${d}`);return c},e)}}const ar=(o,e)=>{o.pending[e]!==void 0&&(delete o.pending[e],o.pendingCount--)};class lr extends rt{constructor(e,t,s){var i,a;let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=s,this.languageUtils=s.languageUtils,this.options=r,this.logger=Se.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],(a=(i=this.backend)==null?void 0:i.init)==null||a.call(i,s,r.backend,r)}queueLoad(e,t,s,r){const i={},a={},c={},l={};return e.forEach(d=>{let g=!0;t.forEach(m=>{const p=`${d}|${m}`;!s.reload&&this.store.hasResourceBundle(d,m)?this.state[p]=2:this.state[p]<0||(this.state[p]===1?a[p]===void 0&&(a[p]=!0):(this.state[p]=1,g=!1,a[p]===void 0&&(a[p]=!0),i[p]===void 0&&(i[p]=!0),l[m]===void 0&&(l[m]=!0)))}),g||(c[d]=!0)}),(Object.keys(i).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(i),pending:Object.keys(a),toLoadLanguages:Object.keys(c),toLoadNamespaces:Object.keys(l)}}loaded(e,t,s){const r=e.split("|"),i=r[0],a=r[1];t&&this.emit("failedLoading",i,a,t),!t&&s&&this.store.addResourceBundle(i,a,s,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&s&&(this.state[e]=0);const c={};this.queue.forEach(l=>{qn(l.loaded,[i],a),ar(l,e),t&&l.errors.push(t),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(d=>{c[d]||(c[d]={});const g=l.loaded[d];g.length&&g.forEach(m=>{c[d][m]===void 0&&(c[d][m]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",c),this.queue=this.queue.filter(l=>!l.done)}read(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:s,tried:r,wait:i,callback:a});return}this.readingCalls++;const c=(d,g)=>{if(this.readingCalls--,this.waitingReads.length>0){const m=this.waitingReads.shift();this.read(m.lng,m.ns,m.fcName,m.tried,m.wait,m.callback)}if(d&&g&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,s,r+1,i*2,a)},i);return}a(d,g)},l=this.backend[s].bind(this.backend);if(l.length===2){try{const d=l(e,t);d&&typeof d.then=="function"?d.then(g=>c(null,g)).catch(c):c(null,d)}catch(d){c(d)}return}return l(e,t,c)}prepareLoading(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();A(e)&&(e=this.languageUtils.toResolveHierarchy(e)),A(t)&&(t=[t]);const i=this.queueLoad(e,t,s,r);if(!i.toLoad.length)return i.pending.length||r(),null;i.toLoad.forEach(a=>{this.loadOne(a)})}load(e,t,s){this.prepareLoading(e,t,{},s)}reload(e,t,s){this.prepareLoading(e,t,{reload:!0},s)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const s=e.split("|"),r=s[0],i=s[1];this.read(r,i,"read",void 0,void 0,(a,c)=>{a&&this.logger.warn(`${t}loading namespace ${i} for language ${r} failed`,a),!a&&c&&this.logger.log(`${t}loaded namespace ${i} for language ${r}`,c),this.loaded(e,a,c)})}saveMissing(e,t,s,r,i){var l,d,g,m,p;let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if((d=(l=this.services)==null?void 0:l.utils)!=null&&d.hasLoadedNamespace&&!((m=(g=this.services)==null?void 0:g.utils)!=null&&m.hasLoadedNamespace(t))){this.logger.warn(`did not save key "${s}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if((p=this.backend)!=null&&p.create){const C={...a,isUpdate:i},x=this.backend.create.bind(this.backend);if(x.length<6)try{let S;x.length===5?S=x(e,t,s,r,C):S=x(e,t,s,r),S&&typeof S.then=="function"?S.then(N=>c(null,N)).catch(c):c(null,S)}catch(S){c(S)}else x(e,t,s,r,c,C)}!e||!e[0]||this.store.addResource(e[0],t,s,r)}}}const is=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:o=>{let e={};if(typeof o[1]=="object"&&(e=o[1]),A(o[1])&&(e.defaultValue=o[1]),A(o[2])&&(e.tDescription=o[2]),typeof o[2]=="object"||typeof o[3]=="object"){const t=o[3]||o[2];Object.keys(t).forEach(s=>{e[s]=t[s]})}return e},interpolation:{escapeValue:!0,format:o=>o,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),os=o=>{var e,t;return A(o.ns)&&(o.ns=[o.ns]),A(o.fallbackLng)&&(o.fallbackLng=[o.fallbackLng]),A(o.fallbackNS)&&(o.fallbackNS=[o.fallbackNS]),((t=(e=o.supportedLngs)==null?void 0:e.indexOf)==null?void 0:t.call(e,"cimode"))<0&&(o.supportedLngs=o.supportedLngs.concat(["cimode"])),typeof o.initImmediate=="boolean"&&(o.initAsync=o.initImmediate),o},Xe=()=>{},cr=o=>{Object.getOwnPropertyNames(Object.getPrototypeOf(o)).forEach(t=>{typeof o[t]=="function"&&(o[t]=o[t].bind(o))})};class Ue extends rt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=os(e),this.services={},this.logger=Se,this.modules={external:[]},cr(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(s=t,t={}),t.defaultNS==null&&t.ns&&(A(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const r=is();this.options={...r,...this.options,...os(t)},this.options.interpolation={...r.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const i=g=>g?typeof g=="function"?new g:g:null;if(!this.options.isClone){this.modules.logger?Se.init(i(this.modules.logger),this.options):Se.init(null,this.options);let g;this.modules.formatter?g=this.modules.formatter:g=or;const m=new ts(this.options);this.store=new Qt(this.options.resources,this.options);const p=this.services;p.logger=Se,p.resourceStore=this.store,p.languageUtils=m,p.pluralResolver=new nr(m,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),g&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(p.formatter=i(g),p.formatter.init(p,this.options),this.options.interpolation.format=p.formatter.format.bind(p.formatter)),p.interpolator=new rr(this.options),p.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},p.backendConnector=new lr(i(this.modules.backend),p.resourceStore,p,this.options),p.backendConnector.on("*",function(C){for(var x=arguments.length,S=new Array(x>1?x-1:0),N=1;N<x;N++)S[N-1]=arguments[N];e.emit(C,...S)}),this.modules.languageDetector&&(p.languageDetector=i(this.modules.languageDetector),p.languageDetector.init&&p.languageDetector.init(p,this.options.detection,this.options)),this.modules.i18nFormat&&(p.i18nFormat=i(this.modules.i18nFormat),p.i18nFormat.init&&p.i18nFormat.init(this)),this.translator=new st(this.services,this.options),this.translator.on("*",function(C){for(var x=arguments.length,S=new Array(x>1?x-1:0),N=1;N<x;N++)S[N-1]=arguments[N];e.emit(C,...S)}),this.modules.external.forEach(C=>{C.init&&C.init(this)})}if(this.format=this.options.interpolation.format,s||(s=Xe),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const g=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);g.length>0&&g[0]!=="dev"&&(this.options.lng=g[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(g=>{this[g]=function(){return e.store[g](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(g=>{this[g]=function(){return e.store[g](...arguments),e}});const l=Me(),d=()=>{const g=(m,p)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(p),s(m,p)};if(this.languages&&!this.isInitialized)return g(null,this.t.bind(this));this.changeLanguage(this.options.lng,g)};return this.options.resources||!this.options.initAsync?d():setTimeout(d,0),l}loadResources(e){var i,a;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xe;const r=A(e)?e:this.language;if(typeof e=="function"&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if((r==null?void 0:r.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const c=[],l=d=>{if(!d||d==="cimode")return;this.services.languageUtils.toResolveHierarchy(d).forEach(m=>{m!=="cimode"&&c.indexOf(m)<0&&c.push(m)})};r?l(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(g=>l(g)),(a=(i=this.options.preload)==null?void 0:i.forEach)==null||a.call(i,d=>l(d)),this.services.backendConnector.load(c,this.options.ns,d=>{!d&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(d)})}else s(null)}reloadResources(e,t,s){const r=Me();return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),s||(s=Xe),this.services.backendConnector.reload(e,t,i=>{r.resolve(),s(i)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&xs.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const s=this.languages[t];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}}changeLanguage(e,t){var s=this;this.isLanguageChangingTo=e;const r=Me();this.emit("languageChanging",e);const i=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},a=(l,d)=>{d?(i(d),this.translator.changeLanguage(d),this.isLanguageChangingTo=void 0,this.emit("languageChanged",d),this.logger.log("languageChanged",d)):this.isLanguageChangingTo=void 0,r.resolve(function(){return s.t(...arguments)}),t&&t(l,function(){return s.t(...arguments)})},c=l=>{var g,m;!e&&!l&&this.services.languageDetector&&(l=[]);const d=A(l)?l:this.services.languageUtils.getBestMatchFromCodes(l);d&&(this.language||i(d),this.translator.language||this.translator.changeLanguage(d),(m=(g=this.services.languageDetector)==null?void 0:g.cacheUserLanguage)==null||m.call(g,d)),this.loadResources(d,p=>{a(p,d)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?c(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(c):this.services.languageDetector.detect(c):c(e),r}getFixedT(e,t,s){var r=this;const i=function(a,c){let l;if(typeof c!="object"){for(var d=arguments.length,g=new Array(d>2?d-2:0),m=2;m<d;m++)g[m-2]=arguments[m];l=r.options.overloadTranslationOptionHandler([a,c].concat(g))}else l={...c};l.lng=l.lng||i.lng,l.lngs=l.lngs||i.lngs,l.ns=l.ns||i.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||s||i.keyPrefix);const p=r.options.keySeparator||".";let C;return l.keyPrefix&&Array.isArray(a)?C=a.map(x=>`${l.keyPrefix}${p}${x}`):C=l.keyPrefix?`${l.keyPrefix}${p}${a}`:a,r.t(C,l)};return A(e)?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=s,i}t(){var r;for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return(r=this.translator)==null?void 0:r.translate(...t)}exists(){var r;for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return(r=this.translator)==null?void 0:r.exists(...t)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=t.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const a=(c,l)=>{const d=this.services.backendConnector.state[`${c}|${l}`];return d===-1||d===0||d===2};if(t.precheck){const c=t.precheck(this,a);if(c!==void 0)return c}return!!(this.hasResourceBundle(s,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(s,e)&&(!r||a(i,e)))}loadNamespaces(e,t){const s=Me();return this.options.ns?(A(e)&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{s.resolve(),t&&t(r)}),s):(t&&t(),Promise.resolve())}loadLanguages(e,t){const s=Me();A(e)&&(e=[e]);const r=this.options.preload||[],i=e.filter(a=>r.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return i.length?(this.options.preload=r.concat(i),this.loadResources(a=>{s.resolve(),t&&t(a)}),s):(t&&t(),Promise.resolve())}dir(e){var r,i;if(e||(e=this.resolvedLanguage||(((r=this.languages)==null?void 0:r.length)>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=((i=this.services)==null?void 0:i.languageUtils)||new ts(is());return t.indexOf(s.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new Ue(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xe;const s=e.forkResourceStore;s&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},i=new Ue(r);if((e.debug!==void 0||e.prefix!==void 0)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(c=>{i[c]=this[c]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},s){const c=Object.keys(this.store.data).reduce((l,d)=>(l[d]={...this.store.data[d]},Object.keys(l[d]).reduce((g,m)=>(g[m]={...l[d][m]},g),{})),{});i.store=new Qt(c,r),i.services.resourceStore=i.store}return i.translator=new st(i.services,r),i.translator.on("*",function(c){for(var l=arguments.length,d=new Array(l>1?l-1:0),g=1;g<l;g++)d[g-1]=arguments[g];i.emit(c,...d)}),i.init(r,t),i.translator.options=r,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const de=Ue.createInstance();de.createInstance=Ue.createInstance;de.createInstance;de.dir;de.init;de.loadResources;de.reloadResources;de.use;de.changeLanguage;de.getFixedT;de.t;de.exists;de.setDefaultNamespace;de.hasLoadedNamespace;de.loadNamespaces;de.loadLanguages;const dr={en:{translation:{login:"Login",toggleTheme:"Toggle Theme",homeSubtitle:"A simple entry to the World of JOE",email:"Email",password:"Password",register:"Register",welcomeTitle:"👋",welcomeMsg:`Hello! I am Joe, your smart assistant.
How can I help you today?`,inputPlaceholder:"Enter your command here...",send:"Send",connecting:"Connecting...",connected:"Connected",copy:"Copy text",working:"Working...",planProposed:"📋 Proposed Plan",planAction:"I will",inputs:"Inputs",outputs:"Outputs",approvalRequired:"Approval Required",risk:"Risk",action:"Action",deny:"Deny",approve:"Approve",tools:{file_write:"Create File",file_read:"Read File",ls:"List Files",web_search:"Web Search",shell_execute:"Execute Command",http_fetch:"Fetch URL",file_edit:"Edit File",plan:"Plan & Analyze",summarize:"Summarize",unknown:"Unknown Tool"},artifacts:{image:"Image",video:"Video",file:"File",openNewWindow:"Open in new window"},error:"Error sending command"}},ar:{translation:{login:"تسجيل الدخول",toggleTheme:"تبديل السمة",homeSubtitle:"بوابة الدخول إلى عالم جو",email:"البريد الإلكتروني",password:"كلمة المرور",register:"تسجيل",welcomeTitle:"👋",welcomeMsg:`مرحباً! أنا جو، مساعدك الذكي.
كيف يمكنني مساعدتك اليوم؟`,inputPlaceholder:"أدخل أمرك هنا...",send:"إرسال",connecting:"جاري الاتصال...",connected:"متصل",copy:"نسخ النص",working:"جاري العمل...",planProposed:"📋 الخطة المقترحة",planAction:"سأقوم بـ",inputs:"المدخلات",outputs:"المخرجات",approvalRequired:"موافقة مطلوبة",risk:"مستوى الخطورة",action:"الإجراء",deny:"رفض",approve:"موافقة",tools:{file_write:"إنشاء ملف",file_read:"قراءة ملف",ls:"عرض الملفات",web_search:"بحث في الويب",shell_execute:"تنفيذ أمر النظام",http_fetch:"جلب رابط",file_edit:"تعديل ملف",plan:"تحليل وتخطيط",summarize:"تلخيص النتائج",unknown:"أداة غير معروفة"},artifacts:{image:"صورة",video:"فيديو",file:"ملف",openNewWindow:"فتح في نافذة جديدة"},error:"فشل إرسال الأمر"}},fr:{translation:{login:"Connexion",toggleTheme:"Changer de thème",homeSubtitle:"Une entrée simple dans le monde de JOE",email:"Email",password:"Mot de passe",register:"S'inscrire",welcomeTitle:"👋",welcomeMsg:`Bonjour ! Je suis Joe, votre assistant intelligent.
Comment puis-je vous aider aujourd'hui ?`,inputPlaceholder:"Entrez votre commande ici...",send:"Envoyer",connecting:"Connexion...",connected:"Connecté",copy:"Copier le texte",working:"En cours...",planProposed:"📋 Plan Proposé",planAction:"Je vais",inputs:"Entrées",outputs:"Sorties",approvalRequired:"Approbation requise",risk:"Risque",action:"Action",deny:"Refuser",approve:"Approuver",tools:{file_write:"Créer un fichier",file_read:"Lire un fichier",ls:"Lister les fichiers",web_search:"Recherche Web",shell_execute:"Exécuter la commande",http_fetch:"Récupérer URL",file_edit:"Modifier le fichier",plan:"Planifier & Analyser",summarize:"Résumer",unknown:"Outil inconnu"},artifacts:{image:"Image",video:"Vidéo",file:"Fichier",openNewWindow:"Ouvrir dans une nouvelle fenêtre"},error:"Erreur lors de l'envoi"}},de:{translation:{login:"Anmelden",toggleTheme:"Thema umschalten",homeSubtitle:"Ein einfacher Zugang zur Welt von JOE",email:"E-Mail",password:"Passwort",register:"Registrieren",welcomeTitle:"👋",welcomeMsg:`Hallo! Ich bin Joe, dein intelligenter Assistent.
Wie kann ich dir heute helfen?`,inputPlaceholder:"Gib deinen Befehl hier ein...",send:"Senden",connecting:"Verbinden...",connected:"Verbunden",copy:"Text kopieren",working:"Arbeite...",planProposed:"📋 Vorgeschlagener Plan",planAction:"Ich werde",inputs:"Eingaben",outputs:"Ausgaben",approvalRequired:"Genehmigung erforderlich",risk:"Risiko",action:"Aktion",deny:"Ablehnen",approve:"Genehmigen",tools:{file_write:"Datei erstellen",file_read:"Datei lesen",ls:"Dateien auflisten",web_search:"Websuche",shell_execute:"Befehl ausführen",http_fetch:"URL abrufen",file_edit:"Datei bearbeiten",plan:"Planen & Analysieren",summarize:"Zusammenfassen",unknown:"Unbekanntes Werkzeug"},artifacts:{image:"Bild",video:"Video",file:"Datei",openNewWindow:"In neuem Fenster öffnen"},error:"Fehler beim Senden"}},ru:{translation:{login:"Войти",toggleTheme:"Сменить тему",homeSubtitle:"Простой вход в мир JOE",email:"Email",password:"Пароль",register:"Регистрация",welcomeTitle:"👋",welcomeMsg:`Привет! Я Джо, твой умный помощник.
Чем я могу помочь сегодня?`,inputPlaceholder:"Введите команду здесь...",send:"Отправить",connecting:"Подключение...",connected:"Подключено",copy:"Копировать",working:"Работаю...",planProposed:"📋 Предложенный план",planAction:"Я сделаю",inputs:"Входные данные",outputs:"Выходные данные",approvalRequired:"Требуется подтверждение",risk:"Риск",action:"Действие",deny:"Отклонить",approve:"Принять",tools:{file_write:"Создать файл",file_read:"Читать файл",ls:"Список файлов",web_search:"Поиск в веб",shell_execute:"Выполнить команду",http_fetch:"Получить URL",file_edit:"Редактировать файл",plan:"Планирование",summarize:"Обобщить",unknown:"Неизвестный инструмент"},artifacts:{image:"Изображение",video:"Видео",file:"Файл",openNewWindow:"Открыть в новом окне"},error:"Ошибка отправки"}},es:{translation:{login:"Iniciar sesión",toggleTheme:"Cambiar tema",homeSubtitle:"Una entrada simple al mundo de JOE",email:"Correo electrónico",password:"Contraseña",register:"Registrarse",welcomeTitle:"👋",welcomeMsg:`¡Hola! Soy Joe, tu asistente inteligente.
¿Cómo puedo ayudarte hoy?`,inputPlaceholder:"Ingresa tu comando aquí...",send:"Enviar",connecting:"Conectando...",connected:"Conectado",copy:"Copiar texto",working:"Trabajando...",planProposed:"📋 Plan Propuesto",planAction:"Voy a",inputs:"Entradas",outputs:"Salidas",approvalRequired:"Aprobación requerida",risk:"Riesgo",action:"Acción",deny:"Rechazar",approve:"Aprobar",tools:{file_write:"Crear archivo",file_read:"Leer archivo",ls:"Listar archivos",web_search:"Búsqueda web",shell_execute:"Ejecutar comando",http_fetch:"Obtener URL",file_edit:"Editar archivo",plan:"Planificar y Analizar",summarize:"Resumir",unknown:"Herramienta desconocida"},artifacts:{image:"Imagen",video:"Video",file:"Archivo",openNewWindow:"Abrir en nueva ventana"},error:"Error al enviar"}}};de.use(In).init({resources:dr,lng:localStorage.getItem("lang")||"en",fallbackLng:"en",interpolation:{escapeValue:!1}});function ur({children:o}){return localStorage.getItem("token")?n.jsx(n.Fragment,{children:o}):n.jsx(dn,{to:"/login",replace:!0})}hn.createRoot(document.getElementById("root")).render(n.jsx(an.StrictMode,{children:n.jsx(ln,{children:n.jsx(cn,{children:n.jsxs(Ge,{path:"/",element:n.jsx($n,{}),children:[n.jsx(Ge,{index:!0,element:n.jsx(An,{})}),n.jsx(Ge,{path:"login",element:n.jsx(_n,{})}),n.jsx(Ge,{path:"joe",element:n.jsx(ur,{children:n.jsx(Wn,{})})})]})})})}));export{ee as A};

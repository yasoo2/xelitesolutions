const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AgentBrowserStream-DvfGRprp.js","assets/ui-vUf7uXgm.js","assets/vendor-DZWZ8VcW.js","assets/markdown-DC0SD8kP.js"])))=>i.map(i=>d[i]);
import{j as n,G as Os,S as Es,M as Ls,L as Ps,a as as,m as ve,A as Ts,Z as yt,X as bt,b as wt,c as $s,d as As,E as ls,e as cs,U as zs,C as Fs,R as _s,f as Ds,F as _t,g as ds,T as Bs,h as us,V as Ms,i as Us,k as Dt,l as fs,n as qe,o as Qe,p as Vs,q as Ks,P as Ws,r as Bt,s as Hs,t as Js,u as qs,v as Mt,w as Gs,x as Ys,y as Xs,z as Qs,B as Zs,D as en,H as tn,I as sn,J as nn}from"./ui-vUf7uXgm.js";import{b as rn,a as h,u as nt,O as on,R as an,B as ln,c as cn,d as Ge,N as dn}from"./vendor-DZWZ8VcW.js";import{_ as un,M as fn,h as pn}from"./markdown-DC0SD8kP.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var Ye={},Ut;function gn(){if(Ut)return Ye;Ut=1;var o=rn();return Ye.createRoot=o.createRoot,Ye.hydrateRoot=o.hydrateRoot,Ye}var hn=gn();const mn=(o,e,t,s)=>{var i,a,c,l;const r=[t,{code:e,...s||{}}];if((a=(i=o==null?void 0:o.services)==null?void 0:i.logger)!=null&&a.forward)return o.services.logger.forward(r,"warn","react-i18next::",!0);Oe(r[0])&&(r[0]=`react-i18next:: ${r[0]}`),(l=(c=o==null?void 0:o.services)==null?void 0:c.logger)!=null&&l.warn?o.services.logger.warn(...r):console!=null&&console.warn&&console.warn(...r)},Vt={},vt=(o,e,t,s)=>{Oe(t)&&Vt[t]||(Oe(t)&&(Vt[t]=new Date),mn(o,e,t,s))},ps=(o,e)=>()=>{if(o.isInitialized)e();else{const t=()=>{setTimeout(()=>{o.off("initialized",t)},0),e()};o.on("initialized",t)}},jt=(o,e,t)=>{o.loadNamespaces(e,ps(o,t))},Kt=(o,e,t,s)=>{if(Oe(t)&&(t=[t]),o.options.preload&&o.options.preload.indexOf(e)>-1)return jt(o,t,s);t.forEach(r=>{o.options.ns.indexOf(r)<0&&o.options.ns.push(r)}),o.loadLanguages(e,ps(o,s))},xn=(o,e,t={})=>!e.languages||!e.languages.length?(vt(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(o,{lng:t.lng,precheck:(s,r)=>{if(t.bindI18n&&t.bindI18n.indexOf("languageChanging")>-1&&s.services.backendConnector.backend&&s.isLanguageChangingTo&&!r(s.isLanguageChangingTo,o))return!1}}),Oe=o=>typeof o=="string",yn=o=>typeof o=="object"&&o!==null,bn=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,wn={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},vn=o=>wn[o],jn=o=>o.replace(bn,vn);let St={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:jn};const Sn=(o={})=>{St={...St,...o}},kn=()=>St;let gs;const Nn=o=>{gs=o},Cn=()=>gs,In={type:"3rdParty",init(o){Sn(o.options.react),Nn(o)}},Rn=h.createContext();class On{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(t=>{this.usedNamespaces[t]||(this.usedNamespaces[t]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const En=(o,e)=>{const t=h.useRef();return h.useEffect(()=>{t.current=o},[o,e]),t.current},hs=(o,e,t,s)=>o.getFixedT(e,t,s),Ln=(o,e,t,s)=>h.useCallback(hs(o,e,t,s),[o,e,t,s]),Ve=(o,e={})=>{var A,M,T,q;const{i18n:t}=e,{i18n:s,defaultNS:r}=h.useContext(Rn)||{},i=t||s||Cn();if(i&&!i.reportNamespaces&&(i.reportNamespaces=new On),!i){vt(i,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const P=(re,V)=>Oe(V)?V:yn(V)&&Oe(V.defaultValue)?V.defaultValue:Array.isArray(re)?re[re.length-1]:re,$=[P,{},!1];return $.t=P,$.i18n={},$.ready=!1,$}(A=i.options.react)!=null&&A.wait&&vt(i,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const a={...kn(),...i.options.react,...e},{useSuspense:c,keyPrefix:l}=a;let d=r||((M=i.options)==null?void 0:M.defaultNS);d=Oe(d)?[d]:d||["translation"],(q=(T=i.reportNamespaces).addUsedNamespaces)==null||q.call(T,d);const g=(i.isInitialized||i.initializedStoreOnce)&&d.every(P=>xn(P,i,a)),y=Ln(i,e.lng||null,a.nsMode==="fallback"?d:d[0],l),p=()=>y,C=()=>hs(i,e.lng||null,a.nsMode==="fallback"?d:d[0],l),[m,S]=h.useState(p);let N=d.join();e.lng&&(N=`${e.lng}${N}`);const _=En(N),I=h.useRef(!0);h.useEffect(()=>{const{bindI18n:P,bindI18nStore:$}=a;I.current=!0,!g&&!c&&(e.lng?Kt(i,e.lng,d,()=>{I.current&&S(C)}):jt(i,d,()=>{I.current&&S(C)})),g&&_&&_!==N&&I.current&&S(C);const re=()=>{I.current&&S(C)};return P&&(i==null||i.on(P,re)),$&&(i==null||i.store.on($,re)),()=>{I.current=!1,i&&P&&(P==null||P.split(" ").forEach(V=>i.off(V,re))),$&&i&&$.split(" ").forEach(V=>i.store.off(V,re))}},[i,N]),h.useEffect(()=>{I.current&&g&&S(p)},[i,l,g]);const E=[m,i,g];if(E.t=m,E.i18n=i,E.ready=g,g||!g&&!c)return E;throw new Promise(P=>{e.lng?Kt(i,e.lng,d,()=>P()):jt(i,d,()=>P())})},Wt=[{code:"en",label:"English"},{code:"ar",label:"العربية"},{code:"fr",label:"Français"},{code:"de",label:"Deutsch"},{code:"ru",label:"Русский"},{code:"es",label:"Español"}];function Pn(){var y;const{i18n:o,t:e}=Ve(),[t,s]=h.useState(()=>localStorage.getItem("theme")||"dark"),[r,i]=h.useState(()=>localStorage.getItem("lang")||"en"),[a,c]=h.useState(!1),l=h.useRef(null),d=nt();h.useEffect(()=>{localStorage.setItem("theme",t),document.documentElement.dataset.theme=t},[t]),h.useEffect(()=>{localStorage.setItem("lang",r),o.changeLanguage(r),document.documentElement.setAttribute("lang",r),document.documentElement.setAttribute("dir",r==="ar"?"rtl":"ltr")},[r,o]),h.useEffect(()=>{function p(C){l.current&&!l.current.contains(C.target)&&c(!1)}return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const g=((y=Wt.find(p=>p.code===r))==null?void 0:y.label)||"English";return n.jsxs("div",{className:"topbar",children:[n.jsx("div",{className:"brand",onClick:()=>d("/"),children:"JOE"}),n.jsx("div",{className:"spacer"}),n.jsxs("div",{className:"topbar-actions",style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"8px",marginInlineStart:"auto"},children:[n.jsxs("div",{className:"lang-dropdown",ref:l,style:{position:"relative"},children:[n.jsx("button",{className:`lang-btn ${a?"active":""}`,onClick:()=>c(!a),title:g,children:n.jsx(Os,{size:20})}),a&&n.jsx("div",{className:"lang-menu",style:{position:"absolute",top:"100%",right:"0",zIndex:1e3,marginTop:"8px"},children:Wt.map(p=>n.jsx("button",{className:`lang-option ${r===p.code?"active":""}`,onClick:()=>{i(p.code),c(!1)},children:p.label},p.code))})]}),n.jsx("button",{className:"action-btn","aria-label":e("toggleTheme"),title:e("toggleTheme"),onClick:()=>{document.documentElement.classList.add("theme-switching"),s(t==="dark"?"light":"dark"),window.setTimeout(()=>{document.documentElement.classList.remove("theme-switching")},300)},children:t==="dark"?n.jsx(Es,{size:20}):n.jsx(Ls,{size:20})}),n.jsx("button",{className:localStorage.getItem("token")?"logout-btn":"login-btn",onClick:()=>{localStorage.getItem("token")?confirm(e("confirmLogout","Are you sure you want to logout?"))&&(localStorage.removeItem("token"),d("/login")):d("/login")},title:localStorage.getItem("token")?e("logout","Logout"):e("login"),children:localStorage.getItem("token")?n.jsx(Ps,{size:20}):n.jsx(as,{size:20})})]})]})}const Tn=()=>n.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:-1,overflow:"hidden",background:"var(--bg-dark)",transition:"background 0.3s ease"},children:[n.jsx(ve.div,{style:{position:"absolute",top:"-10%",left:"-10%",width:"50vw",height:"50vw",borderRadius:"50%",background:"radial-gradient(circle, rgba(37,99,235,0.15) 0%, rgba(37,99,235,0) 70%)",filter:"blur(60px)"},animate:{x:[0,100,0],y:[0,50,0],scale:[1,1.1,1]},transition:{duration:20,repeat:1/0,ease:"easeInOut"}}),n.jsx(ve.div,{style:{position:"absolute",bottom:"-10%",right:"-10%",width:"60vw",height:"60vw",borderRadius:"50%",background:"radial-gradient(circle, rgba(147,51,234,0.15) 0%, rgba(147,51,234,0) 70%)",filter:"blur(80px)"},animate:{x:[0,-100,0],y:[0,-50,0],scale:[1,1.2,1]},transition:{duration:25,repeat:1/0,ease:"easeInOut"}}),n.jsx(ve.div,{style:{position:"absolute",top:"40%",left:"40%",width:"40vw",height:"40vw",borderRadius:"50%",background:"radial-gradient(circle, rgba(56,189,248,0.1) 0%, rgba(56,189,248,0) 70%)",filter:"blur(50px)"},animate:{x:[0,-30,0],y:[0,40,0],scale:[1,1.3,1]},transition:{duration:15,repeat:1/0,ease:"easeInOut"}})]});function $n(){return n.jsxs("div",{className:"app",children:[n.jsx(Tn,{}),n.jsx(Pn,{}),n.jsx("div",{className:"content",children:n.jsx(on,{})})]})}function An(){const{t:o}=Ve(),e=nt();return n.jsxs("div",{className:"home-page",children:[n.jsx("div",{className:"home-bg-glow-1"}),n.jsx("div",{className:"home-bg-glow-2"}),n.jsxs("div",{className:"home-content",children:[n.jsx("div",{className:"home-logo-container",children:n.jsx("div",{className:"home-logo-ring",children:n.jsx("span",{className:"home-logo-text",children:"J"})})}),n.jsxs("h1",{className:"home-title",children:["JOE ",n.jsx("span",{className:"home-title-accent",children:"AI"})]}),n.jsx("p",{className:"home-subtitle",children:o("homeSubtitle","Your intelligent coding companion")}),n.jsxs("div",{className:"home-actions",children:[n.jsxs("button",{className:"home-btn-primary",onClick:()=>e("/login"),children:[n.jsx("span",{children:o("start_now","Start Now")}),n.jsx(Ts,{size:20})]}),n.jsxs("button",{className:"home-btn-secondary",onClick:()=>window.open("https://xelitesolutions.com","_blank"),children:[n.jsx("span",{children:o("learn_more","Learn More")}),n.jsx(yt,{size:18})]})]})]}),n.jsx("div",{className:"home-footer",children:"© 2025 Xelite Solutions. All rights reserved."})]})}const ht=window.location.hostname,zn="http://127.0.0.1:8080";ht.includes("joe-api")||ht.startsWith("api.");const Z=String(zn).replace(/\/+$/,"");let Ae="";Ae||(Ae=`${Z.replace(/^http/,"ws")}/ws`);Ae.startsWith("http")&&(Ae=Ae.replace(/^http/,"ws"));const Fn=Ae;function _n(){const{t:o}=Ve(),e=nt(),[t,s]=h.useState(""),[r,i]=h.useState(""),[a,c]=h.useState(!1),[l,d]=h.useState(null),[g,y]=h.useState(!1);async function p(){d(null),y(!0);try{const m=await fetch(`${Z}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r,role:"OWNER"})});if(!m.ok){const S=await m.text();d(S);return}await C()}catch{d("Registration failed")}finally{y(!1)}}async function C(){d(null),y(!0);try{const m=await fetch(`${Z}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r})}),S=await m.json();if(!m.ok){d((S==null?void 0:S.error)||"Login failed");return}localStorage.setItem("token",S.token),e("/joe")}catch{d("Network error")}finally{y(!1)}}return n.jsxs("div",{className:"login-page",children:[n.jsxs("div",{className:"login-card",style:{position:"relative"},children:[n.jsx("button",{className:"login-close-btn",onClick:()=>e("/"),title:o("close","Close"),children:n.jsx(bt,{size:24})}),n.jsxs("div",{className:"login-header",children:[n.jsx("div",{className:"login-logo-wrapper",children:n.jsx("div",{className:"login-logo",children:n.jsx("span",{className:"login-logo-text",children:"J"})})}),n.jsx("div",{className:"login-title",children:"JOE AI"}),n.jsxs("div",{className:"login-subtitle",children:[n.jsx(wt,{size:14,style:{display:"inline",marginInlineEnd:6,color:"var(--accent-primary)"}}),o("login_subtitle","Welcome back to your workspace"),n.jsx(wt,{size:14,style:{display:"inline",marginInlineStart:6,color:"var(--accent-primary)"}})]})]}),n.jsxs("div",{className:"login-form",children:[l&&n.jsx("div",{className:"login-error",children:l}),n.jsxs("div",{className:"login-input-group",children:[n.jsx("label",{className:"login-label",children:o("email")}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx("input",{className:"login-input",value:t,onChange:m=>s(m.target.value),placeholder:"you@example.com"}),n.jsx($s,{size:18,style:{position:"absolute",top:16,left:16,color:"var(--text-muted)"},className:"input-icon-start"})]})]}),n.jsxs("div",{className:"login-input-group",children:[n.jsx("label",{className:"login-label",children:o("password")}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx("input",{className:"login-input",value:r,onChange:m=>i(m.target.value),type:a?"text":"password",placeholder:"••••••••",onKeyDown:m=>m.key==="Enter"&&C()}),n.jsx(As,{size:18,style:{position:"absolute",top:16,left:16,color:"var(--text-muted)"},className:"input-icon-start"}),n.jsx("button",{type:"button",onClick:()=>c(!a),style:{position:"absolute",top:14,right:16,background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},className:"input-icon-end",children:a?n.jsx(ls,{size:18}):n.jsx(cs,{size:18})})]})]}),n.jsxs("div",{className:"login-actions",children:[n.jsx("button",{className:"login-submit-btn",onClick:C,disabled:g,children:g?"...":n.jsxs("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[n.jsx(as,{size:20})," ",o("login")]})}),n.jsx("button",{className:"login-register-btn",onClick:p,disabled:g,children:n.jsxs("span",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[n.jsx(zs,{size:18})," ",o("register")]})})]})]})]}),n.jsx("div",{style:{position:"absolute",top:"10%",left:"10%",width:"300px",height:"300px",background:"radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%)",filter:"blur(40px)",zIndex:0}}),n.jsx("div",{style:{position:"absolute",bottom:"10%",right:"10%",width:"400px",height:"400px",background:"radial-gradient(circle, rgba(96, 165, 250, 0.1) 0%, transparent 70%)",filter:"blur(60px)",zIndex:0}})]})}const Dn={'pre[class*="language-"]':{color:"#d4d4d4",fontSize:"13px",textShadow:"none",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace',direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",lineHeight:"1.5",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none",padding:"1em",margin:".5em 0",overflow:"auto",background:"#1e1e1e"},'code[class*="language-"]':{color:"#d4d4d4",fontSize:"13px",textShadow:"none",fontFamily:'Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace',direction:"ltr",textAlign:"left",whiteSpace:"pre",wordSpacing:"normal",wordBreak:"normal",lineHeight:"1.5",MozTabSize:"4",OTabSize:"4",tabSize:"4",WebkitHyphens:"none",MozHyphens:"none",msHyphens:"none",hyphens:"none"},'pre[class*="language-"]::selection':{textShadow:"none",background:"#264F78"},'code[class*="language-"]::selection':{textShadow:"none",background:"#264F78"},'pre[class*="language-"] *::selection':{textShadow:"none",background:"#264F78"},'code[class*="language-"] *::selection':{textShadow:"none",background:"#264F78"},':not(pre) > code[class*="language-"]':{padding:".1em .3em",borderRadius:".3em",color:"#db4c69",background:"#1e1e1e"},".namespace":{Opacity:".7"},"doctype.doctype-tag":{color:"#569CD6"},"doctype.name":{color:"#9cdcfe"},comment:{color:"#6a9955"},prolog:{color:"#6a9955"},punctuation:{color:"#d4d4d4"},".language-html .language-css .token.punctuation":{color:"#d4d4d4"},".language-html .language-javascript .token.punctuation":{color:"#d4d4d4"},property:{color:"#9cdcfe"},tag:{color:"#569cd6"},boolean:{color:"#569cd6"},number:{color:"#b5cea8"},constant:{color:"#9cdcfe"},symbol:{color:"#b5cea8"},inserted:{color:"#b5cea8"},unit:{color:"#b5cea8"},selector:{color:"#d7ba7d"},"attr-name":{color:"#9cdcfe"},string:{color:"#ce9178"},char:{color:"#ce9178"},builtin:{color:"#ce9178"},deleted:{color:"#ce9178"},".language-css .token.string.url":{textDecoration:"underline"},operator:{color:"#d4d4d4"},entity:{color:"#569cd6"},"operator.arrow":{color:"#569CD6"},atrule:{color:"#ce9178"},"atrule.rule":{color:"#c586c0"},"atrule.url":{color:"#9cdcfe"},"atrule.url.function":{color:"#dcdcaa"},"atrule.url.punctuation":{color:"#d4d4d4"},keyword:{color:"#569CD6"},"keyword.module":{color:"#c586c0"},"keyword.control-flow":{color:"#c586c0"},function:{color:"#dcdcaa"},"function.maybe-class-name":{color:"#dcdcaa"},regex:{color:"#d16969"},important:{color:"#569cd6"},italic:{fontStyle:"italic"},"class-name":{color:"#4ec9b0"},"maybe-class-name":{color:"#4ec9b0"},console:{color:"#9cdcfe"},parameter:{color:"#9cdcfe"},interpolation:{color:"#9cdcfe"},"punctuation.interpolation-punctuation":{color:"#569cd6"},variable:{color:"#9cdcfe"},"imports.maybe-class-name":{color:"#9cdcfe"},"exports.maybe-class-name":{color:"#9cdcfe"},escape:{color:"#d7ba7d"},"tag.punctuation":{color:"#808080"},cdata:{color:"#808080"},"attr-value":{color:"#ce9178"},"attr-value.punctuation":{color:"#ce9178"},"attr-value.punctuation.attr-equals":{color:"#d4d4d4"},namespace:{color:"#4ec9b0"},'pre[class*="language-javascript"]':{color:"#9cdcfe"},'code[class*="language-javascript"]':{color:"#9cdcfe"},'pre[class*="language-jsx"]':{color:"#9cdcfe"},'code[class*="language-jsx"]':{color:"#9cdcfe"},'pre[class*="language-typescript"]':{color:"#9cdcfe"},'code[class*="language-typescript"]':{color:"#9cdcfe"},'pre[class*="language-tsx"]':{color:"#9cdcfe"},'code[class*="language-tsx"]':{color:"#9cdcfe"},'pre[class*="language-css"]':{color:"#ce9178"},'code[class*="language-css"]':{color:"#ce9178"},'pre[class*="language-html"]':{color:"#d4d4d4"},'code[class*="language-html"]':{color:"#d4d4d4"},".language-regex .token.anchor":{color:"#dcdcaa"},".language-html .token.punctuation":{color:"#808080"},'pre[class*="language-"] > code[class*="language-"]':{position:"relative",zIndex:"1"},".line-highlight.line-highlight":{background:"#f7ebc6",boxShadow:"inset 5px 0 0 #f7d87c",zIndex:"0"}},Bn=!1,Mn=h.lazy(()=>un(()=>import("./AgentBrowserStream-DvfGRprp.js"),__vite__mapDeps([0,1,2,3])));function Un({isThinking:o,toolVisible:e,activeToolName:t}){return n.jsx("div",{className:"mt-0.5",children:n.jsx(us,{children:o&&e&&t&&n.jsx(ve.div,{initial:{opacity:0,y:2},animate:{opacity:1,y:0},exit:{opacity:0,y:-2},transition:{duration:.18},className:"text-[10px] leading-3 font-light text-zinc-400/60",children:t},t)})})}const Ht=h.forwardRef(({event:o,isUser:e,onOptionClick:t},s)=>{const{t:r}=Ve();let i=o.data.text||o.data,a=[];if(!e&&typeof i=="string"&&i.includes(":::options")){const c=m=>{const S=m.search(/[\[{]/);if(S<0)return null;const N=[],_={"{":"}","[":"]"};let I=!1,E=!1;for(let A=S;A<m.length;A++){const M=m[A];if(I){if(E){E=!1;continue}if(M==="\\"){E=!0;continue}M==='"'&&(I=!1);continue}if(M==='"'){I=!0;continue}if(M==="{"||M==="["){N.push(_[M]);continue}if(M==="}"||M==="]"){if(N.length===0)return null;const T=N[N.length-1];if(M!==T)return null;if(N.pop(),N.length===0)return{jsonText:m.slice(S,A+1),rest:m.slice(A+1)}}}return null},l=[];let d=i;const g=/:::options\s*([\s\S]*?):::/g;let y=null,p=0;const C=[];for(;y=g.exec(i);){C.push(i.slice(p,y.index)),p=g.lastIndex;const m=String(y[1]??"").trim();if(m)try{const S=JSON.parse(m);Array.isArray(S)?l.push(...S):S&&l.push(S)}catch{}}if(p>0&&(C.push(i.slice(p)),d=C.join("").trimEnd()),l.length===0){const m=i.indexOf(":::options"),S=i.slice(0,m).trimEnd(),N=i.slice(m+10),_=c(N);if(_)try{const I=JSON.parse(_.jsonText);Array.isArray(I)?l.push(...I):I&&l.push(I),d=S}catch{}}l.length>0&&(a=l,i=d)}return n.jsxs(ve.div,{ref:s,initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.4,ease:"easeOut"},className:`chat-bubble-wrapper ${e?"user":"ai"}`,children:[!e&&n.jsx("div",{className:"chat-avatar ai",children:n.jsx(wt,{size:18})}),n.jsxs("div",{className:"chat-bubble backdrop-blur-md shadow-lg",style:{background:e?"var(--user-msg-bg)":"var(--joe-msg-bg)",color:e?"#ffffff":"var(--text-primary)",backdropFilter:"blur(12px)",border:"1px solid var(--border-color)"},children:[n.jsxs("div",{className:"chat-bubble-header",children:[n.jsx("span",{className:"chat-bubble-sender",children:e?r("you","You"):"JOE AI"}),!e&&n.jsxs("div",{className:"chat-bubble-actions",children:[n.jsx("button",{className:"chat-action-btn",title:r("copy","Copy"),onClick:()=>navigator.clipboard.writeText(i),children:n.jsx(Fs,{size:14})}),n.jsx("button",{className:"chat-action-btn",title:r("regenerate","Regenerate"),children:n.jsx(_s,{size:14})})]})]}),n.jsx("div",{className:"chat-bubble-content",children:e?n.jsx("div",{style:{whiteSpace:"pre-wrap"},children:i}):n.jsxs(n.Fragment,{children:[n.jsx(fn,{components:{h1:({node:c,...l})=>n.jsx("h1",{className:"text-[var(--accent-secondary)] text-2xl mb-2 mt-2 border-b border-[var(--border-color)] pb-1",...l}),h2:({node:c,...l})=>n.jsx("h2",{className:"text-[var(--accent-primary)] text-xl mb-2 mt-4",...l}),h3:({node:c,...l})=>n.jsx("h3",{className:"text-[var(--neon-purple)] text-lg mb-2 mt-4",...l}),ul:({node:c,...l})=>n.jsx("ul",{className:"list-disc pl-6 mb-4",...l}),ol:({node:c,...l})=>n.jsx("ol",{className:"list-decimal pl-6 mb-4",...l}),li:({node:c,...l})=>n.jsx("li",{className:"mb-1 leading-relaxed",...l}),p:({node:c,...l})=>n.jsx("p",{className:"mb-4 leading-relaxed",...l}),blockquote:({node:c,...l})=>n.jsx("blockquote",{className:"border-l-4 border-[var(--accent-secondary)] bg-[var(--bg-secondary)] my-4 py-2 px-4 rounded",...l}),a:({node:c,...l})=>n.jsx("a",{...l,target:"_blank",rel:"noopener noreferrer",className:"text-[var(--accent-primary)] underline"}),code({node:c,inline:l,className:d,children:g,...y}){const p=/language-(\w+)/.exec(d||"");return!l&&p?n.jsx(pn,{style:Dn,language:p[1],PreTag:"div",...y,children:String(g).replace(/\n$/,"")}):n.jsx("code",{className:d,...y,style:l?{background:"rgba(255,255,255,0.1)",padding:"2px 4px",borderRadius:"3px"}:{display:"block",padding:"10px",background:"#1e1e1e",borderRadius:"4px",overflowX:"auto"},children:g})}},children:i||(typeof o.data=="string"?o.data:JSON.stringify(o.data))}),a.length>0&&n.jsx("div",{style:{display:"flex",gap:8,marginTop:16,flexWrap:"wrap",borderTop:"1px solid var(--border-color)",paddingTop:12},children:a.map((c,l)=>n.jsxs("button",{onClick:()=>t==null?void 0:t(c.query),style:{background:"rgba(255,255,255,0.05)",border:"1px solid var(--border-color)",borderRadius:20,padding:"6px 14px",color:"var(--text-secondary)",fontSize:13,cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",gap:6},onMouseEnter:d=>d.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseLeave:d=>d.currentTarget.style.background="rgba(255,255,255,0.05)",children:[n.jsx("span",{style:{opacity:.7},children:"✨"})," ",c.label]},l))})]})})]}),e&&n.jsx("div",{className:"chat-avatar user",children:n.jsx(Ds,{size:18})})]})});function Jt({sessionId:o,sessionKind:e="chat",browserSessionId:t=null,onSessionCreated:s,onPreviewArtifact:r,onStepsUpdate:i,onMessagesUpdate:a}){const{t:c}=Ve(),[l,d]=h.useState(""),[g,y]=h.useState([]),[p,C]=h.useState(!1),[m,S]=h.useState([]),[N,_]=h.useState(null),[I,E]=h.useState(!1),[A,M]=h.useState(!1),[T,q]=h.useState(!1),[P,$]=h.useState(!1),[re,V]=h.useState("idle"),[Y,xe]=h.useState(!1),[X,ne]=h.useState(null),[fe,be]=h.useState(!1),[Ce,ie]=h.useState([]),pe=h.useRef(null);h.useRef(window.speechSynthesis);const ae=h.useRef(null),ke=h.useRef(),Ie=h.useRef(null),Re=h.useRef(null),Ke=h.useRef(null),Se=h.useRef(!0),x=h.useRef(null),v=h.useRef({}),F=h.useRef(null),le=h.useRef(0),he=h.useRef(void 0),Nt=h.useRef(0),we=h.useRef(null),Ct=h.useRef(Y),It=h.useRef(fe),Rt=h.useRef(X),[ys,it]=h.useState(!1),[ee,Ne]=h.useState({openai:{name:"OpenAI",apiKey:"",isConnected:!1,model:"gpt-4o"},anthropic:{name:"Anthropic",apiKey:"",isConnected:!1,model:"claude-3-opus-20240229"},gemini:{name:"Google Gemini",apiKey:"",isConnected:!1,model:"gemini-pro"},grok:{name:"xAI (Grok)",apiKey:"",isConnected:!1,baseUrl:"https://api.x.ai/v1",model:"grok-beta"}}),[U,ot]=h.useState("openai"),[Ot,bs]=h.useState({}),[fr,We]=h.useState(null),He=h.useMemo(()=>{var H,k,B,D,se,J,de,ze,Fe,At,zt,Ft;const u=new Map,f=[],b=[],j=[],R=new Set,L=[],oe=m.map((w,ge)=>({e:w,idx:ge,seq:typeof(w==null?void 0:w.seq)=="number"?w.seq:Number.POSITIVE_INFINITY,ts:typeof(w==null?void 0:w.ts)=="number"?w.ts:ge})).sort((w,ge)=>w.seq-ge.seq||w.ts-ge.ts||w.idx-ge.idx),Q=(w,ge)=>(u.has(w)||(u.set(w,{...ge,key:w}),f.push(w)),u.get(w)),K=new Map,O=new Map;for(const{e:w}of oe){const ge=typeof(w==null?void 0:w.runId)=="string"?w.runId:typeof((H=w==null?void 0:w.data)==null?void 0:H.runId)=="string"?w.data.runId:void 0;if((w.type==="user_input"||w.type==="text"||w.type==="step_started"||w.type==="step_progress"||w.type==="step_done"||w.type==="step_failed"||w.type==="evidence_added"||w.type==="artifact_created"||w.type==="approval_required"||w.type==="approval_result"||w.type==="run_finished"||w.type==="run_completed")&&L.push({type:w.type,data:w.data,duration:w.duration}),w.type==="step_started"&&((k=w.data)!=null&&k.name)){const ye=String(w.data.name),me=`${ge||""}::${ye}`,Pe=(K.get(me)||0)+1;K.set(me,Pe);const _e=`${me}::${Pe}`,De=O.get(me)||[];De.push(_e),O.set(me,De);const ue=Q(_e,{name:ye,status:"running",runId:ge});ue.status="running",typeof(w==null?void 0:w.ts)=="number"&&(ue.startedAt=w.ts),((B=w.data)==null?void 0:B.input)!=null&&ue.input==null&&(ue.input=w.data.input)}if((w.type==="step_done"||w.type==="step_failed")&&((D=w.data)!=null&&D.name)){const ye=String(w.data.name),me=`${ge||""}::${ye}`,Pe=O.get(me)||[],_e=Pe.pop();Pe.length?O.set(me,Pe):O.delete(me);const De=_e||`${me}::${(K.get(me)||0)+1}`;_e||K.set(me,Number(De.split("::").pop())||(K.get(me)||0)+1);const ue=Q(De,{name:ye,status:"running",runId:ge});ue.status=w.type==="step_done"?"done":"failed",typeof w.duration=="number"?ue.duration=w.duration:typeof ue.startedAt=="number"&&typeof(w==null?void 0:w.ts)=="number"&&(ue.duration=w.ts-ue.startedAt),(se=w.data)!=null&&se.plan&&(ue.plan=w.data.plan),(J=w.data)!=null&&J.result&&(ue.result=w.data.result,w.data.result.ok||(ue.error=w.data.result.error||w.data.result.message)),w.type==="step_failed"&&!ue.error&&(ue.error=(de=w.data)==null?void 0:de.error)}if(w.type==="evidence_added"&&String(((ze=w.data)==null?void 0:ze.kind)||"")==="log"&&typeof((Fe=w.data)==null?void 0:Fe.text)=="string"&&b.push(w.data.text),w.type==="artifact_created"){const ye=typeof((At=w.data)==null?void 0:At.href)=="string"?w.data.href:"";ye&&!R.has(ye)&&(R.add(ye),j.push({name:String(((zt=w.data)==null?void 0:zt.name)||"artifact"),href:ye,kind:(Ft=w.data)==null?void 0:Ft.kind}))}}const G=f.map(w=>u.get(w)).filter(Boolean),te=w=>w.startsWith("thinking_step_")?`Plan #${w.replace("thinking_step_","")}`:w.startsWith("execute:")?`Execute: ${w.slice(8)}`:w;return{steps:G.map(w=>({...w,displayName:te(String(w.name||""))})),logs:b,artifacts:j,timeline:L}},[m]);h.useEffect(()=>{const u=f=>{const b=f==null?void 0:f.detail,j=typeof(b==null?void 0:b.text)=="string"?b.text:"";j&&d(R=>R?`${R}
${j}`:j)};return window.addEventListener("joe:prefill",u),()=>window.removeEventListener("joe:prefill",u)},[]),h.useEffect(()=>{try{const u=localStorage.getItem("ai_providers");if(u){const b=JSON.parse(u);Ne(j=>{const R={...j};return Object.keys(b).forEach(L=>{R[L]&&(R[L]={...R[L],...b[L]})}),R})}const f=localStorage.getItem("active_provider");f&&ee[f]&&ot(f)}catch(u){console.error("Failed to load providers settings",u)}},[]),h.useEffect(()=>{localStorage.setItem("ai_providers",JSON.stringify(ee))},[ee]),h.useEffect(()=>{localStorage.setItem("active_provider",U)},[U]);const at=(u="auto")=>{var b;const f=Re.current;if(!f){(b=Ie.current)==null||b.scrollIntoView({behavior:u});return}x.current!=null&&(cancelAnimationFrame(x.current),x.current=null),x.current=requestAnimationFrame(()=>{u==="smooth"?f.scrollTo({top:f.scrollHeight,behavior:u}):f.scrollTop=f.scrollHeight})},ws=()=>{const u=Re.current;if(!u){Se.current=!0;return}const f=u.scrollHeight-u.scrollTop-u.clientHeight;Se.current=f<120};h.useEffect(()=>{Se.current=!0,at("auto")},[o,e]),h.useEffect(()=>{const u=Re.current;if(!u)return;const f=()=>ws();return u.addEventListener("scroll",f,{passive:!0}),()=>u.removeEventListener("scroll",f)},[]),h.useEffect(()=>{const u=Ke.current;if(!u||typeof ResizeObserver>"u")return;const f=new ResizeObserver(()=>{Se.current&&at("auto")});return f.observe(u),()=>f.disconnect()},[]),h.useEffect(()=>()=>{x.current!=null&&cancelAnimationFrame(x.current)},[]),h.useEffect(()=>{if(Se.current&&at("auto"),i&&i(He.steps),a&&a(m),T&&m.length>0){const u=m[m.length-1];u.type==="text"&&u.data.text&&Et(u.data.text)}},[m,He.steps,T,a,i,Y]);const Et=async u=>{if(!T)return;lt(),$(!0);try{const R=localStorage.getItem("token");if(R){const L=await fetch(`${Z}/audio/speech`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${R}`},body:JSON.stringify({text:u,voice:"onyx"})});if(L.ok){const oe=await L.blob(),Q=URL.createObjectURL(oe),K=new Audio(Q);K.onended=()=>$(!1),K.onerror=()=>$(!1),K.play(),window.currentAudio=K;return}}}catch(R){console.warn("Backend TTS failed, falling back to browser",R)}const f=new SpeechSynthesisUtterance(u),b=/[\u0600-\u06FF]/.test(u);f.lang=b?"ar-SA":"en-US";const j=window.speechSynthesis.getVoices();if(b){const R=j.find(L=>L.lang.includes("ar")&&L.name.includes("Google"))||j.find(L=>L.lang.includes("ar"));R&&(f.voice=R)}f.onstart=()=>$(!0),f.onend=()=>$(!1),f.onerror=()=>$(!1),window.speechSynthesis.speak(f)},lt=()=>{window.speechSynthesis.cancel(),window.currentAudio&&(window.currentAudio.pause(),window.currentAudio=null),$(!1)};h.useEffect(()=>(window.speechSynthesis.getVoices(),window.speechSynthesis.onvoiceschanged=()=>{window.speechSynthesis.getVoices()},()=>{lt()}),[]),h.useEffect(()=>{const u=window.SpeechRecognition||window.webkitSpeechRecognition;if(u){const f=new u;f.continuous=!1,f.interimResults=!1,f.lang="ar-SA",f.onstart=()=>M(!0),f.onend=()=>M(!1),f.onresult=b=>{const j=b.results[0][0].transcript;d(R=>R+(R?" ":"")+j)},pe.current=f}},[]);const vs=()=>{if(!pe.current){alert("التعرف الصوتي غير مدعوم في هذا المتصفح. يرجى استخدام Chrome.");return}A?pe.current.stop():pe.current.start()},Ee=()=>{we.current!=null&&(window.clearTimeout(we.current),we.current=null)};h.useEffect(()=>{Ct.current=Y},[Y]),h.useEffect(()=>{It.current=fe},[fe]),h.useEffect(()=>{Rt.current=X},[X]);const Je=u=>{const f=String(u||"").trim();f&&(we.current!=null&&(window.clearTimeout(we.current),we.current=null),V("thinking"),xe(!0),ne(f),be(!0),Nt.current=Date.now())},ct=()=>{const u=Date.now()-Nt.current,f=Math.max(250-u,0);we.current!=null&&window.clearTimeout(we.current);const b=f+250;return we.current=window.setTimeout(()=>{we.current=null,be(!1),window.setTimeout(()=>{ne(null),xe(!1),V("idle"),ie([])},250)},f),b};h.useEffect(()=>(Lt(),()=>{ae.current&&ae.current.close(),ke.current&&window.clearTimeout(ke.current),Ee()}),[]);function Lt(){try{if(ae.current){if(ae.current.readyState===WebSocket.OPEN)return;try{ae.current.close()}catch{}}const u=Fn,f=`${Z.replace(/^http/,"ws")}/ws`,b=L=>{var oe,Q,K,O,G,te,W,H;try{const k=JSON.parse(L.data);if(typeof(k==null?void 0:k.seq)=="number"&&Number.isFinite(k.seq)&&k.seq>le.current&&(le.current=k.seq),typeof(k==null?void 0:k.runId)=="string"&&k.runId.trim()&&We(k.runId.trim()),k.type==="user_input"&&(Ee(),xe(!0),ne(null),be(!1),ie([])),k.type==="artifact_created"){const B=(oe=k.data)==null?void 0:oe.kind,D=(Q=k.data)==null?void 0:Q.href;if(B==="browser_stream"||typeof D=="string"&&(/^wss?:\/\//i.test(D)||/^\/browser\/ws\//i.test(D))&&/\/ws\//i.test(D)){try{const J="http://dummy.com",ze=new URL(D,J).pathname.split("/").filter(Boolean),Fe=ze[ze.length-1];Fe&&window.dispatchEvent(new CustomEvent("joe:browser_attached",{detail:{sessionId:Fe,wsUrl:D}}))}catch(J){console.error("Failed to parse browser stream artifact",J)}if(e==="agent"&&t)return}}if(k.type==="approval_required"){const B=k.data||{},{id:D,risk:se,action:J}=B,de=typeof(B==null?void 0:B.runId)=="string"?B.runId:typeof(k==null?void 0:k.runId)=="string"?k.runId:"";D&&_({id:D,runId:de,risk:se,action:J})}if(k.type==="step_started"){const B=typeof(k==null?void 0:k.runId)=="string"?k.runId:typeof((K=k==null?void 0:k.data)==null?void 0:K.runId)=="string"?k.data.runId:"",D=String(((O=k==null?void 0:k.data)==null?void 0:O.name)||"");if(D&&(v.current[`${B}:${D}`]=Date.now()),D==="plan")Je("خطة"),ie(se=>[...se,"خطة"].slice(-4));else if(D.startsWith("thinking_step_")){const se=D.replace("thinking_step_","").trim(),J=se?`خطة #${se}`:"خطة";Je(J),ie(de=>[...de,J].slice(-4))}else D.startsWith("execute:")?Je(D.slice(8)):D&&Je(D)}if(k.type==="step_done"){const B=typeof(k==null?void 0:k.runId)=="string"?k.runId:typeof((G=k==null?void 0:k.data)==null?void 0:G.runId)=="string"?k.data.runId:"",D=String(((te=k==null?void 0:k.data)==null?void 0:te.name)||""),se=v.current[`${B}:${D}`];if(se&&(k.duration=Date.now()-se,delete v.current[`${B}:${D}`]),D==="execute:browser_open"&&((H=(W=k.data)==null?void 0:W.result)!=null&&H.ok)){const J=k.data.result.output;J!=null&&J.sessionId&&(J!=null&&J.wsUrl)&&window.dispatchEvent(new CustomEvent("joe:browser_attached",{detail:{sessionId:J.sessionId,wsUrl:J.wsUrl}}))}ct()}if(k.type==="text"){const B=typeof(k==null?void 0:k.id)=="string"?k.id:"";if(B.startsWith("system_prompt:"))return;const se=Ct.current||It.current||Rt.current!=null?ct():0;window.setTimeout(()=>{S(J=>B&&J.some(de=>typeof(de==null?void 0:de.id)=="string"&&de.id===B)?J:[...J,k]);try{let J=k.data;if(typeof J=="string"&&(J.startsWith("{")||J.startsWith("["))){const de=JSON.parse(J);J=de.text||de.output||J}Et(String(J))}catch{}},se);return}if(k.type==="run_finished"&&ct(),!Bn&&["step_started","step_progress","step_done","step_failed","evidence_added"].includes(k.type))return;["step_started","step_progress","step_done","step_failed","evidence_added","artifact_created","approval_required","approval_result","run_finished","run_completed","user_input"].includes(k.type)&&S(B=>{const D=typeof(k==null?void 0:k.id)=="string"?k.id:"";return D&&B.some(se=>typeof(se==null?void 0:se.id)=="string"&&se.id===D)?B:[...B,k]})}catch(k){console.error("WS parse error:",k)}},j=(L,oe)=>{L.onopen=()=>{ae.current===L&&E(!0)},L.onmessage=b,L.onclose=()=>{if(ae.current!==L)return;E(!1);const Q=(L==null?void 0:L.__triedFallback)===!0;if(oe&&!Q&&u!==f)try{const K=new WebSocket(f);K.__triedFallback=!0,ae.current=K,j(K,!1);return}catch{}ke.current=window.setTimeout(()=>Lt(),2e3)},L.onerror=()=>{ae.current===L&&E(!1)}},R=new WebSocket(u);ae.current=R,j(R,!0)}catch(u){console.error("WS connect failed:",u),E(!1)}}h.useEffect(()=>{const u=he.current;if(he.current=o,!o){S([]),We(null),_(null),Ee(),V("idle"),ne(null);return}if(u&&u!==o){S([]),We(null),_(null),Ee(),V("idle"),ne(null),Pt(o);return}!u&&m.length===0&&Pt(o)},[o]);async function Pt(u){try{const f=localStorage.getItem("token"),b=await fetch(`${Z}/sessions/${u}/history`,{headers:f?{Authorization:`Bearer ${f}`}:{}});if(b.ok){const j=await b.json();Array.isArray(j.events)&&S(j.events)}}catch(f){console.error("Failed to load history",f)}}async function js(u){var b;if(!((b=u.target.files)!=null&&b.length))return;const f=u.target.files[0];C(!0);try{const j=localStorage.getItem("token"),R=new FormData;R.append("file",f),o&&R.append("sessionId",o);const L=await fetch(`${Z}/files/upload`,{method:"POST",headers:{...j?{Authorization:`Bearer ${j}`}:{}},body:R});if(L.ok){const oe=await L.json();y(Q=>[...Q,{id:oe.file.id,name:oe.file.originalName}])}else alert(c("uploadFailed")||"Upload failed")}catch(j){console.error(j),alert(c("uploadError")||"Upload error")}finally{C(!1),F.current&&(F.current.value="")}}async function dt(u){var oe,Q,K;const f=u||l;if(!f.trim())return;Ee(),V("thinking"),ne(null),ie([]);const b=O=>{const G=String(O||"").trim();if(!G)return!1;if(/https?:\/\/[^\s"'<>]+/i.test(G)||/(\b(browser|web)\b|متصفح|داخل المتصفح)/i.test(G))return!0;const H=/(افتح|افتحي|افتحوا|اذهب|زيارة|open|go to|visit)/i.test(G),k=/(github|جيتهاب|كتهاب|كيتهاب)/i.test(G),B=/(كود|code|repo|repository|مستودع|ملفات|files|اختبر|تحقق|راجع|audit|lint|build|typecheck|تحليل)/i.test(G);if(H&&k&&B)return!1;const D=/(file|folder|directory|ملف|مجلد|مسار|path|terminal|command|أمر|ترمينال)/i.test(G);return H&&D?!1:!!(H||/(youtube|يوتيوب|google|جوجل|facebook|فيسبوك|x\.com|twitter|تويتر|instagram|انستغرام)/i.test(G))},j=async O=>await new Promise((G,te)=>{const H=k=>{const B=(k==null?void 0:k.detail)||{},D=String((B==null?void 0:B.sessionId)||"").trim(),se=typeof(B==null?void 0:B.wsUrl)=="string"?B.wsUrl:void 0;D&&(window.removeEventListener("joe:browser_opened",H),G({sessionId:D,wsUrl:se}))};window.addEventListener("joe:browser_opened",H),window.dispatchEvent(new CustomEvent("joe:browser_open_request",{detail:{url:O}})),window.setTimeout(()=>{window.removeEventListener("joe:browser_opened",H),te(new Error("browser_open_timeout"))},2e4)}),R=Date.now().toString();S(O=>[...O,{type:"user_input",data:f,id:R,ts:Date.now(),seq:le.current+.1}]),u||d(""),y([]);const L=localStorage.getItem("token");try{let O=t;if(e==="agent"&&!O&&b(f)){const H=f.match(/https?:\/\/[^\s"'<>]+/i),k=H==null?void 0:H[0],B=/youtube|يوتيوب/i.test(f),D=/(github|جيتهاب|كتهاب|كيتهاب)/i.test(f);O=(await j(k||(B?"https://www.youtube.com":D?"https://github.com":"https://www.google.com"))).sessionId}const G=await fetch(`${Z}/runs/start`,{method:"POST",headers:{"Content-Type":"application/json",...L?{Authorization:`Bearer ${L}`}:{}},body:JSON.stringify({text:f,sessionId:o,sessionKind:e,...e==="agent"&&O?{browserSessionId:O}:{},fileIds:g.map(H=>H.id),provider:U,apiKey:(oe=ee[U])==null?void 0:oe.apiKey,baseUrl:(Q=ee[U])==null?void 0:Q.baseUrl,model:(K=ee[U])==null?void 0:K.model})}),te=await G.text();let W=null;try{W=te?JSON.parse(te):null}catch{W=null}if(!G.ok){const H=(W==null?void 0:W.error)||te||`HTTP ${G.status}`;throw new Error(String(H).slice(0,500))}if(typeof(W==null?void 0:W.systemPrompt)=="string"&&W.systemPrompt.trim()&&typeof(W==null?void 0:W.systemPromptId)=="string"&&W.systemPromptId.trim()){const H=W.systemPromptId.trim(),k=W.systemPrompt;S(B=>B.some(D=>typeof(D==null?void 0:D.id)=="string"&&D.id===H)?B:[...B,{type:"text",id:H,data:k,ts:Date.now()}])}if(typeof(W==null?void 0:W.runId)=="string"&&W.runId.trim()&&We(W.runId.trim()),W.sessionId&&!o&&s&&s(W.sessionId),!I&&(W!=null&&W.result)){const H=W.result;if(H!=null&&H.output){const k=typeof H.output=="string"?H.output:JSON.stringify(H.output);S(B=>[...B,{type:"text",data:k}])}}}catch(O){console.error(O);const G=String((O==null?void 0:O.message)||O||"").trim(),te=G?`${c("error")}: ${G}`:c("error");S(W=>[...W,{type:"error",data:te}]),u||d(f),Ee(),V("idle"),ne(null)}}async function Tt(u){if(!N)return;const f=localStorage.getItem("token");await fetch(`${Z}/approvals/${N.id}/decision`,{method:"POST",headers:{"Content-Type":"application/json",...f?{Authorization:`Bearer ${f}`}:{}},body:JSON.stringify({decision:u})}),_(null)}const Ss=async u=>{const f=ee[u];Ne(j=>({...j,[u]:{...j[u],isVerifying:!0,lastError:void 0}}));const b=localStorage.getItem("token");try{const j=await fetch(`${Z}/runs/verify`,{method:"POST",headers:{"Content-Type":"application/json",...b?{Authorization:`Bearer ${b}`}:{}},body:JSON.stringify({provider:u,apiKey:f.apiKey,baseUrl:f.baseUrl,model:f.model})}),R=await j.json();if(j.ok)Ne(L=>({...L,[u]:{...L[u],isVerifying:!1,isConnected:!0,lastError:void 0}})),ot(u);else throw new Error(R.error||"Connection failed")}catch(j){Ne(R=>({...R,[u]:{...R[u],isVerifying:!1,isConnected:!1,lastError:j.message}}))}},ks=u=>{confirm("Are you sure you want to remove the API key?")&&Ne(f=>({...f,[u]:{...f[u],apiKey:"",isConnected:!1}}))},[pr,Ns]=h.useState({}),[$t,Cs]=h.useState({}),[gr,hr]=h.useState({}),ut=u=>{var b;const f=typeof(u==null?void 0:u.runId)=="string"?u.runId:typeof((b=u==null?void 0:u.data)==null?void 0:b.runId)=="string"?u.data.runId:"";return f&&f.trim()?f.trim():"no-run"},Le=h.useMemo(()=>m.map((f,b)=>{const j=typeof(f==null?void 0:f.ts)=="number"?f.ts:b,R=typeof(f==null?void 0:f.seq)=="number"?f.seq:void 0,L=typeof(f==null?void 0:f.id)=="string"&&f.id.startsWith("system_prompt:");return{e:f,idx:b,ts:j,seq:R,isSystemPrompt:L}}).sort((f,b)=>{if(f.isSystemPrompt&&!b.isSystemPrompt)return-1;if(!f.isSystemPrompt&&b.isSystemPrompt)return 1;const j=typeof f.seq=="number"&&Number.isFinite(f.seq),R=typeof b.seq=="number"&&Number.isFinite(b.seq);return j&&R?f.seq-b.seq||f.ts-b.ts||f.idx-b.idx:f.ts-b.ts||f.idx-b.idx}),[m]),ft=h.useMemo(()=>{const u=new Map;for(const f of He.steps||[]){const b=typeof(f==null?void 0:f.runId)=="string"&&f.runId.trim()?f.runId.trim():"no-run";u.has(b)||u.set(b,[]),u.get(b).push(f)}return u},[He.steps]);h.useMemo(()=>{var f,b;const u=new Map;for(const{e:j}of Le){if((j==null?void 0:j.type)!=="evidence_added"||String(((f=j==null?void 0:j.data)==null?void 0:f.kind)||"")!=="log"||typeof((b=j==null?void 0:j.data)==null?void 0:b.text)!="string")continue;const R=ut(j);u.has(R)||u.set(R,[]),u.get(R).push(j.data.text)}return u},[Le]);const pt=h.useMemo(()=>{const u=new Map;for(const{e:f}of Le){const b=String((f==null?void 0:f.type)||"");if(b!=="run_finished"&&b!=="run_completed")continue;const j=ut(f);u.set(j,!0)}return u},[Le]),gt=h.useMemo(()=>{const u=new Set;for(const b of ft.keys())u.add(b);for(const b of pt.keys())u.add(b);const f=new Map;for(const b of u){const j=ft.get(b)||[],R=pt.get(b)===!0,L=j.some(O=>(O==null?void 0:O.status)==="running"),oe=j.some(O=>(O==null?void 0:O.status)==="failed"),Q=j.length>0&&j.every(O=>(O==null?void 0:O.status)!=="running"),K=L?"running":oe?"failed":R||Q?"done":"idle";f.set(b,{status:K,terminal:R})}return f},[ft,pt]);h.useEffect(()=>{Ns(u=>{let f=!1;const b={...u};for(const[j,R]of gt.entries()){const L=$t[j]||"auto";R.status==="running"&&L!=="manual"&&(b[j]||(b[j]=!0,f=!0))}return f?b:u}),Cs(u=>{let f=!1;const b={...u};for(const[j,R]of gt.entries()){const L=b[j]||"auto";R.status==="running"&&L!=="manual"&&b[j]!=="auto"&&(b[j]="auto",f=!0),R.terminal&&L!=="manual"&&b[j]!=="auto"&&(b[j]="auto",f=!0)}return f?b:u})},[gt,$t]);const Is=u=>{let f=typeof u=="string"?u:u&&typeof u=="object"&&typeof u.text=="string"?u.text:String(u??"");if(f=f.replace(/\r\n/g,`
`),!f.trim())return"";const b=f.toLowerCase(),j=["file_write","file_read","file_edit","shell_execute","web_search","knowledge_search","grep_search","read_file_tree","scaffold_project","install_dependencies","check_syntax","image_generate","browser_"],R=j.reduce((Q,K)=>Q+(b.includes(K)?1:0),0);return R>=2||/(\bplan\s*#\d+\b)/i.test(f)&&/\b\d+(\.\d+)?s\b/.test(f)&&R>=1||/\bLog\b/.test(f)&&R>=1||/\[20\d\d-\d\d-\d\dT/.test(f)&&R>=1?f.split(`
`).map(Q=>Q.trimEnd()).filter(Q=>{const K=Q.trim();if(!K)return!1;const O=K.toLowerCase();return!(j.some(G=>O.includes(G))||/^\d+(\.\d+)?s\b/i.test(K)||/\bplan\s*#\d+\b/i.test(K)||/\bLog\b/.test(K)||/\[20\d\d-\d\d-\d\dT/.test(K)||/^تم إنهاء التنفيذ\b/.test(K))}).join(`
`).trim():f},Rs=h.useMemo(()=>{const u=[],f=new Set;for(const{e:b,idx:j}of Le){const R=String((b==null?void 0:b.type)||"");if(R==="step_started"||R==="step_progress"||R==="step_done"||R==="step_failed"||R==="evidence_added"){const L=ut(b);f.has(L)||(f.add(L),u.push({kind:"activity",key:`activity:${L}:${j}`,runId:L}));continue}R==="user_input"?u.push({kind:"user",key:`user:${j}`,e:b,idx:j}):R==="text"?u.push({kind:"text",key:`text:${j}`,e:b,idx:j}):R==="error"?u.push({kind:"error",key:`error:${j}`,e:b,idx:j}):R==="artifact_created"&&u.push({kind:"artifact",key:`artifact:${j}`,e:b,idx:j})}return u},[Le]);return n.jsxs("div",{className:"composer",children:[n.jsx("div",{className:"events",ref:Re,children:n.jsxs("div",{className:"events-content",ref:Ke,children:[m.length===0&&n.jsxs("div",{className:"empty-state",children:[n.jsx("div",{className:"empty-state-logo-ring",children:n.jsx("span",{className:"empty-state-logo-text",children:"J"})}),n.jsx("h2",{className:"empty-state-title",children:c("welcomeTitle","How can I help you today?")}),n.jsxs("div",{className:"empty-state-suggestions",children:[n.jsxs("button",{className:"suggestion-card",onClick:()=>d("Write a React component for a login form"),children:[n.jsx("div",{className:"suggestion-icon",children:n.jsx(_t,{size:20})}),n.jsx("div",{className:"suggestion-text",children:"Create a Login Form"})]}),n.jsxs("button",{className:"suggestion-card",onClick:()=>d("Explain how useEffect works"),children:[n.jsx("div",{className:"suggestion-icon",children:n.jsx(yt,{size:20})}),n.jsx("div",{className:"suggestion-text",children:"Explain React Hooks"})]}),n.jsxs("button",{className:"suggestion-card",onClick:()=>d("Analyze this project structure"),children:[n.jsx("div",{className:"suggestion-icon",children:n.jsx(ds,{size:20})}),n.jsx("div",{className:"suggestion-text",children:"Analyze Project"})]}),n.jsxs("button",{className:"suggestion-card",onClick:()=>d("Write a Python script to scrape a website"),children:[n.jsx("div",{className:"suggestion-icon",children:n.jsx(Bs,{size:20})}),n.jsx("div",{className:"suggestion-text",children:"Python Scripting"})]})]})]}),n.jsx(us,{mode:"popLayout",children:Rs.map(u=>{var f,b,j,R,L,oe,Q,K;if(u.kind==="activity")return null;if(u.kind==="user")return n.jsx(Ht,{event:u.e,isUser:!0},u.key);if(u.kind==="error")return n.jsx(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"message-row joe",children:n.jsxs("div",{className:"message-bubble error",dir:"auto",style:{color:"#ef4444",border:"1px solid #ef4444",background:"rgba(239, 68, 68, 0.1)"},children:["⚠️ ",(f=u.e)==null?void 0:f.data]})},u.key);if(u.kind==="text"){let O=(b=u.e)==null?void 0:b.data;try{if(typeof O=="string"&&(O.startsWith("{")||O.startsWith("["))){const te=JSON.parse(O);O=te.text||te.output||O}}catch{}const G=Is(O);return G?n.jsx(Ht,{event:{data:{text:G}},isUser:!1,onOptionClick:te=>dt(te)},u.key):null}if(u.kind==="artifact"){const O=u.e,G=(j=O==null?void 0:O.data)==null?void 0:j.kind,te=(R=O==null?void 0:O.data)==null?void 0:R.href;if((G==="browser_stream"||typeof te=="string"&&/^wss?:\/\//i.test(te)&&/\/ws\//i.test(te))&&te)return e==="agent"&&t?null:n.jsx(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"message-row joe",children:n.jsx("div",{className:"event-artifact",style:{padding:0},children:n.jsx(h.Suspense,{fallback:n.jsx("div",{style:{padding:12,fontSize:12,opacity:.7},children:"Loading Stream..."}),children:n.jsx(Mn,{wsUrl:te})})})},u.key);const H=/\.(png|jpg|jpeg|webp|gif)$/i.test(((L=O==null?void 0:O.data)==null?void 0:L.name)||"")||/\.(png|jpg|jpeg|webp|gif)$/i.test(((oe=O==null?void 0:O.data)==null?void 0:oe.href)||""),k=/\.(mp4|webm|mov)$/i.test(((Q=O==null?void 0:O.data)==null?void 0:Q.name)||"")||/\.(mp4|webm|mov)$/i.test(((K=O==null?void 0:O.data)==null?void 0:K.href)||"");return H?n.jsx(ve.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"message-row joe",children:n.jsxs("div",{className:"image-generation-frame",children:[n.jsx("div",{className:"scanline-overlay"}),n.jsx("img",{src:O.data.href,alt:O.data.name,className:"image-generation-img"})]})},u.key):n.jsx(ve.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"message-row joe",children:n.jsxs("div",{className:"event-artifact",children:[k?n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[n.jsx(Ms,{size:16,className:"artifact-icon"}),n.jsx("div",{className:"artifact-title",children:c("artifacts.video")})]}),n.jsx("video",{controls:!0,src:O.data.href,style:{width:"100%",borderRadius:8}})]}):n.jsx(n.Fragment,{children:n.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[n.jsx(_t,{size:20,className:"artifact-icon"}),n.jsxs("div",{className:"artifact-info",children:[n.jsx("div",{className:"artifact-title",children:c("artifacts.file")}),n.jsx("div",{className:"artifact-name",children:O.data.name})]})]})}),n.jsx("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end"},children:n.jsxs("a",{href:O.data.href,target:"_blank",rel:"noopener noreferrer",className:"artifact-link",children:[n.jsx(Us,{size:12})," ",c("artifacts.openNewWindow")]})})]})},u.key)}return null})}),Y&&n.jsx(ve.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"message-row joe",children:n.jsxs("div",{className:"px-3 py-2",dir:"auto",children:[n.jsx("div",{className:"text-[10px] leading-3 font-light text-zinc-400/65",children:"يفكّر…"}),n.jsx(Un,{isThinking:Y,toolVisible:fe,activeToolName:X}),Ce.length?n.jsx("div",{className:"mt-0.5 text-[10px] leading-3 font-light text-zinc-500/60",children:Ce.join(" › ")}):null]})}),n.jsx("div",{ref:Ie})]})}),N&&n.jsx("div",{className:"approval-modal",children:n.jsxs("div",{className:"approval-content",children:[n.jsx("h3",{children:c("approvalRequired")}),n.jsx("div",{className:"risk-badge",children:N.risk}),n.jsxs("p",{children:[c("action"),": ",N.action]}),n.jsxs("div",{className:"approval-actions",children:[n.jsx("button",{onClick:()=>Tt("denied"),className:"btn deny",children:c("deny")}),n.jsx("button",{onClick:()=>Tt("approved"),className:"btn approve",children:c("approve")})]})]})}),ys&&n.jsx("div",{className:"providers-modal-overlay",onClick:()=>it(!1),children:n.jsxs("div",{className:"providers-modal",onClick:u=>u.stopPropagation(),children:[n.jsxs("div",{className:"providers-left",children:[n.jsxs("h3",{style:{margin:"0 0 16px 0",fontSize:16,fontWeight:700,display:"flex",alignItems:"center",gap:8},children:[n.jsx(Dt,{size:18})," Providers"]}),n.jsx("div",{style:{display:"flex",flexDirection:"column",gap:4},children:Object.entries(ee).map(([u,f])=>n.jsxs("button",{onClick:()=>ot(u),style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderRadius:8,border:"none",background:U===u?"var(--bg-primary, var(--bg-card))":"transparent",color:U===u?"var(--text-primary)":"var(--text-muted)",cursor:"pointer",textAlign:"left",fontWeight:U===u?600:400,transition:"all 0.2s"},children:[n.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("span",{style:{width:8,height:8,borderRadius:"50%",background:f.isConnected?"#22c55e":f.apiKey?"#eab308":"#71717a",boxShadow:f.isConnected?"0 0 8px #22c55e":"none"}}),f.name.split(" ")[0]]}),U===u&&n.jsx(fs,{size:14})]},u))})]}),n.jsx("div",{className:"providers-right",children:ee[U]&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:24},children:[n.jsxs("div",{children:[n.jsx("h2",{style:{margin:0,fontSize:20},children:ee[U].name}),n.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",gap:6},children:[n.jsx("div",{style:{padding:"2px 8px",borderRadius:12,fontSize:11,fontWeight:600,background:ee[U].isConnected?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:ee[U].isConnected?"#22c55e":"#ef4444"},children:ee[U].isConnected?"CONNECTED":"DISCONNECTED"}),ee[U].isVerifying&&n.jsx(qe,{size:12,className:"spin"})]})]}),n.jsx("button",{onClick:()=>it(!1),style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},children:n.jsx(bt,{size:20})})]}),n.jsxs("div",{style:{flex:1},children:[n.jsxs("div",{style:{marginBottom:20},children:[n.jsx("label",{style:{display:"block",fontSize:13,fontWeight:500,marginBottom:8},children:"API Key"}),n.jsxs("div",{style:{position:"relative",display:"flex",gap:8},children:[n.jsxs("div",{style:{position:"relative",flex:1},children:[n.jsx("input",{type:Ot[U]?"text":"password",value:ee[U].apiKey,onChange:u=>Ne(f=>({...f,[U]:{...f[U],apiKey:u.target.value,isConnected:!1}})),placeholder:"sk-...",style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-secondary)",color:"var(--text-primary)",outline:"none",fontSize:14}}),n.jsx("button",{onClick:()=>bs(u=>({...u,[U]:!u[U]})),style:{position:"absolute",right:10,top:10,background:"none",border:"none",cursor:"pointer",opacity:.5},children:Ot[U]?n.jsx(ls,{size:16}):n.jsx(cs,{size:16})})]}),n.jsx("button",{onClick:()=>ks(U),title:"Clear Key",style:{padding:"0 12px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-secondary)",color:"#ef4444",cursor:"pointer"},children:n.jsx(Qe,{size:18})})]})]}),n.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:20},children:[n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:13,fontWeight:500,marginBottom:8},children:"Model ID"}),n.jsx("input",{type:"text",value:ee[U].model||"",onChange:u=>Ne(f=>({...f,[U]:{...f[U],model:u.target.value}})),placeholder:"gpt-4o",style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-secondary)",color:"var(--text-primary)",outline:"none",fontSize:14}})]}),U==="grok"&&n.jsxs("div",{children:[n.jsx("label",{style:{display:"block",fontSize:13,fontWeight:500,marginBottom:8},children:"Base URL"}),n.jsx("input",{type:"text",value:ee[U].baseUrl||"",onChange:u=>Ne(f=>({...f,[U]:{...f[U],baseUrl:u.target.value}})),placeholder:"https://api...",style:{width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-secondary)",color:"var(--text-primary)",outline:"none",fontSize:14}})]})]}),ee[U].lastError&&n.jsxs("div",{style:{padding:12,borderRadius:8,background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.2)",color:"#ef4444",fontSize:13,marginBottom:20,display:"flex",alignItems:"center",gap:8},children:[n.jsx(Vs,{size:16}),ee[U].lastError]})]}),n.jsx("div",{style:{display:"flex",gap:12,paddingTop:20,borderTop:"1px solid var(--border-color)"},children:n.jsx("button",{onClick:()=>Ss(U),disabled:ee[U].isVerifying,style:{flex:1,padding:"12px",borderRadius:8,border:"none",background:ee[U].isConnected?"#22c55e":"var(--accent-primary)",color:"#fff",fontSize:14,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8,opacity:ee[U].isVerifying?.7:1},children:ee[U].isVerifying?n.jsxs(n.Fragment,{children:[n.jsx(qe,{size:18,className:"spin"})," Verifying..."]}):ee[U].isConnected?n.jsxs(n.Fragment,{children:[n.jsx(Ks,{size:18})," Verified & Active"]}):n.jsxs(n.Fragment,{children:[n.jsx(yt,{size:18})," Connect & Activate"]})})})]})})]})}),g.length>0&&n.jsx("div",{className:"attached-files",children:g.map((u,f)=>n.jsxs("div",{className:"attached-file-chip",children:[n.jsx("span",{className:"file-name",children:u.name}),n.jsx("button",{onClick:()=>y(b=>b.filter((j,R)=>R!==f)),className:"remove-file-btn",children:n.jsx(bt,{size:12})})]},f))}),n.jsxs("div",{className:"input-area",children:[n.jsx("textarea",{value:l,onChange:u=>d(u.target.value),placeholder:c("inputPlaceholder"),dir:"auto",disabled:!!N,onKeyDown:u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),dt())}}),n.jsxs("div",{className:"input-actions",children:[n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("div",{style:{width:8,height:8,borderRadius:"50%",backgroundColor:I?"#22c55e":"#ef4444",boxShadow:I?"0 0 6px #22c55e":"none",transition:"all 0.3s"},title:c(I?"connected":"connecting")}),n.jsx("span",{style:{fontSize:12,color:"var(--text-muted)"},children:c(I?"connected":"connecting")})]}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("div",{style:{position:"relative"},children:n.jsx("button",{className:"provider-btn",onClick:()=>it(!0),title:"AI Providers",children:n.jsx(Dt,{size:20})})}),n.jsx("input",{type:"file",ref:F,onChange:js,style:{display:"none"}}),n.jsx("button",{className:"mic-button",onClick:()=>{var u;return(u=F.current)==null?void 0:u.click()},title:c("attachFile")||"Attach file",disabled:p,style:{background:"transparent",border:"none",cursor:"pointer",opacity:p?.5:1},children:p?n.jsx(qe,{size:20,className:"spin"}):n.jsx(Ws,{size:20})}),n.jsx("button",{className:`mic-button ${T?"active":""}`,onClick:()=>q(!T),title:"Voice Mode",style:{background:"transparent",border:"none",cursor:"pointer",color:T?"var(--accent-primary)":"inherit",position:"relative"},children:T?n.jsx(Bt,{size:20}):n.jsx(Hs,{size:20})}),n.jsx("button",{className:"send-button",onClick:()=>dt(),disabled:!l.trim()||!!N,title:c("send"),children:n.jsx(Js,{size:20})})]})]}),T&&n.jsxs("div",{style:{padding:10,background:"var(--bg-secondary)",borderTop:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"center",gap:16},children:[n.jsx("button",{className:`voice-btn ${A?"listening":""}`,onClick:vs,style:{width:50,height:50,borderRadius:"50%",border:"none",background:A?"#ef4444":"var(--accent-primary)",color:"#fff",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:A?"0 0 15px rgba(239, 68, 68, 0.5)":"none",transition:"all 0.3s"},children:A?n.jsx(qe,{className:"spin",size:24}):n.jsx(Bt,{size:24})}),n.jsxs("div",{style:{fontSize:14,fontWeight:500,display:"flex",flexDirection:"column",gap:4},children:[n.jsx("span",{children:A?"Listening...":"Tap to Speak"}),n.jsx("span",{style:{fontSize:10,opacity:.7},children:"Arabic (SA) / English (US)"})]}),n.jsx("button",{className:"icon-btn",title:"Stop Speaking",onClick:lt,disabled:!P,style:{marginLeft:"auto",opacity:P?1:.3},children:n.jsx(qs,{size:18})})]})]})]})}function mt({session:o,isActive:e,onSelect:t,onDelete:s,onPin:r,onShare:i}){const[a,c]=h.useState(!1),l=h.useRef(null);return h.useEffect(()=>{function d(g){l.current&&!l.current.contains(g.target)&&c(!1)}return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]),n.jsxs("div",{className:`session-item ${e?"active":""}`,children:[n.jsx("button",{className:"session-btn",onClick:t,children:n.jsxs("div",{className:"session-info",children:[n.jsxs("div",{className:"session-title",children:[o.isPinned&&n.jsx(Mt,{size:12,className:"pin-icon",fill:"currentColor"}),n.jsx("span",{children:o.title})]}),o.lastSnippet&&n.jsx("div",{className:"session-snippet",children:o.lastSnippet})]})}),n.jsx("button",{className:"menu-trigger",onClick:d=>{d.stopPropagation(),c(!a)},children:n.jsx(Gs,{size:16})}),a&&n.jsxs("div",{className:"session-menu",ref:l,children:[n.jsxs("button",{onClick:d=>{d.stopPropagation(),r(),c(!1)},children:[n.jsx(Mt,{size:14})," ",o.isPinned?"إلغاء التثبيت":"تثبيت"]}),n.jsxs("button",{onClick:d=>{d.stopPropagation(),i(),c(!1)},children:[n.jsx(Ys,{size:14})," مشاركة"]}),n.jsx("div",{className:"divider"}),n.jsxs("button",{className:"delete",onClick:d=>{d.stopPropagation(),s(),c(!1)},children:[n.jsx(Qe,{size:14})," حذف"]})]})]})}function Vn({sessionId:o,className:e,onClose:t}){const s=h.useRef(null),r=h.useRef(null),[i,a]=h.useState("connecting"),[c,l]=h.useState(""),[d,g]=h.useState({w:1280,h:800}),[y,p]=h.useState({x:0,y:0});h.useEffect(()=>{if(!o)return;const I=window.location.protocol==="https:"?"wss:":"ws:",E=Z.replace(/^https?:\/\//,""),A=localStorage.getItem("token"),M=`${I}//${E}/browser/ws/${o}?token=${A}`;console.log("BrowserView: Connecting to",M),a("connecting"),l("");const T=new WebSocket(M);return r.current=T,T.onopen=()=>{console.log("BrowserView: Connected"),a("connected")},T.onclose=q=>{console.log("BrowserView: Closed",q.code,q.reason),a("closed"),r.current=null},T.onerror=()=>{console.error("BrowserView: Error"),a("error"),l("Connection failed")},T.onmessage=q=>{try{const P=JSON.parse(q.data);if(P.type==="stream_start"||P.type==="state"){const $=P.viewport||(P.w&&P.h?{w:P.w,h:P.h}:null);$&&(g({w:$.w,h:$.h}),s.current&&(s.current.width=$.w,s.current.height=$.h))}P.type==="frame"&&P.jpegBase64&&C(P.jpegBase64),P.type==="cursor_move"&&p({x:P.x,y:P.y})}catch(P){console.error("BrowserView: Parse error",P)}},()=>{T.close()}},[o]);function C(I){const E=s.current;if(!E)return;const A=E.getContext("2d");if(!A)return;const M=new Image;M.onload=()=>{A.drawImage(M,0,0,E.width,E.height)},M.src="data:image/jpeg;base64,"+I}function m(I){var E;((E=r.current)==null?void 0:E.readyState)===WebSocket.OPEN&&r.current.send(JSON.stringify({type:"action",action:I}))}function S(I){if(!s.current)return;const E=s.current.getBoundingClientRect(),A=Math.round((I.clientX-E.left)*(d.w/E.width)),M=Math.round((I.clientY-E.top)*(d.h/E.height));m({type:"click",x:A,y:M})}function N(I){if(!s.current)return;const E=s.current.getBoundingClientRect(),A=Math.round((I.clientX-E.left)*(d.w/E.width)),M=Math.round((I.clientY-E.top)*(d.h/E.height));m({type:"mouseMove",x:A,y:M})}function _(I){I.key==="Enter"?m({type:"press",key:"Enter"}):I.key==="Backspace"?m({type:"press",key:"Backspace"}):I.key.length===1&&m({type:"type",text:I.key})}return n.jsxs("div",{className:`browser-view ${e||""}`,style:{width:"100%",height:"100%",position:"relative",background:"#000",overflow:"hidden"},children:[i!=="connected"&&n.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",background:"rgba(0,0,0,0.8)"},children:i==="connecting"?"Connecting...":i==="error"?`Error: ${c}`:"Disconnected"}),n.jsx("canvas",{ref:s,style:{width:"100%",height:"100%",objectFit:"contain"},onMouseDown:S,onMouseMove:N,tabIndex:0,onKeyDown:_})]})}function Kn({onSession:o,autoOpen:e,minimal:t,initialSession:s}){const[r,i]=h.useState("https://www.google.com"),[a,c]=h.useState((s==null?void 0:s.wsUrl)||null),[l,d]=h.useState((s==null?void 0:s.sessionId)||null),[g,y]=h.useState(!1),[p,C]=h.useState(null),m=h.useRef(!1);h.useEffect(()=>{s!=null&&s.wsUrl&&(c(s.wsUrl),d(s.sessionId))},[s]);async function S(N){var _,I,E,A,M;y(!0),C(null);try{const T=localStorage.getItem("token"),q=typeof N=="string"&&N.trim()?N.trim():r,$=await(await fetch(`${Z}/tools/browser_open/execute`,{method:"POST",headers:{"Content-Type":"application/json",...T?{Authorization:`Bearer ${T}`}:{}},body:JSON.stringify({url:q})})).json(),re=((_=$==null?void 0:$.output)==null?void 0:_.wsUrl)||((A=(E=(I=$==null?void 0:$.artifacts)==null?void 0:I.find)==null?void 0:E.call(I,xe=>(xe==null?void 0:xe.kind)==="browser_stream"))==null?void 0:A.href);if(!($!=null&&$.ok)||!re){c(null),d(null),C(String(($==null?void 0:$.error)||"فشل فتح المتصفح"));return}const V=String(((M=$==null?void 0:$.output)==null?void 0:M.sessionId)||""),Y=String(re);c(Y),d(V),V&&Y&&(o==null||o({sessionId:V,wsUrl:Y}),window.dispatchEvent(new CustomEvent("joe:browser_opened",{detail:{sessionId:V,wsUrl:Y}})))}catch(T){c(null),d(null),C(String((T==null?void 0:T.message)||T))}finally{y(!1)}}return h.useEffect(()=>{e&&(m.current||(m.current=!0,S()))},[e]),h.useEffect(()=>{const N=_=>{const I=(_==null?void 0:_.detail)||{},E=typeof(I==null?void 0:I.url)=="string"?I.url:void 0;typeof E=="string"&&E.trim()&&i(E.trim()),S(E)};return window.addEventListener("joe:browser_open_request",N),()=>window.removeEventListener("joe:browser_open_request",N)},[]),h.useEffect(()=>{const N=_=>{const I=(_==null?void 0:_.detail)||{},E=String((I==null?void 0:I.sessionId)||""),A=String((I==null?void 0:I.wsUrl)||"");E&&A&&(c(A),d(E),o==null||o({sessionId:E,wsUrl:A}))};return window.addEventListener("joe:browser_attached",N),()=>window.removeEventListener("joe:browser_attached",N)},[]),n.jsx("div",{className:"browser-app",style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:n.jsx("div",{style:{flex:1,overflow:"hidden",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",background:"#000"},children:l?n.jsx(Vn,{sessionId:l}):n.jsx("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",padding:16,color:"var(--text-secondary)"},dir:"auto",children:n.jsxs("div",{style:{textAlign:"center"},children:[p?n.jsx("div",{style:{color:"#ef4444",marginBottom:10},children:p}):null,n.jsx("div",{children:g?"...جاري فتح المتصفح":"سيتم فتح المتصفح تلقائياً عند الحاجة."})]})})})})}function Wn(){const[o,e]=h.useState([]),[t,s]=h.useState([]),[r,i]=h.useState([]),[a,c]=h.useState({}),[l,d]=h.useState(null),[g,y]=h.useState(null),[p,C]=h.useState(!0),[m,S]=h.useState("agent"),[N,_]=h.useState(""),[I,E]=h.useState(!1),[A,M]=h.useState([]),[T,q]=h.useState(!1),[P,$]=h.useState(null),[re,V]=h.useState(null),Y=nt();h.useEffect(()=>{const x=v=>{const F=(v==null?void 0:v.detail)||{};F.sessionId&&F.wsUrl&&(V({sessionId:F.sessionId,wsUrl:F.wsUrl}),$(F.sessionId),S("agent"))};return window.addEventListener("joe:browser_attached",x),()=>window.removeEventListener("joe:browser_attached",x)},[]);function xe(){d(null),_(""),M([])}async function X(){const x=localStorage.getItem("token");try{const v=await fetch(`${Z}/sessions?kind=chat`,{headers:{Authorization:x?`Bearer ${x}`:""}});if(v.status===401){localStorage.removeItem("token"),Y("/login");return}const le=((await v.json()).sessions||[]).map(he=>({...he,id:he.id||he._id}));e(le),!l&&le[0]&&d(le[0].id)}catch(v){console.error("Failed to load sessions",v)}}async function ne(){const x=localStorage.getItem("token");try{const v=await fetch(`${Z}/sessions?kind=agent`,{headers:{Authorization:x?`Bearer ${x}`:""}});if(v.status===401){localStorage.removeItem("token"),Y("/login");return}const le=((await v.json()).sessions||[]).map(he=>({...he,id:he.id||he._id}));s(le),!g&&le[0]&&y(le[0].id)}catch(v){console.error("Failed to load agent sessions",v)}}async function fe(){const x=localStorage.getItem("token");try{const v=await fetch(`${Z}/folders`,{headers:{Authorization:x?`Bearer ${x}`:""}});if(v.ok){const F=await v.json();i(F)}}catch(v){console.error("Failed to load folders",v)}}h.useEffect(()=>{X(),ne(),fe()},[]),h.useEffect(()=>{m==="agent"?(C(!1),t.length===0&&ne()):(C(!T),o.length===0&&X())},[m]),h.useEffect(()=>{var le;const x=window.matchMedia("(max-width: 900px)"),v=()=>{q(x.matches),C(!x.matches)};v();const F=()=>v();return typeof x.addEventListener=="function"?x.addEventListener("change",F):(le=x.addListener)==null||le.call(x,F),()=>{var he;typeof x.removeEventListener=="function"?x.removeEventListener("change",F):(he=x.removeListener)==null||he.call(x,F)}},[]);async function be(){const x=prompt("اسم المجلد الجديد:");if(!x)return;const v=localStorage.getItem("token");(await fetch(`${Z}/folders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:v?`Bearer ${v}`:""},body:JSON.stringify({name:x})})).ok&&await fe()}async function Ce(x){if(!confirm("هل أنت متأكد من حذف هذا المجلد؟ سيتم نقل الجلسات إلى القائمة الرئيسية."))return;const v=localStorage.getItem("token");await fetch(`${Z}/folders/${x}`,{method:"DELETE",headers:{Authorization:v?`Bearer ${v}`:""}}),await fe(),await X()}async function ie(x,v){const F=localStorage.getItem("token");await fetch(`${Z}/sessions/${x}/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:F?`Bearer ${F}`:""},body:JSON.stringify({folderId:v})}),await X()}async function pe(x,v){if(x===v||!confirm("Are you sure you want to merge these sessions? This cannot be undone."))return;const F=localStorage.getItem("token");(await fetch(`${Z}/sessions/merge`,{method:"POST",headers:{"Content-Type":"application/json",...F?{Authorization:`Bearer ${F}`}:{}},body:JSON.stringify({sourceId:x,targetId:v})})).ok&&(await X(),l===x&&d(v))}async function ae(x){if(!confirm("هل أنت متأكد من حذف هذه الجلسة؟"))return;const v=localStorage.getItem("token");await fetch(`${Z}/sessions/${x}`,{method:"DELETE",headers:{Authorization:v?`Bearer ${v}`:""}}),await X(),l===x&&d(null)}async function ke(x){if(!confirm("هل أنت متأكد من حذف هذه الجلسة؟"))return;const v=localStorage.getItem("token");await fetch(`${Z}/sessions/${x}`,{method:"DELETE",headers:{Authorization:v?`Bearer ${v}`:""}}),await ne(),g===x&&y(null)}async function Ie(){if(!confirm("هل أنت متأكد من حذف جميع الجلسات؟ لا يمكن التراجع عن هذا الإجراء."))return;const x=localStorage.getItem("token");await fetch(`${Z}/sessions`,{method:"DELETE",headers:{Authorization:x?`Bearer ${x}`:""}}),await X(),d(null)}async function Re(x,v){const F=localStorage.getItem("token");await fetch(`${Z}/sessions/${x}/pin`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:F?`Bearer ${F}`:""},body:JSON.stringify({isPinned:!v})}),await X()}async function Ke(x,v){const F=localStorage.getItem("token");await fetch(`${Z}/sessions/${x}/pin`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:F?`Bearer ${F}`:""},body:JSON.stringify({isPinned:!v})}),await ne()}function Se(x){alert("تم نسخ رابط الجلسة")}return h.useEffect(()=>{if(!N){E(!1),M([]);return}const x=setTimeout(async()=>{E(!0);const v=localStorage.getItem("token");try{const le=await(await fetch(`${Z}/sessions/search?q=${encodeURIComponent(N)}&kind=chat`,{headers:v?{Authorization:`Bearer ${v}`}:{}})).json();M(le.results||[])}catch(F){console.error(F)}},500);return()=>clearTimeout(x)},[N]),n.jsxs("div",{className:`joe-layout ${p?"sidebar-open":"sidebar-closed"}`,children:[m==="chat"&&p&&T&&n.jsx("div",{className:"sidebar-backdrop",onClick:()=>C(!1)}),m==="chat"&&p&&n.jsxs("aside",{className:"sidebar",children:[n.jsxs("div",{className:"sidebar-header",children:[n.jsxs("button",{className:"new-chat-btn",onClick:xe,children:[n.jsx("span",{children:"+"})," محادثة جديدة"]}),n.jsx("button",{className:"close-sidebar-btn",onClick:()=>C(!1),children:n.jsx(Xs,{size:20})})]}),n.jsx("div",{className:"search-box-container",style:{padding:"0 4px",marginBottom:16},children:n.jsxs("div",{className:"search-input-wrapper",children:[n.jsx(ds,{size:14,className:"search-icon"}),n.jsx("input",{type:"text",placeholder:"بحث في المحادثات...",value:N,onChange:x=>_(x.target.value),className:"search-input"})]})}),N?n.jsx("div",{className:"session-list",children:A.length===0?n.jsx("div",{style:{padding:16,textAlign:"center",color:"var(--text-muted)",fontSize:13},children:"لا توجد نتائج"}):A.map(x=>n.jsxs("button",{className:"search-result-item",onClick:()=>{d(x.sessionId),_(""),T&&C(!1)},children:[n.jsx("div",{className:"result-session-title",children:x.sessionTitle}),n.jsx("div",{className:"result-content",children:x.content}),n.jsx("div",{className:"result-date",children:new Date(x.createdAt).toLocaleDateString()})]},x.messageId))}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 8px",marginBottom:8},children:[n.jsx("div",{className:"section-title",style:{margin:0},children:"المجلدات"}),n.jsx("button",{onClick:be,style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-muted)"},title:"مجلد جديد",children:n.jsx(Qs,{size:16})})]}),n.jsxs("div",{className:"session-list",children:[r.map(x=>n.jsxs("div",{onDragOver:v=>{v.preventDefault(),v.dataTransfer.dropEffect="move",v.currentTarget.style.background="rgba(255,215,0,0.1)"},onDragLeave:v=>{v.currentTarget.style.background="transparent"},onDrop:v=>{v.preventDefault(),v.currentTarget.style.background="transparent";const F=v.dataTransfer.getData("sessionId");F&&ie(F,x._id)},children:[n.jsxs("div",{className:"folder-header",style:{display:"flex",alignItems:"center",padding:"8px",cursor:"pointer",color:"var(--text-secondary)"},onClick:()=>c(v=>({...v,[x._id]:!v[x._id]})),children:[a[x._id]?n.jsx(Zs,{size:14}):n.jsx(fs,{size:14}),n.jsx(en,{size:14,style:{margin:"0 8px",color:"var(--accent-primary)"}}),n.jsx("span",{style:{fontSize:13,flex:1},children:x.name}),n.jsx("button",{onClick:v=>{v.stopPropagation(),Ce(x._id)},style:{background:"none",border:"none",color:"var(--text-muted)",cursor:"pointer",opacity:.5},className:"folder-delete-btn",children:n.jsx(Qe,{size:12})})]}),a[x._id]&&n.jsxs("div",{style:{paddingRight:16},children:[o.filter(v=>v.folderId===x._id).map(v=>n.jsx("div",{draggable:!0,onDragStart:F=>{F.dataTransfer.setData("sessionId",v.id)},children:n.jsx(mt,{session:v,isActive:l===v.id,onSelect:()=>{d(v.id),T&&C(!1)},onDelete:()=>ae(v.id),onPin:()=>Re(v.id,!!v.isPinned),onShare:()=>Se(v.id)})},v.id)),o.filter(v=>v.folderId===x._id).length===0&&n.jsx("div",{style:{fontSize:11,color:"var(--text-muted)",padding:"4px 8px 8px"},children:"مجلد فارغ"})]})]},x._id)),n.jsx("div",{className:"section-title",style:{marginTop:16},onDragOver:x=>{x.preventDefault(),x.dataTransfer.dropEffect="move"},onDrop:x=>{x.preventDefault();const v=x.dataTransfer.getData("sessionId");v&&ie(v,null)},children:"جلسات أخرى"}),o.filter(x=>!x.folderId).map(x=>n.jsx("div",{draggable:!0,onDragStart:v=>{v.dataTransfer.setData("sessionId",x.id),v.dataTransfer.effectAllowed="move"},onDragOver:v=>{v.preventDefault(),v.dataTransfer.dropEffect="move"},onDrop:v=>{v.preventDefault();const F=v.dataTransfer.getData("sessionId");F&&F!==x.id&&pe(F,x.id)},children:n.jsx(mt,{session:x,isActive:l===x.id,onSelect:()=>{d(x.id),T&&C(!1)},onDelete:()=>ae(x.id),onPin:()=>Re(x.id,!!x.isPinned),onShare:()=>Se(x.id)})},x.id))]})]}),n.jsx("div",{className:"sidebar-footer",children:n.jsxs("button",{className:"delete-all-btn",onClick:Ie,children:[n.jsx(Qe,{size:16})," حذف جميع الجلسات"]})})]}),m==="chat"&&!p&&n.jsx("button",{className:"sidebar-toggle-btn",style:{position:"absolute",left:16,top:16},onClick:()=>C(!0),children:n.jsx(tn,{size:20})}),n.jsxs("main",{className:"center",style:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},children:[n.jsxs("div",{className:"joe-modebar",style:{height:48,borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",padding:"0 16px",gap:8,background:"var(--bg-secondary)",flexShrink:0,overflowX:"auto",WebkitOverflowScrolling:"touch",whiteSpace:"nowrap"},children:[n.jsxs("button",{onClick:()=>S("agent"),style:{background:"none",border:"none",color:m==="agent"?"var(--accent-primary)":"var(--text-secondary)",fontWeight:m==="agent"?600:400,cursor:"pointer",display:"flex",alignItems:"center",gap:6,padding:"6px 12px",borderRadius:6,backgroundColor:m==="agent"?"rgba(37, 99, 235, 0.1)":"transparent"},children:[n.jsx(sn,{size:16})," الوكيل"]}),n.jsxs("button",{onClick:()=>S("chat"),style:{background:"none",border:"none",color:m==="chat"?"var(--accent-primary)":"var(--text-secondary)",fontWeight:m==="chat"?600:400,cursor:"pointer",display:"flex",alignItems:"center",gap:6,padding:"6px 12px",borderRadius:6,backgroundColor:m==="chat"?"rgba(37, 99, 235, 0.1)":"transparent"},children:[n.jsx(nn,{size:16})," Chat"]})]}),n.jsxs("div",{style:{flex:1,overflow:"hidden",position:"relative",display:"flex",flexDirection:"column"},children:[m==="agent"&&n.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:T?"column":"row"},children:[n.jsxs("div",{style:{width:T?"100%":280,flex:"0 0 auto",minHeight:T?180:0,overflow:"hidden",borderRight:T?void 0:"1px solid var(--border-color)",borderBottom:T?"1px solid var(--border-color)":void 0,background:"var(--bg-secondary)",display:"flex",flexDirection:"column"},children:[n.jsxs("div",{style:{padding:"10px 12px",borderBottom:"1px solid var(--border-color)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsx("div",{style:{fontWeight:600,color:"var(--text-primary)",fontSize:13},children:"جلسات الوكيل"}),n.jsx("button",{onClick:()=>y(null),style:{height:28,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(37, 99, 235, 0.12)",color:"var(--text-primary)",cursor:"pointer",fontSize:12},children:"جلسة جديدة"})]}),n.jsx("div",{style:{flex:1,overflow:"auto",padding:6},children:t.length===0?n.jsx("div",{style:{padding:12,color:"var(--text-muted)",fontSize:13},children:"لا توجد جلسات بعد"}):t.map(x=>n.jsx(mt,{session:x,isActive:g===x.id,onSelect:()=>y(x.id),onDelete:()=>ke(x.id),onPin:()=>Ke(x.id,!!x.isPinned),onShare:()=>Se(x.id)},x.id))})]}),n.jsx("div",{style:{flex:1,minHeight:0,overflow:"hidden",background:"var(--bg-secondary)"},children:n.jsx(Kn,{minimal:!0,autoOpen:!0,onSession:x=>{$(x.sessionId)},initialSession:re})}),n.jsx("div",{style:{width:T?"100%":420,flex:"0 0 auto",minHeight:T?340:0,overflow:"hidden",borderLeft:T?void 0:"1px solid var(--border-color)",borderTop:T?"1px solid var(--border-color)":void 0,background:"var(--bg-secondary)",display:"flex",flexDirection:"column",height:"100%"},children:n.jsx(Jt,{sessionId:g||void 0,sessionKind:"agent",browserSessionId:P,onSessionCreated:async x=>{await ne(),y(x)}})})]}),m==="chat"&&n.jsx(Jt,{sessionId:l||void 0,sessionKind:"chat",onSessionCreated:async x=>{await X(),d(x)}})]})]})]})}const z=o=>typeof o=="string",Be=()=>{let o,e;const t=new Promise((s,r)=>{o=s,e=r});return t.resolve=o,t.reject=e,t},qt=o=>o==null?"":""+o,Hn=(o,e,t)=>{o.forEach(s=>{e[s]&&(t[s]=e[s])})},Jn=/###/g,Gt=o=>o&&o.indexOf("###")>-1?o.replace(Jn,"."):o,Yt=o=>!o||z(o),Me=(o,e,t)=>{const s=z(e)?e.split("."):e;let r=0;for(;r<s.length-1;){if(Yt(o))return{};const i=Gt(s[r]);!o[i]&&t&&(o[i]=new t),Object.prototype.hasOwnProperty.call(o,i)?o=o[i]:o={},++r}return Yt(o)?{}:{obj:o,k:Gt(s[r])}},Xt=(o,e,t)=>{const{obj:s,k:r}=Me(o,e,Object);if(s!==void 0||e.length===1){s[r]=t;return}let i=e[e.length-1],a=e.slice(0,e.length-1),c=Me(o,a,Object);for(;c.obj===void 0&&a.length;)i=`${a[a.length-1]}.${i}`,a=a.slice(0,a.length-1),c=Me(o,a,Object),c!=null&&c.obj&&typeof c.obj[`${c.k}.${i}`]<"u"&&(c.obj=void 0);c.obj[`${c.k}.${i}`]=t},qn=(o,e,t,s)=>{const{obj:r,k:i}=Me(o,e,Object);r[i]=r[i]||[],r[i].push(t)},Ze=(o,e)=>{const{obj:t,k:s}=Me(o,e);if(t&&Object.prototype.hasOwnProperty.call(t,s))return t[s]},Gn=(o,e,t)=>{const s=Ze(o,t);return s!==void 0?s:Ze(e,t)},ms=(o,e,t)=>{for(const s in e)s!=="__proto__"&&s!=="constructor"&&(s in o?z(o[s])||o[s]instanceof String||z(e[s])||e[s]instanceof String?t&&(o[s]=e[s]):ms(o[s],e[s],t):o[s]=e[s]);return o},Te=o=>o.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Yn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Xn=o=>z(o)?o.replace(/[&<>"'\/]/g,e=>Yn[e]):o;class Qn{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const s=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,s),this.regExpQueue.push(e),s}}const Zn=[" ",",","?","!",";"],er=new Qn(20),tr=(o,e,t)=>{e=e||"",t=t||"";const s=Zn.filter(a=>e.indexOf(a)<0&&t.indexOf(a)<0);if(s.length===0)return!0;const r=er.getRegExp(`(${s.map(a=>a==="?"?"\\?":a).join("|")})`);let i=!r.test(o);if(!i){const a=o.indexOf(t);a>0&&!r.test(o.substring(0,a))&&(i=!0)}return i},kt=function(o,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!o)return;if(o[e])return Object.prototype.hasOwnProperty.call(o,e)?o[e]:void 0;const s=e.split(t);let r=o;for(let i=0;i<s.length;){if(!r||typeof r!="object")return;let a,c="";for(let l=i;l<s.length;++l)if(l!==i&&(c+=t),c+=s[l],a=r[c],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&l<s.length-1)continue;i+=l-i+1;break}r=a}return r},et=o=>o==null?void 0:o.replace("_","-"),sr={type:"logger",log(o){this.output("log",o)},warn(o){this.output("warn",o)},error(o){this.output("error",o)},output(o,e){var t,s;(s=(t=console==null?void 0:console[o])==null?void 0:t.apply)==null||s.call(t,console,e)}};class tt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||sr,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,s,r){return r&&!this.debug?null:(z(e[0])&&(e[0]=`${s}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new tt(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new tt(this.logger,e)}}var je=new tt;class rt{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const r=this.observers[s].get(t)||0;this.observers[s].set(t,r+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(a=>{let[c,l]=a;for(let d=0;d<l;d++)c(...s)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(a=>{let[c,l]=a;for(let d=0;d<l;d++)c.apply(c,[e,...s])})}}class Qt extends rt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,s){var d,g;let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,a=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let c;e.indexOf(".")>-1?c=e.split("."):(c=[e,t],s&&(Array.isArray(s)?c.push(...s):z(s)&&i?c.push(...s.split(i)):c.push(s)));const l=Ze(this.data,c);return!l&&!t&&!s&&e.indexOf(".")>-1&&(e=c[0],t=c[1],s=c.slice(2).join(".")),l||!a||!z(s)?l:kt((g=(d=this.data)==null?void 0:d[e])==null?void 0:g[t],s,i)}addResource(e,t,s,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const a=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let c=[e,t];s&&(c=c.concat(a?s.split(a):s)),e.indexOf(".")>-1&&(c=e.split("."),r=t,t=c[1]),this.addNamespaces(t),Xt(this.data,c,r),i.silent||this.emit("added",e,t,s,r)}addResources(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const i in s)(z(s[i])||Array.isArray(s[i]))&&this.addResource(e,t,i,s[i],{silent:!0});r.silent||this.emit("added",e,t,s)}addResourceBundle(e,t,s,r,i){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},c=[e,t];e.indexOf(".")>-1&&(c=e.split("."),r=s,s=t,t=c[1]),this.addNamespaces(t);let l=Ze(this.data,c)||{};a.skipCopy||(s=JSON.parse(JSON.stringify(s))),r?ms(l,s,i):l={...l,...s},Xt(this.data,c,l),a.silent||this.emit("added",e,t,s)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(r=>t[r]&&Object.keys(t[r]).length>0)}toJSON(){return this.data}}var xs={processors:{},addPostProcessor(o){this.processors[o.name]=o},handle(o,e,t,s,r){return o.forEach(i=>{var a;e=((a=this.processors[i])==null?void 0:a.process(e,t,s,r))??e}),e}};const Zt={},es=o=>!z(o)&&typeof o!="boolean"&&typeof o!="number";class st extends rt{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Hn(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=je.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const s=this.resolve(e,t);return(s==null?void 0:s.res)!==void 0}extractFromKey(e,t){let s=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const r=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const a=s&&e.indexOf(s)>-1,c=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!tr(e,s,r);if(a&&!c){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:z(i)?[i]:i};const d=e.split(s);(s!==r||s===r&&this.options.ns.indexOf(d[0])>-1)&&(i=d.shift()),e=d.join(r)}return{key:e,namespaces:z(i)?[i]:i}}translate(e,t,s){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const r=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,i=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:a,namespaces:c}=this.extractFromKey(e[e.length-1],t),l=c[c.length-1],d=t.lng||this.language,g=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((d==null?void 0:d.toLowerCase())==="cimode"){if(g){const V=t.nsSeparator||this.options.nsSeparator;return r?{res:`${l}${V}${a}`,usedKey:a,exactUsedKey:a,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:`${l}${V}${a}`}return r?{res:a,usedKey:a,exactUsedKey:a,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:a}const y=this.resolve(e,t);let p=y==null?void 0:y.res;const C=(y==null?void 0:y.usedKey)||a,m=(y==null?void 0:y.exactUsedKey)||a,S=["[object Number]","[object Function]","[object RegExp]"],N=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,_=!this.i18nFormat||this.i18nFormat.handleAsObject,I=t.count!==void 0&&!z(t.count),E=st.hasDefaultValue(t),A=I?this.pluralResolver.getSuffix(d,t.count,t):"",M=t.ordinal&&I?this.pluralResolver.getSuffix(d,t.count,{ordinal:!1}):"",T=I&&!t.ordinal&&t.count===0,q=T&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${A}`]||t[`defaultValue${M}`]||t.defaultValue;let P=p;_&&!p&&E&&(P=q);const $=es(P),re=Object.prototype.toString.apply(P);if(_&&P&&$&&S.indexOf(re)<0&&!(z(N)&&Array.isArray(P))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const V=this.options.returnedObjectHandler?this.options.returnedObjectHandler(C,P,{...t,ns:c}):`key '${a} (${this.language})' returned an object instead of string.`;return r?(y.res=V,y.usedParams=this.getUsedParamsDetails(t),y):V}if(i){const V=Array.isArray(P),Y=V?[]:{},xe=V?m:C;for(const X in P)if(Object.prototype.hasOwnProperty.call(P,X)){const ne=`${xe}${i}${X}`;E&&!p?Y[X]=this.translate(ne,{...t,defaultValue:es(q)?q[X]:void 0,joinArrays:!1,ns:c}):Y[X]=this.translate(ne,{...t,joinArrays:!1,ns:c}),Y[X]===ne&&(Y[X]=P[X])}p=Y}}else if(_&&z(N)&&Array.isArray(p))p=p.join(N),p&&(p=this.extendTranslation(p,e,t,s));else{let V=!1,Y=!1;!this.isValidLookup(p)&&E&&(V=!0,p=q),this.isValidLookup(p)||(Y=!0,p=a);const X=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&Y?void 0:p,ne=E&&q!==p&&this.options.updateMissing;if(Y||V||ne){if(this.logger.log(ne?"updateKey":"missingKey",d,l,a,ne?q:p),i){const ie=this.resolve(a,{...t,keySeparator:!1});ie&&ie.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let fe=[];const be=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&be&&be[0])for(let ie=0;ie<be.length;ie++)fe.push(be[ie]);else this.options.saveMissingTo==="all"?fe=this.languageUtils.toResolveHierarchy(t.lng||this.language):fe.push(t.lng||this.language);const Ce=(ie,pe,ae)=>{var Ie;const ke=E&&ae!==p?ae:X;this.options.missingKeyHandler?this.options.missingKeyHandler(ie,l,pe,ke,ne,t):(Ie=this.backendConnector)!=null&&Ie.saveMissing&&this.backendConnector.saveMissing(ie,l,pe,ke,ne,t),this.emit("missingKey",ie,l,pe,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&I?fe.forEach(ie=>{const pe=this.pluralResolver.getSuffixes(ie,t);T&&t[`defaultValue${this.options.pluralSeparator}zero`]&&pe.indexOf(`${this.options.pluralSeparator}zero`)<0&&pe.push(`${this.options.pluralSeparator}zero`),pe.forEach(ae=>{Ce([ie],a+ae,t[`defaultValue${ae}`]||q)})}):Ce(fe,a,q))}p=this.extendTranslation(p,e,t,y,s),Y&&p===a&&this.options.appendNamespaceToMissingKey&&(p=`${l}:${a}`),(Y||V)&&this.options.parseMissingKeyHandler&&(p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${a}`:a,V?p:void 0))}return r?(y.res=p,y.usedParams=this.getUsedParamsDetails(t),y):p}extendTranslation(e,t,s,r,i){var d,g;var a=this;if((d=this.i18nFormat)!=null&&d.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const y=z(e)&&(((g=s==null?void 0:s.interpolation)==null?void 0:g.skipOnVariables)!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let p;if(y){const m=e.match(this.interpolator.nestingRegexp);p=m&&m.length}let C=s.replace&&!z(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(C={...this.options.interpolation.defaultVariables,...C}),e=this.interpolator.interpolate(e,C,s.lng||this.language||r.usedLng,s),y){const m=e.match(this.interpolator.nestingRegexp),S=m&&m.length;p<S&&(s.nest=!1)}!s.lng&&r&&r.res&&(s.lng=this.language||r.usedLng),s.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var m=arguments.length,S=new Array(m),N=0;N<m;N++)S[N]=arguments[N];return(i==null?void 0:i[0])===S[0]&&!s.context?(a.logger.warn(`It seems you are nesting recursively key: ${S[0]} in key: ${t[0]}`),null):a.translate(...S,t)},s)),s.interpolation&&this.interpolator.reset()}const c=s.postProcess||this.options.postProcess,l=z(c)?[c]:c;return e!=null&&(l!=null&&l.length)&&s.applyPostProcessor!==!1&&(e=xs.handle(l,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s,r,i,a,c;return z(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(s))return;const d=this.extractFromKey(l,t),g=d.key;r=g;let y=d.namespaces;this.options.fallbackNS&&(y=y.concat(this.options.fallbackNS));const p=t.count!==void 0&&!z(t.count),C=p&&!t.ordinal&&t.count===0,m=t.context!==void 0&&(z(t.context)||typeof t.context=="number")&&t.context!=="",S=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);y.forEach(N=>{var _,I;this.isValidLookup(s)||(c=N,!Zt[`${S[0]}-${N}`]&&((_=this.utils)!=null&&_.hasLoadedNamespace)&&!((I=this.utils)!=null&&I.hasLoadedNamespace(c))&&(Zt[`${S[0]}-${N}`]=!0,this.logger.warn(`key "${r}" for languages "${S.join(", ")}" won't get resolved as namespace "${c}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),S.forEach(E=>{var T;if(this.isValidLookup(s))return;a=E;const A=[g];if((T=this.i18nFormat)!=null&&T.addLookupKeys)this.i18nFormat.addLookupKeys(A,g,E,N,t);else{let q;p&&(q=this.pluralResolver.getSuffix(E,t.count,t));const P=`${this.options.pluralSeparator}zero`,$=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(p&&(A.push(g+q),t.ordinal&&q.indexOf($)===0&&A.push(g+q.replace($,this.options.pluralSeparator)),C&&A.push(g+P)),m){const re=`${g}${this.options.contextSeparator}${t.context}`;A.push(re),p&&(A.push(re+q),t.ordinal&&q.indexOf($)===0&&A.push(re+q.replace($,this.options.pluralSeparator)),C&&A.push(re+P))}}let M;for(;M=A.pop();)this.isValidLookup(s)||(i=M,s=this.getResource(E,N,M,t))}))})}),{res:s,usedKey:r,exactUsedKey:i,usedLng:a,usedNS:c}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,s){var i;let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return(i=this.i18nFormat)!=null&&i.getResource?this.i18nFormat.getResource(e,t,s,r):this.resourceStore.getResource(e,t,s,r)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=e.replace&&!z(e.replace);let r=s?e.replace:e;if(s&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!s){r={...r};for(const i of t)delete r[i]}return r}static hasDefaultValue(e){const t="defaultValue";for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t===s.substring(0,t.length)&&e[s]!==void 0)return!0;return!1}}class ts{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=je.create("languageUtils")}getScriptPartFromCode(e){if(e=et(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=et(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(z(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(s=>{if(t)return;const r=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(r))&&(t=r)}),!t&&this.options.supportedLngs&&e.forEach(s=>{if(t)return;const r=this.getLanguagePartFromCode(s);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(i=>{if(i===r)return i;if(!(i.indexOf("-")<0&&r.indexOf("-")<0)&&(i.indexOf("-")>0&&r.indexOf("-")<0&&i.substring(0,i.indexOf("-"))===r||i.indexOf(r)===0&&r.length>1))return i})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),z(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let s=e[t];return s||(s=e[this.getScriptPartFromCode(t)]),s||(s=e[this.formatLanguageCode(t)]),s||(s=e[this.getLanguagePartFromCode(t)]),s||(s=e.default),s||[]}toResolveHierarchy(e,t){const s=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],i=a=>{a&&(this.isSupportedCode(a)?r.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return z(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(e))):z(e)&&i(this.formatLanguageCode(e)),s.forEach(a=>{r.indexOf(a)<0&&i(this.formatLanguageCode(a))}),r}}const ss={zero:0,one:1,two:2,few:3,many:4,other:5},ns={select:o=>o===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class nr{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=je.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=et(e==="dev"?"en":e),r=t.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:s,type:r});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let a;try{a=new Intl.PluralRules(s,{type:r})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),ns;if(!e.match(/-|_/))return ns;const l=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(l,t)}return this.pluralRulesCache[i]=a,a}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.getRule(e,t);return s||(s=this.getRule("dev",t)),(s==null?void 0:s.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,s).map(r=>`${t}${r}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.getRule(e,t);return s||(s=this.getRule("dev",t)),s?s.resolvedOptions().pluralCategories.sort((r,i)=>ss[r]-ss[i]).map(r=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${r}`):[]}getSuffix(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=this.getRule(e,s);return r?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,s))}}const rs=function(o,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,i=Gn(o,e,t);return!i&&r&&z(t)&&(i=kt(o,t,s),i===void 0&&(i=kt(e,t,s))),i},xt=o=>o.replace(/\$/g,"$$$$");class rr{constructor(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=je.create("interpolator"),this.options=e,this.format=((t=e==null?void 0:e.interpolation)==null?void 0:t.format)||(s=>s),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:s,useRawValueToEscape:r,prefix:i,prefixEscaped:a,suffix:c,suffixEscaped:l,formatSeparator:d,unescapeSuffix:g,unescapePrefix:y,nestingPrefix:p,nestingPrefixEscaped:C,nestingSuffix:m,nestingSuffixEscaped:S,nestingOptionsSeparator:N,maxReplaces:_,alwaysFormat:I}=e.interpolation;this.escape=t!==void 0?t:Xn,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=i?Te(i):a||"{{",this.suffix=c?Te(c):l||"}}",this.formatSeparator=d||",",this.unescapePrefix=g?"":y||"-",this.unescapeSuffix=this.unescapePrefix?"":g||"",this.nestingPrefix=p?Te(p):C||Te("$t("),this.nestingSuffix=m?Te(m):S||Te(")"),this.nestingOptionsSeparator=N||",",this.maxReplaces=_||1e3,this.alwaysFormat=I!==void 0?I:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,s)=>(t==null?void 0:t.source)===s?(t.lastIndex=0,t):new RegExp(s,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,s,r){var C;let i,a,c;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},d=m=>{if(m.indexOf(this.formatSeparator)<0){const I=rs(t,l,m,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(I,void 0,s,{...r,...t,interpolationkey:m}):I}const S=m.split(this.formatSeparator),N=S.shift().trim(),_=S.join(this.formatSeparator).trim();return this.format(rs(t,l,N,this.options.keySeparator,this.options.ignoreJSONStructure),_,s,{...r,...t,interpolationkey:N})};this.resetRegExp();const g=(r==null?void 0:r.missingInterpolationHandler)||this.options.missingInterpolationHandler,y=((C=r==null?void 0:r.interpolation)==null?void 0:C.skipOnVariables)!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:m=>xt(m)},{regex:this.regexp,safeValue:m=>this.escapeValue?xt(this.escape(m)):xt(m)}].forEach(m=>{for(c=0;i=m.regex.exec(e);){const S=i[1].trim();if(a=d(S),a===void 0)if(typeof g=="function"){const _=g(e,i,r);a=z(_)?_:""}else if(r&&Object.prototype.hasOwnProperty.call(r,S))a="";else if(y){a=i[0];continue}else this.logger.warn(`missed to pass in variable ${S} for interpolating ${e}`),a="";else!z(a)&&!this.useRawValueToEscape&&(a=qt(a));const N=m.safeValue(a);if(e=e.replace(i[0],N),y?(m.regex.lastIndex+=a.length,m.regex.lastIndex-=i[0].length):m.regex.lastIndex=0,c++,c>=this.maxReplaces)break}}),e}nest(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r,i,a;const c=(l,d)=>{const g=this.nestingOptionsSeparator;if(l.indexOf(g)<0)return l;const y=l.split(new RegExp(`${g}[ ]*{`));let p=`{${y[1]}`;l=y[0],p=this.interpolate(p,a);const C=p.match(/'/g),m=p.match(/"/g);(((C==null?void 0:C.length)??0)%2===0&&!m||m.length%2!==0)&&(p=p.replace(/'/g,'"'));try{a=JSON.parse(p),d&&(a={...d,...a})}catch(S){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,S),`${l}${g}${p}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,l};for(;r=this.nestingRegexp.exec(e);){let l=[];a={...s},a=a.replace&&!z(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;let d=!1;if(r[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(r[1])){const g=r[1].split(this.formatSeparator).map(y=>y.trim());r[1]=g.shift(),l=g,d=!0}if(i=t(c.call(this,r[1].trim(),a),a),i&&r[0]===e&&!z(i))return i;z(i)||(i=qt(i)),i||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),i=""),d&&(i=l.reduce((g,y)=>this.format(g,y,s.lng,{...s,interpolationkey:r[1].trim()}),i.trim())),e=e.replace(r[0],i),this.regexp.lastIndex=0}return e}}const ir=o=>{let e=o.toLowerCase().trim();const t={};if(o.indexOf("(")>-1){const s=o.split("(");e=s[0].toLowerCase().trim();const r=s[1].substring(0,s[1].length-1);e==="currency"&&r.indexOf(":")<0?t.currency||(t.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?t.range||(t.range=r.trim()):r.split(";").forEach(a=>{if(a){const[c,...l]=a.split(":"),d=l.join(":").trim().replace(/^'+|'+$/g,""),g=c.trim();t[g]||(t[g]=d),d==="false"&&(t[g]=!1),d==="true"&&(t[g]=!0),isNaN(d)||(t[g]=parseInt(d,10))}})}return{formatName:e,formatOptions:t}},$e=o=>{const e={};return(t,s,r)=>{let i=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(i={...i,[r.interpolationkey]:void 0});const a=s+JSON.stringify(i);let c=e[a];return c||(c=o(et(s),r),e[a]=c),c(t)}};class or{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=je.create("formatter"),this.options=e,this.formats={number:$e((t,s)=>{const r=new Intl.NumberFormat(t,{...s});return i=>r.format(i)}),currency:$e((t,s)=>{const r=new Intl.NumberFormat(t,{...s,style:"currency"});return i=>r.format(i)}),datetime:$e((t,s)=>{const r=new Intl.DateTimeFormat(t,{...s});return i=>r.format(i)}),relativetime:$e((t,s)=>{const r=new Intl.RelativeTimeFormat(t,{...s});return i=>r.format(i,s.range||"day")}),list:$e((t,s)=>{const r=new Intl.ListFormat(t,{...s});return i=>r.format(i)})},this.init(e)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=t.interpolation.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=$e(t)}format(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=t.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(c=>c.indexOf(")")>-1)){const c=i.findIndex(l=>l.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,c)].join(this.formatSeparator)}return i.reduce((c,l)=>{var y;const{formatName:d,formatOptions:g}=ir(l);if(this.formats[d]){let p=c;try{const C=((y=r==null?void 0:r.formatParams)==null?void 0:y[r.interpolationkey])||{},m=C.locale||C.lng||r.locale||r.lng||s;p=this.formats[d](c,m,{...g,...r,...C})}catch(C){this.logger.warn(C)}return p}else this.logger.warn(`there was no format function for ${d}`);return c},e)}}const ar=(o,e)=>{o.pending[e]!==void 0&&(delete o.pending[e],o.pendingCount--)};class lr extends rt{constructor(e,t,s){var i,a;let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=s,this.languageUtils=s.languageUtils,this.options=r,this.logger=je.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],(a=(i=this.backend)==null?void 0:i.init)==null||a.call(i,s,r.backend,r)}queueLoad(e,t,s,r){const i={},a={},c={},l={};return e.forEach(d=>{let g=!0;t.forEach(y=>{const p=`${d}|${y}`;!s.reload&&this.store.hasResourceBundle(d,y)?this.state[p]=2:this.state[p]<0||(this.state[p]===1?a[p]===void 0&&(a[p]=!0):(this.state[p]=1,g=!1,a[p]===void 0&&(a[p]=!0),i[p]===void 0&&(i[p]=!0),l[y]===void 0&&(l[y]=!0)))}),g||(c[d]=!0)}),(Object.keys(i).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(i),pending:Object.keys(a),toLoadLanguages:Object.keys(c),toLoadNamespaces:Object.keys(l)}}loaded(e,t,s){const r=e.split("|"),i=r[0],a=r[1];t&&this.emit("failedLoading",i,a,t),!t&&s&&this.store.addResourceBundle(i,a,s,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&s&&(this.state[e]=0);const c={};this.queue.forEach(l=>{qn(l.loaded,[i],a),ar(l,e),t&&l.errors.push(t),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(d=>{c[d]||(c[d]={});const g=l.loaded[d];g.length&&g.forEach(y=>{c[d][y]===void 0&&(c[d][y]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",c),this.queue=this.queue.filter(l=>!l.done)}read(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:s,tried:r,wait:i,callback:a});return}this.readingCalls++;const c=(d,g)=>{if(this.readingCalls--,this.waitingReads.length>0){const y=this.waitingReads.shift();this.read(y.lng,y.ns,y.fcName,y.tried,y.wait,y.callback)}if(d&&g&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,s,r+1,i*2,a)},i);return}a(d,g)},l=this.backend[s].bind(this.backend);if(l.length===2){try{const d=l(e,t);d&&typeof d.then=="function"?d.then(g=>c(null,g)).catch(c):c(null,d)}catch(d){c(d)}return}return l(e,t,c)}prepareLoading(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();z(e)&&(e=this.languageUtils.toResolveHierarchy(e)),z(t)&&(t=[t]);const i=this.queueLoad(e,t,s,r);if(!i.toLoad.length)return i.pending.length||r(),null;i.toLoad.forEach(a=>{this.loadOne(a)})}load(e,t,s){this.prepareLoading(e,t,{},s)}reload(e,t,s){this.prepareLoading(e,t,{reload:!0},s)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const s=e.split("|"),r=s[0],i=s[1];this.read(r,i,"read",void 0,void 0,(a,c)=>{a&&this.logger.warn(`${t}loading namespace ${i} for language ${r} failed`,a),!a&&c&&this.logger.log(`${t}loaded namespace ${i} for language ${r}`,c),this.loaded(e,a,c)})}saveMissing(e,t,s,r,i){var l,d,g,y,p;let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if((d=(l=this.services)==null?void 0:l.utils)!=null&&d.hasLoadedNamespace&&!((y=(g=this.services)==null?void 0:g.utils)!=null&&y.hasLoadedNamespace(t))){this.logger.warn(`did not save key "${s}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if((p=this.backend)!=null&&p.create){const C={...a,isUpdate:i},m=this.backend.create.bind(this.backend);if(m.length<6)try{let S;m.length===5?S=m(e,t,s,r,C):S=m(e,t,s,r),S&&typeof S.then=="function"?S.then(N=>c(null,N)).catch(c):c(null,S)}catch(S){c(S)}else m(e,t,s,r,c,C)}!e||!e[0]||this.store.addResource(e[0],t,s,r)}}}const is=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:o=>{let e={};if(typeof o[1]=="object"&&(e=o[1]),z(o[1])&&(e.defaultValue=o[1]),z(o[2])&&(e.tDescription=o[2]),typeof o[2]=="object"||typeof o[3]=="object"){const t=o[3]||o[2];Object.keys(t).forEach(s=>{e[s]=t[s]})}return e},interpolation:{escapeValue:!0,format:o=>o,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),os=o=>{var e,t;return z(o.ns)&&(o.ns=[o.ns]),z(o.fallbackLng)&&(o.fallbackLng=[o.fallbackLng]),z(o.fallbackNS)&&(o.fallbackNS=[o.fallbackNS]),((t=(e=o.supportedLngs)==null?void 0:e.indexOf)==null?void 0:t.call(e,"cimode"))<0&&(o.supportedLngs=o.supportedLngs.concat(["cimode"])),typeof o.initImmediate=="boolean"&&(o.initAsync=o.initImmediate),o},Xe=()=>{},cr=o=>{Object.getOwnPropertyNames(Object.getPrototypeOf(o)).forEach(t=>{typeof o[t]=="function"&&(o[t]=o[t].bind(o))})};class Ue extends rt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=os(e),this.services={},this.logger=je,this.modules={external:[]},cr(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(s=t,t={}),t.defaultNS==null&&t.ns&&(z(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const r=is();this.options={...r,...this.options,...os(t)},this.options.interpolation={...r.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const i=g=>g?typeof g=="function"?new g:g:null;if(!this.options.isClone){this.modules.logger?je.init(i(this.modules.logger),this.options):je.init(null,this.options);let g;this.modules.formatter?g=this.modules.formatter:g=or;const y=new ts(this.options);this.store=new Qt(this.options.resources,this.options);const p=this.services;p.logger=je,p.resourceStore=this.store,p.languageUtils=y,p.pluralResolver=new nr(y,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),g&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(p.formatter=i(g),p.formatter.init(p,this.options),this.options.interpolation.format=p.formatter.format.bind(p.formatter)),p.interpolator=new rr(this.options),p.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},p.backendConnector=new lr(i(this.modules.backend),p.resourceStore,p,this.options),p.backendConnector.on("*",function(C){for(var m=arguments.length,S=new Array(m>1?m-1:0),N=1;N<m;N++)S[N-1]=arguments[N];e.emit(C,...S)}),this.modules.languageDetector&&(p.languageDetector=i(this.modules.languageDetector),p.languageDetector.init&&p.languageDetector.init(p,this.options.detection,this.options)),this.modules.i18nFormat&&(p.i18nFormat=i(this.modules.i18nFormat),p.i18nFormat.init&&p.i18nFormat.init(this)),this.translator=new st(this.services,this.options),this.translator.on("*",function(C){for(var m=arguments.length,S=new Array(m>1?m-1:0),N=1;N<m;N++)S[N-1]=arguments[N];e.emit(C,...S)}),this.modules.external.forEach(C=>{C.init&&C.init(this)})}if(this.format=this.options.interpolation.format,s||(s=Xe),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const g=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);g.length>0&&g[0]!=="dev"&&(this.options.lng=g[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(g=>{this[g]=function(){return e.store[g](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(g=>{this[g]=function(){return e.store[g](...arguments),e}});const l=Be(),d=()=>{const g=(y,p)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(p),s(y,p)};if(this.languages&&!this.isInitialized)return g(null,this.t.bind(this));this.changeLanguage(this.options.lng,g)};return this.options.resources||!this.options.initAsync?d():setTimeout(d,0),l}loadResources(e){var i,a;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xe;const r=z(e)?e:this.language;if(typeof e=="function"&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if((r==null?void 0:r.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const c=[],l=d=>{if(!d||d==="cimode")return;this.services.languageUtils.toResolveHierarchy(d).forEach(y=>{y!=="cimode"&&c.indexOf(y)<0&&c.push(y)})};r?l(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(g=>l(g)),(a=(i=this.options.preload)==null?void 0:i.forEach)==null||a.call(i,d=>l(d)),this.services.backendConnector.load(c,this.options.ns,d=>{!d&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(d)})}else s(null)}reloadResources(e,t,s){const r=Be();return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),s||(s=Xe),this.services.backendConnector.reload(e,t,i=>{r.resolve(),s(i)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&xs.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const s=this.languages[t];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}}changeLanguage(e,t){var s=this;this.isLanguageChangingTo=e;const r=Be();this.emit("languageChanging",e);const i=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},a=(l,d)=>{d?(i(d),this.translator.changeLanguage(d),this.isLanguageChangingTo=void 0,this.emit("languageChanged",d),this.logger.log("languageChanged",d)):this.isLanguageChangingTo=void 0,r.resolve(function(){return s.t(...arguments)}),t&&t(l,function(){return s.t(...arguments)})},c=l=>{var g,y;!e&&!l&&this.services.languageDetector&&(l=[]);const d=z(l)?l:this.services.languageUtils.getBestMatchFromCodes(l);d&&(this.language||i(d),this.translator.language||this.translator.changeLanguage(d),(y=(g=this.services.languageDetector)==null?void 0:g.cacheUserLanguage)==null||y.call(g,d)),this.loadResources(d,p=>{a(p,d)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?c(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(c):this.services.languageDetector.detect(c):c(e),r}getFixedT(e,t,s){var r=this;const i=function(a,c){let l;if(typeof c!="object"){for(var d=arguments.length,g=new Array(d>2?d-2:0),y=2;y<d;y++)g[y-2]=arguments[y];l=r.options.overloadTranslationOptionHandler([a,c].concat(g))}else l={...c};l.lng=l.lng||i.lng,l.lngs=l.lngs||i.lngs,l.ns=l.ns||i.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||s||i.keyPrefix);const p=r.options.keySeparator||".";let C;return l.keyPrefix&&Array.isArray(a)?C=a.map(m=>`${l.keyPrefix}${p}${m}`):C=l.keyPrefix?`${l.keyPrefix}${p}${a}`:a,r.t(C,l)};return z(e)?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=s,i}t(){var r;for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return(r=this.translator)==null?void 0:r.translate(...t)}exists(){var r;for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return(r=this.translator)==null?void 0:r.exists(...t)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=t.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const a=(c,l)=>{const d=this.services.backendConnector.state[`${c}|${l}`];return d===-1||d===0||d===2};if(t.precheck){const c=t.precheck(this,a);if(c!==void 0)return c}return!!(this.hasResourceBundle(s,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(s,e)&&(!r||a(i,e)))}loadNamespaces(e,t){const s=Be();return this.options.ns?(z(e)&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{s.resolve(),t&&t(r)}),s):(t&&t(),Promise.resolve())}loadLanguages(e,t){const s=Be();z(e)&&(e=[e]);const r=this.options.preload||[],i=e.filter(a=>r.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return i.length?(this.options.preload=r.concat(i),this.loadResources(a=>{s.resolve(),t&&t(a)}),s):(t&&t(),Promise.resolve())}dir(e){var r,i;if(e||(e=this.resolvedLanguage||(((r=this.languages)==null?void 0:r.length)>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=((i=this.services)==null?void 0:i.languageUtils)||new ts(is());return t.indexOf(s.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new Ue(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xe;const s=e.forkResourceStore;s&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},i=new Ue(r);if((e.debug!==void 0||e.prefix!==void 0)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(c=>{i[c]=this[c]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},s){const c=Object.keys(this.store.data).reduce((l,d)=>(l[d]={...this.store.data[d]},Object.keys(l[d]).reduce((g,y)=>(g[y]={...l[d][y]},g),{})),{});i.store=new Qt(c,r),i.services.resourceStore=i.store}return i.translator=new st(i.services,r),i.translator.on("*",function(c){for(var l=arguments.length,d=new Array(l>1?l-1:0),g=1;g<l;g++)d[g-1]=arguments[g];i.emit(c,...d)}),i.init(r,t),i.translator.options=r,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const ce=Ue.createInstance();ce.createInstance=Ue.createInstance;ce.createInstance;ce.dir;ce.init;ce.loadResources;ce.reloadResources;ce.use;ce.changeLanguage;ce.getFixedT;ce.t;ce.exists;ce.setDefaultNamespace;ce.hasLoadedNamespace;ce.loadNamespaces;ce.loadLanguages;const dr={en:{translation:{login:"Login",toggleTheme:"Toggle Theme",homeSubtitle:"A simple entry to the World of JOE",email:"Email",password:"Password",register:"Register",welcomeTitle:"👋",welcomeMsg:`Hello! I am Joe, your smart assistant.
How can I help you today?`,inputPlaceholder:"Enter your command here...",send:"Send",connecting:"Connecting...",connected:"Connected",copy:"Copy text",working:"Working...",planProposed:"📋 Proposed Plan",planAction:"I will",inputs:"Inputs",outputs:"Outputs",approvalRequired:"Approval Required",risk:"Risk",action:"Action",deny:"Deny",approve:"Approve",tools:{file_write:"Create File",file_read:"Read File",ls:"List Files",web_search:"Web Search",shell_execute:"Execute Command",http_fetch:"Fetch URL",file_edit:"Edit File",plan:"Plan & Analyze",summarize:"Summarize",unknown:"Unknown Tool"},artifacts:{image:"Image",video:"Video",file:"File",openNewWindow:"Open in new window"},error:"Error sending command"}},ar:{translation:{login:"تسجيل الدخول",toggleTheme:"تبديل السمة",homeSubtitle:"بوابة الدخول إلى عالم جو",email:"البريد الإلكتروني",password:"كلمة المرور",register:"تسجيل",welcomeTitle:"👋",welcomeMsg:`مرحباً! أنا جو، مساعدك الذكي.
كيف يمكنني مساعدتك اليوم؟`,inputPlaceholder:"أدخل أمرك هنا...",send:"إرسال",connecting:"جاري الاتصال...",connected:"متصل",copy:"نسخ النص",working:"جاري العمل...",planProposed:"📋 الخطة المقترحة",planAction:"سأقوم بـ",inputs:"المدخلات",outputs:"المخرجات",approvalRequired:"موافقة مطلوبة",risk:"مستوى الخطورة",action:"الإجراء",deny:"رفض",approve:"موافقة",tools:{file_write:"إنشاء ملف",file_read:"قراءة ملف",ls:"عرض الملفات",web_search:"بحث في الويب",shell_execute:"تنفيذ أمر النظام",http_fetch:"جلب رابط",file_edit:"تعديل ملف",plan:"تحليل وتخطيط",summarize:"تلخيص النتائج",unknown:"أداة غير معروفة"},artifacts:{image:"صورة",video:"فيديو",file:"ملف",openNewWindow:"فتح في نافذة جديدة"},error:"فشل إرسال الأمر"}},fr:{translation:{login:"Connexion",toggleTheme:"Changer de thème",homeSubtitle:"Une entrée simple dans le monde de JOE",email:"Email",password:"Mot de passe",register:"S'inscrire",welcomeTitle:"👋",welcomeMsg:`Bonjour ! Je suis Joe, votre assistant intelligent.
Comment puis-je vous aider aujourd'hui ?`,inputPlaceholder:"Entrez votre commande ici...",send:"Envoyer",connecting:"Connexion...",connected:"Connecté",copy:"Copier le texte",working:"En cours...",planProposed:"📋 Plan Proposé",planAction:"Je vais",inputs:"Entrées",outputs:"Sorties",approvalRequired:"Approbation requise",risk:"Risque",action:"Action",deny:"Refuser",approve:"Approuver",tools:{file_write:"Créer un fichier",file_read:"Lire un fichier",ls:"Lister les fichiers",web_search:"Recherche Web",shell_execute:"Exécuter la commande",http_fetch:"Récupérer URL",file_edit:"Modifier le fichier",plan:"Planifier & Analyser",summarize:"Résumer",unknown:"Outil inconnu"},artifacts:{image:"Image",video:"Vidéo",file:"Fichier",openNewWindow:"Ouvrir dans une nouvelle fenêtre"},error:"Erreur lors de l'envoi"}},de:{translation:{login:"Anmelden",toggleTheme:"Thema umschalten",homeSubtitle:"Ein einfacher Zugang zur Welt von JOE",email:"E-Mail",password:"Passwort",register:"Registrieren",welcomeTitle:"👋",welcomeMsg:`Hallo! Ich bin Joe, dein intelligenter Assistent.
Wie kann ich dir heute helfen?`,inputPlaceholder:"Gib deinen Befehl hier ein...",send:"Senden",connecting:"Verbinden...",connected:"Verbunden",copy:"Text kopieren",working:"Arbeite...",planProposed:"📋 Vorgeschlagener Plan",planAction:"Ich werde",inputs:"Eingaben",outputs:"Ausgaben",approvalRequired:"Genehmigung erforderlich",risk:"Risiko",action:"Aktion",deny:"Ablehnen",approve:"Genehmigen",tools:{file_write:"Datei erstellen",file_read:"Datei lesen",ls:"Dateien auflisten",web_search:"Websuche",shell_execute:"Befehl ausführen",http_fetch:"URL abrufen",file_edit:"Datei bearbeiten",plan:"Planen & Analysieren",summarize:"Zusammenfassen",unknown:"Unbekanntes Werkzeug"},artifacts:{image:"Bild",video:"Video",file:"Datei",openNewWindow:"In neuem Fenster öffnen"},error:"Fehler beim Senden"}},ru:{translation:{login:"Войти",toggleTheme:"Сменить тему",homeSubtitle:"Простой вход в мир JOE",email:"Email",password:"Пароль",register:"Регистрация",welcomeTitle:"👋",welcomeMsg:`Привет! Я Джо, твой умный помощник.
Чем я могу помочь сегодня?`,inputPlaceholder:"Введите команду здесь...",send:"Отправить",connecting:"Подключение...",connected:"Подключено",copy:"Копировать",working:"Работаю...",planProposed:"📋 Предложенный план",planAction:"Я сделаю",inputs:"Входные данные",outputs:"Выходные данные",approvalRequired:"Требуется подтверждение",risk:"Риск",action:"Действие",deny:"Отклонить",approve:"Принять",tools:{file_write:"Создать файл",file_read:"Читать файл",ls:"Список файлов",web_search:"Поиск в веб",shell_execute:"Выполнить команду",http_fetch:"Получить URL",file_edit:"Редактировать файл",plan:"Планирование",summarize:"Обобщить",unknown:"Неизвестный инструмент"},artifacts:{image:"Изображение",video:"Видео",file:"Файл",openNewWindow:"Открыть в новом окне"},error:"Ошибка отправки"}},es:{translation:{login:"Iniciar sesión",toggleTheme:"Cambiar tema",homeSubtitle:"Una entrada simple al mundo de JOE",email:"Correo electrónico",password:"Contraseña",register:"Registrarse",welcomeTitle:"👋",welcomeMsg:`¡Hola! Soy Joe, tu asistente inteligente.
¿Cómo puedo ayudarte hoy?`,inputPlaceholder:"Ingresa tu comando aquí...",send:"Enviar",connecting:"Conectando...",connected:"Conectado",copy:"Copiar texto",working:"Trabajando...",planProposed:"📋 Plan Propuesto",planAction:"Voy a",inputs:"Entradas",outputs:"Salidas",approvalRequired:"Aprobación requerida",risk:"Riesgo",action:"Acción",deny:"Rechazar",approve:"Aprobar",tools:{file_write:"Crear archivo",file_read:"Leer archivo",ls:"Listar archivos",web_search:"Búsqueda web",shell_execute:"Ejecutar comando",http_fetch:"Obtener URL",file_edit:"Editar archivo",plan:"Planificar y Analizar",summarize:"Resumir",unknown:"Herramienta desconocida"},artifacts:{image:"Imagen",video:"Video",file:"Archivo",openNewWindow:"Abrir en nueva ventana"},error:"Error al enviar"}}};ce.use(In).init({resources:dr,lng:localStorage.getItem("lang")||"en",fallbackLng:"en",interpolation:{escapeValue:!1}});function ur({children:o}){return localStorage.getItem("token")?n.jsx(n.Fragment,{children:o}):n.jsx(dn,{to:"/login",replace:!0})}hn.createRoot(document.getElementById("root")).render(n.jsx(an.StrictMode,{children:n.jsx(ln,{children:n.jsx(cn,{children:n.jsxs(Ge,{path:"/",element:n.jsx($n,{}),children:[n.jsx(Ge,{index:!0,element:n.jsx(An,{})}),n.jsx(Ge,{path:"login",element:n.jsx(_n,{})}),n.jsx(Ge,{path:"joe",element:n.jsx(ur,{children:n.jsx(Wn,{})})})]})})})}));export{Z as A};

import{r as n,A as W,j as t}from"./index-DyqTheU1.js";function At({wsUrl:se,minimal:m}){var Je,Xe,Ye;const Re=n.useRef(null),F=n.useRef(null),S=n.useRef(null),ie=n.useMemo(()=>{let e=String(se||"").trim();if(!e)return e;try{if(!/^wss?:\/\//i.test(e)){const r=W.replace(/^http/i,"ws");e=new URL(e,r).toString()}}catch{}try{const r=new URL(e);if(r.pathname.startsWith("/ws/")&&r.searchParams.get("key")){const l=r.pathname.split("/").filter(Boolean).pop()||"",i=W.replace(/^http/i,"ws");e=new URL(`/browser/ws/${encodeURIComponent(l)}`,i).toString()}}catch{}try{const r=new URL(e);if(r.pathname.startsWith("/browser/ws/")&&!r.searchParams.get("token")){const l=localStorage.getItem("token");l&&r.searchParams.set("token",l)}e=r.toString()}catch{}return e},[se]),[x,Ce]=n.useState({w:1280,h:800}),P=n.useRef({w:1280,h:800}),[j,A]=n.useState("connecting"),[H,L]=n.useState(""),[v,O]=n.useState(""),[Te,Ie]=n.useState([]),[_,Ee]=n.useState(""),Ne=n.useRef(""),[z,q]=n.useState([]),[Me,E]=n.useState(""),[R,le]=n.useState("console"),[Be,ce]=n.useState(!1),[Fe,de]=n.useState([]),[Ue,ue]=n.useState([]),[Ae,Q]=n.useState(1),[C,Le]=n.useState(!1),[He,Qe]=n.useState(!1),[pe,he]=n.useState(!1),[Ze,ye]=n.useState(5),[Ge,be]=n.useState(50),[Ve,ge]=n.useState(!0),[et,tt]=n.useState(0),[rt,Ct]=n.useState('{"list":{"selector":"a[href^=\\"https\\"]:not([href*=\\"google.com\\"])","fields":{"text":{"selector":"","attr":""},"url":{"selector":"","attr":"href"}}}}'),[Tt,xe]=n.useState(null),[fe,ot]=n.useState(""),ze=n.useRef(null),[me,D]=n.useState(null),[$,nt]=n.useState(!0),[Z,De]=n.useState(""),[T,$e]=n.useState(""),[K,G]=n.useState(null),[V,It]=n.useState(""),[ee,Et]=n.useState(""),[We,Nt]=n.useState(!0),[at,Mt]=n.useState(!0),[st,Bt]=n.useState(!0),[it,Ft]=n.useState("أضرار التدخين"),te=n.useRef(0),re=n.useRef(null),oe=n.useRef(null),J=n.useRef(0),[f,ve]=n.useState(!1),[lt,Pe]=n.useState(!1),[ne,Oe]=n.useState(!1),[N,ct]=n.useState(null),[ae,dt]=n.useState(!1),[_e,ut]=n.useState(!0),[I,qe]=n.useState([]),[U,pt]=n.useState(!1),[X,we]=n.useState(0);n.useEffect(()=>{m&&(ce(!1),Le(!1),Q(1),he(!1),ve(!1))},[m]),n.useEffect(()=>{P.current=x},[x]),n.useEffect(()=>{Ne.current=_},[_]),n.useEffect(()=>{const e=()=>{Qe(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),e(),()=>document.removeEventListener("fullscreenchange",e)},[]);function ke(){try{const r=new URL(ie).pathname.split("/").filter(Boolean);return r[r.length-1]}catch{return""}}function Se(e){try{const r=new URL(e);return r.protocol==="ws:"&&(r.protocol="http:"),r.protocol==="wss:"&&(r.protocol="https:"),r.toString()}catch{try{const r=new URL(ie);return r.protocol==="ws:"&&(r.protocol="http:"),r.protocol==="wss:"&&(r.protocol="https:"),r.search="",r.hash="",r.pathname="/",new URL(e,r.toString()).toString()}catch{return e}}}function M(e){const r=e.trim();if(!r)return"";try{return new URL(r).toString()}catch{try{return new URL(`https://${r}`).toString()}catch{return r}}}async function a(e){var s;const r=ke();if(!r)return;const l=["mouseMove","click","scroll","type","press","goBack","goForward","reload","goto","screenshot","tab.new","tab.switch","tab.close","tabs.list","pick","stream.setFps","stream.setQuality","redaction.set"];if(S.current&&S.current.readyState===WebSocket.OPEN&&e.every(p=>l.includes(p.type))){e.forEach(d=>{var h;(h=S.current)==null||h.send(JSON.stringify({type:"action",action:d}))});const p=e.map(d=>d.type).join(", ");if(E(p),setTimeout(()=>E(""),1200),$&&e.some(d=>d.type==="press"&&d.key==="Enter")&&setTimeout(()=>Y(),2e3),$&&e.some(d=>d.type==="reload")&&setTimeout(()=>Y(),1500),e.some(d=>d.type==="goto"||d.type==="reload")){if(G(null),We){const d=[];T?d.push({type:"locate",selector:T}):V&&ee&&d.push({type:"locate",role:V,roleName:ee}),d.length&&setTimeout(()=>a(d),1e3)}$&&setTimeout(()=>Y(),1500)}return}try{const p=localStorage.getItem("token"),h=await(await fetch(`${W}/tools/browser_run/execute`,{method:"POST",headers:{"Content-Type":"application/json",...p?{Authorization:`Bearer ${p}`}:{}},body:JSON.stringify({sessionId:r,actions:e})})).json();if(Array.isArray(h.artifacts)){const u=h.artifacts.map(g=>({name:g.name||g.filename||"download",href:g.href}));q(g=>[...u,...g].slice(0,5))}if(h!=null&&h.ok&&Array.isArray((s=h==null?void 0:h.output)==null?void 0:s.outputs)){const u=h.output.outputs.find(g=>g.type==="locate"&&g.boundingBox);if(u!=null&&u.boundingBox&&(G(u.boundingBox),e.some(w=>w.type==="locate")&&at)){const y=[...e].reverse().find(k=>k.type==="locate")||null,o=[];if(y!=null&&y.selector)o.push({type:"click",selector:y.selector});else if(y!=null&&y.role&&(y!=null&&y.roleName))o.push({type:"click",role:y.role,roleName:y.roleName});else{const k=u.boundingBox;if(k){const jt=Math.round(k.x+k.width/2),Rt=Math.round(k.y+k.height/2);o.push({type:"click",x:jt,y:Rt})}}o.length&&setTimeout(()=>a(o),250);const c=!!(y!=null&&y.selector&&/(input|textarea)\[name=["']q["']\]/i.test(String(y.selector))),b=!!(y!=null&&y.roleName&&String(y.roleName).includes("بحث"));st&&!Z.trim()&&(c||b)&&setTimeout(()=>{a([{type:"waitForSelector",selector:'input[name="q"], textarea[name="q"]',timeoutMs:8e3}]),setTimeout(()=>a([{type:"type",text:it,delay:30}]),200),setTimeout(()=>a([{type:"press",key:"Enter"}]),300)},400)}}const B=e.map(u=>u.type).join(", ");if(E(B),setTimeout(()=>E(""),1200),e.some(u=>u.type==="goto"||u.type==="reload")&&(G(null),We)){const u=[];if(T)u.push({type:"locate",selector:T});else if(V&&ee)u.push({type:"locate",role:V,roleName:ee});else{const g=e.find(w=>w.type==="goto");try{const w=g!=null&&g.url?new URL(g.url).hostname:"";w&&/(^|\.)(google)\./i.test(w)&&u.push({type:"locate",selector:'input[name="q"], textarea[name="q"]'})}catch{}}u.length&&setTimeout(()=>a(u),1e3)}$&&e.some(u=>u.type==="press"&&u.key==="Enter")&&setTimeout(()=>{Y()},2e3),$&&e.some(u=>u.type==="goto"||u.type==="reload")&&setTimeout(()=>{Y()},1500)}catch{}}async function Y(){const e=ke();if(e)try{const r=localStorage.getItem("token"),l=JSON.parse(rt),s=await(await fetch(`${W}/tools/browser_extract/execute`,{method:"POST",headers:{"Content-Type":"application/json",...r?{Authorization:`Bearer ${r}`}:{}},body:JSON.stringify({sessionId:e,schema:l})})).json();s!=null&&s.ok&&(s!=null&&s.output)?xe(s.output):xe(null)}catch{xe(null)}}async function ht(){var l,i;const e=ke(),r=(i=(l=ze.current)==null?void 0:l.files)==null?void 0:i[0];if(!(!e||!r||!fe))try{const s=localStorage.getItem("token"),p=new FormData;p.append("file",r),p.append("sessionId",e);const h=await(await fetch(`${W}/files/upload`,{method:"POST",headers:{...s?{Authorization:`Bearer ${s}`}:{}},body:p})).json();if(h&&h._id){const B=`${W}/files/${h._id}/raw`;await a([{type:"uploadFile",selector:fe,fileUrl:B}])}}catch{}}n.useEffect(()=>{let e=!1;J.current=0,A("connecting"),L("");const r=()=>{re.current!=null&&(window.clearTimeout(re.current),re.current=null),oe.current!=null&&(window.clearTimeout(oe.current),oe.current=null)},l=()=>{if(!e){r();try{if(S.current){try{S.current.close()}catch{}S.current=null}const i=new WebSocket(ie);S.current=i,A(J.current>0?"reconnecting":"connecting"),oe.current=window.setTimeout(()=>{try{i.readyState!==WebSocket.OPEN&&i.close()}catch{}},8e3),i.onopen=()=>{r(),!e&&(J.current=0,L(""),A("connected"))},i.onclose=s=>{if(r(),e)return;S.current=null;const p=8,d=J.current+1;if(J.current=d,d>p){A("error");const w=s!=null&&s.reason?` reason=${s.reason}`:"";L(`WebSocket closed (code=${(s==null?void 0:s.code)??"unknown"}${w})`);return}const h=Math.min(8e3,500*Math.pow(2,d-1)),B=Math.floor(Math.random()*250),u=h+B;A("reconnecting");const g=s!=null&&s.reason?` reason=${s.reason}`:"";L(`WebSocket closed (code=${(s==null?void 0:s.code)??"unknown"}${g}). retrying...`),re.current=window.setTimeout(l,u)},i.onerror=()=>{e||L("WebSocket error")},i.onmessage=s=>{var p,d,h,B,u,g,w,y;try{const o=JSON.parse(s.data);if(o.type==="stream_start"){const c={w:o.w,h:o.h};P.current=c,Ce(c)}if(o.type==="state"){if((p=o.viewport)!=null&&p.width&&((d=o.viewport)!=null&&d.height)){const c={w:o.viewport.width,h:o.viewport.height};P.current=c,Ce(c)}if(typeof o.url=="string"&&O(o.url),Array.isArray(o.tabs)&&Ie(o.tabs),typeof o.activeTabId=="string"&&Ee(o.activeTabId),(h=o.stream)!=null&&h.fps&&ye(Number(o.stream.fps)||5),(B=o.stream)!=null&&B.quality&&be(Number(o.stream.quality)||50),typeof o.redactionEnabled=="boolean"&&ge(!!o.redactionEnabled),Array.isArray(o.downloads)){const c=o.downloads.map(b=>({name:b.filename||b.name||"download",href:Se(b.href)}));q(c.slice(-10).reverse())}Array.isArray(o.logs)&&de(o.logs.slice(-500)),Array.isArray(o.network)&&ue(o.network.slice(-500))}if(o.type==="tabs"&&(Array.isArray(o.tabs)&&Ie(o.tabs),typeof o.activeTabId=="string"&&Ee(o.activeTabId)),o.type==="stream"&&(typeof o.fps=="number"&&ye(o.fps),typeof o.quality=="number"&&be(o.quality)),o.type==="redaction"&&typeof o.enabled=="boolean"&&ge(!!o.enabled),o.type==="url"&&typeof o.url=="string"&&(!o.tabId||String(o.tabId)===String(Ne.current))&&O(o.url),o.type==="console"&&o.entry&&de(c=>[...c,o.entry].slice(-500)),o.type==="network"&&o.entry&&ue(c=>[...c,o.entry].slice(-500)),o.type==="download"&&o.download){const c=o.download,b={name:c.filename||c.name||"download",href:Se(c.href)};q(k=>[b,...k].slice(0,10))}if(o.type==="screenshot"&&o.href){const c=Se(String(o.href)),b=String(o.href).split("/").pop()||"screenshot.jpg";q(k=>[{name:b,href:c},...k].slice(0,10))}if(o.type==="cursor_move"&&D({x:o.x,y:o.y}),o.type==="cursor_click"){D({x:o.x,y:o.y});const c=document.createElement("div"),b=P.current;c.style.cssText=`
                position: absolute;
                left: ${o.x/b.w*100}%;
                top: ${o.y/b.h*100}%;
                width: 20px; height: 20px;
                background: rgba(255, 0, 0, 0.5);
                border-radius: 50%;
                transform: translate(-50%, -50%);
                pointer-events: none;
                z-index: 100;
                transition: opacity 0.5s;
              `,(g=(u=F.current)==null?void 0:u.parentElement)==null||g.appendChild(c),setTimeout(()=>c.remove(),500)}if(o.type==="action_start"){const c=o.action;let b=c.type;c.type==="goto"&&(b=`Opening ${new URL(c.url).hostname}...`),c.type==="type"&&(b="Typing..."),c.type==="click"&&(b="Clicking..."),c.type==="scroll"&&(b="Scrolling..."),c.type==="screenshot"&&(b="Capturing View..."),E(b)}if(o.type==="action_done"&&setTimeout(()=>E(""),500),o.type==="action_error"&&(E(String(o.error||"Action error")),setTimeout(()=>E(""),1500)),o.type==="frame"){if(_e&&typeof o.jpegBase64=="string"&&qe(c=>[...c,{ts:Number(o.ts||Date.now()),jpegBase64:o.jpegBase64}].slice(-80)),pe||U)return;typeof o.jpegBase64=="string"&&Ke(o.jpegBase64)}o.type==="pick"&&o.element&&(ct(o.element),(w=o.element)!=null&&w.selector&&$e(String(o.element.selector)),(y=o.element)!=null&&y.boundingBox&&G(o.element.boundingBox))}catch{}}}catch(i){A("error"),L(String((i==null?void 0:i.message)||i))}}};return l(),()=>{var i;e=!0,r();try{(i=S.current)==null||i.close()}catch{}S.current=null}},[se,et]);function yt(e){if(!f)return;const r=F.current;if(!r)return;try{r.focus()}catch{}const l=r.getBoundingClientRect(),i=Math.round((e.clientX-l.left)*(x.w/l.width)),s=Math.round((e.clientY-l.top)*(x.h/l.height));a(ne?[{type:"pick",x:i,y:s}]:[{type:"click",x:i,y:s}]),D({x:i,y:s})}function bt(e){if(!f)return;e.preventDefault();const r=Math.round(e.deltaY);a([{type:"scroll",deltaY:r}])}function gt(e){if(!f)return;const r=Date.now();if(r-(te.current||0)<60)return;te.current=r;const l=F.current;if(!l)return;const i=l.getBoundingClientRect(),s=Math.round((e.clientX-i.left)*(x.w/i.width)),p=Math.round((e.clientY-i.top)*(x.h/i.height));D({x:s,y:p}),a([{type:"mouseMove",x:s,y:p,steps:2}])}function xt(e){var d;if(!f)return;const r=F.current,l=(d=e.touches)==null?void 0:d[0];if(!r||!l)return;e.preventDefault();const i=r.getBoundingClientRect(),s=Math.round((l.clientX-i.left)*(x.w/i.width)),p=Math.round((l.clientY-i.top)*(x.h/i.height));a([{type:"click",x:s,y:p}]),D({x:s,y:p})}function ft(e){var h;if(!f)return;const r=Date.now();if(r-(te.current||0)<60)return;te.current=r;const l=F.current,i=(h=e.touches)==null?void 0:h[0];if(!l||!i)return;e.preventDefault();const s=l.getBoundingClientRect(),p=Math.round((i.clientX-s.left)*(x.w/s.width)),d=Math.round((i.clientY-s.top)*(x.h/s.height));D({x:p,y:d}),a([{type:"mouseMove",x:p,y:d,steps:2}])}function mt(){Z.trim()&&(a([{type:"type",text:Z,delay:30,sensitive:ae}]),De(""))}const[je,vt]=n.useState(!1);function wt(e){if(f){if(e.key==="Enter"){e.preventDefault(),a([{type:"press",key:"Enter"}]);return}if(e.key==="Backspace"){e.preventDefault(),a([{type:"press",key:"Backspace"}]);return}if(e.key==="Tab"){e.preventDefault(),a([{type:"press",key:"Tab"}]);return}if(e.key==="Escape"){e.preventDefault(),a([{type:"press",key:"Escape"}]);return}if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight"){e.preventDefault(),a([{type:"press",key:e.key}]);return}e.ctrlKey||e.metaKey||e.altKey||e.key&&e.key.length===1&&(e.preventDefault(),a([{type:"type",text:e.key,delay:0,sensitive:ae}]))}}function Ke(e){const r=new Image;r.onload=()=>{const l=F.current;if(!l)return;const i=P.current;l.width=i.w,l.height=i.h,l.getContext("2d").drawImage(r,0,0,i.w,i.h)},r.src="data:image/jpeg;base64,"+e}n.useEffect(()=>{if(!U)return;const e=I[X];e!=null&&e.jpegBase64&&Ke(e.jpegBase64)},[U,X,I]),n.useEffect(()=>{U&&we(e=>Math.max(0,Math.min(e,Math.max(0,I.length-1))))},[U,I.length]);const kt=Te.length?t.jsxs("div",{className:"agent-browser-tabs glass-panel",style:{display:"flex",alignItems:"center",gap:6,padding:"8px 10px",borderRadius:14,flexWrap:"nowrap",overflowX:"auto",overscrollBehaviorX:"contain"},children:[Te.slice(0,12).map(e=>{const r=String(e.id)===String(_);let l=e.title&&e.title.trim()?e.title:e.url?(()=>{try{return new URL(String(e.url)).hostname}catch{return String(e.url)}})():e.id;return l=String(l).slice(0,28),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[t.jsx("button",{onClick:()=>a([{type:"tab.switch",tabId:e.id}]),className:`agent-browser-tab${r?" active":""}`,dir:"auto",title:e.title||e.url||e.id,children:l}),t.jsx("button",{onClick:()=>a([{type:"tab.close",tabId:e.id}]),className:"agent-browser-tab-close",title:"Close tab",children:"×"})]},e.id)}),t.jsx("button",{onClick:()=>a([{type:"tab.new",url:"about:blank",waitUntil:"domcontentloaded"}]),className:"agent-browser-tab-new",title:"New tab",children:"+"})]}):null,St=t.jsxs("div",{className:"agent-browser-compact-header glass-panel",style:{position:"absolute",top:10,left:10,right:10,zIndex:60,display:"flex",alignItems:"center",gap:8,padding:10,borderRadius:14},children:[t.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:j==="connected"?"var(--accent-success)":j==="reconnecting"?"var(--accent-warning)":"var(--accent-danger)",boxShadow:j==="connected"?"0 0 8px var(--accent-success)":"none",flex:"0 0 auto"}}),t.jsx("button",{onClick:()=>ve(e=>!e),style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:f?"rgba(37, 99, 235, 0.18)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:f?"تحكم: مفعل":"تحكم: متوقف"}),t.jsx("button",{onClick:()=>Oe(e=>!e),disabled:!f,style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:ne?"rgba(234, 179, 8, 0.18)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:f?"pointer":"not-allowed",opacity:f?1:.6,flex:"0 0 auto"},children:ne?"Picker: مفعل":"Picker"}),t.jsx("button",{onClick:()=>a([{type:"goBack"}]),title:"Back",style:{width:34,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:"⟵"}),t.jsx("button",{onClick:()=>a([{type:"goForward"}]),title:"Forward",style:{width:34,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:"⟶"}),t.jsx("button",{onClick:()=>a([{type:"reload"}]),title:"Reload",style:{width:34,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:"⟳"}),t.jsx("input",{type:"text",value:v,onChange:e=>O(e.target.value),onKeyDown:e=>{if(e.key==="Enter"){const r=M(v);r&&a([{type:"goto",url:r,waitUntil:"domcontentloaded"}])}},placeholder:"https://example.com",dir:"auto",style:{flex:"1 1 auto",height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(0,0,0,0.55)",color:"var(--text-primary)",outline:"none",minWidth:140,backdropFilter:"blur(8px)"}}),t.jsx("button",{onClick:()=>{const e=M(v);e&&a([{type:"goto",url:e,waitUntil:"domcontentloaded"}])},style:{height:32,padding:"0 12px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(37, 99, 235, 0.18)",color:"var(--text-primary)",cursor:"pointer",flex:"0 0 auto"},children:"فتح"}),H?t.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)",maxWidth:420},dir:"auto",children:H}):null]});return t.jsxs("div",{ref:Re,className:"agent-browser-stream",style:{display:"flex",flexDirection:"column",gap:m?0:8,position:C?"fixed":"relative",inset:C?12:void 0,zIndex:C?9999:void 0,background:C?"var(--bg-dark)":void 0,padding:C?12:void 0,borderRadius:C?16:void 0,border:C?"1px solid var(--border-color)":void 0,boxShadow:C?"0 12px 50px rgba(0,0,0,0.6)":void 0,height:m?"100%":void 0},children:[m?St:null,m?null:t.jsxs("div",{className:"agent-browser-header glass-panel",style:{display:"flex",alignItems:"center",padding:"10px 12px",borderRadius:14,gap:8,flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,whiteSpace:"nowrap"},children:[t.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:j==="connected"?"var(--accent-success)":j==="reconnecting"?"var(--accent-warning)":"var(--accent-danger)",boxShadow:j==="connected"?"0 0 8px var(--accent-success)":"none"}}),t.jsx("span",{style:{fontSize:12,fontWeight:600,color:"var(--text-primary)"},dir:"auto",children:j==="connected"?"متصل":j}),j==="error"?t.jsx("button",{onClick:()=>tt(e=>e+1),style:{height:28,padding:"0 10px",borderRadius:8,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.04)",color:"var(--text-primary)",cursor:"pointer"},children:"إعادة اتصال"}):null]}),t.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flex:"1 1 420px",minWidth:260},children:[t.jsx("button",{onClick:()=>a([{type:"goBack"}]),title:"Back",style:{width:32,height:32,borderRadius:8,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"⟵"}),t.jsx("button",{onClick:()=>a([{type:"goForward"}]),title:"Forward",style:{width:32,height:32,borderRadius:8,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"⟶"}),t.jsx("button",{onClick:()=>a([{type:"reload"}]),title:"Reload",style:{width:32,height:32,borderRadius:8,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"⟳"}),t.jsx("input",{type:"text",value:v,onChange:e=>O(e.target.value),onKeyDown:e=>{if(e.key==="Enter"){const r=M(v);r&&a([{type:"goto",url:r,waitUntil:"domcontentloaded"}])}},placeholder:"https://example.com",dir:"auto",style:{flex:1,height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.06)",color:"var(--text-primary)",outline:"none",minWidth:200}}),t.jsx("button",{onClick:()=>{const e=M(v);e&&a([{type:"goto",url:e,waitUntil:"domcontentloaded"}])},style:{height:32,padding:"0 12px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(37, 99, 235, 0.12)",color:"var(--text-primary)",cursor:"pointer"},children:"فتح"})]}),t.jsxs("div",{style:{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"},children:[t.jsx("button",{onClick:()=>{const e=M(v);e&&navigator.clipboard&&navigator.clipboard.writeText(e).catch(()=>{})},title:"Copy URL",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"نسخ"}),t.jsx("button",{onClick:()=>{const e=M(v);e&&window.open(e,"_blank","noreferrer")},title:"Open in new tab",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"فتح خارجي"}),t.jsx("button",{onClick:()=>a([{type:"screenshot",fullPage:!1,quality:60}]),title:"Screenshot",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"لقطة"}),t.jsx("button",{onClick:()=>{const e=z[0];e!=null&&e.href&&window.open(e.href,"_blank","noreferrer")},disabled:!((Je=z[0])!=null&&Je.href),title:"Open latest download",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:(Xe=z[0])!=null&&Xe.href?"pointer":"not-allowed",opacity:(Ye=z[0])!=null&&Ye.href?1:.5},children:"تنزيل"}),t.jsx("button",{onClick:()=>Q(e=>Math.max(.5,Number((e-.1).toFixed(2)))),title:"Zoom out",style:{width:32,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"−"}),t.jsxs("button",{onClick:()=>Q(1),title:"Reset zoom",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:[Math.round(Ae*100),"%"]}),t.jsx("button",{onClick:()=>Q(e=>Math.min(2,Number((e+.1).toFixed(2)))),title:"Zoom in",style:{width:32,height:32,borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"+"}),t.jsx("button",{onClick:async()=>{var e;try{document.fullscreenElement?await document.exitFullscreen():await((e=Re.current)==null?void 0:e.requestFullscreen())}catch{}},title:"Fullscreen",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:He?"خروج":"ملء"}),t.jsx("button",{onClick:()=>he(e=>!e),title:"Pause stream",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:pe?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:pe?"تشغيل":"إيقاف"}),t.jsx("button",{onClick:()=>Le(e=>!e),title:"Focus mode",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:C?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"تركيز"}),t.jsx("button",{onClick:()=>ce(e=>!e),title:"Logs",style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:Be?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"سجلات"}),t.jsx("button",{onClick:()=>vt(!je),style:{height:32,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:je?"أقل":"أكثر"})]}),H?t.jsx("div",{style:{width:"100%",fontSize:12,color:"var(--text-secondary)"},dir:"auto",children:H}):null,Me?t.jsx("div",{style:{width:"100%",display:"flex",justifyContent:"center"},children:t.jsx("div",{style:{padding:"4px 12px",background:"rgba(59, 130, 246, 0.15)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:999,color:"#60a5fa",fontSize:12},dir:"auto",children:Me})}):null]}),kt,t.jsx("div",{className:"agent-browser-canvas-frame",style:{border:m?"none":void 0,borderRadius:m?0:16,overflow:"hidden",position:"relative",background:"#000",boxShadow:m?"none":void 0,flex:m?1:void 0},children:t.jsxs("div",{style:{transform:m?"none":`scale(${Ae})`,transformOrigin:"top left",position:"relative"},children:[t.jsx("canvas",{ref:F,onClick:yt,onWheel:bt,onMouseMove:gt,onTouchStart:xt,onTouchMove:ft,tabIndex:f?0:-1,onFocus:()=>Pe(!0),onBlur:()=>Pe(!1),onKeyDown:wt,style:{width:"100%",height:"auto",display:"block",cursor:f?"crosshair":"default",touchAction:"none",outline:"none"}}),m&&f&&!lt?t.jsx("div",{style:{position:"absolute",left:12,bottom:12,zIndex:70,padding:"6px 10px",borderRadius:12,background:"rgba(0,0,0,0.55)",border:"1px solid rgba(255,255,255,0.12)",color:"rgba(255,255,255,0.85)",fontSize:12,backdropFilter:"blur(8px)"},dir:"auto",children:"اضغط داخل المتصفح لتفعيل لوحة المفاتيح"}):null,K&&t.jsx("div",{style:{position:"absolute",left:`${K.x/x.w*100}%`,top:`${K.y/x.h*100}%`,width:`${K.width/x.w*100}%`,height:`${K.height/x.h*100}%`,border:"2px solid #eab308",boxShadow:"0 0 15px rgba(234, 179, 8, 0.4)",pointerEvents:"none",borderRadius:4,transition:"all 0.2s ease"}}),me&&t.jsx("div",{style:{position:"absolute",left:`${me.x/x.w*100}%`,top:`${me.y/x.h*100}%`,transform:"translate(-50%, -50%)",pointerEvents:"none",zIndex:50,transition:"all 0.1s linear"},children:t.jsx("div",{style:{width:12,height:12,borderRadius:"50%",background:"#eab308",border:"2px solid white",boxShadow:"0 2px 4px rgba(0,0,0,0.3)"}})})]})}),!m&&Be?t.jsxs("div",{className:"glass-panel",style:{borderRadius:14,overflow:"hidden"},children:[t.jsxs("div",{style:{display:"flex",gap:8,padding:10,borderBottom:"1px solid var(--border-color)",flexWrap:"wrap",alignItems:"center"},children:[t.jsx("button",{onClick:()=>le("console"),style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:R==="console"?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"Console"}),t.jsx("button",{onClick:()=>le("network"),style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:R==="network"?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"Network"}),t.jsx("button",{onClick:()=>le("downloads"),style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:R==="downloads"?"rgba(37, 99, 235, 0.12)":"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"Downloads"}),t.jsxs("div",{style:{marginInlineStart:"auto",display:"flex",gap:8,alignItems:"center"},children:[t.jsx("button",{onClick:()=>{R==="console"&&de([]),R==="network"&&ue([]),R==="downloads"&&q([])},style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"Clear"}),t.jsx("button",{onClick:()=>ce(!1),style:{height:30,padding:"0 10px",borderRadius:10,border:"1px solid var(--border-color)",background:"rgba(255,255,255,0.03)",color:"var(--text-primary)",cursor:"pointer"},children:"إخفاء"})]})]}),t.jsxs("div",{style:{maxHeight:220,overflow:"auto",padding:10,fontSize:12,color:"var(--text-primary)",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace'},children:[R==="console"?Fe.length?Fe.slice(-200).map((e,r)=>t.jsxs("div",{style:{opacity:.95,padding:"2px 0"},dir:"auto",children:[t.jsx("span",{style:{color:e.level==="error"?"var(--accent-danger)":e.level==="warning"||e.level==="warn"?"var(--accent-warning)":"var(--text-secondary)"},children:new Date(e.ts).toLocaleTimeString()})," ",e.text]},r)):t.jsx("div",{style:{color:"var(--text-secondary)"},children:"لا توجد رسائل"}):null,R==="network"?Ue.length?Ue.slice(-200).map((e,r)=>t.jsxs("div",{style:{opacity:.95,padding:"2px 0"},dir:"auto",children:[t.jsx("span",{style:{color:"var(--text-secondary)"},children:new Date(e.ts).toLocaleTimeString()})," ",t.jsx("span",{style:{color:e.stage==="response"&&typeof e.status=="number"&&e.status>=400?"var(--accent-danger)":"var(--text-primary)"},children:e.method})," ",e.stage==="response"?t.jsx("span",{style:{color:"var(--text-secondary)"},children:e.status??""}):t.jsx("span",{style:{color:"var(--text-secondary)"},children:"→"})," ",e.url]},r)):t.jsx("div",{style:{color:"var(--text-secondary)"},children:"لا توجد طلبات"}):null,R==="downloads"?z.length?z.map((e,r)=>t.jsx("div",{style:{padding:"2px 0"},dir:"auto",children:t.jsx("a",{href:e.href,target:"_blank",rel:"noreferrer",style:{color:"#3b82f6",textDecoration:"none"},children:e.name})},r)):t.jsx("div",{style:{color:"var(--text-secondary)"},children:"لا توجد تنزيلات"}):null]})]}):null,je&&t.jsxs("div",{style:{padding:12,border:"1px solid var(--border-color)",borderRadius:8,background:"var(--bg-secondary)",display:"flex",flexDirection:"column",gap:12},children:[t.jsxs("div",{className:"agent-browser-controls-row",style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[t.jsx("button",{onClick:()=>a([{type:"goBack"}]),className:"btn",title:"Back",children:"⟵"}),t.jsx("button",{onClick:()=>a([{type:"goForward"}]),className:"btn",title:"Forward",children:"⟶"}),t.jsx("button",{onClick:()=>a([{type:"reload"}]),className:"btn",title:"Reload",children:"⟳"}),t.jsx("input",{type:"text",value:v,onChange:e=>O(e.target.value),onKeyDown:e=>{e.key==="Enter"&&v&&a([{type:"goto",url:M(v),waitUntil:"domcontentloaded"}])},placeholder:"https://example.com",style:{flex:1,minWidth:220,padding:"8px 10px",borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-primary)",color:"var(--text-primary)"}}),t.jsx("button",{onClick:()=>v&&a([{type:"goto",url:M(v),waitUntil:"domcontentloaded"}]),className:"btn",children:"Go"}),t.jsx("button",{onClick:()=>a([{type:"tab.new",url:"about:blank",waitUntil:"domcontentloaded"}]),className:"btn",title:"New tab",children:"+Tab"}),t.jsx("button",{onClick:()=>_&&a([{type:"tab.close",tabId:_}]),className:"btn",title:"Close active tab",children:"×Tab"})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:8},children:[t.jsxs("div",{style:{display:"flex",gap:4},children:[t.jsx("input",{type:"text",placeholder:"Upload Selector",value:fe,onChange:e=>ot(e.target.value),style:{flex:1,padding:4,borderRadius:4,border:"1px solid var(--border-color)"}}),t.jsx("input",{type:"file",ref:ze,style:{width:80}}),t.jsx("button",{onClick:ht,className:"btn",children:"Up"})]}),t.jsxs("div",{style:{display:"flex",gap:4},children:[t.jsx("input",{type:ae?"password":"text",value:Z,onChange:e=>De(e.target.value),placeholder:"Type text...",style:{flex:1,padding:4,borderRadius:4,border:"1px solid var(--border-color)"}}),t.jsx("button",{onClick:mt,className:"btn",children:"Type"}),t.jsx("button",{onClick:()=>a([{type:"press",key:"Enter"}]),className:"btn",children:"Ent"})]}),t.jsxs("div",{style:{display:"flex",gap:4},children:[t.jsx("input",{type:"text",value:T,onChange:e=>$e(e.target.value),placeholder:"CSS Selector",style:{flex:1,padding:4,borderRadius:4,border:"1px solid var(--border-color)"}}),t.jsx("button",{onClick:()=>T&&a([{type:"locate",selector:T}]),className:"btn",children:"Loc"}),t.jsx("button",{onClick:()=>T&&a([{type:"click",selector:T}]),className:"btn",children:"Clk"})]})]}),t.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:[t.jsx("input",{type:"checkbox",checked:f,onChange:e=>ve(e.target.checked)}),"تحكم"]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:[t.jsx("input",{type:"checkbox",checked:ne,onChange:e=>Oe(e.target.checked),disabled:!f}),"Picker"]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:[t.jsx("input",{type:"checkbox",checked:ae,onChange:e=>dt(e.target.checked)}),"Login"]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:[t.jsx("input",{type:"checkbox",checked:Ve,onChange:e=>{const r=e.target.checked;ge(r),a([{type:"redaction.set",enabled:r}])}}),"Redaction"]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:["FPS",t.jsx("select",{value:Ze,onChange:e=>{const r=Number(e.target.value);ye(r),a([{type:"stream.setFps",fps:r}])},style:{height:26,borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[2,5,8,10,15,20].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:["جودة",t.jsx("select",{value:Ge,onChange:e=>{const r=Number(e.target.value);be(r),a([{type:"stream.setQuality",quality:r}])},style:{height:26,borderRadius:8,border:"1px solid var(--border-color)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[35,45,50,60,70].map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",fontSize:12,color:"var(--text-secondary)"},children:["Timeline",t.jsx("input",{type:"checkbox",checked:_e,onChange:e=>ut(e.target.checked)})]}),t.jsx("button",{onClick:()=>{pt(e=>!e),he(!0)},className:"btn",children:U?"إغلاق Replay":"Replay"}),t.jsx("button",{onClick:()=>{qe([]),we(0)},className:"btn",children:"مسح"})]}),U&&I.length?t.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[t.jsx("input",{type:"range",min:0,max:Math.max(0,I.length-1),value:Math.min(X,Math.max(0,I.length-1)),onChange:e=>we(Number(e.target.value)),style:{flex:1,minWidth:240}}),t.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)"},dir:"auto",children:I[X]?new Date(I[X].ts).toLocaleTimeString():""})]}):null,N?t.jsxs("div",{style:{fontSize:12,color:"var(--text-secondary)"},dir:"auto",children:["Picked: ",String(N.tag||"")," ",N.id?`#${N.id}`:""," ",N.ariaLabel?`aria="${N.ariaLabel}"`:""," ",N.selector?`sel=${N.selector}`:""]}):null,t.jsxs("div",{style:{fontSize:11,color:"var(--text-secondary)"},children:["DevTools: ",t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:$,onChange:e=>nt(e.target.checked)})," Auto Extract"]})]})]})]})}export{At as default};
